<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>localStorage æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #00ff00;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            background-color: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            cursor: pointer;
        }
        button:hover {
            background-color: #555;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #00ff00;
            background-color: #2a2a2a;
        }
        .log {
            background-color: #000;
            color: #00ff00;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>localStorage åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="status">
        <h3>å½“å‰çŠ¶æ€</h3>
        <p>defaultUserStatus: <span id="currentStatus">æœªè®¾ç½®</span></p>
        <p>localStorage å¯ç”¨: <span id="storageAvailable">æ£€æŸ¥ä¸­...</span></p>
    </div>
    
    <div>
        <h3>æ“ä½œæŒ‰é’®</h3>
        <button onclick="setStatusTrue()">è®¾ç½®ä¸º true (å¯ç”¨)</button>
        <button onclick="setStatusFalse()">è®¾ç½®ä¸º false (ç¦ç”¨)</button>
        <button onclick="clearStatus()">æ¸…é™¤è®¾ç½®</button>
        <button onclick="checkStatus()">æ£€æŸ¥å½“å‰çŠ¶æ€</button>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    </div>
    
    <div class="log" id="log"></div>

    <script>
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function updateStatus() {
            const statusElement = document.getElementById('currentStatus');
            const storageElement = document.getElementById('storageAvailable');
            
            // æ£€æŸ¥ localStorage æ˜¯å¦å¯ç”¨
            const isStorageAvailable = typeof(Storage) !== "undefined";
            storageElement.textContent = isStorageAvailable ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨';
            
            if (isStorageAvailable) {
                const value = localStorage.getItem('defaultUserStatus');
                if (value === null) {
                    statusElement.textContent = 'âŒ æœªè®¾ç½® (null)';
                } else {
                    try {
                        const parsed = JSON.parse(value);
                        statusElement.textContent = `âœ… ${parsed} (${typeof parsed})`;
                    } catch (e) {
                        statusElement.textContent = `âŒ è§£æé”™è¯¯: ${value}`;
                    }
                }
            } else {
                statusElement.textContent = 'âŒ localStorage ä¸å¯ç”¨';
            }
        }

        function setStatusTrue() {
            log('ğŸ”„ å¼€å§‹è®¾ç½® defaultUserStatus ä¸º true');
            try {
                localStorage.setItem('defaultUserStatus', JSON.stringify(true));
                log('âœ… è®¾ç½®æˆåŠŸ');
                
                // ç«‹å³éªŒè¯
                const saved = localStorage.getItem('defaultUserStatus');
                const parsed = saved ? JSON.parse(saved) : null;
                log(`ğŸ” éªŒè¯ç»“æœ: åŸå§‹å€¼="${saved}", è§£æå€¼=${parsed}, ç±»å‹=${typeof parsed}`);
                
                updateStatus();
            } catch (error) {
                log(`âŒ è®¾ç½®å¤±è´¥: ${error.message}`);
            }
        }

        function setStatusFalse() {
            log('ğŸ”„ å¼€å§‹è®¾ç½® defaultUserStatus ä¸º false');
            try {
                localStorage.setItem('defaultUserStatus', JSON.stringify(false));
                log('âœ… è®¾ç½®æˆåŠŸ');
                
                // ç«‹å³éªŒè¯
                const saved = localStorage.getItem('defaultUserStatus');
                const parsed = saved ? JSON.parse(saved) : null;
                log(`ğŸ” éªŒè¯ç»“æœ: åŸå§‹å€¼="${saved}", è§£æå€¼=${parsed}, ç±»å‹=${typeof parsed}`);
                
                updateStatus();
            } catch (error) {
                log(`âŒ è®¾ç½®å¤±è´¥: ${error.message}`);
            }
        }

        function clearStatus() {
            log('ğŸ”„ å¼€å§‹æ¸…é™¤ defaultUserStatus');
            try {
                localStorage.removeItem('defaultUserStatus');
                log('âœ… æ¸…é™¤æˆåŠŸ');
                updateStatus();
            } catch (error) {
                log(`âŒ æ¸…é™¤å¤±è´¥: ${error.message}`);
            }
        }

        function checkStatus() {
            log('ğŸ” æ£€æŸ¥å½“å‰ localStorage çŠ¶æ€:');
            log(`- localStorage å¯ç”¨: ${typeof(Storage) !== "undefined"}`);
            log(`- æ‰€æœ‰é”®: [${Object.keys(localStorage).join(', ')}]`);
            log(`- é”®æ€»æ•°: ${Object.keys(localStorage).length}`);
            
            const value = localStorage.getItem('defaultUserStatus');
            log(`- defaultUserStatus åŸå§‹å€¼: ${value}`);
            log(`- defaultUserStatus å€¼ç±»å‹: ${typeof value}`);
            log(`- defaultUserStatus æ˜¯å¦ä¸ºnull: ${value === null}`);
            
            if (value !== null) {
                try {
                    const parsed = JSON.parse(value);
                    log(`- defaultUserStatus è§£æå€¼: ${parsed}`);
                    log(`- defaultUserStatus è§£æç±»å‹: ${typeof parsed}`);
                } catch (e) {
                    log(`- defaultUserStatus è§£æé”™è¯¯: ${e.message}`);
                }
            }
            
            updateStatus();
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            log('ğŸ“± é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–æ£€æŸ¥');
            checkStatus();
        };
    </script>
</body>
</html>