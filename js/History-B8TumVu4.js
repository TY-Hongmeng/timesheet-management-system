import{r as e,j as s,a9 as t,e as m,i as n,n as r,Y as a,a2 as i,a3 as o,D as l}from"./react-vendor-DJh0NlN6.js";import{u,s as d}from"./index-DXRv2NX8.js";import{t as c}from"./ui-components-C7XcqZ4h.js";import"./vendor-BiPrETSv.js";import"./supabase-BfQEXDvU.js";const h=()=>{const{user:h}=u(),[g,y]=e.useState([]),[N,x]=e.useState([]),[v,b]=e.useState(!0),[p,f]=e.useState({key:"work_date",direction:"desc"}),[w,k]=e.useState({yearMonth:"",startDate:"",endDate:"",userId:""}),[D,j]=e.useState([]),[E,H]=e.useState([]),[V,_]=e.useState(new Set),[$,S]=e.useState(!0),[C,M]=e.useState(!1);e.useEffect(()=>{h&&(I(),q())},[h]),e.useEffect(()=>{P()},[g,w]);const q=async()=>{if(h)try{const{data:e,error:s}=await d.from("timesheet_records").select("user_id, user:users!timesheet_records_user_id_fkey(id, name)").or(`supervisor_id.eq.${h.id},section_chief_id.eq.${h.id}`).neq("status","draft");if(s)return;const t=(null==e?void 0:e.filter(e=>e.user).reduce((e,s)=>{const t=s.user.id;return e.find(e=>e.id===t)||e.push({id:t,name:s.user.name}),e},[]))||[];H(t)}catch(e){}},I=async()=>{if(h)try{b(!0);const{data:e,error:s}=await d.from("timesheet_records").select("\n          *,\n          user:users!timesheet_records_user_id_fkey(id, name),\n          supervisor:users!timesheet_records_supervisor_id_fkey(id, name),\n          section_chief:users!timesheet_records_section_chief_id_fkey(id, name),\n          items:timesheet_record_items(\n            id,\n            process_id,\n            quantity,\n            unit_price,\n            amount,\n            processes:processes!timesheet_record_items_process_id_fkey(\n              product_process,\n              product_name,\n              production_category,\n              production_line,\n              unit_price\n            )\n          ),\n          approval_history(\n            approver_type,\n            approver_name,\n            created_at,\n            approver:approver_id(name)\n          )\n        ").or(`user_id.eq.${h.id},supervisor_id.eq.${h.id},section_chief_id.eq.${h.id}`).neq("status","draft").order("work_date",{ascending:!1}),t=e?e.filter((e,s,t)=>s===t.findIndex(s=>s.id===e.id)):[];if(s)return void c.error("获取历史记录失败");y(t)}catch(e){c.error("获取历史记录失败")}finally{b(!1)}},P=()=>{let e=[...g];if(w.yearMonth){const[s,t]=w.yearMonth.split("-");e=e.filter(e=>{const m=new Date(e.work_date),n=m.getFullYear(),r=m.getMonth()+1;return n===parseInt(s)&&r===parseInt(t)})}w.startDate&&(e=e.filter(e=>e.work_date>=w.startDate)),w.endDate&&(e=e.filter(e=>e.work_date<=w.endDate)),w.userId&&(e=e.filter(e=>e.user_id===w.userId)),p.key&&e.sort((e,s)=>{let t,m;switch(p.key){case"work_date":t=new Date(e.work_date),m=new Date(s.work_date);break;case"status":t=e.status,m=s.status;break;case"created_at":t=new Date(e.created_at),m=new Date(s.created_at);break;default:t=e[p.key],m=s[p.key]}return t<m?"asc"===p.direction?-1:1:t>m?"asc"===p.direction?1:-1:0}),x(e)},Q=e=>{const s=new Set(V);s.has(e)?s.delete(e):s.add(e),_(s)},W=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),z=e=>{const t=(e=>{switch(e){case"pending":return{text:"待班长审核",icon:"⚠",color:"text-yellow-400"};case"approved":return{text:"待段长审核",icon:"⚠",color:"text-blue-400"};case"section_chief_approved":return{text:"已通过",icon:"✓",color:"text-green-400"};default:return{text:"未知",icon:"⚠",color:"text-gray-400"}}})(e);return s.jsxDEV("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ${t.color}`,children:[s.jsxDEV("span",{className:"w-3 h-3 text-center",children:t.icon},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:397,columnNumber:9},void 0),t.text]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:396,columnNumber:7},void 0)},A=(e,s)=>{var t,m;const n=null==(t=e.approval_history)?void 0:t.find(e=>e.approver_type===s);return n?{name:n.approver_name||(null==(m=n.approver)?void 0:m.name)||"未知",date:W(n.created_at)}:null};return N.length,N.filter(e=>"pending"===e.status).length,N.filter(e=>"approved"===e.status).length,N.filter(e=>"section_chief_approved"===e.status).length,(()=>{const e=new Map;return N.forEach(s=>{var t;const m=s.user_id,n=s.work_date,r=(e=>{const s=e.getDay();if(0===s||6===s)return!1;e.getFullYear();const t=e.getMonth()+1,m=e.getDate();return!(1===t&&1===m||2===t&&m>=10&&m<=17||4===t&&m>=4&&m<=6||5===t&&m>=1&&m<=3||6===t&&m>=22&&m<=24||9===t&&m>=15&&m<=17||10===t&&m>=1&&m<=7)})(new Date(n));e.has(m)||e.set(m,{userId:m,userName:(null==(t=s.user)?void 0:t.name)||"未知",workDates:new Set,workingDates:new Set,holidayDates:new Set});const a=e.get(m);a.workDates.add(n),r?a.workingDates.add(n):a.holidayDates.add(n)}),Array.from(e.values()).map(e=>({...e,totalWorkDays:e.workDates.size,actualWorkDays:e.workingDates.size,holidayDays:e.holidayDates.size}))})().reduce((e,s)=>e+s.actualWorkDays,0),v?s.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:s.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:503,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:502,columnNumber:7},void 0):s.jsxDEV("div",{className:"min-h-screen bg-black text-green-300",children:[s.jsxDEV("header",{className:"bg-gray-900 border-b border-green-400 px-6 py-4",children:s.jsxDEV("div",{className:"max-w-7xl mx-auto",children:s.jsxDEV("div",{className:"flex items-center justify-between",children:[s.jsxDEV("h1",{className:"text-2xl font-bold text-green-400 font-mono flex items-center gap-2",children:[s.jsxDEV(t,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:517,columnNumber:15},void 0),"历史记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:516,columnNumber:13},void 0),s.jsxDEV("div",{className:"flex items-center gap-3",children:[s.jsxDEV("button",{onClick:async()=>{M(!0);try{await Promise.all([I(),q()]),c.success("数据刷新成功")}catch(e){c.error("刷新数据失败，请重试")}finally{M(!1)}},disabled:C,className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 disabled:from-gray-700 disabled:to-gray-800 text-green-300 hover:text-green-200 disabled:text-gray-400 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 disabled:border-gray-600",children:[s.jsxDEV(m,{className:"w-4 h-4 "+(C?"animate-spin":"")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:526,columnNumber:17},void 0),s.jsxDEV("span",{className:"hidden sm:inline",children:C?"刷新中...":"刷新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:527,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:521,columnNumber:15},void 0),s.jsxDEV(n,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[s.jsxDEV(r,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:534,columnNumber:17},void 0),s.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:535,columnNumber:17},void 0),s.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:536,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:530,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:520,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:515,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:514,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:513,columnNumber:7},void 0),s.jsxDEV("div",{className:"max-w-7xl mx-auto p-6",children:[s.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg mb-6",children:[s.jsxDEV("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-800 transition-colors",onClick:()=>S(!$),children:[s.jsxDEV("div",{className:"flex items-center gap-2",children:[s.jsxDEV(a,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:552,columnNumber:15},void 0),s.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono",children:"数据筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:553,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:551,columnNumber:13},void 0),s.jsxDEV("div",{className:"flex items-center gap-2",children:[s.jsxDEV("span",{className:"text-sm text-gray-400 font-mono",children:$?"展开筛选":"收起筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:556,columnNumber:15},void 0),$?s.jsxDEV(i,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:560,columnNumber:17},void 0):s.jsxDEV(o,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:562,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:555,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:547,columnNumber:11},void 0),!$&&s.jsxDEV("div",{className:"px-4 pb-4 border-t border-gray-700",children:s.jsxDEV("div",{className:"space-y-4 mt-4",children:[s.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:574,columnNumber:21},void 0),s.jsxDEV("input",{type:"month",value:w.yearMonth,onChange:e=>k({...w,yearMonth:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:577,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:573,columnNumber:19},void 0),s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:586,columnNumber:21},void 0),s.jsxDEV("select",{value:w.userId,onChange:e=>k({...w,userId:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400",children:[s.jsxDEV("option",{value:"",children:"全部员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:594,columnNumber:23},void 0),E.map(e=>s.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:596,columnNumber:25},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:589,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:585,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:572,columnNumber:17},void 0),s.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"开始日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:605,columnNumber:21},void 0),s.jsxDEV("input",{type:"date",value:w.startDate,onChange:e=>k({...w,startDate:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:608,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:604,columnNumber:19},void 0),s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"结束日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:617,columnNumber:21},void 0),s.jsxDEV("input",{type:"date",value:w.endDate,onChange:e=>k({...w,endDate:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:620,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:616,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:603,columnNumber:17},void 0),s.jsxDEV("div",{className:"flex justify-start",children:s.jsxDEV("button",{onClick:()=>{k({yearMonth:"",startDate:"",endDate:"",userId:""}),f({key:"work_date",direction:"desc"}),c.success("筛选条件已重置")},className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 text-green-300 hover:text-green-200 rounded font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 flex items-center gap-2 text-xs sm:text-sm",children:[s.jsxDEV(m,{className:"w-3 h-3 sm:w-4 sm:h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:635,columnNumber:21},void 0),"重置筛选"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:631,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:630,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:570,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:569,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:545,columnNumber:9},void 0),s.jsxDEV("div",{className:"mb-4",children:s.jsxDEV("h2",{className:"text-xl font-bold text-green-400 font-mono flex items-center gap-2",children:[s.jsxDEV(t,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:649,columnNumber:13},void 0),"详细工时记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:648,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:647,columnNumber:9},void 0),0===N.length?s.jsxDEV("div",{className:"bg-gray-900 rounded-lg border border-gray-700 p-8 text-center",children:[s.jsxDEV("div",{className:"text-green-600 mb-4",children:s.jsxDEV(t,{className:"h-16 w-16 mx-auto"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:658,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:657,columnNumber:13},void 0),s.jsxDEV("h3",{className:"text-lg font-medium text-green-400 mb-2 font-mono",children:"暂无历史记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:660,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-green-600 font-mono",children:"请调整筛选条件或添加新的工时记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:661,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:656,columnNumber:11},void 0):s.jsxDEV("div",{className:"space-y-6",children:(()=>{const e=new Map;return N.forEach(s=>{var t;const m=s.user_id;e.has(m)||e.set(m,{userName:(null==(t=s.user)?void 0:t.name)||"未知用户",records:[]}),e.get(m).records.push(s)}),Array.from(e.values()).sort((e,s)=>e.userName.localeCompare(s.userName)).map((e,t)=>{const m=new Map;e.records.forEach(e=>{const s=e.work_date;m.has(s)||m.set(s,[]),m.get(s).push(e)});const n=Array.from(m.keys()).sort((e,s)=>new Date(s).getTime()-new Date(e).getTime()),r=e.records.filter(e=>"pending"===e.status),a=e.records.filter(e=>"approved"===e.status),u=[...new Set(r.map(e=>e.work_date))],d=[...new Set(a.map(e=>e.work_date))],c={supervisorPending:u.length,sectionChiefPending:d.length,totalWorkDays:n.length};return s.jsxDEV("div",{className:"bg-gray-900 rounded-lg border border-gray-700 overflow-hidden",children:[s.jsxDEV("div",{className:"bg-gray-800 px-4 py-3 border-b border-gray-600 cursor-pointer hover:bg-gray-700 transition-colors",onClick:()=>Q(e.userName),children:s.jsxDEV("div",{className:"flex items-center justify-between",children:s.jsxDEV("div",{className:"flex items-center gap-4",children:[s.jsxDEV("h3",{className:"text-lg font-bold text-green-400 font-mono flex items-center gap-2",children:[e.userName,V.has(e.userName)?s.jsxDEV(i,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:733,columnNumber:31},void 0):s.jsxDEV(o,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:735,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:730,columnNumber:27},void 0),s.jsxDEV("div",{className:"flex items-center gap-4 text-xs",children:[s.jsxDEV("div",{className:"text-center",children:[s.jsxDEV("div",{className:"text-yellow-400 font-mono font-bold",children:c.supervisorPending},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:742,columnNumber:31},void 0),s.jsxDEV("div",{className:"text-gray-400 font-mono",children:"班长待审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:743,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:741,columnNumber:29},void 0),s.jsxDEV("div",{className:"text-center",children:[s.jsxDEV("div",{className:"text-orange-400 font-mono font-bold",children:c.sectionChiefPending},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:746,columnNumber:31},void 0),s.jsxDEV("div",{className:"text-gray-400 font-mono",children:"段长待审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:747,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:745,columnNumber:29},void 0),s.jsxDEV("div",{className:"text-center",children:[s.jsxDEV("div",{className:"text-blue-400 font-mono font-bold",children:c.totalWorkDays},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:750,columnNumber:31},void 0),s.jsxDEV("div",{className:"text-gray-400 font-mono",children:"工作天数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:751,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:749,columnNumber:29},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:740,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:729,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:728,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:724,columnNumber:21},void 0),!V.has(e.userName)&&s.jsxDEV("div",{className:"p-4 space-y-4",children:n.map(t=>{const n=m.get(t),r=`${e.userName}-${t}`,a=V.has(r);return s.jsxDEV("div",{className:"space-y-3",children:[s.jsxDEV("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>Q(r),children:[s.jsxDEV("div",{className:"w-2 h-2 bg-green-400 rounded-full"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:773,columnNumber:33},void 0),s.jsxDEV("h4",{className:"text-md font-semibold text-green-300 font-mono flex items-center gap-2",children:[W(t),a?s.jsxDEV(i,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:777,columnNumber:37},void 0):s.jsxDEV(o,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:779,columnNumber:37},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:774,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:769,columnNumber:31},void 0),!a&&s.jsxDEV("div",{className:"space-y-2",children:n.map(e=>e.items.map((t,m)=>{var n,r,a;return s.jsxDEV("div",{className:"bg-gray-800 rounded-lg p-3 border border-gray-600 hover:border-gray-500 transition-colors",children:s.jsxDEV("div",{className:"space-y-3",children:[s.jsxDEV("div",{className:"flex justify-between items-start gap-3",children:[s.jsxDEV("div",{className:"flex-1",children:[s.jsxDEV("div",{className:"text-xs text-gray-400 font-mono mb-1",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:794,columnNumber:47},void 0),s.jsxDEV("div",{className:"text-sm text-green-300 font-mono break-words",children:`${(null==(n=t.processes)?void 0:n.production_line)||"未知"} - ${(null==(r=t.processes)?void 0:r.product_name)||"未知"} - ${(null==(a=t.processes)?void 0:a.product_process)||"未知"}`},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:795,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:793,columnNumber:45},void 0),s.jsxDEV("div",{className:"text-right",children:[s.jsxDEV("div",{className:"text-xs text-gray-400 font-mono mb-1",children:"数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:800,columnNumber:47},void 0),s.jsxDEV("div",{className:"text-sm text-yellow-400 font-mono font-semibold",children:t.quantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:801,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:799,columnNumber:45},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:792,columnNumber:43},void 0),s.jsxDEV("div",{className:"flex justify-between items-start gap-2 text-xs",children:[s.jsxDEV("div",{className:"flex gap-4 flex-1",children:[s.jsxDEV("div",{className:"flex-1",children:[s.jsxDEV("div",{className:"text-gray-400 font-mono mb-1",children:"班长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:811,columnNumber:49},void 0),s.jsxDEV("div",{className:"text-green-300 font-mono",children:(()=>{var t;const m=A(e,"supervisor"),n=(null==(t=e.supervisor)?void 0:t.name)||"未分配";return m?s.jsxDEV("div",{className:"flex flex-col",children:[s.jsxDEV("div",{className:"truncate",children:m.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:819,columnNumber:59},void 0),s.jsxDEV("div",{className:"text-xs text-gray-400",children:m.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:820,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:818,columnNumber:57},void 0):s.jsxDEV("div",{className:"truncate",children:n},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:824,columnNumber:60},void 0)})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:812,columnNumber:49},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:810,columnNumber:47},void 0),s.jsxDEV("div",{className:"flex-1",children:[s.jsxDEV("div",{className:"text-gray-400 font-mono mb-1",children:"段长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:829,columnNumber:49},void 0),s.jsxDEV("div",{className:"text-green-300 font-mono",children:(()=>{var t;const m=A(e,"section_chief"),n=(null==(t=e.section_chief)?void 0:t.name)||"未分配";return m?s.jsxDEV("div",{className:"flex flex-col",children:[s.jsxDEV("div",{className:"truncate",children:m.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:837,columnNumber:59},void 0),s.jsxDEV("div",{className:"text-xs text-gray-400",children:m.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:838,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:836,columnNumber:57},void 0):s.jsxDEV("div",{className:"truncate",children:n},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:842,columnNumber:60},void 0)})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:830,columnNumber:49},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:828,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:809,columnNumber:45},void 0),s.jsxDEV("div",{className:"text-right",children:[s.jsxDEV("div",{className:"text-gray-400 font-mono mb-1",children:"状态"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:848,columnNumber:47},void 0),s.jsxDEV("div",{className:"flex items-center justify-end",children:z(e.status)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:849,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:847,columnNumber:45},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:808,columnNumber:43},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:790,columnNumber:41},void 0)},`${e.id}-${m}`,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:789,columnNumber:39},void 0)}))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:786,columnNumber:33},void 0)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:767,columnNumber:29},void 0)})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:760,columnNumber:23},void 0),!V.has(e.userName)&&(()=>{const t=e.records.flatMap(e=>e.items.map(s=>({...s,workDate:e.work_date}))),m=new Map;t.forEach(e=>{var s,t,n,r,a,i,o;const l=`${(null==(s=e.processes)?void 0:s.production_line)||"未知"}-${(null==(t=e.processes)?void 0:t.product_name)||"未知"}-${(null==(n=e.processes)?void 0:n.product_process)||"未知"}`;m.has(l)||m.set(l,{productionLine:(null==(r=e.processes)?void 0:r.production_line)||"未知",productName:(null==(a=e.processes)?void 0:a.product_name)||"未知",productProcess:(null==(i=e.processes)?void 0:i.product_process)||"未知",productionCategory:(null==(o=e.processes)?void 0:o.production_category)||"未知",totalQuantity:0,recordCount:0});const u=m.get(l);u.totalQuantity+=e.quantity,u.recordCount+=1});const n=Array.from(m.values()).sort((e,s)=>s.totalQuantity-e.totalQuantity);return 0===n.length?null:s.jsxDEV("div",{className:"mt-4 bg-gray-900 rounded-lg p-3 border border-gray-600",children:[s.jsxDEV("h6",{className:"text-sm font-bold text-blue-400 font-mono mb-3 flex items-center gap-2",children:[s.jsxDEV(l,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:910,columnNumber:29},void 0),e.userName," - 数量统计汇总"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:909,columnNumber:27},void 0),s.jsxDEV("div",{className:"w-full",children:s.jsxDEV("table",{className:"w-full table-fixed",children:[s.jsxDEV("thead",{className:"bg-gray-800",children:s.jsxDEV("tr",{children:[s.jsxDEV("th",{className:"px-1 py-2 text-left text-blue-400 font-mono text-xs w-[50%] sm:w-[60%]",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:918,columnNumber:35},void 0),s.jsxDEV("th",{className:"px-1 py-2 text-left text-blue-400 font-mono text-xs w-[25%] sm:w-[20%]",children:"数量总计"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:919,columnNumber:35},void 0),s.jsxDEV("th",{className:"px-1 py-2 text-left text-blue-400 font-mono text-xs w-[25%] sm:w-[20%]",children:"记录条数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:920,columnNumber:35},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:917,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:916,columnNumber:31},void 0),s.jsxDEV("tbody",{children:n.map((e,t)=>s.jsxDEV("tr",{className:"border-b border-gray-700 hover:bg-gray-800 transition-colors",children:[s.jsxDEV("td",{className:"px-1 py-2 text-green-300 font-mono text-xs",children:s.jsxDEV("div",{className:"break-words text-xs leading-tight",children:`${e.productionLine} - ${e.productName} - ${e.productProcess}`},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:927,columnNumber:39},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:926,columnNumber:37},void 0),s.jsxDEV("td",{className:"px-1 py-2 text-yellow-400 font-mono text-xs font-bold",children:e.totalQuantity.toFixed(1)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:931,columnNumber:37},void 0),s.jsxDEV("td",{className:"px-1 py-2 text-blue-400 font-mono text-xs",children:e.recordCount},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:934,columnNumber:37},void 0)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:925,columnNumber:35},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:923,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:915,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:914,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:908,columnNumber:25},void 0)})()]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:722,columnNumber:19},void 0)})})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:664,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:543,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:511,columnNumber:5},void 0)};export{h as default};
