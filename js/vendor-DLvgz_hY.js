import{g as t,c as e}from"./react-vendor-DNzT5kIg.js";var r,i={exports:{}},n={};r=n,function(){function t(t,e){var r=t.length;t.push(e),function(t,e,r){for(var i=r;i>0;){var s=i-1>>>1,o=t[s];if(0>=n(o,e))return;t[s]=e,t[i]=o,i=s}}(t,e,r)}function e(t){return 0===t.length?null:t[0]}function i(t){if(0===t.length)return null;var e=t[0],r=t.pop();return r!==e&&(t[0]=r,function(t,e){for(var r=0,i=t.length,s=i>>>1;s>r;){var o=2*(r+1)-1,a=t[o],l=o+1,c=t[l];if(0>n(a,e))i>l&&0>n(c,a)?(t[r]=c,t[l]=e,r=l):(t[r]=a,t[o]=e,r=o);else{if(l>=i||n(c,e)>=0)return;t[r]=c,t[l]=e,r=l}}}(t,r)),e}function n(t,e){var r=t.sortIndex-e.sortIndex;return 0!==r?r:t.id-e.id}if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error()),"object"==typeof performance&&"function"==typeof performance.now){var s=performance;r.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,d=3,f=!1,v=!1,w=!1,p="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function g(r){for(var n=e(c);null!==n;){if(null===n.callback)i(c);else{if(n.startTime>r)return;i(c),n.sortIndex=n.expirationTime,t(l,n)}n=e(c)}}function m(t){if(w=!1,g(t),!v)if(null!==e(l))v=!0,x(_);else{var r=e(c);null!==r&&N(m,r.startTime-t)}}function _(t,n){v=!1,w&&(w=!1,U()),f=!0;var s=d;try{return function(t,n){var s=n;for(g(s),h=e(l);null!==h&&(h.expirationTime<=s||t&&!k());){var o=h.callback;if("function"==typeof o){h.callback=null,d=h.priorityLevel;var a=o(h.expirationTime<=s);s=r.unstable_now(),"function"==typeof a?h.callback=a:h===e(l)&&i(l),g(s)}else i(l);h=e(l)}if(null!==h)return!0;var u=e(c);return null!==u&&N(m,u.startTime-s),!1}(t,n)}finally{h=null,d=s,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var O=!1,E=null,S=-1,T=5,j=-1;function k(){return r.unstable_now()-j>=T}var A,I=function(){if(null!==E){var t=r.unstable_now();j=t;var e=!0;try{e=E(!0,t)}finally{e?A():(O=!1,E=null)}}else O=!1};if("function"==typeof b)A=function(){b(I)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,P=R.port2;R.port1.onmessage=I,A=function(){P.postMessage(null)}}else A=function(){p(I,0)};function x(t){E=t,O||(O=!0,A())}function N(t,e){S=p(function(){t(r.unstable_now())},e)}function U(){y(S),S=-1}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(t){t.callback=null},r.unstable_continueExecution=function(){v||f||(v=!0,x(_))},r.unstable_forceFrameRate=function(t){0>t||t>125||(T=t>0?Math.floor(1e3/t):5)},r.unstable_getCurrentPriorityLevel=function(){return d},r.unstable_getFirstCallbackNode=function(){return e(l)},r.unstable_next=function(t){var e;switch(d){case 1:case 2:case 3:e=3;break;default:e=d}var r=d;d=e;try{return t()}finally{d=r}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var r=d;d=t;try{return e()}finally{d=r}},r.unstable_scheduleCallback=function(i,n,s){var o,a,h=r.unstable_now();if("object"==typeof s&&null!==s){var d=s.delay;o="number"==typeof d&&d>0?h+d:h}else o=h;switch(i){case 1:a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}var p=o+a,y={id:u++,callback:n,priorityLevel:i,startTime:o,expirationTime:p,sortIndex:-1};return o>h?(y.sortIndex=o,t(c,y),null===e(l)&&y===e(c)&&(w?U():w=!0,N(m,o-h))):(y.sortIndex=p,t(l,y),v||f||(v=!0,x(_))),y},r.unstable_shouldYield=k,r.unstable_wrapCallback=function(t){var e=d;return function(){var r=d;d=e;try{return t.apply(this,arguments)}finally{d=r}}},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}(),i.exports=n;var s=i.exports;const o={},a=function(t,e,r){let i=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),r=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));i=Promise.allSettled(e.map(t=>{if((t=function(t){return"/timesheet-management-system/"+t}(t))in o)return;o[t]=!0;const e=t.endsWith(".css"),i=e?'[rel="stylesheet"]':"";if(document.querySelector('link[href="'.concat(t,'"]').concat(i)))return;const n=document.createElement("link");return n.rel=e?"stylesheet":"modulepreload",e||(n.as="script"),n.crossOrigin="",n.href=t,r&&n.setAttribute("nonce",r),document.head.appendChild(n),e?new Promise((e,r)=>{n.addEventListener("load",e),n.addEventListener("error",()=>r(Error("Unable to preload CSS for ".concat(t))))}):void 0}))}function n(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return i.then(e=>{for(const t of e||[])"rejected"===t.status&&n(t.reason);return t().catch(n)})};class l extends Error{constructor(t,e="FunctionsError",r){super(t),this.name=e,this.context=r}}class c extends l{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class u extends l{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class h extends l{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var d,f;(f=d||(d={})).Any="any",f.ApNortheast1="ap-northeast-1",f.ApNortheast2="ap-northeast-2",f.ApSouth1="ap-south-1",f.ApSoutheast1="ap-southeast-1",f.ApSoutheast2="ap-southeast-2",f.CaCentral1="ca-central-1",f.EuCentral1="eu-central-1",f.EuWest1="eu-west-1",f.EuWest2="eu-west-2",f.EuWest3="eu-west-3",f.SaEast1="sa-east-1",f.UsEast1="us-east-1",f.UsWest1="us-west-1",f.UsWest2="us-west-2";class v{constructor(t,{headers:e={},customFetch:r,region:i=d.Any}={}){this.url=t,this.headers=e,this.region=i,this.fetch=(t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>a(async()=>{const{default:t}=await Promise.resolve().then(()=>k);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)})(r)}setAuth(t){this.headers.Authorization="Bearer ".concat(t)}invoke(t){return e=this,r=arguments,n=function*(t,e={}){var r;try{const{headers:i,method:n,body:s,signal:o}=e;let a={},{region:l}=e;l||(l=this.region);const d=new URL("".concat(this.url,"/").concat(t));let f;l&&"any"!==l&&(a["x-region"]=l,d.searchParams.set("forceFunctionRegion",l)),s&&(i&&!{}.hasOwnProperty.call(i,"Content-Type")||!i)&&("undefined"!=typeof Blob&&s instanceof Blob||s instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",f=s):"string"==typeof s?(a["Content-Type"]="text/plain",f=s):"undefined"!=typeof FormData&&s instanceof FormData?f=s:(a["Content-Type"]="application/json",f=JSON.stringify(s)));const v=yield this.fetch(d.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),i),body:f,signal:o}).catch(t=>{if("AbortError"===t.name)throw t;throw new c(t)}),w=v.headers.get("x-relay-error");if(w&&"true"===w)throw new u(v);if(!v.ok)throw new h(v);let p,y=(null!==(r=v.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return p="application/json"===y?yield v.json():"application/octet-stream"===y?yield v.blob():"text/event-stream"===y?v:"multipart/form-data"===y?yield v.formData():yield v.text(),{data:p,error:null,response:v}}catch(i){return i instanceof Error&&"AbortError"===i.name?{data:null,error:new c(i)}:{data:null,error:i,response:i instanceof h||i instanceof u?i.context:void 0}}},new((i=void 0)||(i=Promise))(function(t,s){function o(t){try{l(n.next(t))}catch(e){s(e)}}function a(t){try{l(n.throw(t))}catch(e){s(e)}}function l(e){var r;e.done?t(e.value):(r=e.value,r instanceof i?r:new i(function(t){t(r)})).then(o,a)}l((n=n.apply(e,r||[])).next())});var e,r,i,n}}var w={},p={},y={},b={},g={},m={},_=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof globalThis)return globalThis;throw Error("unable to locate global object")}();const O=_.fetch,E=_.fetch.bind(_),S=_.Headers,T=_.Request,j=_.Response,k=Object.freeze(Object.defineProperty({__proto__:null,Headers:S,Request:T,Response:j,default:E,fetch:O},Symbol.toStringTag,{value:"Module"})),A=t(k);var I={};Object.defineProperty(I,"t",{value:!0}),I.default=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};var R=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(m,"t",{value:!0});const P=R(A),x=R(I);m.default=class{constructor(t){var e,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=null!==(e=t.shouldThrowOnError)&&void 0!==e&&e,this.signal=t.signal,this.isMaybeSingle=null!==(r=t.isMaybeSingle)&&void 0!==r&&r,t.fetch?this.fetch=t.fetch:"undefined"==typeof fetch?this.fetch=P.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async t=>{var e,r,i,n;let s=null,o=null,a=null,l=t.status,c=t.statusText;if(t.ok){if("HEAD"!==this.method){const r=await t.text();""===r||(o="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(e=this.headers.get("Accept"))||void 0===e?void 0:e.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}const n=null===(r=this.headers.get("Prefer"))||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),u=null===(i=t.headers.get("content-range"))||void 0===i?void 0:i.split("/");n&&u&&u.length>1&&(a=parseInt(u[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(s={code:"PGRST116",details:"Results contain ".concat(o.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,l=406,c="Not Acceptable"):o=1===o.length?o[0]:null)}else{const e=await t.text();try{s=JSON.parse(e),Array.isArray(s)&&404===t.status&&(o=[],s=null,l=200,c="OK")}catch(u){404===t.status&&""===e?(l=204,c="No Content"):s={message:e}}if(s&&this.isMaybeSingle&&(null===(n=null==s?void 0:s.details)||void 0===n?void 0:n.includes("0 rows"))&&(s=null,l=200,c="OK"),s&&this.shouldThrowOnError)throw new x.default(s)}return{error:s,data:o,count:a,status:l,statusText:c}});return this.shouldThrowOnError||(r=r.catch(t=>{var e,r,i;return{error:{message:"".concat(null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"FetchError",": ").concat(null==t?void 0:t.message),details:"".concat(null!==(r=null==t?void 0:t.stack)&&void 0!==r?r:""),hint:"",code:"".concat(null!==(i=null==t?void 0:t.code)&&void 0!==i?i:"")},data:null,count:null,status:0,statusText:""}})),r.then(t,e)}returns(){return this}overrideTypes(){return this}};var N=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(g,"t",{value:!0});const U=N(m);let C=class extends U.default{select(t){let e=!1;const r=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:i,referencedTable:n=i}={}){const s=n?"".concat(n,".order"):"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,"".concat(o?"".concat(o,","):"").concat(t,".").concat(e?"asc":"desc").concat(void 0===r?"":r?".nullsfirst":".nullslast")),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const i=void 0===r?"limit":"".concat(r,".limit");return this.url.searchParams.set(i,"".concat(t)),this}range(t,e,{foreignTable:r,referencedTable:i=r}={}){const n=void 0===i?"offset":"".concat(i,".offset"),s=void 0===i?"limit":"".concat(i,".limit");return this.url.searchParams.set(n,"".concat(t)),this.url.searchParams.set(s,"".concat(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:i=!1,wal:n=!1,format:s="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,r?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(s,'; for="').concat(l,'"; options=').concat(a,";")),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(t)),this}};g.default=C;var D=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(b,"t",{value:!0});const L=D(g);let B=class extends L.default{eq(t,e){return this.url.searchParams.append(t,"eq.".concat(e)),this}neq(t,e){return this.url.searchParams.append(t,"neq.".concat(e)),this}gt(t,e){return this.url.searchParams.append(t,"gt.".concat(e)),this}gte(t,e){return this.url.searchParams.append(t,"gte.".concat(e)),this}lt(t,e){return this.url.searchParams.append(t,"lt.".concat(e)),this}lte(t,e){return this.url.searchParams.append(t,"lte.".concat(e)),this}like(t,e){return this.url.searchParams.append(t,"like.".concat(e)),this}likeAllOf(t,e){return this.url.searchParams.append(t,"like(all).{".concat(e.join(","),"}")),this}likeAnyOf(t,e){return this.url.searchParams.append(t,"like(any).{".concat(e.join(","),"}")),this}ilike(t,e){return this.url.searchParams.append(t,"ilike.".concat(e)),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,"ilike(all).{".concat(e.join(","),"}")),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,"ilike(any).{".concat(e.join(","),"}")),this}is(t,e){return this.url.searchParams.append(t,"is.".concat(e)),this}in(t,e){const r=Array.from(new Set(e)).map(t=>"string"==typeof t&&RegExp("[,()]").test(t)?'"'.concat(t,'"'):"".concat(t)).join(",");return this.url.searchParams.append(t,"in.(".concat(r,")")),this}contains(t,e){return"string"==typeof e?this.url.searchParams.append(t,"cs.".concat(e)):Array.isArray(e)?this.url.searchParams.append(t,"cs.{".concat(e.join(","),"}")):this.url.searchParams.append(t,"cs.".concat(JSON.stringify(e))),this}containedBy(t,e){return"string"==typeof e?this.url.searchParams.append(t,"cd.".concat(e)):Array.isArray(e)?this.url.searchParams.append(t,"cd.{".concat(e.join(","),"}")):this.url.searchParams.append(t,"cd.".concat(JSON.stringify(e))),this}rangeGt(t,e){return this.url.searchParams.append(t,"sr.".concat(e)),this}rangeGte(t,e){return this.url.searchParams.append(t,"nxl.".concat(e)),this}rangeLt(t,e){return this.url.searchParams.append(t,"sl.".concat(e)),this}rangeLte(t,e){return this.url.searchParams.append(t,"nxr.".concat(e)),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,"adj.".concat(e)),this}overlaps(t,e){return"string"==typeof e?this.url.searchParams.append(t,"ov.".concat(e)):this.url.searchParams.append(t,"ov.{".concat(e.join(","),"}")),this}textSearch(t,e,{config:r,type:i}={}){let n="";"plain"===i?n="pl":"phrase"===i?n="ph":"websearch"===i&&(n="w");const s=void 0===r?"":"(".concat(r,")");return this.url.searchParams.append(t,"".concat(n,"fts").concat(s,".").concat(e)),this}match(t){return Object.entries(t).forEach(([t,e])=>{this.url.searchParams.append(t,"eq.".concat(e))}),this}not(t,e,r){return this.url.searchParams.append(t,"not.".concat(e,".").concat(r)),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const i=r?"".concat(r,".or"):"or";return this.url.searchParams.append(i,"(".concat(t,")")),this}filter(t,e,r){return this.url.searchParams.append(t,"".concat(e,".").concat(r)),this}};b.default=B;var W=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(y,"t",{value:!0});const G=W(b);y.default=class{constructor(t,{headers:e={},schema:r,fetch:i}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=i}select(t,e){const{head:r=!1,count:i}=null!=e?e:{},n=r?"HEAD":"GET";let s=!1;const o=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!s?"":('"'===t&&(s=!s),t)).join("");return this.url.searchParams.set("select",o),i&&this.headers.append("Prefer","count=".concat(i)),new G.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:r=!0}={}){var i;if(e&&this.headers.append("Prefer","count=".concat(e)),r||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>'"'.concat(t,'"'));this.url.searchParams.set("columns",t.join(","))}}return new G.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:i,defaultToNull:n=!0}={}){var s;if(this.headers.append("Prefer","resolution=".concat(r?"ignore":"merge","-duplicates")),void 0!==e&&this.url.searchParams.set("on_conflict",e),i&&this.headers.append("Prefer","count=".concat(i)),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>'"'.concat(t,'"'));this.url.searchParams.set("columns",t.join(","))}}return new G.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}update(t,{count:e}={}){var r;return e&&this.headers.append("Prefer","count=".concat(e)),new G.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:t}={}){var e;return t&&this.headers.append("Prefer","count=".concat(t)),new G.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(e=this.fetch)&&void 0!==e?e:fetch})}};var q=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(p,"t",{value:!0});const F=q(y),J=q(b);p.default=class t{constructor(t,{headers:e={},schema:r,fetch:i}={}){this.url=t,this.headers=new Headers(e),this.schemaName=r,this.fetch=i}from(t){const e=new URL("".concat(this.url,"/").concat(t));return new F.default(e,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new t(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(t,e={},{head:r=!1,get:i=!1,count:n}={}){var s;let o;const a=new URL("".concat(this.url,"/rpc/").concat(t));let l;r||i?(o=r?"HEAD":"GET",Object.entries(e).filter(([t,e])=>void 0!==e).map(([t,e])=>[t,Array.isArray(e)?"{".concat(e.join(","),"}"):"".concat(e)]).forEach(([t,e])=>{a.searchParams.append(t,e)})):(o="POST",l=e);const c=new Headers(this.headers);return n&&c.set("Prefer","count=".concat(n)),new J.default({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}};var M=e&&e.i||function(t){return t&&t.t?t:{default:t}};Object.defineProperty(w,"t",{value:!0}),w.PostgrestError=w.PostgrestBuilder=w.PostgrestTransformBuilder=w.PostgrestFilterBuilder=w.PostgrestQueryBuilder=w.PostgrestClient=void 0;const H=M(p);w.PostgrestClient=H.default;const K=M(y);w.PostgrestQueryBuilder=K.default;const V=M(b);w.PostgrestFilterBuilder=V.default;const z=M(g);w.PostgrestTransformBuilder=z.default;const Y=M(m);w.PostgrestBuilder=Y.default;const $=M(I);w.PostgrestError=$.default;var Q=w.default={PostgrestClient:H.default,PostgrestQueryBuilder:K.default,PostgrestFilterBuilder:V.default,PostgrestTransformBuilder:z.default,PostgrestBuilder:Y.default,PostgrestError:$.default};const{PostgrestClient:X,PostgrestQueryBuilder:Z,PostgrestFilterBuilder:tt,PostgrestTransformBuilder:et,PostgrestBuilder:rt,PostgrestError:it}=Q;class nt{static detectEnvironment(){var t;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(t=navigator.userAgent)||void 0===t?void 0:t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const t=process.versions;if(t&&t.node){const e=t.node,r=parseInt(e.replace(/^v/,"").split(".")[0]);return 22>r?{type:"unsupported",error:"Node.js ".concat(r," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}:void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(r," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+="\n\nSuggested solution: ".concat(t.workaround)),Error(e)}static createWebSocket(t,e){return new(this.getWebSocketConstructor())(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return"native"===t.type||"ws"===t.type}catch(t){return!1}}}var st,ot,at,lt,ct,ut,ht,dt,ft,vt,wt;(ot=st||(st={}))[ot.connecting=0]="connecting",ot[ot.open=1]="open",ot[ot.closing=2]="closing",ot[ot.closed=3]="closed",(lt=at||(at={})).closed="closed",lt.errored="errored",lt.joined="joined",lt.joining="joining",lt.leaving="leaving",(ut=ct||(ct={})).close="phx_close",ut.error="phx_error",ut.join="phx_join",ut.reply="phx_reply",ut.leave="phx_leave",ut.access_token="access_token",(ht||(ht={})).websocket="websocket",(ft=dt||(dt={})).Connecting="connecting",ft.Open="open",ft.Closing="closing",ft.Closed="closed";class pt{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this.o(t)):e("string"==typeof t?JSON.parse(t):{})}o(t){const e=new DataView(t),r=new TextDecoder;return this.l(t,e,r)}l(t,e,r){const i=e.getUint8(1),n=e.getUint8(2);let s=this.HEADER_LENGTH+2;const o=r.decode(t.slice(s,s+i));s+=i;const a=r.decode(t.slice(s,s+n));return s+=n,{ref:null,topic:o,event:a,payload:JSON.parse(r.decode(t.slice(s,t.byteLength)))}}}class yt{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(wt=vt||(vt={})).abstime="abstime",wt.bool="bool",wt.date="date",wt.daterange="daterange",wt.float4="float4",wt.float8="float8",wt.int2="int2",wt.int4="int4",wt.int4range="int4range",wt.int8="int8",wt.int8range="int8range",wt.json="json",wt.jsonb="jsonb",wt.money="money",wt.numeric="numeric",wt.oid="oid",wt.reltime="reltime",wt.text="text",wt.time="time",wt.timestamp="timestamp",wt.timestamptz="timestamptz",wt.timetz="timetz",wt.tsrange="tsrange",wt.tstzrange="tstzrange";const bt=(t,e,r={})=>{var i;const n=null!==(i=r.skipTypes)&&void 0!==i?i:[];return e?Object.keys(e).reduce((r,i)=>(r[i]=gt(i,t,e,n),r),{}):{}},gt=(t,e,r,i)=>{const n=e.find(e=>e.name===t),s=null==n?void 0:n.type,o=r[t];return s&&!i.includes(s)?mt(s,o):_t(o)},mt=(t,e)=>{if("_"===t.charAt(0)){const r=t.slice(1,t.length);return Tt(e,r)}switch(t){case vt.bool:return Ot(e);case vt.float4:case vt.float8:case vt.int2:case vt.int4:case vt.int8:case vt.numeric:case vt.oid:return Et(e);case vt.json:case vt.jsonb:return St(e);case vt.timestamp:return jt(e);case vt.abstime:case vt.date:case vt.daterange:case vt.int4range:case vt.int8range:case vt.money:case vt.reltime:case vt.text:case vt.time:case vt.timestamptz:case vt.timetz:case vt.tsrange:case vt.tstzrange:default:return _t(e)}},_t=t=>t,Ot=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Et=t=>{if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},St=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t},Tt=(t,e)=>{if("string"!=typeof t)return t;const r=t.length-1,i=t[r];if("{"===t[0]&&"}"===i){let i;const s=t.slice(1,r);try{i=JSON.parse("["+s+"]")}catch(n){i=s?s.split(","):[]}return i.map(t=>mt(e,t))}return t},jt=t=>"string"==typeof t?t.replace(" ","T"):t,kt=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class At{constructor(t,e,r={},i=1e4){this.channel=t,this.event=e,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this.u(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this.h("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel.v()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var r;return this.h(t)&&e(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket.p(),this.refEvent=this.channel.m(this.ref),this.channel._(this.refEvent,{},t=>{this.u(),this.O(),this.receivedResp=t,this.S(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(t,e){this.refEvent&&this.channel.T(this.refEvent,{status:t,response:e})}destroy(){this.u(),this.O()}u(){this.refEvent&&this.channel.j(this.refEvent,{})}O(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}S({status:t,response:e}){this.recHooks.filter(e=>e.status===t).forEach(t=>t.callback(e))}h(t){return this.receivedResp&&this.receivedResp.status===t}}var It,Rt,Pt,xt,Nt,Ut,Ct,Dt;(Rt=It||(It={})).SYNC="sync",Rt.JOIN="join",Rt.LEAVE="leave";class Lt{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._(r.state,{},t=>{const{onJoin:e,onLeave:r,onSync:i}=this.caller;this.joinRef=this.channel.v(),this.state=Lt.syncState(this.state,t,e,r),this.pendingDiffs.forEach(t=>{this.state=Lt.syncDiff(this.state,t,e,r)}),this.pendingDiffs=[],i()}),this.channel._(r.diff,{},t=>{const{onJoin:e,onLeave:r,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=Lt.syncDiff(this.state,t,e,r),i())}),this.onJoin((t,e,r)=>{this.channel.T("presence",{event:"join",key:t,currentPresences:e,newPresences:r})}),this.onLeave((t,e,r)=>{this.channel.T("presence",{event:"leave",key:t,currentPresences:e,leftPresences:r})}),this.onSync(()=>{this.channel.T("presence",{event:"sync"})})}static syncState(t,e,r,i){const n=this.cloneDeep(t),s=this.transformState(e),o={},a={};return this.map(n,(t,e)=>{s[t]||(a[t]=e)}),this.map(s,(t,e)=>{const r=n[t];if(r){const i=e.map(t=>t.presence_ref),n=r.map(t=>t.presence_ref),s=e.filter(t=>0>n.indexOf(t.presence_ref)),l=r.filter(t=>0>i.indexOf(t.presence_ref));s.length>0&&(o[t]=s),l.length>0&&(a[t]=l)}else o[t]=e}),this.syncDiff(n,{joins:o,leaves:a},r,i)}static syncDiff(t,e,r,i){const{joins:n,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(n,(e,i)=>{var n;const s=null!==(n=t[e])&&void 0!==n?n:[];if(t[e]=this.cloneDeep(i),s.length>0){const r=t[e].map(t=>t.presence_ref),i=s.filter(t=>0>r.indexOf(t.presence_ref));t[e].unshift(...i)}r(e,s,i)}),this.map(s,(e,r)=>{let n=t[e];if(!n)return;const s=r.map(t=>t.presence_ref);n=n.filter(t=>0>s.indexOf(t.presence_ref)),t[e]=n,i(e,n,r),0===n.length&&delete t[e]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(r=>e(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,r)=>{const i=t[r];return e[r]="metas"in i?i.metas.map(t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t)):i,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.v()}}(xt=Pt||(Pt={})).ALL="*",xt.INSERT="INSERT",xt.UPDATE="UPDATE",xt.DELETE="DELETE",(Ut=Nt||(Nt={})).BROADCAST="broadcast",Ut.PRESENCE="presence",Ut.POSTGRES_CHANGES="postgres_changes",Ut.SYSTEM="system",(Dt=Ct||(Ct={})).SUBSCRIBED="SUBSCRIBED",Dt.TIMED_OUT="TIMED_OUT",Dt.CLOSED="CLOSED",Dt.CHANNEL_ERROR="CHANNEL_ERROR";class Bt{constructor(t,e={config:{}},r){var i,n;if(this.topic=t,this.params=e,this.socket=r,this.bindings={},this.state=at.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new At(this,ct.join,this.params,this.timeout),this.rejoinTimer=new yt(()=>this.k(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=at.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this.A(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this.v())),this.state=at.closed,this.socket.I(this)}),this.R(t=>{this.P()||this.N()||(this.socket.log("channel","error ".concat(this.topic),t),this.state=at.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.U()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=at.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",t=>{this.P()||this.N()||(this.socket.log("channel","error ".concat(this.topic),t),this.state=at.errored,this.rejoinTimer.scheduleTimeout())}),this._(ct.reply,{},(t,e)=>{this.T(this.m(e),t)}),this.presence=new Lt(this),this.broadcastEndpointURL=kt(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(n=null===(i=this.params.config)||void 0===i?void 0:i.broadcast)||void 0===n?void 0:n.replay))throw"tried to use replay on public channel '".concat(this.topic,"'. It must be a private channel.")}subscribe(t,e=this.timeout){var r,i,n;if(this.socket.isConnected()||this.socket.connect(),this.state==at.closed){const{config:{broadcast:s,presence:o,private:a}}=this.params,l=null!==(i=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(t=>t.filter))&&void 0!==i?i:[],c=!!this.bindings[Nt.PRESENCE]&&this.bindings[Nt.PRESENCE].length>0||!0===(null===(n=this.params.config.presence)||void 0===n?void 0:n.enabled),u={},h={broadcast:s,presence:Object.assign(Object.assign({},o),{enabled:c}),postgres_changes:l,private:a};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this.R(e=>null==t?void 0:t(Ct.CHANNEL_ERROR,e)),this.A(()=>null==t?void 0:t(Ct.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this.C(e),this.joinPush.receive("ok",async({postgres_changes:e})=>{var r;if(this.socket.setAuth(),void 0!==e){const i=this.bindings.postgres_changes,n=null!==(r=null==i?void 0:i.length)&&void 0!==r?r:0,s=[];for(let r=0;n>r;r++){const n=i[r],{filter:{event:o,schema:a,table:l,filter:c}}=n,u=e&&e[r];if(!u||u.event!==o||u.schema!==a||u.table!==l||u.filter!==c)return this.unsubscribe(),this.state=at.errored,void(null==t||t(Ct.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes")));s.push(Object.assign(Object.assign({},n),{id:u.id}))}return this.bindings.postgres_changes=s,void(t&&t(Ct.SUBSCRIBED))}null==t||t(Ct.SUBSCRIBED)}).receive("error",e=>{this.state=at.errored,null==t||t(Ct.CHANNEL_ERROR,Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",()=>{null==t||t(Ct.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,r){return this.state===at.joined&&t===Nt.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(()=>this.subscribe())),this._(t,e,r)}async send(t,e={}){var r,i;if(this.D()||"broadcast"!==t.type)return new Promise(r=>{var i,n,s;const o=this.L(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(s=null===(n=null===(i=this.params)||void 0===i?void 0:i.config)||void 0===n?void 0:n.broadcast)||void 0===s?void 0:s.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{const{event:s,payload:o}=t,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const t=await this.B(this.broadcastEndpointURL,a,null!==(r=e.timeout)&&void 0!==r?r:this.timeout);return await(null===(i=t.body)||void 0===i?void 0:i.cancel()),t.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=at.leaving;const e=()=>{this.socket.log("channel","leave ".concat(this.topic)),this.T(ct.close,"leave",this.v())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new At(this,ct.leave,{},t),r.receive("ok",()=>{e(),i("ok")}).receive("timeout",()=>{e(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this.D()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=at.closed,this.bindings={}}async B(t,e,r){const i=new AbortController,n=setTimeout(()=>i.abort(),r),s=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:i.signal}));return clearTimeout(n),s}L(t,e,r=this.timeout){if(!this.joinedOnce)throw"tried to push '".concat(t,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let i=new At(this,t,e,r);return this.D()?i.send():this.W(i),i}W(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>100){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(t.event),t.payload))}}G(t,e,r){return e}q(t){return this.topic===t}v(){return this.joinPush.ref}T(t,e,r){var i,n;const s=t.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=ct;if(r&&[o,a,l,c].indexOf(s)>=0&&r!==this.v())return;let u=this.G(s,e,r);if(e&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?null===(i=this.bindings.postgres_changes)||void 0===i||i.filter(t=>{var e,r,i;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(i=null===(r=t.filter)||void 0===r?void 0:r.event)||void 0===i?void 0:i.toLocaleLowerCase())===s}).map(t=>t.callback(u,r)):null===(n=this.bindings[s])||void 0===n||n.filter(t=>{var r,i,n,o,a,l;if(["broadcast","presence","postgres_changes"].includes(s)){if("id"in t){const s=t.id,o=null===(r=t.filter)||void 0===r?void 0:r.event;return s&&(null===(i=e.ids)||void 0===i?void 0:i.includes(s))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=e.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(l=null==e?void 0:e.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===s}).map(t=>{if("object"==typeof u&&"ids"in u){const t=u.data,{schema:e,table:r,commit_timestamp:i,type:n,errors:s}=t;u=Object.assign(Object.assign({},{schema:e,table:r,commit_timestamp:i,eventType:n,new:{},old:{},errors:s}),this.F(t))}t.callback(u,r)})}N(){return this.state===at.closed}J(){return this.state===at.joined}U(){return this.state===at.joining}P(){return this.state===at.leaving}m(t){return"chan_reply_".concat(t)}_(t,e,r){const i=t.toLocaleLowerCase(),n={type:i,filter:e,callback:r};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}j(t,e){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(t=>{var i;return!((null===(i=t.type)||void 0===i?void 0:i.toLocaleLowerCase())===r&&Bt.isEqual(t.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const r in t)if(t[r]!==e[r])return!1;return!0}k(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.C()}A(t){this._(ct.close,{},t)}R(t){this._(ct.error,{},e=>t(e))}D(){return this.socket.isConnected()&&this.J()}C(t=this.timeout){this.P()||(this.socket.M(this.topic),this.state=at.joining,this.joinPush.resend(t))}F(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=bt(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=bt(t.columns,t.old_record)),e}}const Wt=()=>{},Gt=[1e3,2e3,5e3,1e4];class qt{constructor(t,e){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Wt,this.ref=0,this.reconnectTimer=null,this.logger=Wt,this.conn=null,this.sendBuffer=[],this.serializer=new pt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this.H="disconnected",this.K=!1,this.V=null,this.Y=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>a(async()=>{const{default:t}=await Promise.resolve().then(()=>k);return{default:t}},void 0).then(({default:e})=>e(...t)).catch(t=>{throw Error("Failed to load @supabase/node-fetch: ".concat(t.message,". ")+"This is required for HTTP requests in Node.js environments without native fetch.")}):fetch),(...t)=>e(...t)},!(null===(r=null==e?void 0:e.params)||void 0===r?void 0:r.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint="".concat(t,"/").concat(ht.websocket),this.httpEndpoint=kt(t),this.$(e),this.X(),this.fetch=this.Y(null==e?void 0:e.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this.Z("connecting"),this.tt("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=nt.createWebSocket(this.endpointURL())}catch(t){this.Z("disconnected");const e=t.message;if(e.includes("Node.js"))throw Error("".concat(e,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw Error("WebSocket not available: ".concat(e))}this.et()}}endpointURL(){return this.rt(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(t,e){if(!this.isDisconnecting())if(this.Z("disconnecting",!0),this.conn){const r=setTimeout(()=>{this.Z("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this.Z("disconnected")},t?this.conn.close(t,null!=e?e:""):this.conn.close(),this.it()}else this.Z("disconnected")}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,r){this.logger(t,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case st.connecting:return dt.Connecting;case st.open:return dt.Open;case st.closing:return dt.Closing;default:return dt.Closed}}isConnected(){return this.connectionState()===dt.Open}isConnecting(){return"connecting"===this.H}isDisconnecting(){return"disconnecting"===this.H}channel(t,e={config:{}}){const r="realtime:".concat(t),i=this.getChannels().find(t=>t.topic===r);if(i)return i;{const r=new Bt("realtime:".concat(t),e,this);return this.channels.push(r),r}}push(t){const{topic:e,event:r,payload:i,ref:n}=t,s=()=>{this.encode(t,t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)})};this.log("push","".concat(e," ").concat(r," (").concat(n,")"),i),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(t=null){this.V=this.nt(t);try{await this.V}finally{this.V=null}}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}return this.K=!1,null===(t=this.conn)||void 0===t||t.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var t;this.isConnected()||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout()},100)}this.pendingHeartbeatRef=this.p(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this.tt("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}p(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}M(t){let e=this.channels.find(e=>e.topic===t&&(e.J()||e.U()));e&&(this.log("transport",'leaving duplicate topic "'.concat(t,'"')),e.unsubscribe())}I(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}st(t){this.decode(t.data,t=>{if("phoenix"===t.topic&&"phx_reply"===t.event)try{this.heartbeatCallback("ok"===t.payload.status?"ok":"error")}catch(a){this.log("error","error in heartbeat callback",a)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:e,event:r,payload:i,ref:n}=t,s=n?"(".concat(n,")"):"",o=i.status||"";this.log("receive","".concat(o," ").concat(e," ").concat(r," ").concat(s).trim(),i),this.channels.filter(t=>t.q(e)).forEach(t=>t.T(r,i,n)),this.ot("message",t)})}ct(t){var e;"heartbeat"===t&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===t&&(null===(e=this.reconnectTimer)||void 0===e||e.reset())}ut(){this.ct("heartbeat"),this.ct("reconnect")}et(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this.ht(),this.conn.onerror=t=>this.dt(t),this.conn.onmessage=t=>this.st(t),this.conn.onclose=t=>this.ft(t))}it(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this.ut(),this.channels.forEach(t=>t.teardown())}ht(){this.Z("connected"),this.log("transport","connected to ".concat(this.endpointURL())),this.flushSendBuffer(),this.ct("reconnect"),this.worker?this.workerRef||this.vt():this.wt(),this.ot("open")}wt(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}vt(){this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");const t=this.yt(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}ft(t){var e;this.Z("disconnected"),this.log("transport","close",t),this.bt(),this.ct("heartbeat"),this.K||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout(),this.ot("close",t)}dt(t){this.Z("disconnected"),this.log("transport","".concat(t)),this.bt(),this.ot("error",t)}bt(){this.channels.forEach(t=>t.T(ct.error))}rt(t,e){if(0===Object.keys(e).length)return t;const r=t.match(/\?/)?"&":"?",i=new URLSearchParams(e);return"".concat(t).concat(r).concat(i)}yt(t){let e;if(t)e=t;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}Z(t,e=!1){this.H=t,"connecting"===t?this.K=!1:"disconnecting"===t&&(this.K=e)}async nt(t=null){let e;e=t||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const r={access_token:e,version:"realtime-js/2.75.0"};e&&t.updateJoinPayload(r),t.joinedOnce&&t.J()&&t.L(ct.access_token,{access_token:e})}))}async _t(){this.V&&await this.V}tt(t="general"){this.setAuth().catch(e=>{this.log("error","error setting auth in ".concat(t),e)})}ot(t,e){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(e)}catch(i){this.log("error","error in ".concat(t," callback"),i)}})}catch(r){this.log("error","error triggering ".concat(t," callbacks"),r)}}X(){this.reconnectTimer=new yt(async()=>{setTimeout(async()=>{await this._t(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}$(t){var e,r,i,n,s,o,a,l,c;if(this.transport=null!==(e=null==t?void 0:t.transport)&&void 0!==e?e:null,this.timeout=null!==(r=null==t?void 0:t.timeout)&&void 0!==r?r:1e4,this.heartbeatIntervalMs=null!==(i=null==t?void 0:t.heartbeatIntervalMs)&&void 0!==i?i:25e3,this.worker=null!==(n=null==t?void 0:t.worker)&&void 0!==n&&n,this.accessToken=null!==(s=null==t?void 0:t.accessToken)&&void 0!==s?s:null,this.heartbeatCallback=null!==(o=null==t?void 0:t.heartbeatCallback)&&void 0!==o?o:Wt,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(a=null==t?void 0:t.reconnectAfterMs)&&void 0!==a?a:t=>Gt[t-1]||1e4,this.encode=null!==(l=null==t?void 0:t.encode)&&void 0!==l?l:(t,e)=>e(JSON.stringify(t)),this.decode=null!==(c=null==t?void 0:t.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.workerUrl=null==t?void 0:t.workerUrl}}}class Ft extends Error{constructor(t){super(t),this.Ot=!0,this.name="StorageError"}}function Jt(t){return"object"==typeof t&&null!==t&&"Ot"in t}class Mt extends Ft{constructor(t,e,r){super(t),this.name="StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ht extends Ft{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}const Kt=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>a(async()=>{const{default:t}=await Promise.resolve().then(()=>k);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},Vt=t=>{if(Array.isArray(t))return t.map(t=>Vt(t));if("function"==typeof t||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,t=>t.toUpperCase().replace(/[-_]/g,""));e[i]=Vt(r)}),e};var zt=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function o(t){try{l(i.next(t))}catch(e){s(e)}}function a(t){try{l(i.throw(t))}catch(e){s(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};const Yt=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t);function $t(t,e,r,i,n,s){return zt(this,void 0,void 0,function*(){return new Promise((o,l)=>{t(r,((t,e,r,i)=>{const n={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"!==t&&i?((t=>{if("object"!=typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)})(i)?(n.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),n.body=JSON.stringify(i)):n.body=i,(null==e?void 0:e.duplex)&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),r)):n})(e,i,n,s)).then(t=>{if(!t.ok)throw t;return(null==i?void 0:i.noResolveJson)?t:t.json()}).then(t=>o(t)).catch(t=>((t,e,r)=>zt(void 0,void 0,void 0,function*(){const i=yield(n=void 0,s=function*(){return"undefined"==typeof Response?(yield a(()=>Promise.resolve().then(()=>k),void 0)).Response:Response},new(n||(n=Promise))(function(t,e){function r(t){try{o(s.next(t))}catch(r){e(r)}}function i(t){try{o(s.throw(t))}catch(r){e(r)}}function o(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n(function(t){t(s)})).then(r,i)}o((s=s.call(void 0)).next())}));var n,s;t instanceof i&&!(null==r?void 0:r.noResolveJson)?t.json().then(r=>{const i=t.status||500,n=(null==r?void 0:r.statusCode)||i+"";e(new Mt(Yt(r),i,n))}).catch(t=>{e(new Ht(Yt(t),t))}):e(new Ht(Yt(t),t))}))(t,l,i))})})}function Qt(t,e,r,i){return zt(this,void 0,void 0,function*(){return $t(t,"GET",e,r,i)})}function Xt(t,e,r,i,n){return zt(this,void 0,void 0,function*(){return $t(t,"POST",e,i,n,r)})}function Zt(t,e,r,i,n){return zt(this,void 0,void 0,function*(){return $t(t,"PUT",e,i,n,r)})}function te(t,e,r,i,n){return zt(this,void 0,void 0,function*(){return $t(t,"DELETE",e,i,n,r)})}class ee{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}execute(){return t=this,r=function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Jt(t))return{data:null,error:t};throw t}},new((e=void 0)||(e=Promise))(function(i,n){function s(t){try{a(r.next(t))}catch(e){n(e)}}function o(t){try{a(r.throw(t))}catch(e){n(e)}}function a(t){var r;t.done?i(t.value):(r=t.value,r instanceof e?r:new e(function(t){t(r)})).then(s,o)}a((r=r.call(t)).next())});var t,e,r}}class re{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}asStream(){return new ee(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.execute().then(t,e)}execute(){return t=this,r=function*(){try{const t=yield this.downloadFn();return{data:yield t.blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Jt(t))return{data:null,error:t};throw t}},new((e=void 0)||(e=Promise))(function(i,n){function s(t){try{a(r.next(t))}catch(e){n(e)}}function o(t){try{a(r.throw(t))}catch(e){n(e)}}function a(t){var r;t.done?i(t.value):(r=t.value,r instanceof e?r:new e(function(t){t(r)})).then(s,o)}a((r=r.call(t)).next())});var t,e,r}}var ie=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function o(t){try{l(i.next(t))}catch(e){s(e)}}function a(t){try{l(i.throw(t))}catch(e){s(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};const ne={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},se={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class oe{constructor(t,e={},r,i){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=r,this.fetch=Kt(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,e,r,i){return ie(this,void 0,void 0,function*(){try{let n;const s=Object.assign(Object.assign({},se),i);let o=Object.assign(Object.assign({},this.headers),"POST"===t&&{"x-upsert":s.upsert+""});const a=s.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",s.cacheControl),a&&n.append("metadata",this.encodeMetadata(a)),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",s.cacheControl),a&&n.append("metadata",this.encodeMetadata(a))):(n=r,o["cache-control"]="max-age=".concat(s.cacheControl),o["content-type"]=s.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==i?void 0:i.headers)&&(o=Object.assign(Object.assign({},o),i.headers));const l=this.Et(e),c=this.St(l),u=yield("PUT"==t?Zt:Xt)(this.fetch,"".concat(this.url,"/object/").concat(c),n,Object.assign({headers:o},(null==s?void 0:s.duplex)?{duplex:s.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Jt(n))return{data:null,error:n};throw n}})}upload(t,e,r){return ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,r)})}uploadToSignedUrl(t,e,r,i){return ie(this,void 0,void 0,function*(){const n=this.Et(t),s=this.St(n),o=new URL(this.url+"/object/upload/sign/".concat(s));o.searchParams.set("token",e);try{let t;const e=Object.assign({upsert:se.upsert},i),s=Object.assign(Object.assign({},this.headers),{"x-upsert":e.upsert+""});return"undefined"!=typeof Blob&&r instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(t=r,t.append("cacheControl",e.cacheControl)):(t=r,s["cache-control"]="max-age=".concat(e.cacheControl),s["content-type"]=e.contentType),{data:{path:n,fullPath:(yield Zt(this.fetch,o.toString(),t,{headers:s})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Jt(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(t,e){return ie(this,void 0,void 0,function*(){try{let r=this.St(t);const i=Object.assign({},this.headers);(null==e?void 0:e.upsert)&&(i["x-upsert"]="true");const n=yield Xt(this.fetch,"".concat(this.url,"/object/upload/sign/").concat(r),{},{headers:i}),s=new URL(this.url+n.url),o=s.searchParams.get("token");if(!o)throw new Ft("No token returned by API");return{data:{signedUrl:s.toString(),path:t,token:o},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Jt(r))return{data:null,error:r};throw r}})}update(t,e,r){return ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,r)})}move(t,e,r){return ie(this,void 0,void 0,function*(){try{return{data:yield Xt(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Jt(i))return{data:null,error:i};throw i}})}copy(t,e,r){return ie(this,void 0,void 0,function*(){try{return{data:{path:(yield Xt(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Jt(i))return{data:null,error:i};throw i}})}createSignedUrl(t,e,r){return ie(this,void 0,void 0,function*(){try{let i=this.St(t),n=yield Xt(this.fetch,"".concat(this.url,"/object/sign/").concat(i),Object.assign({expiresIn:e},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const s=(null==r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"";return n={signedUrl:encodeURI("".concat(this.url).concat(n.signedURL).concat(s))},{data:n,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Jt(i))return{data:null,error:i};throw i}})}createSignedUrls(t,e,r){return ie(this,void 0,void 0,function*(){try{const i=yield Xt(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:e,paths:t},{headers:this.headers}),n=(null==r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"";return{data:i.map(t=>Object.assign(Object.assign({},t),{signedUrl:t.signedURL?encodeURI("".concat(this.url).concat(t.signedURL).concat(n)):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Jt(i))return{data:null,error:i};throw i}})}download(t,e){const r=void 0!==(null==e?void 0:e.transform)?"render/image/authenticated":"object",i=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),n=i?"?".concat(i):"",s=this.St(t);return new re(()=>Qt(this.fetch,"".concat(this.url,"/").concat(r,"/").concat(s).concat(n),{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(t){return ie(this,void 0,void 0,function*(){const e=this.St(t);try{const t=yield Qt(this.fetch,"".concat(this.url,"/object/info/").concat(e),{headers:this.headers});return{data:Vt(t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Jt(r))return{data:null,error:r};throw r}})}exists(t){return ie(this,void 0,void 0,function*(){const e=this.St(t);try{return yield function(t,e,r){return zt(this,void 0,void 0,function*(){return $t(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),void 0)})}(this.fetch,"".concat(this.url,"/object/").concat(e),{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Jt(r)&&r instanceof Ht){const t=r.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,e){const r=this.St(t),i=[],n=(null==e?void 0:e.download)?"download=".concat(!0===e.download?"":e.download):"";""!==n&&i.push(n);const s=void 0!==(null==e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==o&&i.push(o);let a=i.join("&");return""!==a&&(a="?".concat(a)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(s,"/public/").concat(r).concat(a))}}}remove(t){return ie(this,void 0,void 0,function*(){try{return{data:yield te(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Jt(e))return{data:null,error:e};throw e}})}list(t,e,r){return ie(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},ne),e),{prefix:t||""});return{data:yield Xt(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),i,{headers:this.headers},r),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Jt(i))return{data:null,error:i};throw i}})}listV2(t,e){return ie(this,void 0,void 0,function*(){try{const r=Object.assign({},t);return{data:yield Xt(this.fetch,"".concat(this.url,"/object/list-v2/").concat(this.bucketId),r,{headers:this.headers},e),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Jt(r))return{data:null,error:r};throw r}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return"undefined"!=typeof Buffer?Buffer.from(t).toString("base64"):btoa(t)}St(t){return"".concat(this.bucketId,"/").concat(t.replace(/^\/+/,""))}Et(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push("width=".concat(t.width)),t.height&&e.push("height=".concat(t.height)),t.resize&&e.push("resize=".concat(t.resize)),t.format&&e.push("format=".concat(t.format)),t.quality&&e.push("quality=".concat(t.quality)),e.join("&")}}const ae={"X-Client-Info":"storage-js/2.75.0"};var le=function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function o(t){try{l(i.next(t))}catch(e){s(e)}}function a(t){try{l(i.throw(t))}catch(e){s(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class ce{constructor(t,e={},r,i){this.shouldThrowOnError=!1;const n=new URL(t);(null==i?void 0:i.useNewHostname)&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},ae),e),this.fetch=Kt(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return le(this,void 0,void 0,function*(){try{return{data:yield Qt(this.fetch,"".concat(this.url,"/bucket"),{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Jt(t))return{data:null,error:t};throw t}})}getBucket(t){return le(this,void 0,void 0,function*(){try{return{data:yield Qt(this.fetch,"".concat(this.url,"/bucket/").concat(t),{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Jt(e))return{data:null,error:e};throw e}})}createBucket(t){return le(this,arguments,void 0,function*(t,e={public:!1}){try{return{data:yield Xt(this.fetch,"".concat(this.url,"/bucket"),{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Jt(r))return{data:null,error:r};throw r}})}updateBucket(t,e){return le(this,void 0,void 0,function*(){try{return{data:yield Zt(this.fetch,"".concat(this.url,"/bucket/").concat(t),{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Jt(r))return{data:null,error:r};throw r}})}emptyBucket(t){return le(this,void 0,void 0,function*(){try{return{data:yield Xt(this.fetch,"".concat(this.url,"/bucket/").concat(t,"/empty"),{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Jt(e))return{data:null,error:e};throw e}})}deleteBucket(t){return le(this,void 0,void 0,function*(){try{return{data:yield te(this.fetch,"".concat(this.url,"/bucket/").concat(t),{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Jt(e))return{data:null,error:e};throw e}})}}class ue extends ce{constructor(t,e={},r,i){super(t,e,r,i)}from(t){return new oe(this.url,this.headers,t,this.fetch)}}const he=3e4,de=9e4,fe="X-Supabase-Api-Version",ve=Date.parse("2024-01-01T00:00:00.0Z"),we=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class pe extends Error{constructor(t,e,r){super(t),this.Tt=!0,this.name="AuthError",this.status=e,this.code=r}}function ye(t){return"object"==typeof t&&null!==t&&"Tt"in t}class be extends pe{constructor(t,e,r){super(t,e,r),this.name="AuthApiError",this.status=e,this.code=r}}class ge extends pe{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class me extends pe{constructor(t,e,r,i){super(t,r,i),this.name=e,this.status=r}}class _e extends me{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Oe extends me{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ee extends me{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Se extends me{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Te extends me{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class je extends me{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function ke(t){return ye(t)&&"AuthRetryableFetchError"===t.name}class Ae extends me{constructor(t,e,r){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}}class Ie extends me{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Pe=" \t\n\r=".split(""),xe=(()=>{const t=Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Pe.length;e+=1)t[Pe[e].charCodeAt(0)]=-2;for(let e=0;e<Re.length;e+=1)t[Re[e].charCodeAt(0)]=e;return t})();function Ne(t,e,r){if(null!==t)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;r(Re[t]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;r(Re[t]),e.queuedBits-=6}}function Ue(t,e,r){const i=xe[t];if(-1>=i){if(-2===i)return;throw Error('Invalid Base64-URL character "'.concat(String.fromCharCode(t),'"'))}for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8}function Ce(t){const e=[],r=t=>{e.push(String.fromCodePoint(t))},i={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},s=t=>{!function(t,e,r){if(0===e.utf8seq){if(127>=t)return void r(t);for(let r=1;6>r;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(2===e.utf8seq)e.codepoint=31&t;else if(3===e.utf8seq)e.codepoint=15&t;else{if(4!==e.utf8seq)throw Error("Invalid UTF-8 sequence");e.codepoint=7&t}e.utf8seq-=1}else if(e.utf8seq>0){if(127>=t)throw Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|63&t,e.utf8seq-=1,0===e.utf8seq&&r(e.codepoint)}}(t,i,r)};for(let o=0;o<t.length;o+=1)Ue(t.charCodeAt(o),n,s);return e.join("")}function De(t,e){if(t>127){if(2047>=t)return e(192|t>>6),void e(128|63&t);if(65535>=t)return e(224|t>>12),e(128|t>>6&63),void e(128|63&t);if(1114111>=t)return e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),void e(128|63&t);throw Error("Unrecognized Unicode codepoint: ".concat(t.toString(16)))}e(t)}function Le(t){const e=[],r={queue:0,queuedBits:0},i=t=>{e.push(t)};for(let n=0;n<t.length;n+=1)Ue(t.charCodeAt(n),r,i);return new Uint8Array(e)}function Be(t){const e=[],r={queue:0,queuedBits:0},i=t=>{e.push(t)};return t.forEach(t=>Ne(t,r,i)),Ne(null,r,i),e.join("")}const We=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Ge={tested:!1,writable:!1},qe=()=>{if(!We())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(Ge.tested)return Ge.writable;const t="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Ge.tested=!0,Ge.writable=!0}catch(e){Ge.tested=!0,Ge.writable=!1}return Ge.writable},Fe=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>a(async()=>{const{default:t}=await Promise.resolve().then(()=>k);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},Je=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},Me=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch(i){return r}},He=async(t,e)=>{await t.removeItem(e)};class Ke{constructor(){this.promise=new Ke.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}function Ve(t){const e=t.split(".");if(3!==e.length)throw new Ie("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!we.test(e[r]))throw new Ie("JWT not in base64url format");return{header:JSON.parse(Ce(e[0])),payload:JSON.parse(Ce(e[1])),signature:Le(e[2]),raw:{header:e[0],payload:e[1]}}}function ze(t){return("0"+t.toString(16)).substr(-2)}async function Ye(t,e,r=!1){const i=function(){const t=new Uint32Array(56);if("undefined"==typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let r="";for(let i=0;56>i;i++)r+=t.charAt(Math.floor(Math.random()*e));return r}return crypto.getRandomValues(t),Array.from(t,ze).join("")}();let n=i;r&&(n+="/PASSWORD_RECOVERY"),await Je(t,"".concat(e,"-code-verifier"),n);const s=await async function(t){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return t;const e=await async function(t){const e=(new TextEncoder).encode(t),r=await crypto.subtle.digest("SHA-256",e),i=new Uint8Array(r);return Array.from(i).map(t=>String.fromCharCode(t)).join("")}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(i);return[s,i===s?"plain":"s256"]}Ke.promiseConstructor=Promise;const $e=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,Qe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Xe(t){if(!Qe.test(t))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ze(){return new Proxy({},{get:(t,e)=>{if("__isUserNotAvailableProxy"===e)return!0;if("symbol"==typeof e){const t=e.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t)return}throw Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(e,'" property of the session object is not supported. Please use getUser() instead.'))},set:(t,e)=>{throw Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(e,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:(t,e)=>{throw Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(e,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function tr(t){return JSON.parse(JSON.stringify(t))}const er=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),rr=[502,503,504];async function ir(t){var e,r;if(!("object"==typeof(r=t)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new je(er(t),0);if(rr.includes(t.status))throw new je(er(t),t.status);let i,n;try{i=await t.json()}catch(o){throw new ge(er(o),o)}const s=function(t){const e=t.headers.get(fe);if(!e)return null;if(!e.match($e))return null;try{return new Date("".concat(e,"T00:00:00.0Z"))}catch(o){return null}}(t);if(s&&s.getTime()>=ve&&"object"==typeof i&&i&&"string"==typeof i.code?n=i.code:"object"==typeof i&&i&&"string"==typeof i.error_code&&(n=i.error_code),n){if("weak_password"===n)throw new Ae(er(i),t.status,(null===(e=i.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===n)throw new _e}else if("object"==typeof i&&i&&"object"==typeof i.weak_password&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0))throw new Ae(er(i),t.status,i.weak_password.reasons);throw new be(er(i),t.status||500,n)}async function nr(t,e,r,i){var n;const s=Object.assign({},null==i?void 0:i.headers);s[fe]||(s[fe]="2024-01-01"),(null==i?void 0:i.jwt)&&(s.Authorization="Bearer ".concat(i.jwt));const o=null!==(n=null==i?void 0:i.query)&&void 0!==n?n:{};(null==i?void 0:i.redirectTo)&&(o.redirect_to=i.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(t,e,r,i,n,s){const o=((t,e,r,i)=>{const n={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==e?void 0:e.headers),n.body=JSON.stringify(i),Object.assign(Object.assign({},n),{}))})(e,i,0,s);let a;try{a=await t(r,Object.assign({},o))}catch(l){throw new je(er(l),0)}if(a.ok||await ir(a),null==i?void 0:i.noResolveJson)return a;try{return await a.json()}catch(l){await ir(l)}}(t,e,r+a,{headers:s,noResolveJson:null==i?void 0:i.noResolveJson},0,null==i?void 0:i.body);return(null==i?void 0:i.xform)?null==i?void 0:i.xform(l):{data:Object.assign({},l),error:null}}function sr(t){var e;let r=null;var i;return function(t){return t.access_token&&t.refresh_token&&t.expires_in}(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=(i=t.expires_in,Math.round(Date.now()/1e3)+i))),{data:{session:r,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function or(t){const e=sr(t);return!e.error&&t.weak_password&&"object"==typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"==typeof t.weak_password.message&&t.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0)&&(e.data.weak_password=t.weak_password),e}function ar(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function lr(t){return{data:t,error:null}}function cr(t){const{action_link:e,email_otp:r,hashed_token:i,redirect_to:n,verification_type:s}=t,o=function(t,e){var r={};for(var i in t)({}).hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)0>e.indexOf(i[n])&&{}.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]])}return r}(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:e,email_otp:r,hashed_token:i,redirect_to:n,verification_type:s},user:Object.assign({},o)},error:null}}function ur(t){return t}const hr=["global","local","others"];class dr{constructor({url:t="",headers:e={},fetch:r}){this.url=t,this.headers=e,this.fetch=Fe(r),this.mfa={listFactors:this.jt.bind(this),deleteFactor:this.kt.bind(this)},this.oauth={listClients:this.At.bind(this),createClient:this.It.bind(this),getClient:this.Rt.bind(this),deleteClient:this.Pt.bind(this),regenerateClientSecret:this.xt.bind(this)}}async signOut(t,e=hr[0]){if(0>hr.indexOf(e))throw Error("@supabase/auth-js: Parameter scope must be one of ".concat(hr.join(", ")));try{return await nr(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(e),{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ye(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,e={}){try{return await nr(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:ar})}catch(r){if(ye(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:e}=t,r=function(t,e){var r={};for(var i in t)({}).hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)0>e.indexOf(i[n])&&{}.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]])}return r}(t,["options"]),i=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(i.new_email=null==r?void 0:r.newEmail,delete i.newEmail),await nr(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:i,headers:this.headers,xform:cr,redirectTo:null==e?void 0:e.redirectTo})}catch(e){if(ye(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await nr(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:t,headers:this.headers,xform:ar})}catch(e){if(ye(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,r,i,n,s,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await nr(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(i=null==t?void 0:t.perPage)||void 0===i?void 0:i.toString())&&void 0!==n?n:""},xform:ur});if(c.error)throw c.error;const u=await c.json(),h=null!==(s=c.headers.get("x-total-count"))&&void 0!==s?s:0,d=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(t.split(";")[1].split("=")[1]);l["".concat(r,"Page")]=e}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(ye(l))return{data:{users:[]},error:l};throw l}}async getUserById(t){Xe(t);try{return await nr(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(t),{headers:this.headers,xform:ar})}catch(e){if(ye(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){Xe(t);try{return await nr(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(t),{body:e,headers:this.headers,xform:ar})}catch(r){if(ye(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,e=!1){Xe(t);try{return await nr(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(t),{headers:this.headers,body:{should_soft_delete:e},xform:ar})}catch(r){if(ye(r))return{data:{user:null},error:r};throw r}}async jt(t){Xe(t.userId);try{const{data:e,error:r}=await nr(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(t.userId,"/factors"),{headers:this.headers,xform:t=>({data:{factors:t},error:null})});return{data:e,error:r}}catch(e){if(ye(e))return{data:null,error:e};throw e}}async kt(t){Xe(t.userId),Xe(t.id);try{return{data:await nr(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(t.userId,"/factors/").concat(t.id),{headers:this.headers}),error:null}}catch(e){if(ye(e))return{data:null,error:e};throw e}}async At(t){var e,r,i,n,s,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await nr(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(i=null==t?void 0:t.perPage)||void 0===i?void 0:i.toString())&&void 0!==n?n:""},xform:ur});if(c.error)throw c.error;const u=await c.json(),h=null!==(s=c.headers.get("x-total-count"))&&void 0!==s?s:0,d=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(t.split(";")[1].split("=")[1]);l["".concat(r,"Page")]=e}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(ye(l))return{data:{clients:[]},error:l};throw l}}async It(t){try{return await nr(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients"),{body:t,headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(ye(e))return{data:null,error:e};throw e}}async Rt(t){try{return await nr(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients/").concat(t),{headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(ye(e))return{data:null,error:e};throw e}}async Pt(t){try{return await nr(this.fetch,"DELETE","".concat(this.url,"/admin/oauth/clients/").concat(t),{headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(ye(e))return{data:null,error:e};throw e}}async xt(t){try{return await nr(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients/").concat(t,"/regenerate_secret"),{headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(ye(e))return{data:null,error:e};throw e}}}function fr(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const vr=!!(globalThis&&qe()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class wr extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class pr extends wr{}async function yr(t,e,r){const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort()},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async i=>{if(!i){if(0===e)throw new pr('Acquiring an exclusive Navigator LockManager lock "'.concat(t,'" immediately failed'));if(vr)try{await globalThis.navigator.locks.query()}catch(n){}return await r()}try{return await r()}finally{}}))}function br(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw Error('@supabase/auth-js: Address "'.concat(t,'" is invalid.'));return t.toLowerCase()}function gr(t){const e=(new TextEncoder).encode(t);return"0x"+Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}class mr extends Error{constructor({message:t,code:e,cause:r,name:i}){var n;super(t,{cause:r}),this.Nt=!0,this.name=null!==(n=null!=i?i:r instanceof Error?r.name:void 0)&&void 0!==n?n:"Unknown Error",this.code=e}}class _r extends mr{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}}function Or({error:t,options:e}){var r,i,n;const{publicKey:s}=e;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(e.signal instanceof AbortSignal)return new mr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if("ConstraintError"===t.name){if(!0===(null===(r=s.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new mr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if("conditional"===e.mediation&&"required"===(null===(i=s.authenticatorSelection)||void 0===i?void 0:i.userVerification))return new mr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if("required"===(null===(n=s.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new mr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if("InvalidStateError"===t.name)return new mr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if("NotAllowedError"===t.name)return new mr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("NotSupportedError"===t.name)return 0===s.pubKeyCredParams.filter(t=>"public-key"===t.type).length?new mr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new mr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if("SecurityError"===t.name){const e=window.location.hostname;if(!Rr(e))return new mr({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(s.rp.id!==e)return new mr({message:'The RP ID "'.concat(s.rp.id,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("TypeError"===t.name){if(1>s.user.id.byteLength||s.user.id.byteLength>64)return new mr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if("UnknownError"===t.name)return new mr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new mr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function Er({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(e.signal instanceof AbortSignal)return new mr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if("NotAllowedError"===t.name)return new mr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("SecurityError"===t.name){const e=window.location.hostname;if(!Rr(e))return new mr({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(r.rpId!==e)return new mr({message:'The RP ID "'.concat(r.rpId,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("UnknownError"===t.name)return new mr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new mr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}var Sr=function(t,e){var r={};for(var i in t)({}).hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)0>e.indexOf(i[n])&&{}.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]])}return r};const Tr=new class{createNewAbortSignal(){if(this.controller){const t=Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}};function jr(t){if(!t)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:i}=t,n=Sr(t,["challenge","user","excludeCredentials"]),s=Le(e).buffer,o=Object.assign(Object.assign({},r),{id:Le(r.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:s,user:o});if(i&&i.length>0){a.excludeCredentials=Array(i.length);for(let t=0;t<i.length;t++){const e=i[t];a.excludeCredentials[t]=Object.assign(Object.assign({},e),{id:Le(e.id).buffer,type:e.type||"public-key",transports:e.transports})}}return a}function kr(t){if(!t)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,i=Sr(t,["challenge","allowCredentials"]),n=Le(e).buffer,s=Object.assign(Object.assign({},i),{challenge:n});if(r&&r.length>0){s.allowCredentials=Array(r.length);for(let t=0;t<r.length;t++){const e=r[t];s.allowCredentials[t]=Object.assign(Object.assign({},e),{id:Le(e.id).buffer,type:e.type||"public-key",transports:e.transports})}}return s}function Ar(t){var e;if("toJSON"in t&&"function"==typeof t.toJSON)return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:Be(new Uint8Array(t.response.attestationObject)),clientDataJSON:Be(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:null!==(e=r.authenticatorAttachment)&&void 0!==e?e:void 0}}function Ir(t){var e;if("toJSON"in t&&"function"==typeof t.toJSON)return t.toJSON();const r=t,i=t.getClientExtensionResults(),n=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Be(new Uint8Array(n.authenticatorData)),clientDataJSON:Be(new Uint8Array(n.clientDataJSON)),signature:Be(new Uint8Array(n.signature)),userHandle:n.userHandle?Be(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:null!==(e=r.authenticatorAttachment)&&void 0!==e?e:void 0}}function Rr(t){return"localhost"===t||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Pr(){var t,e;return!!(We()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.create)&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.get))}const xr={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},Nr={userVerification:"preferred",hints:["security-key"]};function Ur(...t){const e=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),r=t=>t instanceof ArrayBuffer||ArrayBuffer.isView(t),i={};for(const n of t)if(n)for(const t in n){const s=n[t];if(void 0!==s)if(Array.isArray(s))i[t]=s;else if(r(s))i[t]=s;else if(e(s)){const r=i[t];e(r)?i[t]=Ur(r,s):i[t]=Ur(s)}else i[t]=s}return i}class Cr{constructor(t){this.client=t,this.enroll=this.Ut.bind(this),this.challenge=this.Ct.bind(this),this.verify=this.Dt.bind(this),this.authenticate=this.Lt.bind(this),this.register=this.Bt.bind(this)}async Ut(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async Ct({factorId:t,webauthn:e,friendlyName:r,signal:i},n){try{const{data:s,error:o}=await this.client.mfa.challenge({factorId:t,webauthn:e});if(!s)return{data:null,error:o};const a=null!=i?i:Tr.createNewAbortSignal();if("create"===s.webauthn.type){const{user:t}=s.webauthn.credential_options.publicKey;t.name||(t.name="".concat(t.id,":").concat(r)),t.displayName||(t.displayName=t.name)}switch(s.webauthn.type){case"create":{const e=function(t,e){return Ur(xr,t,e||{})}(s.webauthn.credential_options.publicKey,null==n?void 0:n.create),{data:r,error:i}=await async function(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new _r("Browser returned unexpected credential type",e)}:{data:null,error:new _r("Empty credential response",e)}}catch(e){return{data:null,error:Or({error:e,options:t})}}}({publicKey:e,signal:a});return r?{data:{factorId:t,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:r}},error:null}:{data:null,error:i}}case"request":{const e=function(t,e){return Ur(Nr,t,e||{})}(s.webauthn.credential_options.publicKey,null==n?void 0:n.request),{data:r,error:i}=await async function(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new _r("Browser returned unexpected credential type",e)}:{data:null,error:new _r("Empty credential response",e)}}catch(e){return{data:null,error:Er({error:e,options:t})}}}(Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:e,signal:a}));return r?{data:{factorId:t,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:r}},error:null}:{data:null,error:i}}}}catch(s){return ye(s)?{data:null,error:s}:{data:null,error:new ge("Unexpected error in challenge",s)}}}async Dt({challengeId:t,factorId:e,webauthn:r}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:r})}async Lt({factorId:t,webauthn:{rpId:e=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:i}},n){if(!e)return{data:null,error:new pe("rpId is required for WebAuthn authentication")};try{if(!Pr())return{data:null,error:new ge("Browser does not support WebAuthn",null)};const{data:s,error:o}=await this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:r},signal:i},{request:n});if(!s)return{data:null,error:o};const{webauthn:a}=s;return this.Dt({factorId:t,challengeId:s.challengeId,webauthn:{type:a.type,rpId:e,rpOrigins:r,credential_response:a.credential_response}})}catch(s){return ye(s)?{data:null,error:s}:{data:null,error:new ge("Unexpected error in authenticate",s)}}}async Bt({friendlyName:t,rpId:e=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:i},n){if(!e)return{data:null,error:new pe("rpId is required for WebAuthn registration")};try{if(!Pr())return{data:null,error:new ge("Browser does not support WebAuthn",null)};const{data:s,error:o}=await this.Ut({friendlyName:t});if(!s)return await this.client.mfa.listFactors().then(e=>{var r;return null===(r=e.data)||void 0===r?void 0:r.all.find(e=>"webauthn"===e.factor_type&&e.friendly_name===t&&"unverified"!==e.status)}).then(t=>t?this.client.mfa.unenroll({factorId:null==t?void 0:t.id}):void 0),{data:null,error:o};const{data:a,error:l}=await this.Ct({factorId:s.id,friendlyName:s.friendly_name,webauthn:{rpId:e,rpOrigins:r},signal:i},{create:n});return a?this.Dt({factorId:s.id,challengeId:a.challengeId,webauthn:{rpId:e,rpOrigins:r,type:a.webauthn.type,credential_response:a.webauthn.credential_response}}):{data:null,error:l}}catch(s){return ye(s)?{data:null,error:s}:{data:null,error:new ge("Unexpected error in register",s)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"Wt",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.Wt}catch(t){"undefined"!=typeof self&&(self.globalThis=self)}}();const Dr={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:{"X-Client-Info":"gotrue-js/2.75.0"},flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Lr(t,e,r){return await r()}const Br={};class Wr{get jwks(){var t,e;return null!==(e=null===(t=Br[this.storageKey])||void 0===t?void 0:t.jwks)&&void 0!==e?e:{keys:[]}}set jwks(t){Br[this.storageKey]=Object.assign(Object.assign({},Br[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return null!==(e=null===(t=Br[this.storageKey])||void 0===t?void 0:t.cachedAt)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Br[this.storageKey]=Object.assign(Object.assign({},Br[this.storageKey]),{cachedAt:t})}constructor(t){var e,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Wr.nextInstanceID,Wr.nextInstanceID+=1,this.instanceID>0&&We();const i=Object.assign(Object.assign({},Dr),t);if(this.logDebugMessages=!!i.debug,"function"==typeof i.debug&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new dr({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Fe(i.fetch),this.lock=i.lock||Lr,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:We()&&(null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===e?void 0:e.locks)?this.lock=yr:this.lock=Lr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this.Dt.bind(this),enroll:this.Ut.bind(this),unenroll:this.Gt.bind(this),challenge:this.Ct.bind(this),listFactors:this.jt.bind(this),challengeAndVerify:this.qt.bind(this),getAuthenticatorAssuranceLevel:this.Ft.bind(this),webauthn:new Cr(this)},this.persistSession?(i.storage?this.storage=i.storage:qe()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=fr(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=fr(this.memoryStorage)),We()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async t=>{this.Jt("received broadcast notification from other tab or client",t),await this.Mt(t.data.event,t.data.session,!1)})}this.initialize()}Jt(...t){return this.logDebugMessages&&this.logger("GoTrueClient@".concat(this.instanceID," (").concat("2.75.0",") ").concat((new Date).toISOString()),...t),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this.Ht(-1,async()=>await this.Kt()))()),await this.initializePromise}async Kt(){var t;try{const e=function(t){const e={},r=new URL(t);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((t,r)=>{e[r]=t})}catch(i){}return r.searchParams.forEach((t,r)=>{e[r]=t}),e}(window.location.href);let r="none";if(this.Vt(e)?r="implicit":await this.zt(e)&&(r="pkce"),We()&&this.detectSessionInUrl&&"none"!==r){const{data:i,error:n}=await this.Yt(e,r);if(n){if(this.Jt("#_initialize()","error detecting session from URL",n),function(t){return ye(t)&&"AuthImplicitGrantRedirectError"===t.name}(n)){const e=null===(t=n.details)||void 0===t?void 0:t.code;if("identity_already_exists"===e||"identity_not_found"===e||"single_identity_not_deletable"===e)return{error:n}}return await this.$t(),{error:n}}const{session:s,redirectType:o}=i;return this.Jt("#_initialize()","detected session in URL",s,"redirect type",o),await this.Qt(s),setTimeout(async()=>{"recovery"===o?await this.Mt("PASSWORD_RECOVERY",s):await this.Mt("SIGNED_IN",s)},0),{error:null}}return await this.Xt(),{error:null}}catch(e){return ye(e)?{error:e}:{error:new ge("Unexpected error during initialization",e)}}finally{await this.Zt(),this.Jt("#_initialize()","end")}}async signInAnonymously(t){var e,r,i;try{const n=await nr(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!==(r=null===(e=null==t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(i=null==t?void 0:t.options)||void 0===i?void 0:i.captchaToken}},xform:sr}),{data:s,error:o}=n;if(o||!s)return{data:{user:null,session:null},error:o};const a=s.session,l=s.user;return s.session&&(await this.Qt(s.session),await this.Mt("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(ye(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(t){var e,r,i;try{let n;if("email"in t){const{email:r,password:i,options:s}=t;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Ye(this.storage,this.storageKey)),n=await nr(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null==s?void 0:s.emailRedirectTo,body:{email:r,password:i,data:null!==(e=null==s?void 0:s.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:o,code_challenge_method:a},xform:sr})}else{if(!("phone"in t))throw new Ee("You must provide either an email or phone number and a password");{const{phone:e,password:s,options:o}=t;n=await nr(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:e,password:s,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(i=null==o?void 0:o.channel)&&void 0!==i?i:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:sr})}}const{data:s,error:o}=n;if(o||!s)return{data:{user:null,session:null},error:o};const a=s.session,l=s.user;return s.session&&(await this.Qt(s.session),await this.Mt("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(ye(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(t){try{let e;if("email"in t){const{email:r,password:i,options:n}=t;e=await nr(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:r,password:i,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:or})}else{if(!("phone"in t))throw new Ee("You must provide either an email or phone number and a password");{const{phone:r,password:i,options:n}=t;e=await nr(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:r,password:i,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:or})}}const{data:r,error:i}=e;return i?{data:{user:null,session:null},error:i}:r&&r.session&&r.user?(r.session&&(await this.Qt(r.session),await this.Mt("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i}):{data:{user:null,session:null},error:new Oe}}catch(e){if(ye(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(t){var e,r,i,n;return await this.te(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(r=t.options)||void 0===r?void 0:r.scopes,queryParams:null===(i=t.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:null===(n=t.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this.Ht(-1,async()=>this.ee(t))}async signInWithWeb3(t){const{chain:e}=t;switch(e){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw Error('@supabase/auth-js: Unsupported chain "'.concat(e,'"'))}}async signInWithEthereum(t){var e,r,i,n,s,o,a,l,c,u,h;let d,f;if("message"in t)d=t.message,f=t.signature;else{const{chain:u,wallet:h,statement:v,options:w}=t;let p;if(We())if("object"==typeof h)p=h;else{const t=window;if(!("ethereum"in t)||"object"!=typeof t.ethereum||!("request"in t.ethereum)||"function"!=typeof t.ethereum.request)throw Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");p=t.ethereum}else{if("object"!=typeof h||!(null==w?void 0:w.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");p=h}const y=new URL(null!==(e=null==w?void 0:w.url)&&void 0!==e?e:window.location.href),b=await p.request({method:"eth_requestAccounts"}).then(t=>t).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!b||0===b.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const g=br(b[0]);let m=null===(r=null==w?void 0:w.signInWithEthereum)||void 0===r?void 0:r.chainId;if(!m){const t=await p.request({method:"eth_chainId"});m=parseInt(t,16)}d=function(t){var e;const{chainId:r,domain:i,expirationTime:n,issuedAt:s=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:h,version:d}=t;if(!Number.isInteger(r))throw Error('@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: '.concat(r));if(!i)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&8>o.length)throw Error('@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: '.concat(o));if(!h)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw Error("@supabase/auth-js: Invalid SIWE message field \"version\". Version must be '1'. Provided value: ".concat(d));if(null===(e=t.statement)||void 0===e?void 0:e.includes("\n"))throw Error("@supabase/auth-js: Invalid SIWE message field \"statement\". Statement must not include '\\n'. Provided value: ".concat(t.statement));const f=br(t.address),v=u?"".concat(u,"://").concat(i):i,w=t.statement?"".concat(t.statement,"\n"):"",p="".concat(v," wants you to sign in with your Ethereum account:\n").concat(f,"\n\n").concat(w);let y="URI: ".concat(h,"\nVersion: ").concat(d,"\nChain ID: ").concat(r).concat(o?"\nNonce: ".concat(o):"","\nIssued At: ").concat(s.toISOString());if(n&&(y+="\nExpiration Time: ".concat(n.toISOString())),a&&(y+="\nNot Before: ".concat(a.toISOString())),l&&(y+="\nRequest ID: ".concat(l)),c){let t="\nResources:";for(const e of c){if(!e||"string"!=typeof e)throw Error('@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: '.concat(e));t+="\n- ".concat(e)}y+=t}return"".concat(p,"\n").concat(y)}({domain:y.host,address:g,statement:v,uri:y.href,version:"1",chainId:m,nonce:null===(i=null==w?void 0:w.signInWithEthereum)||void 0===i?void 0:i.nonce,issuedAt:null!==(s=null===(n=null==w?void 0:w.signInWithEthereum)||void 0===n?void 0:n.issuedAt)&&void 0!==s?s:new Date,expirationTime:null===(o=null==w?void 0:w.signInWithEthereum)||void 0===o?void 0:o.expirationTime,notBefore:null===(a=null==w?void 0:w.signInWithEthereum)||void 0===a?void 0:a.notBefore,requestId:null===(l=null==w?void 0:w.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null==w?void 0:w.signInWithEthereum)||void 0===c?void 0:c.resources}),f=await p.request({method:"personal_sign",params:[gr(d),g]})}try{const{data:e,error:r}=await nr(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"ethereum",message:d,signature:f},(null===(u=t.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=t.options)||void 0===h?void 0:h.captchaToken}}:null),xform:sr});if(r)throw r;return e&&e.session&&e.user?(e.session&&(await this.Qt(e.session),await this.Mt("SIGNED_IN",e.session)),{data:Object.assign({},e),error:r}):{data:{user:null,session:null},error:new Oe}}catch(v){if(ye(v))return{data:{user:null,session:null},error:v};throw v}}async signInWithSolana(t){var e,r,i,n,s,o,a,l,c,u,h,d;let f,v;if("message"in t)f=t.message,v=t.signature;else{const{chain:h,wallet:d,statement:w,options:p}=t;let y;if(We())if("object"==typeof d)y=d;else{const t=window;if(!("solana"in t)||"object"!=typeof t.solana||!("signIn"in t.solana&&"function"==typeof t.solana.signIn||"signMessage"in t.solana&&"function"==typeof t.solana.signMessage))throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=t.solana}else{if("object"!=typeof d||!(null==p?void 0:p.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=d}const b=new URL(null!==(e=null==p?void 0:p.url)&&void 0!==e?e:window.location.href);if("signIn"in y&&y.signIn){const t=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==p?void 0:p.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),w?{statement:w}:null));let e;if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else{if(!(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t))throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");e=t}if(!("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof e.signedMessage?e.signedMessage:(new TextDecoder).decode(e.signedMessage),v=e.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=["".concat(b.host," wants you to sign in with your Solana account:"),y.publicKey.toBase58(),...w?["",w,""]:[""],"Version: 1","URI: ".concat(b.href),"Issued At: ".concat(null!==(i=null===(r=null==p?void 0:p.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==i?i:(new Date).toISOString()),...(null===(n=null==p?void 0:p.signInWithSolana)||void 0===n?void 0:n.notBefore)?["Not Before: ".concat(p.signInWithSolana.notBefore)]:[],...(null===(s=null==p?void 0:p.signInWithSolana)||void 0===s?void 0:s.expirationTime)?["Expiration Time: ".concat(p.signInWithSolana.expirationTime)]:[],...(null===(o=null==p?void 0:p.signInWithSolana)||void 0===o?void 0:o.chainId)?["Chain ID: ".concat(p.signInWithSolana.chainId)]:[],...(null===(a=null==p?void 0:p.signInWithSolana)||void 0===a?void 0:a.nonce)?["Nonce: ".concat(p.signInWithSolana.nonce)]:[],...(null===(l=null==p?void 0:p.signInWithSolana)||void 0===l?void 0:l.requestId)?["Request ID: ".concat(p.signInWithSolana.requestId)]:[],...(null===(u=null===(c=null==p?void 0:p.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...p.signInWithSolana.resources.map(t=>"- ".concat(t))]:[]].join("\n");const t=await y.signMessage((new TextEncoder).encode(f),"utf8");if(!(t&&t instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=t}}try{const{data:e,error:r}=await nr(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:Be(v)},(null===(h=t.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=t.options)||void 0===d?void 0:d.captchaToken}}:null),xform:sr});if(r)throw r;return e&&e.session&&e.user?(e.session&&(await this.Qt(e.session),await this.Mt("SIGNED_IN",e.session)),{data:Object.assign({},e),error:r}):{data:{user:null,session:null},error:new Oe}}catch(w){if(ye(w))return{data:{user:null,session:null},error:w};throw w}}async ee(t){const e=await Me(this.storage,"".concat(this.storageKey,"-code-verifier")),[r,i]=(null!=e?e:"").split("/");try{const{data:e,error:n}=await nr(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:sr});if(await He(this.storage,"".concat(this.storageKey,"-code-verifier")),n)throw n;return e&&e.session&&e.user?(e.session&&(await this.Qt(e.session),await this.Mt("SIGNED_IN",e.session)),{data:Object.assign(Object.assign({},e),{redirectType:null!=i?i:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new Oe}}catch(n){if(ye(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(t){try{const{options:e,provider:r,token:i,access_token:n,nonce:s}=t,o=await nr(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:r,id_token:i,access_token:n,nonce:s,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:sr}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this.Qt(a.session),await this.Mt("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new Oe}}catch(e){if(ye(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(t){var e,r,i,n,s;try{if("email"in t){const{email:i,options:n}=t;let s=null,o=null;"pkce"===this.flowType&&([s,o]=await Ye(this.storage,this.storageKey));const{error:a}=await nr(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:i,data:null!==(e=null==n?void 0:n.data)&&void 0!==e?e:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:s,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in t){const{phone:e,options:r}=t,{data:o,error:a}=await nr(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:e,data:null!==(i=null==r?void 0:r.data)&&void 0!==i?i:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(s=null==r?void 0:r.channel)&&void 0!==s?s:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new Ee("You must provide either an email or phone number.")}catch(o){if(ye(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var e,r;try{let i,n;"options"in t&&(i=null===(e=t.options)||void 0===e?void 0:e.redirectTo,n=null===(r=t.options)||void 0===r?void 0:r.captchaToken);const{data:s,error:o}=await nr(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:sr});if(o)throw o;if(!s)throw Error("An error occurred on token verification.");const a=s.session,l=s.user;return(null==a?void 0:a.access_token)&&(await this.Qt(a),await this.Mt("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(i){if(ye(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(t){var e,r,i;try{let n=null,s=null;return"pkce"===this.flowType&&([n,s]=await Ye(this.storage,this.storageKey)),await nr(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(r=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==r?r:void 0}),(null===(i=null==t?void 0:t.options)||void 0===i?void 0:i.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:s}),headers:this.headers,xform:lr})}catch(n){if(ye(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this.Ht(-1,async()=>await this.re())}async re(){try{return await this.ie(async t=>{const{data:{session:e},error:r}=t;if(r)throw r;if(!e)throw new _e;const{error:i}=await nr(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:i}})}catch(t){if(ye(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const e="".concat(this.url,"/resend");if("email"in t){const{email:r,type:i,options:n}=t,{error:s}=await nr(this.fetch,"POST",e,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:s}}if("phone"in t){const{phone:r,type:i,options:n}=t,{data:s,error:o}=await nr(this.fetch,"POST",e,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==s?void 0:s.message_id},error:o}}throw new Ee("You must provide either an email or phone number and a type")}catch(e){if(ye(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this.Ht(-1,async()=>this.ie(async t=>t))}async Ht(t,e){this.Jt("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await t,await e()))();return this.pendingInLock.push((async()=>{try{await r}catch(t){}})()),r}return await this.lock("lock:".concat(this.storageKey),t,async()=>{this.Jt("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((async()=>{try{await t}catch(e){}})()),await t;this.pendingInLock.length;){const t=[...this.pendingInLock];await Promise.all(t),this.pendingInLock.splice(0,t.length)}return await t}finally{this.Jt("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this.Jt("#_acquireLock","end")}}async ie(t){this.Jt("#_useSession","begin");try{const e=await this.ne();return await t(e)}finally{this.Jt("#_useSession","end")}}async ne(){this.Jt("#__loadSession()","begin"),this.lockAcquired||this.Jt("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let t=null;const e=await Me(this.storage,this.storageKey);if(this.Jt("#getSession()","session from storage",e),null!==e&&(this.se(e)?t=e:(this.Jt("#getSession()","session from storage is not valid"),await this.$t())),!t)return{data:{session:null},error:null};const r=!!t.expires_at&&1e3*t.expires_at-Date.now()<de;if(this.Jt("#__loadSession()","session has".concat(r?"":" not"," expired"),"expires_at",t.expires_at),!r){if(this.userStorage){const e=await Me(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=Ze()}if(this.storage.isServer&&t.user){let e=this.suppressGetSessionWarning;t=new Proxy(t,{get:(t,r,i)=>(e||"user"!==r||(e=!0,this.suppressGetSessionWarning=!0),Reflect.get(t,r,i))})}return{data:{session:t},error:null}}const{data:i,error:n}=await this.oe(t.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this.Jt("#__loadSession()","end")}}async getUser(t){return t?await this.ae(t):(await this.initializePromise,await this.Ht(-1,async()=>await this.ae()))}async ae(t){try{return t?await nr(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:t,xform:ar}):await this.ie(async t=>{var e,r,i;const{data:n,error:s}=t;if(s)throw s;return(null===(e=n.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?await nr(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:null!==(i=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==i?i:void 0,xform:ar}):{data:{user:null},error:new _e}})}catch(e){if(ye(e))return function(t){return ye(t)&&"AuthSessionMissingError"===t.name}(e)&&(await this.$t(),await He(this.storage,"".concat(this.storageKey,"-code-verifier"))),{data:{user:null},error:e};throw e}}async updateUser(t,e={}){return await this.initializePromise,await this.Ht(-1,async()=>await this.le(t,e))}async le(t,e={}){try{return await this.ie(async r=>{const{data:i,error:n}=r;if(n)throw n;if(!i.session)throw new _e;const s=i.session;let o=null,a=null;"pkce"===this.flowType&&null!=t.email&&([o,a]=await Ye(this.storage,this.storageKey));const{data:l,error:c}=await nr(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null==e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:s.access_token,xform:ar});if(c)throw c;return s.user=l.user,await this.Qt(s),await this.Mt("USER_UPDATED",s),{data:{user:s.user},error:null}})}catch(r){if(ye(r))return{data:{user:null},error:r};throw r}}async setSession(t){return await this.initializePromise,await this.Ht(-1,async()=>await this.ce(t))}async ce(t){try{if(!t.access_token||!t.refresh_token)throw new _e;const e=Date.now()/1e3;let r=e,i=!0,n=null;const{payload:s}=Ve(t.access_token);if(s.exp&&(r=s.exp,i=e>=r),i){const{data:e,error:r}=await this.oe(t.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!e)return{data:{user:null,session:null},error:null};n=e}else{const{data:i,error:s}=await this.ae(t.access_token);if(s)throw s;n={access_token:t.access_token,refresh_token:t.refresh_token,user:i.user,token_type:"bearer",expires_in:r-e,expires_at:r},await this.Qt(n),await this.Mt("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(e){if(ye(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(t){return await this.initializePromise,await this.Ht(-1,async()=>await this.ue(t))}async ue(t){try{return await this.ie(async e=>{var r;if(!t){const{data:i,error:n}=e;if(n)throw n;t=null!==(r=i.session)&&void 0!==r?r:void 0}if(!(null==t?void 0:t.refresh_token))throw new _e;const{data:i,error:n}=await this.oe(t.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(ye(e))return{data:{user:null,session:null},error:e};throw e}}async Yt(t,e){try{if(!We())throw new Se("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Se(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if("pkce"===this.flowType)throw new Te("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Se("Not a valid implicit grant flow url.")}if("pkce"===e){if(this.Jt("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Te("No code detected.");const{data:e,error:r}=await this.ee(t.code);if(r)throw r;const i=new URL(window.location.href);return i.searchParams.delete("code"),window.history.replaceState(window.history.state,"",i.toString()),{data:{session:e.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:n,refresh_token:s,expires_in:o,expires_at:a,token_type:l}=t;if(!(n&&o&&s&&l))throw new Se("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(o);let h=c+u;a&&(h=parseInt(a));const{data:d,error:f}=await this.ae(n);if(f)throw f;const v={provider_token:r,provider_refresh_token:i,access_token:n,expires_in:u,expires_at:h,refresh_token:s,token_type:l,user:d.user};return window.location.hash="",this.Jt("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:t.type},error:null}}catch(r){if(ye(r))return{data:{session:null,redirectType:null},error:r};throw r}}Vt(t){return!(!t.access_token&&!t.error_description)}async zt(t){const e=await Me(this.storage,"".concat(this.storageKey,"-code-verifier"));return!(!t.code||!e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this.Ht(-1,async()=>await this.he(t))}async he({scope:t}={scope:"global"}){return await this.ie(async e=>{var r;const{data:i,error:n}=e;if(n)return{error:n};const s=null===(r=i.session)||void 0===r?void 0:r.access_token;if(s){const{error:e}=await this.admin.signOut(s,t);if(e&&(!function(t){return ye(t)&&"AuthApiError"===t.name}(e)||404!==e.status&&401!==e.status&&403!==e.status))return{error:e}}return"others"!==t&&(await this.$t(),await He(this.storage,"".concat(this.storageKey,"-code-verifier"))),{error:null}})}onAuthStateChange(t){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),r={id:e,callback:t,unsubscribe:()=>{this.Jt("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this.Jt("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,r),(async()=>{await this.initializePromise,await this.Ht(-1,async()=>{this.de(e)})})(),{data:{subscription:r}}}async de(t){return await this.ie(async e=>{var r,i;try{const{data:{session:i},error:n}=e;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(t))||void 0===r?void 0:r.callback("INITIAL_SESSION",i)),this.Jt("INITIAL_SESSION","callback id",t,"session",i)}catch(n){await(null===(i=this.stateChangeEmitters.get(t))||void 0===i?void 0:i.callback("INITIAL_SESSION",null)),this.Jt("INITIAL_SESSION","callback id",t,"error",n)}})}async resetPasswordForEmail(t,e={}){let r=null,i=null;"pkce"===this.flowType&&([r,i]=await Ye(this.storage,this.storageKey,!0));try{return await nr(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:t,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(n){if(ye(n))return{data:null,error:n};throw n}}async getUserIdentities(){var t;try{const{data:e,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null}}catch(e){if(ye(e))return{data:null,error:e};throw e}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var e;try{const{data:r,error:i}=await this.ie(async e=>{var r,i,n,s,o;const{data:a,error:l}=e;if(l)throw l;const c=await this.fe("".concat(this.url,"/user/identities/authorize"),t.provider,{redirectTo:null===(r=t.options)||void 0===r?void 0:r.redirectTo,scopes:null===(i=t.options)||void 0===i?void 0:i.scopes,queryParams:null===(n=t.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await nr(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==o?o:void 0})});if(i)throw i;return We()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:t.provider,url:null==r?void 0:r.url},error:null}}catch(r){if(ye(r))return{data:{provider:t.provider,url:null},error:r};throw r}}async linkIdentityIdToken(t){return await this.ie(async e=>{var r;try{const{error:i,data:{session:n}}=e;if(i)throw i;const{options:s,provider:o,token:a,access_token:l,nonce:c}=t,u=await nr(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,jwt:null!==(r=null==n?void 0:n.access_token)&&void 0!==r?r:void 0,body:{provider:o,id_token:a,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:sr}),{data:h,error:d}=u;return d?{data:{user:null,session:null},error:d}:h&&h.session&&h.user?(h.session&&(await this.Qt(h.session),await this.Mt("USER_UPDATED",h.session)),{data:h,error:d}):{data:{user:null,session:null},error:new Oe}}catch(i){if(ye(i))return{data:{user:null,session:null},error:i};throw i}})}async unlinkIdentity(t){try{return await this.ie(async e=>{var r,i;const{data:n,error:s}=e;if(s)throw s;return await nr(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(t.identity_id),{headers:this.headers,jwt:null!==(i=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==i?i:void 0})})}catch(e){if(ye(e))return{data:null,error:e};throw e}}async ve(t){const e="#_refreshAccessToken(".concat(t.substring(0,5),"...)");this.Jt(e,"begin");try{const n=Date.now();return await(r=async r=>(r>0&&await async function(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}(200*Math.pow(2,r-1)),this.Jt(e,"refreshing attempt",r),await nr(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:t},headers:this.headers,xform:sr})),i=(t,e)=>{const r=200*Math.pow(2,t);return e&&ke(e)&&Date.now()+r-n<he},new Promise((t,e)=>{(async()=>{for(let s=0;1/0>s;s++)try{const e=await r(s);if(!i(s,null))return void t(e)}catch(n){if(!i(s,n))return void e(n)}})()}))}catch(n){if(this.Jt(e,"error",n),ye(n))return{data:{session:null,user:null},error:n};throw n}finally{this.Jt(e,"end")}var r,i}se(t){return"object"==typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async te(t,e){const r=await this.fe("".concat(this.url,"/authorize"),t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this.Jt("#_handleProviderSignIn()","provider",t,"options",e,"url",r),We()&&!e.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async Xt(){var t,e;const r="#_recoverAndRefresh()";this.Jt(r,"begin");try{const n=await Me(this.storage,this.storageKey);if(n&&this.userStorage){let e=await Me(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||e||(e={user:n.user},await Je(this.userStorage,this.storageKey+"-user",e)),n.user=null!==(t=null==e?void 0:e.user)&&void 0!==t?t:Ze()}else if(n&&!n.user&&!n.user){const t=await Me(this.storage,this.storageKey+"-user");t&&(null==t?void 0:t.user)?(n.user=t.user,await He(this.storage,this.storageKey+"-user"),await Je(this.storage,this.storageKey,n)):n.user=Ze()}if(this.Jt(r,"session from storage",n),!this.se(n))return this.Jt(r,"session is not valid"),void(null!==n&&await this.$t());const s=1e3*(null!==(e=n.expires_at)&&void 0!==e?e:1/0)-Date.now()<de;if(this.Jt(r,"session has".concat(s?"":" not"," expired with margin of ").concat(de,"s")),s){if(this.autoRefreshToken&&n.refresh_token){const{error:t}=await this.oe(n.refresh_token);t&&(ke(t)||(this.Jt(r,"refresh failed with a non-retryable error, removing the session",t),await this.$t()))}}else if(n.user&&!0===n.user.we)try{const{data:t,error:e}=await this.ae(n.access_token);!e&&(null==t?void 0:t.user)?(n.user=t.user,await this.Qt(n),await this.Mt("SIGNED_IN",n)):this.Jt(r,"could not get user data, skipping SIGNED_IN notification")}catch(i){this.Jt(r,"error getting user data, skipping SIGNED_IN notification",i)}else await this.Mt("SIGNED_IN",n)}catch(n){return void this.Jt(r,"error",n)}finally{this.Jt(r,"end")}}async oe(t){var e,r;if(!t)throw new _e;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i="#_callRefreshToken(".concat(t.substring(0,5),"...)");this.Jt(i,"begin");try{this.refreshingDeferred=new Ke;const{data:e,error:r}=await this.ve(t);if(r)throw r;if(!e.session)throw new _e;await this.Qt(e.session),await this.Mt("TOKEN_REFRESHED",e.session);const i={data:e.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(n){if(this.Jt(i,"error",n),ye(n)){const t={data:null,error:n};return ke(n)||await this.$t(),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(n),n}finally{this.refreshingDeferred=null,this.Jt(i,"end")}}async Mt(t,e,r=!0){const i="#_notifyAllSubscribers(".concat(t,")");this.Jt(i,"begin",e,"broadcast = ".concat(r));try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:e});const i=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(t,e)}catch(n){i.push(n)}});if(await Promise.all(n),i.length>0){for(let t=0;t<i.length;t+=1);throw i[0]}}finally{this.Jt(i,"end")}}async Qt(t){this.Jt("#_saveSession()",t),this.suppressGetSessionWarning=!0;const e=Object.assign({},t),r=e.user&&!0===e.user.we;if(this.userStorage){!r&&e.user&&await Je(this.userStorage,this.storageKey+"-user",{user:e.user});const t=Object.assign({},e);delete t.user;const i=tr(t);await Je(this.storage,this.storageKey,i)}else{const t=tr(e);await Je(this.storage,this.storageKey,t)}}async $t(){this.Jt("#_removeSession()"),await He(this.storage,this.storageKey),await He(this.storage,this.storageKey+"-code-verifier"),await He(this.storage,this.storageKey+"-user"),this.userStorage&&await He(this.userStorage,this.storageKey+"-user"),await this.Mt("SIGNED_OUT",null)}pe(){this.Jt("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&We()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){}}async ye(){await this.be(),this.Jt("#_startAutoRefresh()");const t=setInterval(()=>this.ge(),he);this.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this.ge()},0)}async be(){this.Jt("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this.pe(),await this.ye()}async stopAutoRefresh(){this.pe(),await this.be()}async ge(){this.Jt("#_autoRefreshTokenTick()","begin");try{await this.Ht(0,async()=>{try{const e=Date.now();try{return await this.ie(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this.Jt("#_autoRefreshTokenTick()","no session");const i=Math.floor((1e3*r.expires_at-e)/he);this.Jt("#_autoRefreshTokenTick()","access token expires in ".concat(i," ticks, a tick lasts ").concat(he,"ms, refresh threshold is ").concat(3," ticks")),i>3||await this.oe(r.refresh_token)})}catch(t){}}finally{this.Jt("#_autoRefreshTokenTick()","end")}})}catch(t){if(!(t.isAcquireTimeout||t instanceof wr))throw t;this.Jt("auto refresh token tick lock not available")}}async Zt(){if(this.Jt("#_handleVisibilityChange()"),!We()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this.me(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this.me(!0)}catch(t){}}async me(t){const e="#_onVisibilityChanged(".concat(t,")");this.Jt(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this.ye(),t||(await this.initializePromise,await this.Ht(-1,async()=>{"visible"===document.visibilityState?await this.Xt():this.Jt(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this.be()}async fe(t,e,r){const i=["provider=".concat(encodeURIComponent(e))];if((null==r?void 0:r.redirectTo)&&i.push("redirect_to=".concat(encodeURIComponent(r.redirectTo))),(null==r?void 0:r.scopes)&&i.push("scopes=".concat(encodeURIComponent(r.scopes))),"pkce"===this.flowType){const[t,e]=await Ye(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(t)),code_challenge_method:"".concat(encodeURIComponent(e))});i.push(r.toString())}if(null==r?void 0:r.queryParams){const t=new URLSearchParams(r.queryParams);i.push(t.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&i.push("skip_http_redirect=".concat(r.skipBrowserRedirect)),"".concat(t,"?").concat(i.join("&"))}async Gt(t){try{return await this.ie(async e=>{var r;const{data:i,error:n}=e;return n?{data:null,error:n}:await nr(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(t.factorId),{headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token})})}catch(e){if(ye(e))return{data:null,error:e};throw e}}async Ut(t){try{return await this.ie(async e=>{var r,i;const{data:n,error:s}=e;if(s)return{data:null,error:s};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:"totp"===t.factorType?{issuer:t.issuer}:{}),{data:a,error:l}=await nr(this.fetch,"POST","".concat(this.url,"/factors"),{body:o,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:("totp"===t.factorType&&"totp"===a.type&&(null===(i=null==a?void 0:a.totp)||void 0===i?void 0:i.qr_code)&&(a.totp.qr_code="data:image/svg+xml;utf-8,".concat(a.totp.qr_code)),{data:a,error:null})})}catch(e){if(ye(e))return{data:null,error:e};throw e}}async Dt(t){return this.Ht(-1,async()=>{try{return await this.ie(async e=>{var r;const{data:i,error:n}=e;if(n)return{data:null,error:n};const s=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:"create"===t.webauthn.type?Ar(t.webauthn.credential_response):Ir(t.webauthn.credential_response)})}:{code:t.code}),{data:o,error:a}=await nr(this.fetch,"POST","".concat(this.url,"/factors/").concat(t.factorId,"/verify"),{body:s,headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token});return a?{data:null,error:a}:(await this.Qt(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this.Mt("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(e){if(ye(e))return{data:null,error:e};throw e}})}async Ct(t){return this.Ht(-1,async()=>{try{return await this.ie(async e=>{var r;const{data:i,error:n}=e;if(n)return{data:null,error:n};const s=await nr(this.fetch,"POST","".concat(this.url,"/factors/").concat(t.factorId,"/challenge"),{body:t,headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token});if(s.error)return s;const{data:o}=s;if("webauthn"!==o.type)return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:jr(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:kr(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(ye(e))return{data:null,error:e};throw e}})}async qt(t){const{data:e,error:r}=await this.Ct({factorId:t.factorId});return r?{data:null,error:r}:await this.Dt({factorId:t.factorId,challengeId:e.id,code:t.code})}async jt(){var t;const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const i={all:[],phone:[],totp:[],webauthn:[]};for(const n of null!==(t=null==e?void 0:e.factors)&&void 0!==t?t:[])i.all.push(n),"verified"===n.status&&i[n.factor_type].push(n);return{data:i,error:null}}async Ft(){return this.Ht(-1,async()=>await this.ie(async t=>{var e,r;const{data:{session:i},error:n}=t;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=Ve(i.access_token);let o=null;s.aal&&(o=s.aal);let a=o;return(null!==(r=null===(e=i.user.factors)||void 0===e?void 0:e.filter(t=>"verified"===t.status))&&void 0!==r?r:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:s.amr||[]},error:null}}))}async fetchJwk(t,e={keys:[]}){let r=e.keys.find(e=>e.kid===t);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(e=>e.kid===t),r&&this.jwks_cached_at+6e5>i)return r;const{data:n,error:s}=await nr(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(s)throw s;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=i,r=n.keys.find(e=>e.kid===t),r||null):null}async getClaims(t,e={}){try{let r=t;if(!r){const{data:t,error:e}=await this.getSession();if(e||!t.session)return{data:null,error:e};r=t.session.access_token}const{header:i,payload:n,signature:s,raw:{header:o,payload:a}}=Ve(r);(null==e?void 0:e.allowExpired)||function(t){if(!t)throw Error("Missing exp claim");if(Math.floor(Date.now()/1e3)>=t)throw Error("JWT has expired")}(n.exp);const l=i.alg&&!i.alg.startsWith("HS")&&i.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(i.kid,(null==e?void 0:e.keys)?{keys:e.keys}:null==e?void 0:e.jwks):null;if(!l){const{error:t}=await this.getUser(r);if(t)throw t;return{data:{claims:n,header:i,signature:s},error:null}}const c=function(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(i.alg),u=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(await crypto.subtle.verify(c,u,s,function(t){const e=[];return function(t,e){for(let r=0;r<t.length;r+=1){let i=t.charCodeAt(r);if(i>55295&&56319>=i){const e=1024*(i-55296)&65535;i=65536+(t.charCodeAt(r+1)-56320&65535|e),r+=1}De(i,e)}}(t,t=>e.push(t)),new Uint8Array(e)}("".concat(o,".").concat(a)))))throw new Ie("Invalid JWT signature");return{data:{claims:n,header:i,signature:s},error:null}}catch(r){if(ye(r))return{data:null,error:r};throw r}}}Wr.nextInstanceID=0;const Gr=Wr;export{Gr as A,v as F,S as H,X as P,qt as R,ue as S,a as _,E as n,s};
