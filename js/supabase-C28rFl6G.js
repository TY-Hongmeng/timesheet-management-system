import{H as t,n as e,A as n,P as i,S as s,F as r,R as o}from"./vendor-_fbq4b22.js";let a="";a="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const c={headers:{"X-Client-Info":`supabase-js-${a}/2.75.0`}},h={schema:"public"},u={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},l={};class d extends n{constructor(t){super(t)}}class f{constructor(n,r,o){var a,d,f;this.supabaseUrl=n,this.supabaseKey=r;const v=function(t){const e=null==t?void 0:t.trim();if(!e)throw Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((n=e).endsWith("/")?n:n+"/")}catch(a){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var n}(n);if(!r)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const b=`sb-${v.hostname.split(".")[0]}-auth-token`,p=function(t,e){var n,i;const{db:s,auth:r,realtime:o,global:a}=t,{db:c,auth:h,realtime:u,global:l}=e,d={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},h),r),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},l),a),{headers:Object.assign(Object.assign({},null!==(n=null==l?void 0:l.headers)&&void 0!==n?n:{}),null!==(i=null==a?void 0:a.headers)&&void 0!==i?i:{})}),accessToken:()=>{return t=this,n=function*(){return""},new((e=void 0)||(e=Promise))(function(i,s){function r(t){try{a(n.next(t))}catch(e){s(e)}}function o(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e(function(t){t(n)})).then(r,o)}a((n=n.call(t)).next())});var t,e,n}};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}(null!=o?o:{},{db:h,realtime:l,auth:Object.assign(Object.assign({},u),{storageKey:b}),global:c});this.storageKey=null!==(a=p.auth.storageKey)&&void 0!==a?a:"",this.headers=null!==(d=p.global.headers)&&void 0!==d?d:{},p.accessToken?(this.accessToken=p.accessToken,this.auth=new Proxy({},{get:(t,e)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${e+""} is not possible`)}})):this.auth=this.t(null!==(f=p.auth)&&void 0!==f?f:{},this.headers,p.global.fetch),this.fetch=((n,i,s)=>{const r=(t=>{let n;return n=t||("undefined"==typeof fetch?e:fetch),(...t)=>n(...t)})(s),o="undefined"==typeof Headers?t:Headers;return(t,e)=>{return a=function*(){var s;const a=null!==(s=yield i())&&void 0!==s?s:n;let c=new o(null==e?void 0:e.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization","Bearer "+a),r(t,Object.assign(Object.assign({},e),{headers:c}))},new((s=void 0)||(s=Promise))(function(t,e){function n(t){try{r(a.next(t))}catch(n){e(n)}}function i(t){try{r(a.throw(t))}catch(n){e(n)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof s?r:new s(function(t){t(r)})).then(n,i)}r((a=a.call(void 0)).next())});var s,a}})(r,this.i.bind(this),p.global.fetch),this.realtime=this.o(Object.assign({headers:this.headers,accessToken:this.i.bind(this)},p.realtime)),this.rest=new i(new URL("rest/v1",v).href,{headers:this.headers,schema:p.db.schema,fetch:this.fetch}),this.storage=new s(this.storageUrl.href,this.headers,this.fetch,null==o?void 0:o.storage),p.accessToken||this.h()}get functions(){return new r(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}i(){return t=this,n=function*(){var t,e;if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return null!==(e=null===(t=n.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:this.supabaseKey},new((e=void 0)||(e=Promise))(function(i,s){function r(t){try{a(n.next(t))}catch(e){s(e)}}function o(t){try{a(n.throw(t))}catch(e){s(e)}}function a(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e(function(t){t(n)})).then(r,o)}a((n=n.call(t)).next())});var t,e,n}t({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:i,userStorage:s,storageKey:r,flowType:o,lock:a,debug:c},h,u){const l={Authorization:"Bearer "+this.supabaseKey,apikey:""+this.supabaseKey};return new d({url:this.authUrl.href,headers:Object.assign(Object.assign({},l),h),storageKey:r,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:i,userStorage:s,flowType:o,lock:a,debug:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(t=>"authorization"===t.toLowerCase())})}o(t){return new o(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},null==t?void 0:t.params)}))}h(){return this.auth.onAuthStateChange((t,e)=>{this.u(t,"CLIENT",null==e?void 0:e.access_token)})}u(t,e,n){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===n?"SIGNED_OUT"===t&&(this.realtime.setAuth(),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=n,this.realtime.setAuth(n))}}const v=(t,e,n)=>new f(t,e,n);!function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const t=process.version;if(null==t)return!1;const e=t.match(/^v(\d+)\./);e&&e[1]}();export{v as c};
