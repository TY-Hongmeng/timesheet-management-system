import{r as t,a as e,c as r}from"./react-BjXQKpih.js";import"./react-dom-BYPRsttm.js";var n,i={exports:{}},s={};n=s,function(){function t(t,e){var r=t.length;t.push(e),function(t,e,r){for(var n=r;n>0;){var s=n-1>>>1,o=t[s];if(0>=i(o,e))return;t[s]=e,t[n]=o,n=s}}(t,e,r)}function e(t){return 0===t.length?null:t[0]}function r(t){if(0===t.length)return null;var e=t[0],r=t.pop();return r!==e&&(t[0]=r,function(t,e){for(var r=0,n=t.length,s=n>>>1;s>r;){var o=2*(r+1)-1,a=t[o],l=o+1,u=t[l];if(0>i(a,e))n>l&&0>i(u,a)?(t[r]=u,t[l]=e,r=l):(t[r]=a,t[o]=e,r=o);else{if(l>=n||i(u,e)>=0)return;t[r]=u,t[l]=e,r=l}}}(t,r)),e}function i(t,e){var r=t.sortIndex-e.sortIndex;return 0!==r?r:t.id-e.id}if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error()),"object"==typeof performance&&"function"==typeof performance.now){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,h=null,d=3,f=!1,v=!1,p=!1,w="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,m="undefined"!=typeof setImmediate?setImmediate:null;function b(n){for(var i=e(u);null!==i;){if(null===i.callback)r(u);else{if(i.startTime>n)return;r(u),i.sortIndex=i.expirationTime,t(l,i)}i=e(u)}}function g(t){if(p=!1,b(t),!v)if(null!==e(l))v=!0,$(_);else{var r=e(u);null!==r&&x(g,r.startTime-t)}}function _(t,i){v=!1,p&&(p=!1,N()),f=!0;var s=d;try{return function(t,i){var s=i;for(b(s),h=e(l);null!==h&&(h.expirationTime<=s||t&&!R());){var o=h.callback;if("function"==typeof o){h.callback=null,d=h.priorityLevel;var a=o(h.expirationTime<=s);s=n.unstable_now(),"function"==typeof a?h.callback=a:h===e(l)&&r(l),b(s)}else r(l);h=e(l)}if(null!==h)return!0;var c=e(u);return null!==c&&x(g,c.startTime-s),!1}(t,i)}finally{h=null,d=s,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E=!1,O=null,S=-1,T=5,k=-1;function R(){return n.unstable_now()-k>=T}var j,A=function(){if(null!==O){var t=n.unstable_now();k=t;var e=!0;try{e=O(!0,t)}finally{e?j():(E=!1,O=null)}}else E=!1};if("function"==typeof m)j=function(){m(A)};else if("undefined"!=typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=A,j=function(){P.postMessage(null)}}else j=function(){w(A,0)};function $(t){O=t,E||(E=!0,j())}function x(t,e){S=w(function(){t(n.unstable_now())},e)}function N(){y(S),S=-1}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(t){t.callback=null},n.unstable_continueExecution=function(){v||f||(v=!0,$(_))},n.unstable_forceFrameRate=function(t){0>t||t>125||(T=t>0?Math.floor(1e3/t):5)},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return e(l)},n.unstable_next=function(t){var e;switch(d){case 1:case 2:case 3:e=3;break;default:e=d}var r=d;d=e;try{return t()}finally{d=r}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var r=d;d=t;try{return e()}finally{d=r}},n.unstable_scheduleCallback=function(r,i,s){var o,a,h=n.unstable_now();if("object"==typeof s&&null!==s){var d=s.delay;o="number"==typeof d&&d>0?h+d:h}else o=h;switch(r){case 1:a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}var w=o+a,y={id:c++,callback:i,priorityLevel:r,startTime:o,expirationTime:w,sortIndex:-1};return o>h?(y.sortIndex=o,t(u,y),null===e(l)&&y===e(u)&&(p?N():p=!0,x(g,o-h))):(y.sortIndex=w,t(l,y),v||f||(v=!0,$(_))),y},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(t){var e=d;return function(){var r=d;d=e;try{return t.apply(this,arguments)}finally{d=r}}},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}(),i.exports=s;var o=i.exports;const a={},l=function(t,e,r){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),r=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));n=Promise.allSettled(e.map(t=>{if((t=function(t){return"/timesheet-management-system/"+t}(t))in a)return;a[t]=!0;const e=t.endsWith(".css"),n=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${n}`))return;const i=document.createElement("link");return i.rel=e?"stylesheet":"modulepreload",e||(i.as="script"),i.crossOrigin="",i.href=t,r&&i.setAttribute("nonce",r),document.head.appendChild(i),e?new Promise((e,r)=>{i.addEventListener("load",e),i.addEventListener("error",()=>r(Error("Unable to preload CSS for "+t)))}):void 0}))}function i(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return n.then(e=>{for(const t of e||[])"rejected"===t.status&&i(t.reason);return t().catch(i)})};var u="popstate";function c(t,e){if(!1===t||null==t)throw Error(e)}function h(t,e){if(!t)try{throw Error(e)}catch(r){}}function d(t,e){return{usr:t.state,key:t.key,idx:e}}function f(t,e,r=null,n){return{pathname:"string"==typeof t?t:t.pathname,search:"",hash:"",..."string"==typeof e?p(e):e,state:r,key:e&&e.key||n||Math.random().toString(36).substring(2,10)}}function v({pathname:t="/",search:e="",hash:r=""}){return e&&"?"!==e&&(t+="?"===e.charAt(0)?e:"?"+e),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function p(t){let e={};if(t){let r=t.indexOf("#");0>r||(e.hash=t.substring(r),t=t.substring(0,r));let n=t.indexOf("?");0>n||(e.search=t.substring(n),t=t.substring(0,n)),t&&(e.pathname=t)}return e}function w(t,e,r="/"){return function(t,e,r){let n=I(("string"==typeof e?p(e):e).pathname||"/",r);if(null==n)return null;let i=y(t);!function(t){t.sort((t,e)=>t.score!==e.score?e.score-t.score:function(t,e){return t.length===e.length&&t.slice(0,-1).every((t,r)=>t===e[r])?t[t.length-1]-e[e.length-1]:0}(t.routesMeta.map(t=>t.childrenIndex),e.routesMeta.map(t=>t.childrenIndex)))}(i);let s=null;for(let o=0;null==s&&o<i.length;++o){let t=A(n);s=R(i[o],t,!1)}return s}(t,e,r)}function y(t,e=[],r=[],n="",i=!1){let s=(t,s,o=i,a)=>{let l={relativePath:void 0===a?t.path||"":a,caseSensitive:!0===t.caseSensitive,childrenIndex:s,route:t};if(l.relativePath.startsWith("/")){if(!l.relativePath.startsWith(n)&&o)return;c(l.relativePath.startsWith(n),`Absolute route path "${l.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(n.length)}let u=N([n,l.relativePath]),h=r.concat(l);t.children&&t.children.length>0&&(c(!0!==t.index,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),y(t.children,e,h,u,o)),(null!=t.path||t.index)&&e.push({path:u,score:k(u,t.index),routesMeta:h})};return t.forEach((t,e)=>{var r;if(""!==t.path&&(null==(r=t.path)?void 0:r.includes("?")))for(let n of m(t.path))s(t,e,!0,n);else s(t,e)}),e}function m(t){let e=t.split("/");if(0===e.length)return[];let[r,...n]=e,i=r.endsWith("?"),s=r.replace(/\?$/,"");if(0===n.length)return i?[s,""]:[s];let o=m(n.join("/")),a=[];return a.push(...o.map(t=>""===t?s:[s,t].join("/"))),i&&a.push(...o),a.map(e=>t.startsWith("/")&&""===e?"/":e)}var b=/^:[\w-]+$/,g=3,_=2,E=1,O=10,S=-2,T=t=>"*"===t;function k(t,e){let r=t.split("/"),n=r.length;return r.some(T)&&(n+=S),e&&(n+=_),r.filter(t=>!T(t)).reduce((t,e)=>t+(b.test(e)?g:""===e?E:O),n)}function R(t,e,r=!1){let{routesMeta:n}=t,i={},s="/",o=[];for(let a=0;a<n.length;++a){let t=n[a],l=a===n.length-1,u="/"===s?e:e.slice(s.length)||"/",c=j({path:t.relativePath,caseSensitive:t.caseSensitive,end:l},u),h=t.route;if(!c&&l&&r&&!n[n.length-1].route.index&&(c=j({path:t.relativePath,caseSensitive:t.caseSensitive,end:!1},u)),!c)return null;Object.assign(i,c.params),o.push({params:i,pathname:N([s,c.pathname]),pathnameBase:U(N([s,c.pathnameBase])),route:h}),"/"!==c.pathnameBase&&(s=N([s,c.pathnameBase]))}return o}function j(t,e){"string"==typeof t&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=function(t,e=!1,r=!0){h("*"===t||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(t,e,r)=>(n.push({paramName:e,isOptional:null!=r}),r?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(n.push({paramName:"*"}),i+="*"===t||"/*"===t?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":""!==t&&"/"!==t&&(i+="(?:(?=\\/|$))"),[RegExp(i,e?void 0:"i"),n]}(t.path,t.caseSensitive,t.end),i=e.match(r);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:n.reduce((t,{paramName:e,isOptional:r},n)=>{if("*"===e){let t=a[n]||"";o=s.slice(0,s.length-t.length).replace(/(.)\/+$/,"$1")}const i=a[n];return t[e]=r&&!i?void 0:(i||"").replace(/%2F/g,"/"),t},{}),pathname:s,pathnameBase:o,pattern:t}}function A(t){try{return t.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(e){return h(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function I(t,e){if("/"===e)return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&"/"!==n?null:t.slice(r)||"/"}function P(t,e,r,n){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function $(t){let e=function(t){return t.filter((t,e)=>0===e||t.route.path&&t.route.path.length>0)}(t);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function x(t,e,r,n=!1){let i;"string"==typeof t?i=p(t):(i={...t},c(!i.pathname||!i.pathname.includes("?"),P("?","pathname","search",i)),c(!i.pathname||!i.pathname.includes("#"),P("#","pathname","hash",i)),c(!i.search||!i.search.includes("#"),P("#","search","hash",i)));let s,o=""===t||""===i.pathname,a=o?"/":i.pathname;if(null==a)s=r;else{let t=e.length-1;if(!n&&a.startsWith("..")){let e=a.split("/");for(;".."===e[0];)e.shift(),t-=1;i.pathname=e.join("/")}s=0>t?"/":e[t]}let l=function(t,e="/"){let{pathname:r,search:n="",hash:i=""}="string"==typeof t?p(t):t,s=r?r.startsWith("/")?r:function(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(t=>{".."===t?r.length>1&&r.pop():"."!==t&&r.push(t)}),r.length>1?r.join("/"):"/"}(r,e):e;return{pathname:s,search:C(n),hash:D(i)}}(i,s),u=a&&"/"!==a&&a.endsWith("/"),h=(o||"."===a)&&r.endsWith("/");return l.pathname.endsWith("/")||!u&&!h||(l.pathname+="/"),l}var N=t=>t.join("/").replace(/\/\/+/g,"/"),U=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),C=t=>t&&"?"!==t?t.startsWith("?")?t:"?"+t:"",D=t=>t&&"#"!==t?t.startsWith("#")?t:"#"+t:"",L=["POST","PUT","PATCH","DELETE"];new Set(L);var B=["GET",...L];new Set(B);var F=t.createContext(null);F.displayName="DataRouter";var M=t.createContext(null);M.displayName="DataRouterState",t.createContext(!1);var W=t.createContext({isTransitioning:!1});W.displayName="ViewTransition",t.createContext(new Map).displayName="Fetchers",t.createContext(null).displayName="Await";var J=t.createContext(null);J.displayName="Navigation";var H=t.createContext(null);H.displayName="Location";var G=t.createContext({outlet:null,matches:[],isDataRoute:!1});G.displayName="Route";var q=t.createContext(null);function K(){return null!=t.useContext(H)}function V(){return c(K(),"useLocation() may be used only in the context of a <Router> component."),t.useContext(H).location}q.displayName="RouteError";var z="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Y(e){t.useContext(J).static||t.useLayoutEffect(e)}function X(){let{isDataRoute:e}=t.useContext(G);return e?function(){let{router:e}=function(){let e=t.useContext(F);return c(e,st("useNavigate")),e}(),r=ot("useNavigate"),n=t.useRef(!1);return Y(()=>{n.current=!0}),t.useCallback(async(t,i={})=>{h(n.current,z),n.current&&("number"==typeof t?e.navigate(t):await e.navigate(t,{fromRouteId:r,...i}))},[e,r])}():function(){c(K(),"useNavigate() may be used only in the context of a <Router> component.");let e=t.useContext(F),{basename:r,navigator:n}=t.useContext(J),{matches:i}=t.useContext(G),{pathname:s}=V(),o=JSON.stringify($(i)),a=t.useRef(!1);return Y(()=>{a.current=!0}),t.useCallback((t,i={})=>{if(h(a.current,z),!a.current)return;if("number"==typeof t)return void n.go(t);let l=x(t,JSON.parse(o),s,"path"===i.relative);null==e&&"/"!==r&&(l.pathname="/"===l.pathname?r:N([r,l.pathname])),(i.replace?n.replace:n.push)(l,i.state,i)},[r,n,o,s,e])}()}function Q(){let{matches:e}=t.useContext(G),r=e[e.length-1];return r?r.params:{}}function Z(e,{relative:r}={}){let{matches:n}=t.useContext(G),{pathname:i}=V(),s=JSON.stringify($(n));return t.useMemo(()=>x(e,JSON.parse(s),i,"path"===r),[e,s,i,r])}function tt(e,r,n,i,s){var o;c(K(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=t.useContext(J),{matches:l}=t.useContext(G),u=l[l.length-1],d=u?u.params:{},f=u?u.pathname:"/",v=u?u.pathnameBase:"/",y=u&&u.route;{let t=y&&y.path||"";lt(f,!y||t.endsWith("*")||t.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${t}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="${t}"> to <Route path="${"/"===t?"*":t+"/*"}">.`)}let m,b=V();if(r){let t="string"==typeof r?p(r):r;c("/"===v||(null==(o=t.pathname)?void 0:o.startsWith(v)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${v}" but pathname "${t.pathname}" was given in the \`location\` prop.`),m=t}else m=b;let g=m.pathname||"/",_=g;if("/"!==v){let t=v.replace(/^\//,"").split("/");_="/"+g.replace(/^\//,"").split("/").slice(t.length).join("/")}let E=w(e,{pathname:_});h(y||null!=E,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),h(null==E||void 0!==E[E.length-1].route.element||void 0!==E[E.length-1].route.Component||void 0!==E[E.length-1].route.lazy,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let O=function(e,r=[],n=null,i=null){if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==r.length||n.initialized||0>=n.matches.length)return null;e=n.matches}}let s=e,o=null==n?void 0:n.errors;if(null!=o){let t=s.findIndex(t=>t.route.id&&void 0!==(null==o?void 0:o[t.route.id]));c(t>=0,"Could not find a matching route for errors on route IDs: "+Object.keys(o).join(",")),s=s.slice(0,Math.min(s.length,t+1))}let a=!1,l=-1;if(n)for(let t=0;t<s.length;t++){let e=s[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(l=t),e.route.id){let{loaderData:t,errors:r}=n,i=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!r||void 0===r[e.route.id]);if(e.route.lazy||i){a=!0,s=0>l?[s[0]]:s.slice(0,l+1);break}}}return s.reduceRight((e,u,c)=>{let h,d=!1,f=null,v=null;n&&(h=o&&u.route.id?o[u.route.id]:void 0,f=u.route.errorElement||rt,a&&(0>l&&0===c?(lt("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,v=null):l===c&&(d=!0,v=u.route.hydrateFallbackElement||null)));let p=r.concat(s.slice(0,c+1)),w=()=>{let r;return r=h?f:d?v:u.route.Component?t.createElement(u.route.Component,null):u.route.element?u.route.element:e,t.createElement(it,{match:u,routeContext:{outlet:e,matches:p,isDataRoute:null!=n},children:r})};return n&&(u.route.ErrorBoundary||u.route.errorElement||0===c)?t.createElement(nt,{location:n.location,revalidation:n.revalidation,component:f,error:h,children:w(),routeContext:{outlet:null,matches:p,isDataRoute:!0},unstable_onError:i}):w()},null)}(E&&E.map(t=>Object.assign({},t,{params:Object.assign({},d,t.params),pathname:N([v,a.encodeLocation?a.encodeLocation(t.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:t.pathname]),pathnameBase:"/"===t.pathnameBase?v:N([v,a.encodeLocation?a.encodeLocation(t.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:t.pathnameBase])})),l,n,i);return r&&O?t.createElement(H.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},O):O}function et(){let e=function(){var e;let r=t.useContext(q),n=function(){let e=t.useContext(M);return c(e,st("useRouteError")),e}(),i=ot("useRouteError");return void 0!==r?r:null==(e=n.errors)?void 0:e[i]}(),r=function(t){return null!=t&&"number"==typeof t.status&&"string"==typeof t.statusText&&"boolean"==typeof t.internal&&"data"in t}(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i},o={padding:"2px 4px",backgroundColor:i},a=null;return a=t.createElement(t.Fragment,null,t.createElement("p",null,"💿 Hey developer 👋"),t.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",t.createElement("code",{style:o},"ErrorBoundary")," or"," ",t.createElement("code",{style:o},"errorElement")," prop on your route.")),t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},r),n?t.createElement("pre",{style:s},n):null,a)}t.createContext(null);var rt=t.createElement(et,null),nt=class extends t.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||"idle"!==e.revalidation&&"idle"===t.revalidation?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:void 0!==t.error?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.unstable_onError&&this.props.unstable_onError(t,e)}render(){return void 0!==this.state.error?t.createElement(G.Provider,{value:this.props.routeContext},t.createElement(q.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function it({routeContext:e,match:r,children:n}){let i=t.useContext(F);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext.t=r.route.id),t.createElement(G.Provider,{value:e},n)}function st(t){return t+" must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router."}function ot(e){let r=function(e){let r=t.useContext(G);return c(r,st(e)),r}(e),n=r.matches[r.matches.length-1];return c(n.route.id,e+' can only be used on routes that contain a unique "id"'),n.route.id}var at={};function lt(t,e,r){e||at[t]||(at[t]=!0,h(!1,r))}function ut({to:e,replace:r,state:n,relative:i}){c(K(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=t.useContext(J);h(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=t.useContext(G),{pathname:a}=V(),l=X(),u=x(e,$(o),a,"path"===i),d=JSON.stringify(u);return t.useEffect(()=>{l(JSON.parse(d),{replace:r,state:n,relative:i})},[l,d,i,r,n]),null}function ct(t){c(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function ht({basename:e="/",children:r=null,location:n,navigationType:i="POP",navigator:s,static:o=!1}){c(!K(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=e.replace(/^\/*/,"/"),l=t.useMemo(()=>({basename:a,navigator:s,static:o,future:{}}),[a,s,o]);"string"==typeof n&&(n=p(n));let{pathname:u="/",search:d="",hash:f="",state:v=null,key:w="default"}=n,y=t.useMemo(()=>{let t=I(u,a);return null==t?null:{location:{pathname:t,search:d,hash:f,state:v,key:w},navigationType:i}},[a,u,d,f,v,w,i]);return h(null!=y,`<Router basename="${a}"> is not able to match the URL "${u}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),null==y?null:t.createElement(J.Provider,{value:l},t.createElement(H.Provider,{children:r,value:y}))}function dt({children:t,location:e}){return tt(ft(t),e)}function ft(e,r=[]){let n=[];return t.Children.forEach(e,(e,i)=>{if(!t.isValidElement(e))return;let s=[...r,i];if(e.type===t.Fragment)return void n.push.apply(n,ft(e.props.children,s));c(e.type===ct,`[${"string"==typeof e.type?e.type:e.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),c(!e.props.index||!e.props.children,"An index route cannot have child routes.");let o={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,middleware:e.props.middleware,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=ft(e.props.children,s)),n.push(o)}),n}t.memo(function({routes:t,future:e,state:r,unstable_onError:n}){return tt(t,void 0,r,n)});var vt="get",pt="application/x-www-form-urlencoded";function wt(t){return null!=t&&"string"==typeof t.tagName}var yt=null,mt=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function bt(t){return null==t||mt.has(t)?t:(h(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${pt}"`),null)}function gt(t,e){if(!1===t||null==t)throw Error(e)}function _t(t){return null!=t&&(null==t.href?"preload"===t.rel&&"string"==typeof t.imageSrcSet&&"string"==typeof t.imageSizes:"string"==typeof t.rel&&"string"==typeof t.href)}function Et(t,e,r,n,i,s){let o=(t,e)=>!r[e]||t.route.id!==r[e].route.id,a=(t,e)=>{var n;return r[e].pathname!==t.pathname||(null==(n=r[e].route.path)?void 0:n.endsWith("*"))&&r[e].params["*"]!==t.params["*"]};return"assets"===s?e.filter((t,e)=>o(t,e)||a(t,e)):"data"===s?e.filter((e,s)=>{var l;let u=n.routes[e.route.id];if(!u||!u.hasLoader)return!1;if(o(e,s)||a(e,s))return!0;if(e.route.shouldRevalidate){let n=e.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:(null==(l=r[0])?void 0:l.params)||{},nextUrl:new URL(t,window.origin),nextParams:e.params,defaultShouldRevalidate:!0});if("boolean"==typeof n)return n}return!0}):[]}function Ot(){let e=t.useContext(F);return gt(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var St=t.createContext(void 0);function Tt(){let e=t.useContext(St);return gt(e,"You must render this element inside a <HydratedRouter> element"),e}function kt(t,e){return r=>{t&&t(r),r.defaultPrevented||e(r)}}function Rt({page:e,...r}){let{router:n}=Ot(),i=t.useMemo(()=>w(n.routes,e,n.basename),[n.routes,e,n.basename]);return i?t.createElement(jt,{page:e,matches:i,...r}):null}function jt({page:e,matches:r,...n}){let i=V(),{manifest:s,routeModules:o}=Tt(),{basename:a}=Ot(),{loaderData:l,matches:u}=function(){let e=t.useContext(M);return gt(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}(),c=t.useMemo(()=>Et(e,r,u,s,i,"data"),[e,r,u,s,i]),h=t.useMemo(()=>Et(e,r,u,s,i,"assets"),[e,r,u,s,i]),d=t.useMemo(()=>{if(e===i.pathname+i.search+i.hash)return[];let t=new Set,n=!1;if(r.forEach(e=>{var r;let i=s.routes[e.route.id];i&&i.hasLoader&&(!c.some(t=>t.route.id===e.route.id)&&e.route.id in l&&(null==(r=o[e.route.id])?void 0:r.shouldRevalidate)||i.hasClientLoader?n=!0:t.add(e.route.id))}),0===t.size)return[];let u=function(t,e,r){let n="string"==typeof t?new URL(t,"undefined"==typeof window?"server://singlefetch/":window.location.origin):t;return"/"===n.pathname?n.pathname="_root."+r:e&&"/"===I(n.pathname,e)?n.pathname=`${e.replace(/\/$/,"")}/_root.${r}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${r}`,n}(e,a,"data");return n&&t.size>0&&u.searchParams.set("_routes",r.filter(e=>t.has(e.route.id)).map(t=>t.route.id).join(",")),[u.pathname+u.search]},[a,l,i,s,c,r,e,o]),f=t.useMemo(()=>function(t,e,{includeHydrateFallback:r}={}){return n=t.map(t=>{let n=e.routes[t.route.id];if(!n)return[];let i=[n.module];return n.clientActionModule&&(i=i.concat(n.clientActionModule)),n.clientLoaderModule&&(i=i.concat(n.clientLoaderModule)),r&&n.hydrateFallbackModule&&(i=i.concat(n.hydrateFallbackModule)),n.imports&&(i=i.concat(n.imports)),i}).flat(1),[...new Set(n)];var n}(h,s),[h,s]),v=function(e){let{manifest:r,routeModules:n}=Tt(),[i,s]=t.useState([]);return t.useEffect(()=>{let t=!1;return async function(t,e,r){return function(t){let e=new Set;return new Set(void 0),t.reduce((t,r)=>{let n=JSON.stringify(function(t){let e={},r=Object.keys(t).sort();for(let n of r)e[n]=t[n];return e}(r));return e.has(n)||(e.add(n),t.push({key:n,link:r})),t},[])}((await Promise.all(t.map(async t=>{let n=e.routes[t.route.id];if(n){let t=await async function(t,e){if(t.id in e)return e[t.id];try{let r=await import(t.module);return e[t.id]=r,r}catch(r){return window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}(n,r);return t.links?t.links():[]}return[]}))).flat(1).filter(_t).filter(t=>"stylesheet"===t.rel||"preload"===t.rel).map(t=>"stylesheet"===t.rel?{...t,rel:"prefetch",as:"style"}:{...t,rel:"prefetch"}))}(e,r,n).then(e=>{t||s(e)}),()=>{t=!0}},[e,r,n]),i}(h);return t.createElement(t.Fragment,null,d.map(e=>t.createElement("link",{key:e,rel:"prefetch",as:"fetch",href:e,...n})),f.map(e=>t.createElement("link",{key:e,rel:"modulepreload",href:e,...n})),v.map(({key:e,link:r})=>t.createElement("link",{key:e,nonce:n.nonce,...r})))}function At(...t){return e=>{t.forEach(t=>{"function"==typeof t?t(e):null!=t&&(t.current=e)})}}St.displayName="FrameworkContext";var It="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;try{It&&(window.__reactRouterVersion="7.9.4")}catch(mi){}function Pt({basename:e,children:r,window:n}){let i=t.useRef();null==i.current&&(i.current=function(t={}){return function(t,e,r,n={}){let{window:i=document.defaultView,v5Compat:s=!1}=n,o=i.history,a="POP",l=null,h=p();function p(){return(o.state||{idx:null}).idx}function w(){a="POP";let t=p(),e=null==t?null:t-h;h=t,l&&l({action:a,location:m.location,delta:e})}function y(t){return function(t,e=!1){let r="http://localhost";"undefined"!=typeof window&&(r="null"!==window.location.origin?window.location.origin:window.location.href),c(r,"No window.location.(origin|href) available to create URL");let n="string"==typeof t?t:v(t);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=r+n),new URL(n,r)}(t)}null==h&&(h=0,o.replaceState({...o.state,idx:h},""));let m={get action(){return a},get location(){return t(i,o)},listen(t){if(l)throw Error("A history only accepts one active listener");return i.addEventListener(u,w),l=t,()=>{i.removeEventListener(u,w),l=null}},createHref:t=>e(i,t),createURL:y,encodeLocation(t){let e=y(t);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(t,e){a="PUSH";let r=f(m.location,t,e);h=p()+1;let n=d(r,h),u=m.createHref(r);try{o.pushState(n,"",u)}catch(c){if(c instanceof DOMException&&"DataCloneError"===c.name)throw c;i.location.assign(u)}s&&l&&l({action:a,location:m.location,delta:1})},replace:function(t,e){a="REPLACE";let r=f(m.location,t,e);h=p();let n=d(r,h),i=m.createHref(r);o.replaceState(n,"",i),s&&l&&l({action:a,location:m.location,delta:0})},go:t=>o.go(t)};return m}(function(t,e){let{pathname:r,search:n,hash:i}=t.location;return f("",{pathname:r,search:n,hash:i},e.state&&e.state.usr||null,e.state&&e.state.key||"default")},function(t,e){return"string"==typeof e?e:v(e)},0,t)}({window:n,v5Compat:!0}));let s=i.current,[o,a]=t.useState({action:s.action,location:s.location}),l=t.useCallback(e=>{t.startTransition(()=>a(e))},[a]);return t.useLayoutEffect(()=>s.listen(l),[s,l]),t.createElement(ht,{basename:e,children:r,location:o.location,navigationType:o.action,navigator:s})}var $t=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xt=t.forwardRef(function({onClick:e,discover:r="render",prefetch:n="none",relative:i,reloadDocument:s,replace:o,state:a,target:l,to:u,preventScrollReset:d,viewTransition:f,...p},w){let y,{basename:m}=t.useContext(J),b="string"==typeof u&&$t.test(u),g=!1;if("string"==typeof u&&b&&(y=u,It))try{let t=new URL(window.location.href),e=u.startsWith("//")?new URL(t.protocol+u):new URL(u),r=I(e.pathname,m);e.origin===t.origin&&null!=r?u=r+e.search+e.hash:g=!0}catch(mi){h(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let _=function(e,{relative:r}={}){c(K(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=t.useContext(J),{hash:s,pathname:o,search:a}=Z(e,{relative:r}),l=o;return"/"!==n&&(l="/"===o?n:N([n,o])),i.createHref({pathname:l,search:a,hash:s})}(u,{relative:i}),[E,O,S]=function(e,r){let n=t.useContext(St),[i,s]=t.useState(!1),[o,a]=t.useState(!1),{onFocus:l,onBlur:u,onMouseEnter:c,onMouseLeave:h,onTouchStart:d}=r,f=t.useRef(null);t.useEffect(()=>{if("render"===e&&a(!0),"viewport"===e){let t=new IntersectionObserver(t=>{t.forEach(t=>{a(t.isIntersecting)})},{threshold:.5});return f.current&&t.observe(f.current),()=>{t.disconnect()}}},[e]),t.useEffect(()=>{if(i){let t=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(t)}}},[i]);let v=()=>{s(!0)},p=()=>{s(!1),a(!1)};return n?"intent"!==e?[o,f,{}]:[o,f,{onFocus:kt(l,v),onBlur:kt(u,p),onMouseEnter:kt(c,v),onMouseLeave:kt(h,p),onTouchStart:kt(d,v)}]:[!1,f,{}]}(n,p),T=function(e,{target:r,replace:n,state:i,preventScrollReset:s,relative:o,viewTransition:a}={}){let l=X(),u=V(),c=Z(e,{relative:o});return t.useCallback(t=>{if(function(t,e){return!(0!==t.button||e&&"_self"!==e||function(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}(t))}(t,r)){t.preventDefault();let r=void 0!==n?n:v(u)===v(c);l(e,{replace:r,state:i,preventScrollReset:s,relative:o,viewTransition:a})}},[u,l,c,n,i,r,e,s,o,a])}(u,{replace:o,state:a,target:l,preventScrollReset:d,relative:i,viewTransition:f}),k=t.createElement("a",{...p,...S,href:y||_,onClick:g||s?e:function(t){e&&e(t),t.defaultPrevented||T(t)},ref:At(w,O),target:l,"data-discover":b||"render"!==r?void 0:"true"});return E&&!b?t.createElement(t.Fragment,null,k,t.createElement(Rt,{page:_})):k});function Nt(e){let r=t.useContext(F);return c(r,function(t){return t+" must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router."}(e)),r}xt.displayName="Link",t.forwardRef(function({"aria-current":e="page",caseSensitive:r=!1,className:n="",end:i=!1,style:s,to:o,viewTransition:a,children:l,...u},h){let d=Z(o,{relative:u.relative}),f=V(),v=t.useContext(M),{navigator:p,basename:w}=t.useContext(J),y=null!=v&&function(e,{relative:r}={}){let n=t.useContext(W);c(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=Nt("useViewTransitionState"),s=Z(e,{relative:r});if(!n.isTransitioning)return!1;let o=I(n.currentLocation.pathname,i)||n.currentLocation.pathname,a=I(n.nextLocation.pathname,i)||n.nextLocation.pathname;return null!=j(s.pathname,a)||null!=j(s.pathname,o)}(d)&&!0===a,m=p.encodeLocation?p.encodeLocation(d).pathname:d.pathname,b=f.pathname,g=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;r||(b=b.toLowerCase(),g=g?g.toLowerCase():null,m=m.toLowerCase()),g&&w&&(g=I(g,w)||g);const _="/"!==m&&m.endsWith("/")?m.length-1:m.length;let E,O=b===m||!i&&b.startsWith(m)&&"/"===b.charAt(_),S=null!=g&&(g===m||!i&&g.startsWith(m)&&"/"===g.charAt(m.length)),T={isActive:O,isPending:S,isTransitioning:y},k=O?e:void 0;E="function"==typeof n?n(T):[n,O?"active":null,S?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let R="function"==typeof s?s(T):s;return t.createElement(xt,{...u,"aria-current":k,className:E,ref:h,style:R,to:o,viewTransition:a},"function"==typeof l?l(T):l)}).displayName="NavLink",t.forwardRef(({discover:e="render",fetcherKey:r,navigate:n,reloadDocument:i,replace:s,state:o,method:a=vt,action:l,onSubmit:u,relative:h,preventScrollReset:d,viewTransition:f,...p},w)=>{let y=function(){let{router:e}=Nt("useSubmit"),{basename:r}=t.useContext(J),n=ot("useRouteId");return t.useCallback(async(t,i={})=>{let{action:s,method:o,encType:a,formData:l,body:u}=function(t,e){let r,n,i,s,o;if(wt(a=t)&&"form"===a.tagName.toLowerCase()){let o=t.getAttribute("action");n=o?I(o,e):null,r=t.getAttribute("method")||vt,i=bt(t.getAttribute("enctype"))||pt,s=new FormData(t)}else if(function(t){return wt(t)&&"button"===t.tagName.toLowerCase()}(t)||function(t){return wt(t)&&"input"===t.tagName.toLowerCase()}(t)&&("submit"===t.type||"image"===t.type)){let o=t.form;if(null==o)throw Error('Cannot submit a <button> or <input type="submit"> without a <form>');let a=t.getAttribute("formaction")||o.getAttribute("action");if(n=a?I(a,e):null,r=t.getAttribute("formmethod")||o.getAttribute("method")||vt,i=bt(t.getAttribute("formenctype"))||bt(o.getAttribute("enctype"))||pt,s=new FormData(o,t),!function(){if(null===yt)try{new FormData(document.createElement("form"),0),yt=!1}catch(mi){yt=!0}return yt}()){let{name:e,type:r,value:n}=t;if("image"===r){let t=e?e+".":"";s.append(t+"x","0"),s.append(t+"y","0")}else e&&s.append(e,n)}}else{if(wt(t))throw Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=vt,n=null,i=pt,o=t}var a;return s&&"text/plain"===i&&(o=s,s=void 0),{action:n,method:r.toLowerCase(),encType:i,formData:s,body:o}}(t,r);if(!1===i.navigate){let t=i.fetcherKey||Lt();await e.fetch(t,n,i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||o,formEncType:i.encType||a,flushSync:i.flushSync})}else await e.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||o,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[e,r,n])}(),m=function(e,{relative:r}={}){let{basename:n}=t.useContext(J),i=t.useContext(G);c(i,"useFormAction must be used inside a RouteContext");let[s]=i.matches.slice(-1),o={...Z(e||".",{relative:r})},a=V();if(null==e){o.search=a.search;let t=new URLSearchParams(o.search),e=t.getAll("index");if(e.some(t=>""===t)){t.delete("index"),e.filter(t=>t).forEach(e=>t.append("index",e));let r=t.toString();o.search=r?"?"+r:""}}return e&&"."!==e||!s.route.index||(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),"/"!==n&&(o.pathname="/"===o.pathname?n:N([n,o.pathname])),v(o)}(l,{relative:h}),b="get"===a.toLowerCase()?"get":"post",g="string"==typeof l&&$t.test(l);return t.createElement("form",{ref:w,method:b,action:m,onSubmit:i?u:t=>{if(u&&u(t),t.defaultPrevented)return;t.preventDefault();let e=t.nativeEvent.submitter,i=(null==e?void 0:e.getAttribute("formmethod"))||a;y(e||t.currentTarget,{fetcherKey:r,method:i,navigate:n,replace:s,state:o,relative:h,preventScrollReset:d,viewTransition:f})},...p,"data-discover":g||"render"!==e?void 0:"true"})}).displayName="Form";var Ut,Ct,Dt=0,Lt=()=>`__${++Dt+""}__`;class Bt extends Error{constructor(t,e="FunctionsError",r){super(t),this.name=e,this.context=r}}class Ft extends Bt{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Mt extends Bt{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Wt extends Bt{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}(Ct=Ut||(Ut={})).Any="any",Ct.ApNortheast1="ap-northeast-1",Ct.ApNortheast2="ap-northeast-2",Ct.ApSouth1="ap-south-1",Ct.ApSoutheast1="ap-southeast-1",Ct.ApSoutheast2="ap-southeast-2",Ct.CaCentral1="ca-central-1",Ct.EuCentral1="eu-central-1",Ct.EuWest1="eu-west-1",Ct.EuWest2="eu-west-2",Ct.EuWest3="eu-west-3",Ct.SaEast1="sa-east-1",Ct.UsEast1="us-east-1",Ct.UsWest1="us-west-1",Ct.UsWest2="us-west-2";class Jt{constructor(t,{headers:e={},customFetch:r,region:n=Ut.Any}={}){this.url=t,this.headers=e,this.region=n,this.fetch=(t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>l(async()=>{const{default:t}=await Promise.resolve().then(()=>re);return{default:t}},[]).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)})(r)}setAuth(t){this.headers.Authorization="Bearer "+t}invoke(t){return e=this,r=arguments,i=function*(t,e={}){var r;try{const{headers:n,method:i,body:s,signal:o}=e;let a={},{region:l}=e;l||(l=this.region);const u=new URL(`${this.url}/${t}`);let c;l&&"any"!==l&&(a["x-region"]=l,u.searchParams.set("forceFunctionRegion",l)),s&&(n&&!{}.hasOwnProperty.call(n,"Content-Type")||!n)&&("undefined"!=typeof Blob&&s instanceof Blob||s instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=s):"string"==typeof s?(a["Content-Type"]="text/plain",c=s):"undefined"!=typeof FormData&&s instanceof FormData?c=s:(a["Content-Type"]="application/json",c=JSON.stringify(s)));const h=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:c,signal:o}).catch(t=>{if("AbortError"===t.name)throw t;throw new Ft(t)}),d=h.headers.get("x-relay-error");if(d&&"true"===d)throw new Mt(h);if(!h.ok)throw new Wt(h);let f,v=(null!==(r=h.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return f="application/json"===v?yield h.json():"application/octet-stream"===v?yield h.blob():"text/event-stream"===v?h:"multipart/form-data"===v?yield h.formData():yield h.text(),{data:f,error:null,response:h}}catch(n){return n instanceof Error&&"AbortError"===n.name?{data:null,error:new Ft(n)}:{data:null,error:n,response:n instanceof Wt||n instanceof Mt?n.context:void 0}}},new((n=void 0)||(n=Promise))(function(t,s){function o(t){try{l(i.next(t))}catch(mi){s(mi)}}function a(t){try{l(i.throw(t))}catch(mi){s(mi)}}function l(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(t){t(r)})).then(o,a)}l((i=i.apply(e,r||[])).next())});var e,r,n,i}}var Ht={},Gt={},qt={},Kt={},Vt={},zt={},Yt=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof globalThis)return globalThis;throw Error("unable to locate global object")}();const Xt=Yt.fetch,Qt=Yt.fetch.bind(Yt),Zt=Yt.Headers,te=Yt.Request,ee=Yt.Response,re=Object.freeze(Object.defineProperty({__proto__:null,Headers:Zt,Request:te,Response:ee,default:Qt,fetch:Xt},Symbol.toStringTag,{value:"Module"})),ne=e(re);var ie={};Object.defineProperty(ie,"i",{value:!0}),ie.default=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};var se=r&&r.o||function(t){return t&&t.i?t:{default:t}};Object.defineProperty(zt,"i",{value:!0});const oe=se(ne),ae=se(ie);zt.default=class{constructor(t){var e,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=null!==(e=t.shouldThrowOnError)&&void 0!==e&&e,this.signal=t.signal,this.isMaybeSingle=null!==(r=t.isMaybeSingle)&&void 0!==r&&r,t.fetch?this.fetch=t.fetch:"undefined"==typeof fetch?this.fetch=oe.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async t=>{var e,r,n,i;let s=null,o=null,a=null,l=t.status,u=t.statusText;if(t.ok){if("HEAD"!==this.method){const r=await t.text();""===r||(o="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(e=this.headers.get("Accept"))||void 0===e?void 0:e.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}const i=null===(r=this.headers.get("Prefer"))||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),c=null===(n=t.headers.get("content-range"))||void 0===n?void 0:n.split("/");i&&c&&c.length>1&&(a=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(s={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,l=406,u="Not Acceptable"):o=1===o.length?o[0]:null)}else{const e=await t.text();try{s=JSON.parse(e),Array.isArray(s)&&404===t.status&&(o=[],s=null,l=200,u="OK")}catch(c){404===t.status&&""===e?(l=204,u="No Content"):s={message:e}}if(s&&this.isMaybeSingle&&(null===(i=null==s?void 0:s.details)||void 0===i?void 0:i.includes("0 rows"))&&(s=null,l=200,u="OK"),s&&this.shouldThrowOnError)throw new ae.default(s)}return{error:s,data:o,count:a,status:l,statusText:u}});return this.shouldThrowOnError||(r=r.catch(t=>{var e,r,n;return{error:{message:`${null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"FetchError"}: ${null==t?void 0:t.message}`,details:""+(null!==(r=null==t?void 0:t.stack)&&void 0!==r?r:""),hint:"",code:""+(null!==(n=null==t?void 0:t.code)&&void 0!==n?n:"")},data:null,count:null,status:0,statusText:""}})),r.then(t,e)}returns(){return this}overrideTypes(){return this}};var le=r&&r.o||function(t){return t&&t.i?t:{default:t}};Object.defineProperty(Vt,"i",{value:!0});const ue=le(zt);let ce=class extends ue.default{select(t){let e=!1;const r=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:n,referencedTable:i=n}={}){const s=i?i+".order":"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?o+",":""}${t}.${e?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const n=void 0===r?"limit":r+".limit";return this.url.searchParams.set(n,""+t),this}range(t,e,{foreignTable:r,referencedTable:n=r}={}){const i=void 0===n?"offset":n+".offset",s=void 0===n?"limit":n+".limit";return this.url.searchParams.set(i,""+t),this.url.searchParams.set(s,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:n=!1,wal:i=!1,format:s="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,r?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${s}; for="${l}"; options=${a};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected="+t),this}};Vt.default=ce;var he=r&&r.o||function(t){return t&&t.i?t:{default:t}};Object.defineProperty(Kt,"i",{value:!0});const de=he(Vt);let fe=class extends de.default{eq(t,e){return this.url.searchParams.append(t,"eq."+e),this}neq(t,e){return this.url.searchParams.append(t,"neq."+e),this}gt(t,e){return this.url.searchParams.append(t,"gt."+e),this}gte(t,e){return this.url.searchParams.append(t,"gte."+e),this}lt(t,e){return this.url.searchParams.append(t,"lt."+e),this}lte(t,e){return this.url.searchParams.append(t,"lte."+e),this}like(t,e){return this.url.searchParams.append(t,"like."+e),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,"ilike."+e),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,"is."+e),this}in(t,e){const r=Array.from(new Set(e)).map(t=>"string"==typeof t&&RegExp("[,()]").test(t)?`"${t}"`:""+t).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}contains(t,e){return"string"==typeof e?this.url.searchParams.append(t,"cs."+e):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,"cs."+JSON.stringify(e)),this}containedBy(t,e){return"string"==typeof e?this.url.searchParams.append(t,"cd."+e):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,"cd."+JSON.stringify(e)),this}rangeGt(t,e){return this.url.searchParams.append(t,"sr."+e),this}rangeGte(t,e){return this.url.searchParams.append(t,"nxl."+e),this}rangeLt(t,e){return this.url.searchParams.append(t,"sl."+e),this}rangeLte(t,e){return this.url.searchParams.append(t,"nxr."+e),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,"adj."+e),this}overlaps(t,e){return"string"==typeof e?this.url.searchParams.append(t,"ov."+e):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:n}={}){let i="";"plain"===n?i="pl":"phrase"===n?i="ph":"websearch"===n&&(i="w");const s=void 0===r?"":`(${r})`;return this.url.searchParams.append(t,`${i}fts${s}.${e}`),this}match(t){return Object.entries(t).forEach(([t,e])=>{this.url.searchParams.append(t,"eq."+e)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const n=r?r+".or":"or";return this.url.searchParams.append(n,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}};Kt.default=fe;var ve=r&&r.o||function(t){return t&&t.i?t:{default:t}};Object.defineProperty(qt,"i",{value:!0});const pe=ve(Kt);qt.default=class{constructor(t,{headers:e={},schema:r,fetch:n}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=n}select(t,e){const{head:r=!1,count:n}=null!=e?e:{},i=r?"HEAD":"GET";let s=!1;const o=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!s?"":('"'===t&&(s=!s),t)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer","count="+n),new pe.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:r=!0}={}){var n;if(e&&this.headers.append("Prefer","count="+e),r||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new pe.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){var s;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==e&&this.url.searchParams.set("on_conflict",e),n&&this.headers.append("Prefer","count="+n),i||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new pe.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}update(t,{count:e}={}){var r;return e&&this.headers.append("Prefer","count="+e),new pe.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:t}={}){var e;return t&&this.headers.append("Prefer","count="+t),new pe.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(e=this.fetch)&&void 0!==e?e:fetch})}};var we=r&&r.o||function(t){return t&&t.i?t:{default:t}};Object.defineProperty(Gt,"i",{value:!0});const ye=we(qt),me=we(Kt);Gt.default=class t{constructor(t,{headers:e={},schema:r,fetch:n}={}){this.url=t,this.headers=new Headers(e),this.schemaName=r,this.fetch=n}from(t){const e=new URL(`${this.url}/${t}`);return new ye.default(e,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new t(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(t,e={},{head:r=!1,get:n=!1,count:i}={}){var s;let o;const a=new URL(`${this.url}/rpc/${t}`);let l;r||n?(o=r?"HEAD":"GET",Object.entries(e).filter(([t,e])=>void 0!==e).map(([t,e])=>[t,Array.isArray(e)?`{${e.join(",")}}`:""+e]).forEach(([t,e])=>{a.searchParams.append(t,e)})):(o="POST",l=e);const u=new Headers(this.headers);return i&&u.set("Prefer","count="+i),new me.default({method:o,url:a,headers:u,schema:this.schemaName,body:l,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}};var be=r&&r.o||function(t){return t&&t.i?t:{default:t}};Object.defineProperty(Ht,"i",{value:!0}),Ht.PostgrestError=Ht.PostgrestBuilder=Ht.PostgrestTransformBuilder=Ht.PostgrestFilterBuilder=Ht.PostgrestQueryBuilder=Ht.PostgrestClient=void 0;const ge=be(Gt);Ht.PostgrestClient=ge.default;const _e=be(qt);Ht.PostgrestQueryBuilder=_e.default;const Ee=be(Kt);Ht.PostgrestFilterBuilder=Ee.default;const Oe=be(Vt);Ht.PostgrestTransformBuilder=Oe.default;const Se=be(zt);Ht.PostgrestBuilder=Se.default;const Te=be(ie);Ht.PostgrestError=Te.default;var ke=Ht.default={PostgrestClient:ge.default,PostgrestQueryBuilder:_e.default,PostgrestFilterBuilder:Ee.default,PostgrestTransformBuilder:Oe.default,PostgrestBuilder:Se.default,PostgrestError:Te.default};const{PostgrestClient:Re,PostgrestQueryBuilder:je,PostgrestFilterBuilder:Ae,PostgrestTransformBuilder:Ie,PostgrestBuilder:Pe,PostgrestError:$e}=ke;class xe{static detectEnvironment(){var t;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(t=navigator.userAgent)||void 0===t?void 0:t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const t=process.versions;if(t&&t.node){const e=t.node,r=parseInt(e.replace(/^v/,"").split(".")[0]);return 22>r?{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}:void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+="\n\nSuggested solution: "+t.workaround),Error(e)}static createWebSocket(t,e){return new(this.getWebSocketConstructor())(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return"native"===t.type||"ws"===t.type}catch(t){return!1}}}var Ne,Ue,Ce,De,Le,Be,Fe,Me,We,Je,He;(Ue=Ne||(Ne={}))[Ue.connecting=0]="connecting",Ue[Ue.open=1]="open",Ue[Ue.closing=2]="closing",Ue[Ue.closed=3]="closed",(De=Ce||(Ce={})).closed="closed",De.errored="errored",De.joined="joined",De.joining="joining",De.leaving="leaving",(Be=Le||(Le={})).close="phx_close",Be.error="phx_error",Be.join="phx_join",Be.reply="phx_reply",Be.leave="phx_leave",Be.access_token="access_token",(Fe||(Fe={})).websocket="websocket",(We=Me||(Me={})).Connecting="connecting",We.Open="open",We.Closing="closing",We.Closed="closed";class Ge{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this.l(t)):e("string"==typeof t?JSON.parse(t):{})}l(t){const e=new DataView(t),r=new TextDecoder;return this.u(t,e,r)}u(t,e,r){const n=e.getUint8(1),i=e.getUint8(2);let s=this.HEADER_LENGTH+2;const o=r.decode(t.slice(s,s+n));s+=n;const a=r.decode(t.slice(s,s+i));return s+=i,{ref:null,topic:o,event:a,payload:JSON.parse(r.decode(t.slice(s,t.byteLength)))}}}class qe{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(He=Je||(Je={})).abstime="abstime",He.bool="bool",He.date="date",He.daterange="daterange",He.float4="float4",He.float8="float8",He.int2="int2",He.int4="int4",He.int4range="int4range",He.int8="int8",He.int8range="int8range",He.json="json",He.jsonb="jsonb",He.money="money",He.numeric="numeric",He.oid="oid",He.reltime="reltime",He.text="text",He.time="time",He.timestamp="timestamp",He.timestamptz="timestamptz",He.timetz="timetz",He.tsrange="tsrange",He.tstzrange="tstzrange";const Ke=(t,e,r={})=>{var n;const i=null!==(n=r.skipTypes)&&void 0!==n?n:[];return e?Object.keys(e).reduce((r,n)=>(r[n]=Ve(n,t,e,i),r),{}):{}},Ve=(t,e,r,n)=>{const i=e.find(e=>e.name===t),s=null==i?void 0:i.type,o=r[t];return s&&!n.includes(s)?ze(s,o):Ye(o)},ze=(t,e)=>{if("_"===t.charAt(0)){const r=t.slice(1,t.length);return tr(e,r)}switch(t){case Je.bool:return Xe(e);case Je.float4:case Je.float8:case Je.int2:case Je.int4:case Je.int8:case Je.numeric:case Je.oid:return Qe(e);case Je.json:case Je.jsonb:return Ze(e);case Je.timestamp:return er(e);case Je.abstime:case Je.date:case Je.daterange:case Je.int4range:case Je.int8range:case Je.money:case Je.reltime:case Je.text:case Je.time:case Je.timestamptz:case Je.timetz:case Je.tsrange:case Je.tstzrange:default:return Ye(e)}},Ye=t=>t,Xe=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Qe=t=>{if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Ze=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t},tr=(t,e)=>{if("string"!=typeof t)return t;const r=t.length-1,n=t[r];if("{"===t[0]&&"}"===n){let n;const s=t.slice(1,r);try{n=JSON.parse("["+s+"]")}catch(i){n=s?s.split(","):[]}return n.map(t=>ze(e,t))}return t},er=t=>"string"==typeof t?t.replace(" ","T"):t,rr=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class nr{constructor(t,e,r={},n=1e4){this.channel=t,this.event=e,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this.h(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this.v("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel.p()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var r;return this.v(t)&&e(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket.m(),this.refEvent=this.channel._(this.ref),this.channel.O(this.refEvent,{},t=>{this.h(),this.S(),this.receivedResp=t,this.T(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(t,e){this.refEvent&&this.channel.k(this.refEvent,{status:t,response:e})}destroy(){this.h(),this.S()}h(){this.refEvent&&this.channel.R(this.refEvent,{})}S(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}T({status:t,response:e}){this.recHooks.filter(e=>e.status===t).forEach(t=>t.callback(e))}v(t){return this.receivedResp&&this.receivedResp.status===t}}var ir,sr,or,ar,lr,ur,cr,hr;(sr=ir||(ir={})).SYNC="sync",sr.JOIN="join",sr.LEAVE="leave";class dr{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel.O(r.state,{},t=>{const{onJoin:e,onLeave:r,onSync:n}=this.caller;this.joinRef=this.channel.p(),this.state=dr.syncState(this.state,t,e,r),this.pendingDiffs.forEach(t=>{this.state=dr.syncDiff(this.state,t,e,r)}),this.pendingDiffs=[],n()}),this.channel.O(r.diff,{},t=>{const{onJoin:e,onLeave:r,onSync:n}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=dr.syncDiff(this.state,t,e,r),n())}),this.onJoin((t,e,r)=>{this.channel.k("presence",{event:"join",key:t,currentPresences:e,newPresences:r})}),this.onLeave((t,e,r)=>{this.channel.k("presence",{event:"leave",key:t,currentPresences:e,leftPresences:r})}),this.onSync(()=>{this.channel.k("presence",{event:"sync"})})}static syncState(t,e,r,n){const i=this.cloneDeep(t),s=this.transformState(e),o={},a={};return this.map(i,(t,e)=>{s[t]||(a[t]=e)}),this.map(s,(t,e)=>{const r=i[t];if(r){const n=e.map(t=>t.presence_ref),i=r.map(t=>t.presence_ref),s=e.filter(t=>0>i.indexOf(t.presence_ref)),l=r.filter(t=>0>n.indexOf(t.presence_ref));s.length>0&&(o[t]=s),l.length>0&&(a[t]=l)}else o[t]=e}),this.syncDiff(i,{joins:o,leaves:a},r,n)}static syncDiff(t,e,r,n){const{joins:i,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(e,n)=>{var i;const s=null!==(i=t[e])&&void 0!==i?i:[];if(t[e]=this.cloneDeep(n),s.length>0){const r=t[e].map(t=>t.presence_ref),n=s.filter(t=>0>r.indexOf(t.presence_ref));t[e].unshift(...n)}r(e,s,n)}),this.map(s,(e,r)=>{let i=t[e];if(!i)return;const s=r.map(t=>t.presence_ref);i=i.filter(t=>0>s.indexOf(t.presence_ref)),t[e]=i,n(e,i,r),0===i.length&&delete t[e]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(r=>e(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,r)=>{const n=t[r];return e[r]="metas"in n?n.metas.map(t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t)):n,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.p()}}(ar=or||(or={})).ALL="*",ar.INSERT="INSERT",ar.UPDATE="UPDATE",ar.DELETE="DELETE",(ur=lr||(lr={})).BROADCAST="broadcast",ur.PRESENCE="presence",ur.POSTGRES_CHANGES="postgres_changes",ur.SYSTEM="system",(hr=cr||(cr={})).SUBSCRIBED="SUBSCRIBED",hr.TIMED_OUT="TIMED_OUT",hr.CLOSED="CLOSED",hr.CHANNEL_ERROR="CHANNEL_ERROR";class fr{constructor(t,e={config:{}},r){var n,i;if(this.topic=t,this.params=e,this.socket=r,this.bindings={},this.state=Ce.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new nr(this,Le.join,this.params,this.timeout),this.rejoinTimer=new qe(()=>this.j(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ce.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this.A(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.p()}`),this.state=Ce.closed,this.socket.I(this)}),this.P(t=>{this.$()||this.N()||(this.socket.log("channel","error "+this.topic,t),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.U()&&(this.socket.log("channel","timeout "+this.topic,this.joinPush.timeout),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",t=>{this.$()||this.N()||(this.socket.log("channel","error "+this.topic,t),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this.O(Le.reply,{},(t,e)=>{this.k(this._(e),t)}),this.presence=new dr(this),this.broadcastEndpointURL=rr(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(i=null===(n=this.params.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var r,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Ce.closed){const{config:{broadcast:s,presence:o,private:a}}=this.params,l=null!==(n=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(t=>t.filter))&&void 0!==n?n:[],u=!!this.bindings[lr.PRESENCE]&&this.bindings[lr.PRESENCE].length>0||!0===(null===(i=this.params.config.presence)||void 0===i?void 0:i.enabled),c={},h={broadcast:s,presence:Object.assign(Object.assign({},o),{enabled:u}),postgres_changes:l,private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.P(e=>null==t?void 0:t(cr.CHANNEL_ERROR,e)),this.A(()=>null==t?void 0:t(cr.CLOSED)),this.updateJoinPayload(Object.assign({config:h},c)),this.joinedOnce=!0,this.C(e),this.joinPush.receive("ok",async({postgres_changes:e})=>{var r;if(this.socket.setAuth(),void 0!==e){const n=this.bindings.postgres_changes,i=null!==(r=null==n?void 0:n.length)&&void 0!==r?r:0,s=[];for(let r=0;i>r;r++){const i=n[r],{filter:{event:o,schema:a,table:l,filter:u}}=i,c=e&&e[r];if(!c||c.event!==o||c.schema!==a||c.table!==l||c.filter!==u)return this.unsubscribe(),this.state=Ce.errored,void(null==t||t(cr.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes")));s.push(Object.assign(Object.assign({},i),{id:c.id}))}return this.bindings.postgres_changes=s,void(t&&t(cr.SUBSCRIBED))}null==t||t(cr.SUBSCRIBED)}).receive("error",e=>{this.state=Ce.errored,null==t||t(cr.CHANNEL_ERROR,Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",()=>{null==t||t(cr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,r){return this.state===Ce.joined&&t===lr.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this.O(t,e,r)}async send(t,e={}){var r,n;if(this.D()||"broadcast"!==t.type)return new Promise(r=>{var n,i,s;const o=this.L(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(s=null===(i=null===(n=this.params)||void 0===n?void 0:n.config)||void 0===i?void 0:i.broadcast)||void 0===s?void 0:s.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{const{event:s,payload:o}=t,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer "+this.socket.accessTokenValue:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const t=await this.B(this.broadcastEndpointURL,a,null!==(r=e.timeout)&&void 0!==r?r:this.timeout);return await(null===(n=t.body)||void 0===n?void 0:n.cancel()),t.ok?"ok":"error"}catch(i){return"AbortError"===i.name?"timed out":"error"}}}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Ce.leaving;const e=()=>{this.socket.log("channel","leave "+this.topic),this.k(Le.close,"leave",this.p())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new nr(this,Le.leave,{},t),r.receive("ok",()=>{e(),n("ok")}).receive("timeout",()=>{e(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this.D()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ce.closed,this.bindings={}}async B(t,e,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),s=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:n.signal}));return clearTimeout(i),s}L(t,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new nr(this,t,e,r);return this.D()?n.send():this.F(n),n}F(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>100){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel","discarded push due to buffer overflow: "+t.event,t.payload))}}M(t,e,r){return e}W(t){return this.topic===t}p(){return this.joinPush.ref}k(t,e,r){var n,i;const s=t.toLocaleLowerCase(),{close:o,error:a,leave:l,join:u}=Le;if(r&&[o,a,l,u].indexOf(s)>=0&&r!==this.p())return;let c=this.M(s,e,r);if(e&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(t=>{var e,r,n;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(n=null===(r=t.filter)||void 0===r?void 0:r.event)||void 0===n?void 0:n.toLocaleLowerCase())===s}).map(t=>t.callback(c,r)):null===(i=this.bindings[s])||void 0===i||i.filter(t=>{var r,n,i,o,a,l;if(["broadcast","presence","postgres_changes"].includes(s)){if("id"in t){const s=t.id,o=null===(r=t.filter)||void 0===r?void 0:r.event;return s&&(null===(n=e.ids)||void 0===n?void 0:n.includes(s))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(i=e.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(l=null==e?void 0:e.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===s}).map(t=>{if("object"==typeof c&&"ids"in c){const t=c.data,{schema:e,table:r,commit_timestamp:n,type:i,errors:s}=t;c=Object.assign(Object.assign({},{schema:e,table:r,commit_timestamp:n,eventType:i,new:{},old:{},errors:s}),this.J(t))}t.callback(c,r)})}N(){return this.state===Ce.closed}H(){return this.state===Ce.joined}U(){return this.state===Ce.joining}$(){return this.state===Ce.leaving}_(t){return"chan_reply_"+t}O(t,e,r){const n=t.toLocaleLowerCase(),i={type:n,filter:e,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}R(t,e){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(t=>{var n;return!((null===(n=t.type)||void 0===n?void 0:n.toLocaleLowerCase())===r&&fr.isEqual(t.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const r in t)if(t[r]!==e[r])return!1;return!0}j(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.C()}A(t){this.O(Le.close,{},t)}P(t){this.O(Le.error,{},e=>t(e))}D(){return this.socket.isConnected()&&this.H()}C(t=this.timeout){this.$()||(this.socket.G(this.topic),this.state=Ce.joining,this.joinPush.resend(t))}J(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=Ke(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=Ke(t.columns,t.old_record)),e}}const vr=()=>{},pr=[1e3,2e3,5e3,1e4];class wr{constructor(t,e){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=vr,this.ref=0,this.reconnectTimer=null,this.logger=vr,this.conn=null,this.sendBuffer=[],this.serializer=new Ge,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this.q="disconnected",this.K=!1,this.V=null,this.Y=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>l(async()=>{const{default:t}=await Promise.resolve().then(()=>re);return{default:t}},void 0).then(({default:e})=>e(...t)).catch(t=>{throw Error(`Failed to load @supabase/node-fetch: ${t.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...t)=>e(...t)},!(null===(r=null==e?void 0:e.params)||void 0===r?void 0:r.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${Fe.websocket}`,this.httpEndpoint=rr(t),this.X(e),this.Z(),this.fetch=this.Y(null==e?void 0:e.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this.tt("connecting"),this.et("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=xe.createWebSocket(this.endpointURL())}catch(t){this.tt("disconnected");const e=t.message;if(e.includes("Node.js"))throw Error(e+'\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw Error("WebSocket not available: "+e)}this.rt()}}endpointURL(){return this.nt(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(t,e){if(!this.isDisconnecting())if(this.tt("disconnecting",!0),this.conn){const r=setTimeout(()=>{this.tt("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this.tt("disconnected")},t?this.conn.close(t,null!=e?e:""):this.conn.close(),this.it()}else this.tt("disconnected")}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,r){this.logger(t,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ne.connecting:return Me.Connecting;case Ne.open:return Me.Open;case Ne.closing:return Me.Closing;default:return Me.Closed}}isConnected(){return this.connectionState()===Me.Open}isConnecting(){return"connecting"===this.q}isDisconnecting(){return"disconnecting"===this.q}channel(t,e={config:{}}){const r="realtime:"+t,n=this.getChannels().find(t=>t.topic===r);if(n)return n;{const r=new fr("realtime:"+t,e,this);return this.channels.push(r),r}}push(t){const{topic:e,event:r,payload:n,ref:i}=t,s=()=>{this.encode(t,t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)})};this.log("push",`${e} ${r} (${i})`,n),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(t=null){this.V=this.st(t);try{await this.V}finally{this.V=null}}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(mi){this.log("error","error in heartbeat callback",mi)}return this.K=!1,null===(t=this.conn)||void 0===t||t.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var t;this.isConnected()||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout()},100)}this.pendingHeartbeatRef=this.m(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(mi){this.log("error","error in heartbeat callback",mi)}this.et("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(mi){this.log("error","error in heartbeat callback",mi)}}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}m(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}G(t){let e=this.channels.find(e=>e.topic===t&&(e.H()||e.U()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}I(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}ot(t){this.decode(t.data,t=>{if("phoenix"===t.topic&&"phx_reply"===t.event)try{this.heartbeatCallback("ok"===t.payload.status?"ok":"error")}catch(mi){this.log("error","error in heartbeat callback",mi)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:e,event:r,payload:n,ref:i}=t,s=i?`(${i})`:"",o=n.status||"";this.log("receive",`${o} ${e} ${r} ${s}`.trim(),n),this.channels.filter(t=>t.W(e)).forEach(t=>t.k(r,n,i)),this.ut("message",t)})}ct(t){var e;"heartbeat"===t&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===t&&(null===(e=this.reconnectTimer)||void 0===e||e.reset())}ht(){this.ct("heartbeat"),this.ct("reconnect")}rt(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this.dt(),this.conn.onerror=t=>this.ft(t),this.conn.onmessage=t=>this.ot(t),this.conn.onclose=t=>this.vt(t))}it(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this.ht(),this.channels.forEach(t=>t.teardown())}dt(){this.tt("connected"),this.log("transport","connected to "+this.endpointURL()),this.flushSendBuffer(),this.ct("reconnect"),this.worker?this.workerRef||this.wt():this.yt(),this.ut("open")}yt(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}wt(){this.workerUrl?this.log("worker","starting worker for from "+this.workerUrl):this.log("worker","starting default worker");const t=this.bt(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}vt(t){var e;this.tt("disconnected"),this.log("transport","close",t),this._t(),this.ct("heartbeat"),this.K||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout(),this.ut("close",t)}ft(t){this.tt("disconnected"),this.log("transport",""+t),this._t(),this.ut("error",t)}_t(){this.channels.forEach(t=>t.k(Le.error))}nt(t,e){if(0===Object.keys(e).length)return t;const r=t.match(/\?/)?"&":"?";return`${t}${r}${new URLSearchParams(e)}`}bt(t){let e;if(t)e=t;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}tt(t,e=!1){this.q=t,"connecting"===t?this.K=!1:"disconnecting"===t&&(this.K=e)}async st(t=null){let e;e=t||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const r={access_token:e,version:"realtime-js/2.75.0"};e&&t.updateJoinPayload(r),t.joinedOnce&&t.H()&&t.L(Le.access_token,{access_token:e})}))}async Et(){this.V&&await this.V}et(t="general"){this.setAuth().catch(e=>{this.log("error","error setting auth in "+t,e)})}ut(t,e){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(e)}catch(mi){this.log("error",`error in ${t} callback`,mi)}})}catch(mi){this.log("error",`error triggering ${t} callbacks`,mi)}}Z(){this.reconnectTimer=new qe(async()=>{setTimeout(async()=>{await this.Et(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}X(t){var e,r,n,i,s,o,a,l,u;if(this.transport=null!==(e=null==t?void 0:t.transport)&&void 0!==e?e:null,this.timeout=null!==(r=null==t?void 0:t.timeout)&&void 0!==r?r:1e4,this.heartbeatIntervalMs=null!==(n=null==t?void 0:t.heartbeatIntervalMs)&&void 0!==n?n:25e3,this.worker=null!==(i=null==t?void 0:t.worker)&&void 0!==i&&i,this.accessToken=null!==(s=null==t?void 0:t.accessToken)&&void 0!==s?s:null,this.heartbeatCallback=null!==(o=null==t?void 0:t.heartbeatCallback)&&void 0!==o?o:vr,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(a=null==t?void 0:t.reconnectAfterMs)&&void 0!==a?a:t=>pr[t-1]||1e4,this.encode=null!==(l=null==t?void 0:t.encode)&&void 0!==l?l:(t,e)=>e(JSON.stringify(t)),this.decode=null!==(u=null==t?void 0:t.decode)&&void 0!==u?u:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.workerUrl=null==t?void 0:t.workerUrl}}}class yr extends Error{constructor(t){super(t),this.Ot=!0,this.name="StorageError"}}function mr(t){return"object"==typeof t&&null!==t&&"Ot"in t}class br extends yr{constructor(t,e,r){super(t),this.name="StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class gr extends yr{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}const _r=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>l(async()=>{const{default:t}=await Promise.resolve().then(()=>re);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},Er=t=>{if(Array.isArray(t))return t.map(t=>Er(t));if("function"==typeof t||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,t=>t.toUpperCase().replace(/[-_]/g,""));e[n]=Er(r)}),e};var Or=function(t,e,r,n){return new(r||(r=Promise))(function(i,s){function o(t){try{l(n.next(t))}catch(mi){s(mi)}}function a(t){try{l(n.throw(t))}catch(mi){s(mi)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,a)}l((n=n.apply(t,e||[])).next())})};const Sr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t);function Tr(t,e,r,n,i,s){return Or(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(r,((t,e,r,n)=>{const i={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"!==t&&n?((t=>{if("object"!=typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)})(n)?(i.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),i.body=JSON.stringify(n)):i.body=n,(null==e?void 0:e.duplex)&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),r)):i})(e,n,i,s)).then(t=>{if(!t.ok)throw t;return(null==n?void 0:n.noResolveJson)?t:t.json()}).then(t=>o(t)).catch(t=>((t,e,r)=>Or(void 0,void 0,void 0,function*(){const n=yield(i=void 0,s=function*(){return"undefined"==typeof Response?(yield l(()=>Promise.resolve().then(()=>re),void 0)).Response:Response},new(i||(i=Promise))(function(t,e){function r(t){try{o(s.next(t))}catch(mi){e(mi)}}function n(t){try{o(s.throw(t))}catch(mi){e(mi)}}function o(e){var s;e.done?t(e.value):(s=e.value,s instanceof i?s:new i(function(t){t(s)})).then(r,n)}o((s=s.call(void 0)).next())}));var i,s;t instanceof n&&!(null==r?void 0:r.noResolveJson)?t.json().then(r=>{const n=t.status||500,i=(null==r?void 0:r.statusCode)||n+"";e(new br(Sr(r),n,i))}).catch(t=>{e(new gr(Sr(t),t))}):e(new gr(Sr(t),t))}))(t,a,n))})})}function kr(t,e,r,n){return Or(this,void 0,void 0,function*(){return Tr(t,"GET",e,r,n)})}function Rr(t,e,r,n,i){return Or(this,void 0,void 0,function*(){return Tr(t,"POST",e,n,i,r)})}function jr(t,e,r,n,i){return Or(this,void 0,void 0,function*(){return Tr(t,"PUT",e,n,i,r)})}function Ar(t,e,r,n,i){return Or(this,void 0,void 0,function*(){return Tr(t,"DELETE",e,n,i,r)})}class Ir{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}execute(){return t=this,r=function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(mr(t))return{data:null,error:t};throw t}},new((e=void 0)||(e=Promise))(function(n,i){function s(t){try{a(r.next(t))}catch(mi){i(mi)}}function o(t){try{a(r.throw(t))}catch(mi){i(mi)}}function a(t){var r;t.done?n(t.value):(r=t.value,r instanceof e?r:new e(function(t){t(r)})).then(s,o)}a((r=r.call(t)).next())});var t,e,r}}class Pr{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}asStream(){return new Ir(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.execute().then(t,e)}execute(){return t=this,r=function*(){try{const t=yield this.downloadFn();return{data:yield t.blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(mr(t))return{data:null,error:t};throw t}},new((e=void 0)||(e=Promise))(function(n,i){function s(t){try{a(r.next(t))}catch(mi){i(mi)}}function o(t){try{a(r.throw(t))}catch(mi){i(mi)}}function a(t){var r;t.done?n(t.value):(r=t.value,r instanceof e?r:new e(function(t){t(r)})).then(s,o)}a((r=r.call(t)).next())});var t,e,r}}var $r=function(t,e,r,n){return new(r||(r=Promise))(function(i,s){function o(t){try{l(n.next(t))}catch(mi){s(mi)}}function a(t){try{l(n.throw(t))}catch(mi){s(mi)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,a)}l((n=n.apply(t,e||[])).next())})};const xr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Nr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ur{constructor(t,e={},r,n){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=r,this.fetch=_r(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,e,r,n){return $r(this,void 0,void 0,function*(){try{let i;const s=Object.assign(Object.assign({},Nr),n);let o=Object.assign(Object.assign({},this.headers),"POST"===t&&{"x-upsert":s.upsert+""});const a=s.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(i=new FormData,i.append("cacheControl",s.cacheControl),a&&i.append("metadata",this.encodeMetadata(a)),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(i=r,i.append("cacheControl",s.cacheControl),a&&i.append("metadata",this.encodeMetadata(a))):(i=r,o["cache-control"]="max-age="+s.cacheControl,o["content-type"]=s.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==n?void 0:n.headers)&&(o=Object.assign(Object.assign({},o),n.headers));const l=this.St(e),u=this.Tt(l),c=yield("PUT"==t?jr:Rr)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:o},(null==s?void 0:s.duplex)?{duplex:s.duplex}:{}));return{data:{path:l,id:c.Id,fullPath:c.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(mr(i))return{data:null,error:i};throw i}})}upload(t,e,r){return $r(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,r)})}uploadToSignedUrl(t,e,r,n){return $r(this,void 0,void 0,function*(){const i=this.St(t),s=this.Tt(i),o=new URL(this.url+"/object/upload/sign/"+s);o.searchParams.set("token",e);try{let t;const e=Object.assign({upsert:Nr.upsert},n),s=Object.assign(Object.assign({},this.headers),{"x-upsert":e.upsert+""});return"undefined"!=typeof Blob&&r instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(t=r,t.append("cacheControl",e.cacheControl)):(t=r,s["cache-control"]="max-age="+e.cacheControl,s["content-type"]=e.contentType),{data:{path:i,fullPath:(yield jr(this.fetch,o.toString(),t,{headers:s})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(mr(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(t,e){return $r(this,void 0,void 0,function*(){try{let r=this.Tt(t);const n=Object.assign({},this.headers);(null==e?void 0:e.upsert)&&(n["x-upsert"]="true");const i=yield Rr(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),s=new URL(this.url+i.url),o=s.searchParams.get("token");if(!o)throw new yr("No token returned by API");return{data:{signedUrl:s.toString(),path:t,token:o},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(mr(r))return{data:null,error:r};throw r}})}update(t,e,r){return $r(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,r)})}move(t,e,r){return $r(this,void 0,void 0,function*(){try{return{data:yield Rr(this.fetch,this.url+"/object/move",{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mr(n))return{data:null,error:n};throw n}})}copy(t,e,r){return $r(this,void 0,void 0,function*(){try{return{data:{path:(yield Rr(this.fetch,this.url+"/object/copy",{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mr(n))return{data:null,error:n};throw n}})}createSignedUrl(t,e,r){return $r(this,void 0,void 0,function*(){try{let n=this.Tt(t),i=yield Rr(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:e},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const s=(null==r?void 0:r.download)?"&download="+(!0===r.download?"":r.download):"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${s}`)},{data:i,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mr(n))return{data:null,error:n};throw n}})}createSignedUrls(t,e,r){return $r(this,void 0,void 0,function*(){try{const n=yield Rr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),i=(null==r?void 0:r.download)?"&download="+(!0===r.download?"":r.download):"";return{data:n.map(t=>Object.assign(Object.assign({},t),{signedUrl:t.signedURL?encodeURI(`${this.url}${t.signedURL}${i}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mr(n))return{data:null,error:n};throw n}})}download(t,e){const r=void 0!==(null==e?void 0:e.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),i=n?"?"+n:"",s=this.Tt(t);return new Pr(()=>kr(this.fetch,`${this.url}/${r}/${s}${i}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(t){return $r(this,void 0,void 0,function*(){const e=this.Tt(t);try{const t=yield kr(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:Er(t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(mr(r))return{data:null,error:r};throw r}})}exists(t){return $r(this,void 0,void 0,function*(){const e=this.Tt(t);try{return yield function(t,e,r){return Or(this,void 0,void 0,function*(){return Tr(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(mr(r)&&r instanceof gr){const t=r.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,e){const r=this.Tt(t),n=[],i=(null==e?void 0:e.download)?"download="+(!0===e.download?"":e.download):"";""!==i&&n.push(i);const s=void 0!==(null==e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==o&&n.push(o);let a=n.join("&");return""!==a&&(a="?"+a),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${r}${a}`)}}}remove(t){return $r(this,void 0,void 0,function*(){try{return{data:yield Ar(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(mr(e))return{data:null,error:e};throw e}})}list(t,e,r){return $r(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},xr),e),{prefix:t||""});return{data:yield Rr(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(mr(n))return{data:null,error:n};throw n}})}listV2(t,e){return $r(this,void 0,void 0,function*(){try{const r=Object.assign({},t);return{data:yield Rr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},e),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(mr(r))return{data:null,error:r};throw r}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return"undefined"!=typeof Buffer?Buffer.from(t).toString("base64"):btoa(t)}Tt(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}St(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push("width="+t.width),t.height&&e.push("height="+t.height),t.resize&&e.push("resize="+t.resize),t.format&&e.push("format="+t.format),t.quality&&e.push("quality="+t.quality),e.join("&")}}const Cr={"X-Client-Info":"storage-js/2.75.0"};var Dr=function(t,e,r,n){return new(r||(r=Promise))(function(i,s){function o(t){try{l(n.next(t))}catch(mi){s(mi)}}function a(t){try{l(n.throw(t))}catch(mi){s(mi)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,a)}l((n=n.apply(t,e||[])).next())})};class Lr{constructor(t,e={},r,n){this.shouldThrowOnError=!1;const i=new URL(t);(null==n?void 0:n.useNewHostname)&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Cr),e),this.fetch=_r(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Dr(this,void 0,void 0,function*(){try{return{data:yield kr(this.fetch,this.url+"/bucket",{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(mr(t))return{data:null,error:t};throw t}})}getBucket(t){return Dr(this,void 0,void 0,function*(){try{return{data:yield kr(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(mr(e))return{data:null,error:e};throw e}})}createBucket(t){return Dr(this,arguments,void 0,function*(t,e={public:!1}){try{return{data:yield Rr(this.fetch,this.url+"/bucket",{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(mr(r))return{data:null,error:r};throw r}})}updateBucket(t,e){return Dr(this,void 0,void 0,function*(){try{return{data:yield jr(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(mr(r))return{data:null,error:r};throw r}})}emptyBucket(t){return Dr(this,void 0,void 0,function*(){try{return{data:yield Rr(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(mr(e))return{data:null,error:e};throw e}})}deleteBucket(t){return Dr(this,void 0,void 0,function*(){try{return{data:yield Ar(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(mr(e))return{data:null,error:e};throw e}})}}class Br extends Lr{constructor(t,e={},r,n){super(t,e,r,n)}from(t){return new Ur(this.url,this.headers,t,this.fetch)}}const Fr="2.75.0",Mr=3e4,Wr={"X-Client-Info":"gotrue-js/"+Fr},Jr="X-Supabase-Api-Version",Hr=Date.parse("2024-01-01T00:00:00.0Z"),Gr=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class qr extends Error{constructor(t,e,r){super(t),this.kt=!0,this.name="AuthError",this.status=e,this.code=r}}function Kr(t){return"object"==typeof t&&null!==t&&"kt"in t}class Vr extends qr{constructor(t,e,r){super(t,e,r),this.name="AuthApiError",this.status=e,this.code=r}}class zr extends qr{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Yr extends qr{constructor(t,e,r,n){super(t,r,n),this.name=e,this.status=r}}class Xr extends Yr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Qr extends Yr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Zr extends Yr{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class tn extends Yr{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class en extends Yr{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class rn extends Yr{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function nn(t){return Kr(t)&&"AuthRetryableFetchError"===t.name}class sn extends Yr{constructor(t,e,r){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}}class on extends Yr{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const an="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ln=" \t\n\r=".split(""),un=(()=>{const t=Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<ln.length;e+=1)t[ln[e].charCodeAt(0)]=-2;for(let e=0;e<an.length;e+=1)t[an[e].charCodeAt(0)]=e;return t})();function cn(t,e,r){if(null!==t)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;r(an[t]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;r(an[t]),e.queuedBits-=6}}function hn(t,e,r){const n=un[t];if(-1>=n){if(-2===n)return;throw Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8}function dn(t){const e=[],r=t=>{e.push(String.fromCodePoint(t))},n={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},s=t=>{!function(t,e,r){if(0===e.utf8seq){if(127>=t)return void r(t);for(let r=1;6>r;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(2===e.utf8seq)e.codepoint=31&t;else if(3===e.utf8seq)e.codepoint=15&t;else{if(4!==e.utf8seq)throw Error("Invalid UTF-8 sequence");e.codepoint=7&t}e.utf8seq-=1}else if(e.utf8seq>0){if(127>=t)throw Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|63&t,e.utf8seq-=1,0===e.utf8seq&&r(e.codepoint)}}(t,n,r)};for(let o=0;o<t.length;o+=1)hn(t.charCodeAt(o),i,s);return e.join("")}function fn(t,e){if(t>127){if(2047>=t)return e(192|t>>6),void e(128|63&t);if(65535>=t)return e(224|t>>12),e(128|t>>6&63),void e(128|63&t);if(1114111>=t)return e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),void e(128|63&t);throw Error("Unrecognized Unicode codepoint: "+t.toString(16))}e(t)}function vn(t){const e=[],r={queue:0,queuedBits:0},n=t=>{e.push(t)};for(let i=0;i<t.length;i+=1)hn(t.charCodeAt(i),r,n);return new Uint8Array(e)}function pn(t){const e=[],r={queue:0,queuedBits:0},n=t=>{e.push(t)};return t.forEach(t=>cn(t,r,n)),cn(null,r,n),e.join("")}const wn=()=>"undefined"!=typeof window&&"undefined"!=typeof document,yn={tested:!1,writable:!1},mn=()=>{if(!wn())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(mi){return!1}if(yn.tested)return yn.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),yn.tested=!0,yn.writable=!0}catch(mi){yn.tested=!0,yn.writable=!1}return yn.writable},bn=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>l(async()=>{const{default:t}=await Promise.resolve().then(()=>re);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},gn=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},_n=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch(n){return r}},En=async(t,e)=>{await t.removeItem(e)};class On{constructor(){this.promise=new On.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}function Sn(t){const e=t.split(".");if(3!==e.length)throw new on("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Gr.test(e[r]))throw new on("JWT not in base64url format");return{header:JSON.parse(dn(e[0])),payload:JSON.parse(dn(e[1])),signature:vn(e[2]),raw:{header:e[0],payload:e[1]}}}function Tn(t){return("0"+t.toString(16)).substr(-2)}async function kn(t,e,r=!1){const n=function(){const t=new Uint32Array(56);if("undefined"==typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let r="";for(let n=0;56>n;n++)r+=t.charAt(Math.floor(Math.random()*e));return r}return crypto.getRandomValues(t),Array.from(t,Tn).join("")}();let i=n;r&&(i+="/PASSWORD_RECOVERY"),await gn(t,e+"-code-verifier",i);const s=await async function(t){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return t;const e=await async function(t){const e=(new TextEncoder).encode(t),r=await crypto.subtle.digest("SHA-256",e),n=new Uint8Array(r);return Array.from(n).map(t=>String.fromCharCode(t)).join("")}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(n);return[s,n===s?"plain":"s256"]}On.promiseConstructor=Promise;const Rn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,jn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function An(t){if(!jn.test(t))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function In(){return new Proxy({},{get:(t,e)=>{if("__isUserNotAvailableProxy"===e)return!0;if("symbol"==typeof e){const t=e.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t)return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Pn(t){return JSON.parse(JSON.stringify(t))}const $n=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),xn=[502,503,504];async function Nn(t){var e,r;if(!("object"==typeof(r=t)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new rn($n(t),0);if(xn.includes(t.status))throw new rn($n(t),t.status);let n,i;try{n=await t.json()}catch(mi){throw new zr($n(mi),mi)}const s=function(t){const e=t.headers.get(Jr);if(!e)return null;if(!e.match(Rn))return null;try{return new Date(e+"T00:00:00.0Z")}catch(mi){return null}}(t);if(s&&s.getTime()>=Hr&&"object"==typeof n&&n&&"string"==typeof n.code?i=n.code:"object"==typeof n&&n&&"string"==typeof n.error_code&&(i=n.error_code),i){if("weak_password"===i)throw new sn($n(n),t.status,(null===(e=n.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===i)throw new Xr}else if("object"==typeof n&&n&&"object"==typeof n.weak_password&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0))throw new sn($n(n),t.status,n.weak_password.reasons);throw new Vr($n(n),t.status||500,i)}async function Un(t,e,r,n){var i;const s=Object.assign({},null==n?void 0:n.headers);s[Jr]||(s[Jr]="2024-01-01"),(null==n?void 0:n.jwt)&&(s.Authorization="Bearer "+n.jwt);const o=null!==(i=null==n?void 0:n.query)&&void 0!==i?i:{};(null==n?void 0:n.redirectTo)&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(t,e,r,n,i,s){const o=((t,e,r,n)=>{const i={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==e?void 0:e.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),{}))})(e,n,0,s);let a;try{a=await t(r,Object.assign({},o))}catch(mi){throw new rn($n(mi),0)}if(a.ok||await Nn(a),null==n?void 0:n.noResolveJson)return a;try{return await a.json()}catch(mi){await Nn(mi)}}(t,e,r+a,{headers:s,noResolveJson:null==n?void 0:n.noResolveJson},0,null==n?void 0:n.body);return(null==n?void 0:n.xform)?null==n?void 0:n.xform(l):{data:Object.assign({},l),error:null}}function Cn(t){var e;let r=null;var n;return function(t){return t.access_token&&t.refresh_token&&t.expires_in}(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=(n=t.expires_in,Math.round(Date.now()/1e3)+n))),{data:{session:r,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function Dn(t){const e=Cn(t);return!e.error&&t.weak_password&&"object"==typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"==typeof t.weak_password.message&&t.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0)&&(e.data.weak_password=t.weak_password),e}function Ln(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function Bn(t){return{data:t,error:null}}function Fn(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:i,verification_type:s}=t,o=function(t,e){var r={};for(var n in t)({}).hasOwnProperty.call(t,n)&&0>e.indexOf(n)&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)0>e.indexOf(n[i])&&{}.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:e,email_otp:r,hashed_token:n,redirect_to:i,verification_type:s},user:Object.assign({},o)},error:null}}function Mn(t){return t}const Wn=["global","local","others"];class Jn{constructor({url:t="",headers:e={},fetch:r}){this.url=t,this.headers=e,this.fetch=bn(r),this.mfa={listFactors:this.Rt.bind(this),deleteFactor:this.jt.bind(this)},this.oauth={listClients:this.At.bind(this),createClient:this.It.bind(this),getClient:this.Pt.bind(this),deleteClient:this.$t.bind(this),regenerateClientSecret:this.xt.bind(this)}}async signOut(t,e=Wn[0]){if(0>Wn.indexOf(e))throw Error("@supabase/auth-js: Parameter scope must be one of "+Wn.join(", "));try{return await Un(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Kr(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,e={}){try{return await Un(this.fetch,"POST",this.url+"/invite",{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:Ln})}catch(r){if(Kr(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:e}=t,r=function(t,e){var r={};for(var n in t)({}).hasOwnProperty.call(t,n)&&0>e.indexOf(n)&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)0>e.indexOf(n[i])&&{}.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}(t,["options"]),n=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(n.new_email=null==r?void 0:r.newEmail,delete n.newEmail),await Un(this.fetch,"POST",this.url+"/admin/generate_link",{body:n,headers:this.headers,xform:Fn,redirectTo:null==e?void 0:e.redirectTo})}catch(e){if(Kr(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await Un(this.fetch,"POST",this.url+"/admin/users",{body:t,headers:this.headers,xform:Ln})}catch(e){if(Kr(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,r,n,i,s,o,a;try{const l={nextPage:null,lastPage:0,total:0},u=await Un(this.fetch,"GET",this.url+"/admin/users",{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==r?r:"",per_page:null!==(i=null===(n=null==t?void 0:t.perPage)||void 0===n?void 0:n.toString())&&void 0!==i?i:""},xform:Mn});if(u.error)throw u.error;const c=await u.json(),h=null!==(s=u.headers.get("x-total-count"))&&void 0!==s?s:0,d=null!==(a=null===(o=u.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(t.split(";")[1].split("=")[1]);l[r+"Page"]=e}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(l){if(Kr(l))return{data:{users:[]},error:l};throw l}}async getUserById(t){An(t);try{return await Un(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ln})}catch(e){if(Kr(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){An(t);try{return await Un(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:Ln})}catch(r){if(Kr(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,e=!1){An(t);try{return await Un(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:Ln})}catch(r){if(Kr(r))return{data:{user:null},error:r};throw r}}async Rt(t){An(t.userId);try{const{data:e,error:r}=await Un(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:t=>({data:{factors:t},error:null})});return{data:e,error:r}}catch(e){if(Kr(e))return{data:null,error:e};throw e}}async jt(t){An(t.userId),An(t.id);try{return{data:await Un(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(Kr(e))return{data:null,error:e};throw e}}async At(t){var e,r,n,i,s,o,a;try{const l={nextPage:null,lastPage:0,total:0},u=await Un(this.fetch,"GET",this.url+"/admin/oauth/clients",{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==r?r:"",per_page:null!==(i=null===(n=null==t?void 0:t.perPage)||void 0===n?void 0:n.toString())&&void 0!==i?i:""},xform:Mn});if(u.error)throw u.error;const c=await u.json(),h=null!==(s=u.headers.get("x-total-count"))&&void 0!==s?s:0,d=null!==(a=null===(o=u.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(t.split(";")[1].split("=")[1]);l[r+"Page"]=e}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(l){if(Kr(l))return{data:{clients:[]},error:l};throw l}}async It(t){try{return await Un(this.fetch,"POST",this.url+"/admin/oauth/clients",{body:t,headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(Kr(e))return{data:null,error:e};throw e}}async Pt(t){try{return await Un(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(Kr(e))return{data:null,error:e};throw e}}async $t(t){try{return await Un(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(Kr(e))return{data:null,error:e};throw e}}async xt(t){try{return await Un(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(e){if(Kr(e))return{data:null,error:e};throw e}}}function Hn(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const Gn=!!(globalThis&&mn()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class qn extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Kn extends qn{}async function Vn(t,e,r){const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort()},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async n=>{if(!n){if(0===e)throw new Kn(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Gn)try{await globalThis.navigator.locks.query()}catch(mi){}return await r()}try{return await r()}finally{}}))}function zn(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Yn(t){const e=(new TextEncoder).encode(t);return"0x"+Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}class Xn extends Error{constructor({message:t,code:e,cause:r,name:n}){var i;super(t,{cause:r}),this.Nt=!0,this.name=null!==(i=null!=n?n:r instanceof Error?r.name:void 0)&&void 0!==i?i:"Unknown Error",this.code=e}}class Qn extends Xn{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}}function Zn({error:t,options:e}){var r,n,i;const{publicKey:s}=e;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(e.signal instanceof AbortSignal)return new Xn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if("ConstraintError"===t.name){if(!0===(null===(r=s.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new Xn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if("conditional"===e.mediation&&"required"===(null===(n=s.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new Xn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if("required"===(null===(i=s.authenticatorSelection)||void 0===i?void 0:i.userVerification))return new Xn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if("InvalidStateError"===t.name)return new Xn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if("NotAllowedError"===t.name)return new Xn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("NotSupportedError"===t.name)return 0===s.pubKeyCredParams.filter(t=>"public-key"===t.type).length?new Xn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Xn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if("SecurityError"===t.name){const e=window.location.hostname;if(!ai(e))return new Xn({message:window.location.hostname+" is an invalid domain",code:"ERROR_INVALID_DOMAIN",cause:t});if(s.rp.id!==e)return new Xn({message:`The RP ID "${s.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else if("TypeError"===t.name){if(1>s.user.id.byteLength||s.user.id.byteLength>64)return new Xn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if("UnknownError"===t.name)return new Xn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Xn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function ti({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(e.signal instanceof AbortSignal)return new Xn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if("NotAllowedError"===t.name)return new Xn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("SecurityError"===t.name){const e=window.location.hostname;if(!ai(e))return new Xn({message:window.location.hostname+" is an invalid domain",code:"ERROR_INVALID_DOMAIN",cause:t});if(r.rpId!==e)return new Xn({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else if("UnknownError"===t.name)return new Xn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Xn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}var ei=function(t,e){var r={};for(var n in t)({}).hasOwnProperty.call(t,n)&&0>e.indexOf(n)&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)0>e.indexOf(n[i])&&{}.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r};const ri=new class{createNewAbortSignal(){if(this.controller){const t=Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}};function ni(t){if(!t)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:n}=t,i=ei(t,["challenge","user","excludeCredentials"]),s=vn(e).buffer,o=Object.assign(Object.assign({},r),{id:vn(r.id).buffer}),a=Object.assign(Object.assign({},i),{challenge:s,user:o});if(n&&n.length>0){a.excludeCredentials=Array(n.length);for(let t=0;t<n.length;t++){const e=n[t];a.excludeCredentials[t]=Object.assign(Object.assign({},e),{id:vn(e.id).buffer,type:e.type||"public-key",transports:e.transports})}}return a}function ii(t){if(!t)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,n=ei(t,["challenge","allowCredentials"]),i=vn(e).buffer,s=Object.assign(Object.assign({},n),{challenge:i});if(r&&r.length>0){s.allowCredentials=Array(r.length);for(let t=0;t<r.length;t++){const e=r[t];s.allowCredentials[t]=Object.assign(Object.assign({},e),{id:vn(e.id).buffer,type:e.type||"public-key",transports:e.transports})}}return s}function si(t){var e;if("toJSON"in t&&"function"==typeof t.toJSON)return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:pn(new Uint8Array(t.response.attestationObject)),clientDataJSON:pn(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:null!==(e=r.authenticatorAttachment)&&void 0!==e?e:void 0}}function oi(t){var e;if("toJSON"in t&&"function"==typeof t.toJSON)return t.toJSON();const r=t,n=t.getClientExtensionResults(),i=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:pn(new Uint8Array(i.authenticatorData)),clientDataJSON:pn(new Uint8Array(i.clientDataJSON)),signature:pn(new Uint8Array(i.signature)),userHandle:i.userHandle?pn(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:null!==(e=r.authenticatorAttachment)&&void 0!==e?e:void 0}}function ai(t){return"localhost"===t||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function li(){var t,e;return!!(wn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.create)&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.get))}const ui={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},ci={userVerification:"preferred",hints:["security-key"]};function hi(...t){const e=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),r=t=>t instanceof ArrayBuffer||ArrayBuffer.isView(t),n={};for(const i of t)if(i)for(const t in i){const s=i[t];if(void 0!==s)if(Array.isArray(s))n[t]=s;else if(r(s))n[t]=s;else if(e(s)){const r=n[t];e(r)?n[t]=hi(r,s):n[t]=hi(s)}else n[t]=s}return n}class di{constructor(t){this.client=t,this.enroll=this.Ut.bind(this),this.challenge=this.Ct.bind(this),this.verify=this.Dt.bind(this),this.authenticate=this.Lt.bind(this),this.register=this.Bt.bind(this)}async Ut(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async Ct({factorId:t,webauthn:e,friendlyName:r,signal:n},i){try{const{data:s,error:o}=await this.client.mfa.challenge({factorId:t,webauthn:e});if(!s)return{data:null,error:o};const a=null!=n?n:ri.createNewAbortSignal();if("create"===s.webauthn.type){const{user:t}=s.webauthn.credential_options.publicKey;t.name||(t.name=`${t.id}:${r}`),t.displayName||(t.displayName=t.name)}switch(s.webauthn.type){case"create":{const e=function(t,e){return hi(ui,t,e||{})}(s.webauthn.credential_options.publicKey,null==i?void 0:i.create),{data:r,error:n}=await async function(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Qn("Browser returned unexpected credential type",e)}:{data:null,error:new Qn("Empty credential response",e)}}catch(e){return{data:null,error:Zn({error:e,options:t})}}}({publicKey:e,signal:a});return r?{data:{factorId:t,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:r}},error:null}:{data:null,error:n}}case"request":{const e=function(t,e){return hi(ci,t,e||{})}(s.webauthn.credential_options.publicKey,null==i?void 0:i.request),{data:r,error:n}=await async function(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Qn("Browser returned unexpected credential type",e)}:{data:null,error:new Qn("Empty credential response",e)}}catch(e){return{data:null,error:ti({error:e,options:t})}}}(Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:e,signal:a}));return r?{data:{factorId:t,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:r}},error:null}:{data:null,error:n}}}}catch(s){return Kr(s)?{data:null,error:s}:{data:null,error:new zr("Unexpected error in challenge",s)}}}async Dt({challengeId:t,factorId:e,webauthn:r}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:r})}async Lt({factorId:t,webauthn:{rpId:e=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n}},i){if(!e)return{data:null,error:new qr("rpId is required for WebAuthn authentication")};try{if(!li())return{data:null,error:new zr("Browser does not support WebAuthn",null)};const{data:s,error:o}=await this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:r},signal:n},{request:i});if(!s)return{data:null,error:o};const{webauthn:a}=s;return this.Dt({factorId:t,challengeId:s.challengeId,webauthn:{type:a.type,rpId:e,rpOrigins:r,credential_response:a.credential_response}})}catch(s){return Kr(s)?{data:null,error:s}:{data:null,error:new zr("Unexpected error in authenticate",s)}}}async Bt({friendlyName:t,rpId:e=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n},i){if(!e)return{data:null,error:new qr("rpId is required for WebAuthn registration")};try{if(!li())return{data:null,error:new zr("Browser does not support WebAuthn",null)};const{data:s,error:o}=await this.Ut({friendlyName:t});if(!s)return await this.client.mfa.listFactors().then(e=>{var r;return null===(r=e.data)||void 0===r?void 0:r.all.find(e=>"webauthn"===e.factor_type&&e.friendly_name===t&&"unverified"!==e.status)}).then(t=>t?this.client.mfa.unenroll({factorId:null==t?void 0:t.id}):void 0),{data:null,error:o};const{data:a,error:l}=await this.Ct({factorId:s.id,friendlyName:s.friendly_name,webauthn:{rpId:e,rpOrigins:r},signal:n},{create:i});return a?this.Dt({factorId:s.id,challengeId:a.challengeId,webauthn:{rpId:e,rpOrigins:r,type:a.webauthn.type,credential_response:a.webauthn.credential_response}}):{data:null,error:l}}catch(s){return Kr(s)?{data:null,error:s}:{data:null,error:new zr("Unexpected error in register",s)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"Ft",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.Ft}catch(mi){"undefined"!=typeof self&&(self.globalThis=self)}}();const fi={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Wr,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function vi(t,e,r){return await r()}const pi={};class wi{get jwks(){var t,e;return null!==(e=null===(t=pi[this.storageKey])||void 0===t?void 0:t.jwks)&&void 0!==e?e:{keys:[]}}set jwks(t){pi[this.storageKey]=Object.assign(Object.assign({},pi[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return null!==(e=null===(t=pi[this.storageKey])||void 0===t?void 0:t.cachedAt)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){pi[this.storageKey]=Object.assign(Object.assign({},pi[this.storageKey]),{cachedAt:t})}constructor(t){var e,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=wi.nextInstanceID,wi.nextInstanceID+=1,this.instanceID>0&&wn();const n=Object.assign(Object.assign({},fi),t);if(this.logDebugMessages=!!n.debug,"function"==typeof n.debug&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Jn({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=bn(n.fetch),this.lock=n.lock||vi,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:wn()&&(null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===e?void 0:e.locks)?this.lock=Vn:this.lock=vi,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this.Dt.bind(this),enroll:this.Ut.bind(this),unenroll:this.Mt.bind(this),challenge:this.Ct.bind(this),listFactors:this.Rt.bind(this),challengeAndVerify:this.Wt.bind(this),getAuthenticatorAssuranceLevel:this.Jt.bind(this),webauthn:new di(this)},this.persistSession?(n.storage?this.storage=n.storage:mn()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Hn(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Hn(this.memoryStorage)),wn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(mi){}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async t=>{this.Ht("received broadcast notification from other tab or client",t),await this.Gt(t.data.event,t.data.session,!1)})}this.initialize()}Ht(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Fr}) ${(new Date).toISOString()}`,...t),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this.qt(-1,async()=>await this.Kt()))()),await this.initializePromise}async Kt(){var t;try{const e=function(t){const e={},r=new URL(t);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((t,r)=>{e[r]=t})}catch(mi){}return r.searchParams.forEach((t,r)=>{e[r]=t}),e}(window.location.href);let r="none";if(this.Vt(e)?r="implicit":await this.zt(e)&&(r="pkce"),wn()&&this.detectSessionInUrl&&"none"!==r){const{data:n,error:i}=await this.Yt(e,r);if(i){if(this.Ht("#_initialize()","error detecting session from URL",i),function(t){return Kr(t)&&"AuthImplicitGrantRedirectError"===t.name}(i)){const e=null===(t=i.details)||void 0===t?void 0:t.code;if("identity_already_exists"===e||"identity_not_found"===e||"single_identity_not_deletable"===e)return{error:i}}return await this.Xt(),{error:i}}const{session:s,redirectType:o}=n;return this.Ht("#_initialize()","detected session in URL",s,"redirect type",o),await this.Qt(s),setTimeout(async()=>{"recovery"===o?await this.Gt("PASSWORD_RECOVERY",s):await this.Gt("SIGNED_IN",s)},0),{error:null}}return await this.Zt(),{error:null}}catch(e){return Kr(e)?{error:e}:{error:new zr("Unexpected error during initialization",e)}}finally{await this.te(),this.Ht("#_initialize()","end")}}async signInAnonymously(t){var e,r,n;try{const i=await Un(this.fetch,"POST",this.url+"/signup",{headers:this.headers,body:{data:null!==(r=null===(e=null==t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(n=null==t?void 0:t.options)||void 0===n?void 0:n.captchaToken}},xform:Cn}),{data:s,error:o}=i;if(o||!s)return{data:{user:null,session:null},error:o};const a=s.session,l=s.user;return s.session&&(await this.Qt(s.session),await this.Gt("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(i){if(Kr(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(t){var e,r,n;try{let i;if("email"in t){const{email:r,password:n,options:s}=t;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await kn(this.storage,this.storageKey)),i=await Un(this.fetch,"POST",this.url+"/signup",{headers:this.headers,redirectTo:null==s?void 0:s.emailRedirectTo,body:{email:r,password:n,data:null!==(e=null==s?void 0:s.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:o,code_challenge_method:a},xform:Cn})}else{if(!("phone"in t))throw new Zr("You must provide either an email or phone number and a password");{const{phone:e,password:s,options:o}=t;i=await Un(this.fetch,"POST",this.url+"/signup",{headers:this.headers,body:{phone:e,password:s,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(n=null==o?void 0:o.channel)&&void 0!==n?n:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:Cn})}}const{data:s,error:o}=i;if(o||!s)return{data:{user:null,session:null},error:o};const a=s.session,l=s.user;return s.session&&(await this.Qt(s.session),await this.Gt("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(i){if(Kr(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(t){try{let e;if("email"in t){const{email:r,password:n,options:i}=t;e=await Un(this.fetch,"POST",this.url+"/token?grant_type=password",{headers:this.headers,body:{email:r,password:n,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Dn})}else{if(!("phone"in t))throw new Zr("You must provide either an email or phone number and a password");{const{phone:r,password:n,options:i}=t;e=await Un(this.fetch,"POST",this.url+"/token?grant_type=password",{headers:this.headers,body:{phone:r,password:n,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Dn})}}const{data:r,error:n}=e;return n?{data:{user:null,session:null},error:n}:r&&r.session&&r.user?(r.session&&(await this.Qt(r.session),await this.Gt("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n}):{data:{user:null,session:null},error:new Qr}}catch(e){if(Kr(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(t){var e,r,n,i;return await this.ee(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(r=t.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=t.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:null===(i=t.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this.qt(-1,async()=>this.re(t))}async signInWithWeb3(t){const{chain:e}=t;switch(e){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw Error(`@supabase/auth-js: Unsupported chain "${e}"`)}}async signInWithEthereum(t){var e,r,n,i,s,o,a,l,u,c,h;let d,f;if("message"in t)d=t.message,f=t.signature;else{const{chain:c,wallet:h,statement:v,options:p}=t;let w;if(wn())if("object"==typeof h)w=h;else{const t=window;if(!("ethereum"in t)||"object"!=typeof t.ethereum||!("request"in t.ethereum)||"function"!=typeof t.ethereum.request)throw Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");w=t.ethereum}else{if("object"!=typeof h||!(null==p?void 0:p.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=h}const y=new URL(null!==(e=null==p?void 0:p.url)&&void 0!==e?e:window.location.href),m=await w.request({method:"eth_requestAccounts"}).then(t=>t).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!m||0===m.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const b=zn(m[0]);let g=null===(r=null==p?void 0:p.signInWithEthereum)||void 0===r?void 0:r.chainId;if(!g){const t=await w.request({method:"eth_chainId"});g=parseInt(t,16)}d=function(t){var e;const{chainId:r,domain:n,expirationTime:i,issuedAt:s=new Date,nonce:o,notBefore:a,requestId:l,resources:u,scheme:c,uri:h,version:d}=t;if(!Number.isInteger(r))throw Error('@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: '+r);if(!n)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&8>o.length)throw Error('@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: '+o);if(!h)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw Error("@supabase/auth-js: Invalid SIWE message field \"version\". Version must be '1'. Provided value: "+d);if(null===(e=t.statement)||void 0===e?void 0:e.includes("\n"))throw Error("@supabase/auth-js: Invalid SIWE message field \"statement\". Statement must not include '\\n'. Provided value: "+t.statement);const f=`${c?`${c}://${n}`:n} wants you to sign in with your Ethereum account:\n${zn(t.address)}\n\n${t.statement?t.statement+"\n":""}`;let v=`URI: ${h}\nVersion: ${d}\nChain ID: ${r}${o?"\nNonce: "+o:""}\nIssued At: ${s.toISOString()}`;if(i&&(v+="\nExpiration Time: "+i.toISOString()),a&&(v+="\nNot Before: "+a.toISOString()),l&&(v+="\nRequest ID: "+l),u){let t="\nResources:";for(const e of u){if(!e||"string"!=typeof e)throw Error('@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: '+e);t+="\n- "+e}v+=t}return`${f}\n${v}`}({domain:y.host,address:b,statement:v,uri:y.href,version:"1",chainId:g,nonce:null===(n=null==p?void 0:p.signInWithEthereum)||void 0===n?void 0:n.nonce,issuedAt:null!==(s=null===(i=null==p?void 0:p.signInWithEthereum)||void 0===i?void 0:i.issuedAt)&&void 0!==s?s:new Date,expirationTime:null===(o=null==p?void 0:p.signInWithEthereum)||void 0===o?void 0:o.expirationTime,notBefore:null===(a=null==p?void 0:p.signInWithEthereum)||void 0===a?void 0:a.notBefore,requestId:null===(l=null==p?void 0:p.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(u=null==p?void 0:p.signInWithEthereum)||void 0===u?void 0:u.resources}),f=await w.request({method:"personal_sign",params:[Yn(d),b]})}try{const{data:e,error:r}=await Un(this.fetch,"POST",this.url+"/token?grant_type=web3",{headers:this.headers,body:Object.assign({chain:"ethereum",message:d,signature:f},(null===(c=t.options)||void 0===c?void 0:c.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=t.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Cn});if(r)throw r;return e&&e.session&&e.user?(e.session&&(await this.Qt(e.session),await this.Gt("SIGNED_IN",e.session)),{data:Object.assign({},e),error:r}):{data:{user:null,session:null},error:new Qr}}catch(v){if(Kr(v))return{data:{user:null,session:null},error:v};throw v}}async signInWithSolana(t){var e,r,n,i,s,o,a,l,u,c,h,d;let f,v;if("message"in t)f=t.message,v=t.signature;else{const{chain:h,wallet:d,statement:p,options:w}=t;let y;if(wn())if("object"==typeof d)y=d;else{const t=window;if(!("solana"in t)||"object"!=typeof t.solana||!("signIn"in t.solana&&"function"==typeof t.solana.signIn||"signMessage"in t.solana&&"function"==typeof t.solana.signMessage))throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=t.solana}else{if("object"!=typeof d||!(null==w?void 0:w.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=d}const m=new URL(null!==(e=null==w?void 0:w.url)&&void 0!==e?e:window.location.href);if("signIn"in y&&y.signIn){const t=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==w?void 0:w.signInWithSolana),{version:"1",domain:m.host,uri:m.href}),p?{statement:p}:null));let e;if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else{if(!(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t))throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");e=t}if(!("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof e.signedMessage?e.signedMessage:(new TextDecoder).decode(e.signedMessage),v=e.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[m.host+" wants you to sign in with your Solana account:",y.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1","URI: "+m.href,"Issued At: "+(null!==(n=null===(r=null==w?void 0:w.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==n?n:(new Date).toISOString()),...(null===(i=null==w?void 0:w.signInWithSolana)||void 0===i?void 0:i.notBefore)?["Not Before: "+w.signInWithSolana.notBefore]:[],...(null===(s=null==w?void 0:w.signInWithSolana)||void 0===s?void 0:s.expirationTime)?["Expiration Time: "+w.signInWithSolana.expirationTime]:[],...(null===(o=null==w?void 0:w.signInWithSolana)||void 0===o?void 0:o.chainId)?["Chain ID: "+w.signInWithSolana.chainId]:[],...(null===(a=null==w?void 0:w.signInWithSolana)||void 0===a?void 0:a.nonce)?["Nonce: "+w.signInWithSolana.nonce]:[],...(null===(l=null==w?void 0:w.signInWithSolana)||void 0===l?void 0:l.requestId)?["Request ID: "+w.signInWithSolana.requestId]:[],...(null===(c=null===(u=null==w?void 0:w.signInWithSolana)||void 0===u?void 0:u.resources)||void 0===c?void 0:c.length)?["Resources",...w.signInWithSolana.resources.map(t=>"- "+t)]:[]].join("\n");const t=await y.signMessage((new TextEncoder).encode(f),"utf8");if(!(t&&t instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=t}}try{const{data:e,error:r}=await Un(this.fetch,"POST",this.url+"/token?grant_type=web3",{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:pn(v)},(null===(h=t.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=t.options)||void 0===d?void 0:d.captchaToken}}:null),xform:Cn});if(r)throw r;return e&&e.session&&e.user?(e.session&&(await this.Qt(e.session),await this.Gt("SIGNED_IN",e.session)),{data:Object.assign({},e),error:r}):{data:{user:null,session:null},error:new Qr}}catch(p){if(Kr(p))return{data:{user:null,session:null},error:p};throw p}}async re(t){const e=await _n(this.storage,this.storageKey+"-code-verifier"),[r,n]=(null!=e?e:"").split("/");try{const{data:e,error:i}=await Un(this.fetch,"POST",this.url+"/token?grant_type=pkce",{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:Cn});if(await En(this.storage,this.storageKey+"-code-verifier"),i)throw i;return e&&e.session&&e.user?(e.session&&(await this.Qt(e.session),await this.Gt("SIGNED_IN",e.session)),{data:Object.assign(Object.assign({},e),{redirectType:null!=n?n:null}),error:i}):{data:{user:null,session:null,redirectType:null},error:new Qr}}catch(i){if(Kr(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(t){try{const{options:e,provider:r,token:n,access_token:i,nonce:s}=t,o=await Un(this.fetch,"POST",this.url+"/token?grant_type=id_token",{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:s,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:Cn}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this.Qt(a.session),await this.Gt("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new Qr}}catch(e){if(Kr(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(t){var e,r,n,i,s;try{if("email"in t){const{email:n,options:i}=t;let s=null,o=null;"pkce"===this.flowType&&([s,o]=await kn(this.storage,this.storageKey));const{error:a}=await Un(this.fetch,"POST",this.url+"/otp",{headers:this.headers,body:{email:n,data:null!==(e=null==i?void 0:i.data)&&void 0!==e?e:{},create_user:null===(r=null==i?void 0:i.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:s,code_challenge_method:o},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in t){const{phone:e,options:r}=t,{data:o,error:a}=await Un(this.fetch,"POST",this.url+"/otp",{headers:this.headers,body:{phone:e,data:null!==(n=null==r?void 0:r.data)&&void 0!==n?n:{},create_user:null===(i=null==r?void 0:r.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(s=null==r?void 0:r.channel)&&void 0!==s?s:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new Zr("You must provide either an email or phone number.")}catch(o){if(Kr(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var e,r;try{let n,i;"options"in t&&(n=null===(e=t.options)||void 0===e?void 0:e.redirectTo,i=null===(r=t.options)||void 0===r?void 0:r.captchaToken);const{data:s,error:o}=await Un(this.fetch,"POST",this.url+"/verify",{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:Cn});if(o)throw o;if(!s)throw Error("An error occurred on token verification.");const a=s.session,l=s.user;return(null==a?void 0:a.access_token)&&(await this.Qt(a),await this.Gt("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(Kr(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(t){var e,r,n;try{let i=null,s=null;return"pkce"===this.flowType&&([i,s]=await kn(this.storage,this.storageKey)),await Un(this.fetch,"POST",this.url+"/sso",{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(r=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==r?r:void 0}),(null===(n=null==t?void 0:t.options)||void 0===n?void 0:n.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:s}),headers:this.headers,xform:Bn})}catch(i){if(Kr(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this.qt(-1,async()=>await this.ne())}async ne(){try{return await this.ie(async t=>{const{data:{session:e},error:r}=t;if(r)throw r;if(!e)throw new Xr;const{error:n}=await Un(this.fetch,"GET",this.url+"/reauthenticate",{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:n}})}catch(t){if(Kr(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const e=this.url+"/resend";if("email"in t){const{email:r,type:n,options:i}=t,{error:s}=await Un(this.fetch,"POST",e,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:s}}if("phone"in t){const{phone:r,type:n,options:i}=t,{data:s,error:o}=await Un(this.fetch,"POST",e,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==s?void 0:s.message_id},error:o}}throw new Zr("You must provide either an email or phone number and a type")}catch(e){if(Kr(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this.qt(-1,async()=>this.ie(async t=>t))}async qt(t,e){this.Ht("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await t,await e()))();return this.pendingInLock.push((async()=>{try{await r}catch(mi){}})()),r}return await this.lock("lock:"+this.storageKey,t,async()=>{this.Ht("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((async()=>{try{await t}catch(mi){}})()),await t;this.pendingInLock.length;){const t=[...this.pendingInLock];await Promise.all(t),this.pendingInLock.splice(0,t.length)}return await t}finally{this.Ht("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this.Ht("#_acquireLock","end")}}async ie(t){this.Ht("#_useSession","begin");try{const e=await this.se();return await t(e)}finally{this.Ht("#_useSession","end")}}async se(){this.Ht("#__loadSession()","begin"),this.lockAcquired||this.Ht("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let t=null;const e=await _n(this.storage,this.storageKey);if(this.Ht("#getSession()","session from storage",e),null!==e&&(this.oe(e)?t=e:(this.Ht("#getSession()","session from storage is not valid"),await this.Xt())),!t)return{data:{session:null},error:null};const r=!!t.expires_at&&9e4>1e3*t.expires_at-Date.now();if(this.Ht("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const e=await _n(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=In()}if(this.storage.isServer&&t.user){let e=this.suppressGetSessionWarning;t=new Proxy(t,{get:(t,r,n)=>(e||"user"!==r||(e=!0,this.suppressGetSessionWarning=!0),Reflect.get(t,r,n))})}return{data:{session:t},error:null}}const{data:n,error:i}=await this.ae(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this.Ht("#__loadSession()","end")}}async getUser(t){return t?await this.le(t):(await this.initializePromise,await this.qt(-1,async()=>await this.le()))}async le(t){try{return t?await Un(this.fetch,"GET",this.url+"/user",{headers:this.headers,jwt:t,xform:Ln}):await this.ie(async t=>{var e,r,n;const{data:i,error:s}=t;if(s)throw s;return(null===(e=i.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?await Un(this.fetch,"GET",this.url+"/user",{headers:this.headers,jwt:null!==(n=null===(r=i.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0,xform:Ln}):{data:{user:null},error:new Xr}})}catch(e){if(Kr(e))return function(t){return Kr(t)&&"AuthSessionMissingError"===t.name}(e)&&(await this.Xt(),await En(this.storage,this.storageKey+"-code-verifier")),{data:{user:null},error:e};throw e}}async updateUser(t,e={}){return await this.initializePromise,await this.qt(-1,async()=>await this.ue(t,e))}async ue(t,e={}){try{return await this.ie(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new Xr;const s=n.session;let o=null,a=null;"pkce"===this.flowType&&null!=t.email&&([o,a]=await kn(this.storage,this.storageKey));const{data:l,error:u}=await Un(this.fetch,"PUT",this.url+"/user",{headers:this.headers,redirectTo:null==e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:s.access_token,xform:Ln});if(u)throw u;return s.user=l.user,await this.Qt(s),await this.Gt("USER_UPDATED",s),{data:{user:s.user},error:null}})}catch(r){if(Kr(r))return{data:{user:null},error:r};throw r}}async setSession(t){return await this.initializePromise,await this.qt(-1,async()=>await this.ce(t))}async ce(t){try{if(!t.access_token||!t.refresh_token)throw new Xr;const e=Date.now()/1e3;let r=e,n=!0,i=null;const{payload:s}=Sn(t.access_token);if(s.exp&&(r=s.exp,n=e>=r),n){const{data:e,error:r}=await this.ae(t.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!e)return{data:{user:null,session:null},error:null};i=e}else{const{data:n,error:s}=await this.le(t.access_token);if(s)throw s;i={access_token:t.access_token,refresh_token:t.refresh_token,user:n.user,token_type:"bearer",expires_in:r-e,expires_at:r},await this.Qt(i),await this.Gt("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(e){if(Kr(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(t){return await this.initializePromise,await this.qt(-1,async()=>await this.he(t))}async he(t){try{return await this.ie(async e=>{var r;if(!t){const{data:n,error:i}=e;if(i)throw i;t=null!==(r=n.session)&&void 0!==r?r:void 0}if(!(null==t?void 0:t.refresh_token))throw new Xr;const{data:n,error:i}=await this.ae(t.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(Kr(e))return{data:{user:null,session:null},error:e};throw e}}async Yt(t,e){try{if(!wn())throw new tn("No browser detected.");if(t.error||t.error_description||t.error_code)throw new tn(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if("pkce"===this.flowType)throw new en("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new tn("Not a valid implicit grant flow url.")}if("pkce"===e){if(this.Ht("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new en("No code detected.");const{data:e,error:r}=await this.re(t.code);if(r)throw r;const n=new URL(window.location.href);return n.searchParams.delete("code"),window.history.replaceState(window.history.state,"",n.toString()),{data:{session:e.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:s,expires_in:o,expires_at:a,token_type:l}=t;if(!(i&&o&&s&&l))throw new tn("No session defined in URL");const u=Math.round(Date.now()/1e3),c=parseInt(o);let h=u+c;a&&(h=parseInt(a));const{data:d,error:f}=await this.le(i);if(f)throw f;const v={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:c,expires_at:h,refresh_token:s,token_type:l,user:d.user};return window.location.hash="",this.Ht("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:t.type},error:null}}catch(r){if(Kr(r))return{data:{session:null,redirectType:null},error:r};throw r}}Vt(t){return!(!t.access_token&&!t.error_description)}async zt(t){const e=await _n(this.storage,this.storageKey+"-code-verifier");return!(!t.code||!e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this.qt(-1,async()=>await this.de(t))}async de({scope:t}={scope:"global"}){return await this.ie(async e=>{var r;const{data:n,error:i}=e;if(i)return{error:i};const s=null===(r=n.session)||void 0===r?void 0:r.access_token;if(s){const{error:e}=await this.admin.signOut(s,t);if(e&&(!function(t){return Kr(t)&&"AuthApiError"===t.name}(e)||404!==e.status&&401!==e.status&&403!==e.status))return{error:e}}return"others"!==t&&(await this.Xt(),await En(this.storage,this.storageKey+"-code-verifier")),{error:null}})}onAuthStateChange(t){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),r={id:e,callback:t,unsubscribe:()=>{this.Ht("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this.Ht("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,r),(async()=>{await this.initializePromise,await this.qt(-1,async()=>{this.fe(e)})})(),{data:{subscription:r}}}async fe(t){return await this.ie(async e=>{var r,n;try{const{data:{session:n},error:i}=e;if(i)throw i;await(null===(r=this.stateChangeEmitters.get(t))||void 0===r?void 0:r.callback("INITIAL_SESSION",n)),this.Ht("INITIAL_SESSION","callback id",t,"session",n)}catch(i){await(null===(n=this.stateChangeEmitters.get(t))||void 0===n?void 0:n.callback("INITIAL_SESSION",null)),this.Ht("INITIAL_SESSION","callback id",t,"error",i)}})}async resetPasswordForEmail(t,e={}){let r=null,n=null;"pkce"===this.flowType&&([r,n]=await kn(this.storage,this.storageKey,!0));try{return await Un(this.fetch,"POST",this.url+"/recover",{body:{email:t,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(i){if(Kr(i))return{data:null,error:i};throw i}}async getUserIdentities(){var t;try{const{data:e,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null}}catch(e){if(Kr(e))return{data:null,error:e};throw e}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var e;try{const{data:r,error:n}=await this.ie(async e=>{var r,n,i,s,o;const{data:a,error:l}=e;if(l)throw l;const u=await this.ve(this.url+"/user/identities/authorize",t.provider,{redirectTo:null===(r=t.options)||void 0===r?void 0:r.redirectTo,scopes:null===(n=t.options)||void 0===n?void 0:n.scopes,queryParams:null===(i=t.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:!0});return await Un(this.fetch,"GET",u,{headers:this.headers,jwt:null!==(o=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==o?o:void 0})});if(n)throw n;return wn()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:t.provider,url:null==r?void 0:r.url},error:null}}catch(r){if(Kr(r))return{data:{provider:t.provider,url:null},error:r};throw r}}async linkIdentityIdToken(t){return await this.ie(async e=>{var r;try{const{error:n,data:{session:i}}=e;if(n)throw n;const{options:s,provider:o,token:a,access_token:l,nonce:u}=t,c=await Un(this.fetch,"POST",this.url+"/token?grant_type=id_token",{headers:this.headers,jwt:null!==(r=null==i?void 0:i.access_token)&&void 0!==r?r:void 0,body:{provider:o,id_token:a,access_token:l,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:Cn}),{data:h,error:d}=c;return d?{data:{user:null,session:null},error:d}:h&&h.session&&h.user?(h.session&&(await this.Qt(h.session),await this.Gt("USER_UPDATED",h.session)),{data:h,error:d}):{data:{user:null,session:null},error:new Qr}}catch(n){if(Kr(n))return{data:{user:null,session:null},error:n};throw n}})}async unlinkIdentity(t){try{return await this.ie(async e=>{var r,n;const{data:i,error:s}=e;if(s)throw s;return await Un(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(n=null===(r=i.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0})})}catch(e){if(Kr(e))return{data:null,error:e};throw e}}async pe(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this.Ht(e,"begin");try{const i=Date.now();return await(r=async r=>(r>0&&await async function(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}(200*Math.pow(2,r-1)),this.Ht(e,"refreshing attempt",r),await Un(this.fetch,"POST",this.url+"/token?grant_type=refresh_token",{body:{refresh_token:t},headers:this.headers,xform:Cn})),n=(t,e)=>{const r=200*Math.pow(2,t);return e&&nn(e)&&Date.now()+r-i<Mr},new Promise((t,e)=>{(async()=>{for(let i=0;1/0>i;i++)try{const e=await r(i);if(!n(i,null))return void t(e)}catch(mi){if(!n(i,mi))return void e(mi)}})()}))}catch(i){if(this.Ht(e,"error",i),Kr(i))return{data:{session:null,user:null},error:i};throw i}finally{this.Ht(e,"end")}var r,n}oe(t){return"object"==typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async ee(t,e){const r=await this.ve(this.url+"/authorize",t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this.Ht("#_handleProviderSignIn()","provider",t,"options",e,"url",r),wn()&&!e.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async Zt(){var t,e;const r="#_recoverAndRefresh()";this.Ht(r,"begin");try{const i=await _n(this.storage,this.storageKey);if(i&&this.userStorage){let e=await _n(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||e||(e={user:i.user},await gn(this.userStorage,this.storageKey+"-user",e)),i.user=null!==(t=null==e?void 0:e.user)&&void 0!==t?t:In()}else if(i&&!i.user&&!i.user){const t=await _n(this.storage,this.storageKey+"-user");t&&(null==t?void 0:t.user)?(i.user=t.user,await En(this.storage,this.storageKey+"-user"),await gn(this.storage,this.storageKey,i)):i.user=In()}if(this.Ht(r,"session from storage",i),!this.oe(i))return this.Ht(r,"session is not valid"),void(null!==i&&await this.Xt());const s=9e4>1e3*(null!==(e=i.expires_at)&&void 0!==e?e:1/0)-Date.now();if(this.Ht(r,`session has${s?"":" not"} expired with margin of 90000s`),s){if(this.autoRefreshToken&&i.refresh_token){const{error:t}=await this.ae(i.refresh_token);t&&(nn(t)||(this.Ht(r,"refresh failed with a non-retryable error, removing the session",t),await this.Xt()))}}else if(i.user&&!0===i.user.we)try{const{data:t,error:e}=await this.le(i.access_token);!e&&(null==t?void 0:t.user)?(i.user=t.user,await this.Qt(i),await this.Gt("SIGNED_IN",i)):this.Ht(r,"could not get user data, skipping SIGNED_IN notification")}catch(n){this.Ht(r,"error getting user data, skipping SIGNED_IN notification",n)}else await this.Gt("SIGNED_IN",i)}catch(i){return void this.Ht(r,"error",i)}finally{this.Ht(r,"end")}}async ae(t){var e,r;if(!t)throw new Xr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${t.substring(0,5)}...)`;this.Ht(n,"begin");try{this.refreshingDeferred=new On;const{data:e,error:r}=await this.pe(t);if(r)throw r;if(!e.session)throw new Xr;await this.Qt(e.session),await this.Gt("TOKEN_REFRESHED",e.session);const n={data:e.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(i){if(this.Ht(n,"error",i),Kr(i)){const t={data:null,error:i};return nn(i)||await this.Xt(),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(i),i}finally{this.refreshingDeferred=null,this.Ht(n,"end")}}async Gt(t,e,r=!0){const n=`#_notifyAllSubscribers(${t})`;this.Ht(n,"begin",e,"broadcast = "+r);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:e});const n=[],i=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(t,e)}catch(mi){n.push(mi)}});if(await Promise.all(i),n.length>0){for(let t=0;t<n.length;t+=1);throw n[0]}}finally{this.Ht(n,"end")}}async Qt(t){this.Ht("#_saveSession()",t),this.suppressGetSessionWarning=!0;const e=Object.assign({},t),r=e.user&&!0===e.user.we;if(this.userStorage){!r&&e.user&&await gn(this.userStorage,this.storageKey+"-user",{user:e.user});const t=Object.assign({},e);delete t.user;const n=Pn(t);await gn(this.storage,this.storageKey,n)}else{const t=Pn(e);await gn(this.storage,this.storageKey,t)}}async Xt(){this.Ht("#_removeSession()"),await En(this.storage,this.storageKey),await En(this.storage,this.storageKey+"-code-verifier"),await En(this.storage,this.storageKey+"-user"),this.userStorage&&await En(this.userStorage,this.storageKey+"-user"),await this.Gt("SIGNED_OUT",null)}ye(){this.Ht("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&wn()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(mi){}}async me(){await this.be(),this.Ht("#_startAutoRefresh()");const t=setInterval(()=>this.ge(),Mr);this.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this.ge()},0)}async be(){this.Ht("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this.ye(),await this.me()}async stopAutoRefresh(){this.ye(),await this.be()}async ge(){this.Ht("#_autoRefreshTokenTick()","begin");try{await this.qt(0,async()=>{try{const t=Date.now();try{return await this.ie(async e=>{const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at)return void this.Ht("#_autoRefreshTokenTick()","no session");const n=Math.floor((1e3*r.expires_at-t)/Mr);this.Ht("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),n>3||await this.ae(r.refresh_token)})}catch(mi){}}finally{this.Ht("#_autoRefreshTokenTick()","end")}})}catch(mi){if(!(mi.isAcquireTimeout||mi instanceof qn))throw mi;this.Ht("auto refresh token tick lock not available")}}async te(){if(this.Ht("#_handleVisibilityChange()"),!wn()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._e(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._e(!0)}catch(t){}}async _e(t){const e=`#_onVisibilityChanged(${t})`;this.Ht(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this.me(),t||(await this.initializePromise,await this.qt(-1,async()=>{"visible"===document.visibilityState?await this.Zt():this.Ht(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this.be()}async ve(t,e,r){const n=["provider="+encodeURIComponent(e)];if((null==r?void 0:r.redirectTo)&&n.push("redirect_to="+encodeURIComponent(r.redirectTo)),(null==r?void 0:r.scopes)&&n.push("scopes="+encodeURIComponent(r.scopes)),"pkce"===this.flowType){const[t,e]=await kn(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:""+encodeURIComponent(t),code_challenge_method:""+encodeURIComponent(e)});n.push(r.toString())}if(null==r?void 0:r.queryParams){const t=new URLSearchParams(r.queryParams);n.push(t.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&n.push("skip_http_redirect="+r.skipBrowserRedirect),`${t}?${n.join("&")}`}async Mt(t){try{return await this.ie(async e=>{var r;const{data:n,error:i}=e;return i?{data:null,error:i}:await Un(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token})})}catch(e){if(Kr(e))return{data:null,error:e};throw e}}async Ut(t){try{return await this.ie(async e=>{var r,n;const{data:i,error:s}=e;if(s)return{data:null,error:s};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:"totp"===t.factorType?{issuer:t.issuer}:{}),{data:a,error:l}=await Un(this.fetch,"POST",this.url+"/factors",{body:o,headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:("totp"===t.factorType&&"totp"===a.type&&(null===(n=null==a?void 0:a.totp)||void 0===n?void 0:n.qr_code)&&(a.totp.qr_code="data:image/svg+xml;utf-8,"+a.totp.qr_code),{data:a,error:null})})}catch(e){if(Kr(e))return{data:null,error:e};throw e}}async Dt(t){return this.qt(-1,async()=>{try{return await this.ie(async e=>{var r;const{data:n,error:i}=e;if(i)return{data:null,error:i};const s=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:"create"===t.webauthn.type?si(t.webauthn.credential_response):oi(t.webauthn.credential_response)})}:{code:t.code}),{data:o,error:a}=await Un(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:s,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return a?{data:null,error:a}:(await this.Qt(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this.Gt("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(e){if(Kr(e))return{data:null,error:e};throw e}})}async Ct(t){return this.qt(-1,async()=>{try{return await this.ie(async e=>{var r;const{data:n,error:i}=e;if(i)return{data:null,error:i};const s=await Un(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});if(s.error)return s;const{data:o}=s;if("webauthn"!==o.type)return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:ni(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:ii(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(Kr(e))return{data:null,error:e};throw e}})}async Wt(t){const{data:e,error:r}=await this.Ct({factorId:t.factorId});return r?{data:null,error:r}:await this.Dt({factorId:t.factorId,challengeId:e.id,code:t.code})}async Rt(){var t;const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of null!==(t=null==e?void 0:e.factors)&&void 0!==t?t:[])n.all.push(i),"verified"===i.status&&n[i.factor_type].push(i);return{data:n,error:null}}async Jt(){return this.qt(-1,async()=>await this.ie(async t=>{var e,r;const{data:{session:n},error:i}=t;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=Sn(n.access_token);let o=null;s.aal&&(o=s.aal);let a=o;return(null!==(r=null===(e=n.user.factors)||void 0===e?void 0:e.filter(t=>"verified"===t.status))&&void 0!==r?r:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:s.amr||[]},error:null}}))}async fetchJwk(t,e={keys:[]}){let r=e.keys.find(e=>e.kid===t);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(e=>e.kid===t),r&&this.jwks_cached_at+6e5>n)return r;const{data:i,error:s}=await Un(this.fetch,"GET",this.url+"/.well-known/jwks.json",{headers:this.headers});if(s)throw s;return i.keys&&0!==i.keys.length?(this.jwks=i,this.jwks_cached_at=n,r=i.keys.find(e=>e.kid===t),r||null):null}async getClaims(t,e={}){try{let r=t;if(!r){const{data:t,error:e}=await this.getSession();if(e||!t.session)return{data:null,error:e};r=t.session.access_token}const{header:n,payload:i,signature:s,raw:{header:o,payload:a}}=Sn(r);(null==e?void 0:e.allowExpired)||function(t){if(!t)throw Error("Missing exp claim");if(Math.floor(Date.now()/1e3)>=t)throw Error("JWT has expired")}(i.exp);const l=n.alg&&!n.alg.startsWith("HS")&&n.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(n.kid,(null==e?void 0:e.keys)?{keys:e.keys}:null==e?void 0:e.jwks):null;if(!l){const{error:t}=await this.getUser(r);if(t)throw t;return{data:{claims:i,header:n,signature:s},error:null}}const u=function(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(n.alg),c=await crypto.subtle.importKey("jwk",l,u,!0,["verify"]);if(!(await crypto.subtle.verify(u,c,s,function(t){const e=[];return function(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&56319>=n){const e=1024*(n-55296)&65535;n=65536+(t.charCodeAt(r+1)-56320&65535|e),r+=1}fn(n,e)}}(t,t=>e.push(t)),new Uint8Array(e)}(`${o}.${a}`))))throw new on("Invalid JWT signature");return{data:{claims:i,header:n,signature:s},error:null}}catch(r){if(Kr(r))return{data:null,error:r};throw r}}}wi.nextInstanceID=0;const yi=wi;export{yi as A,Pt as B,Jt as F,Zt as H,xt as L,ut as N,Re as P,wr as R,Br as S,l as _,X as a,dt as b,ct as c,Q as d,Qt as n,o as s,V as u};
