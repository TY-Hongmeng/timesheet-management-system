import{_ as e}from"./vendor-BiPrETSv.js";import{j as t,T as s,X as m,M as n,f as r,r as o,D as a,e as i,i as l,n as u,Y as c,a2 as d,a3 as h,a4 as g,Q as p,R as N,a5 as x,a6 as y,U as v,Z as b,a7 as f,_ as w,I as D,z as k}from"./react-vendor-DJh0NlN6.js";import{u as E,i as j,s as _}from"./index-DZuSn6T7.js";import{t as V}from"./ui-components-C7XcqZ4h.js";import"./supabase-BfQEXDvU.js";const R=({isOpen:e,title:n="确认删除",message:r="您确定要删除以下工时记录吗？",employeeName:o,workDate:a,workProject:i,onConfirm:l,onCancel:u,confirmText:c="确认删除",cancelText:d="取消"})=>e?t.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:t.jsxDEV("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 border border-gray-600",children:[t.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-gray-600",children:[t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV("div",{className:"w-8 h-8 bg-red-600 rounded-full flex items-center justify-center",children:t.jsxDEV(s,{className:"w-5 h-5 text-white"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:38,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:37,columnNumber:13},void 0),t.jsxDEV("h3",{className:"text-lg font-semibold text-white",children:n},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:40,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:36,columnNumber:11},void 0),t.jsxDEV("button",{onClick:u,className:"text-gray-400 hover:text-gray-300 transition-colors",children:t.jsxDEV(m,{size:20},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:46,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:42,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:35,columnNumber:9},void 0),t.jsxDEV("div",{className:"p-4",children:[t.jsxDEV("p",{className:"text-gray-300 mb-4",children:r},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:52,columnNumber:11},void 0),(o||a||i)&&t.jsxDEV("div",{className:"bg-gray-700 rounded-lg p-3 mb-4 space-y-2",children:[o&&t.jsxDEV("div",{className:"flex justify-between",children:[t.jsxDEV("span",{className:"text-gray-400",children:"员工姓名："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:59,columnNumber:19},void 0),t.jsxDEV("span",{className:"text-white",children:o},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:60,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:58,columnNumber:17},void 0),a&&t.jsxDEV("div",{className:"flex justify-between",children:[t.jsxDEV("span",{className:"text-gray-400",children:"工作日期："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:65,columnNumber:19},void 0),t.jsxDEV("span",{className:"text-white",children:a},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:66,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:64,columnNumber:17},void 0),i&&t.jsxDEV("div",{className:"flex justify-between",children:[t.jsxDEV("span",{className:"text-gray-400",children:"工时项目："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:71,columnNumber:19},void 0),t.jsxDEV("span",{className:"text-white",children:i},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:72,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:70,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:56,columnNumber:13},void 0),t.jsxDEV("div",{className:"flex items-center gap-2 p-3 bg-red-900 bg-opacity-20 border border-red-600 rounded-lg",children:[t.jsxDEV(s,{className:"w-4 h-4 text-red-400 flex-shrink-0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:80,columnNumber:13},void 0),t.jsxDEV("span",{className:"text-red-400 text-sm",children:"删除后数据将无法恢复，请谨慎操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:81,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:79,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:51,columnNumber:9},void 0),t.jsxDEV("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-gray-600",children:[t.jsxDEV("button",{onClick:u,className:"px-4 py-2 text-gray-300 bg-gray-600 border border-gray-500 rounded-md hover:bg-gray-500 transition-colors",children:d},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:87,columnNumber:11},void 0),t.jsxDEV("button",{onClick:l,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors flex items-center gap-2",children:[t.jsxDEV(s,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:97,columnNumber:13},void 0),c]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:93,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:86,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:33,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:32,columnNumber:5},void 0):null,C=({isOpen:e,title:s="确认修改数量",message:r="您确定要修改数量吗？",currentQuantity:o,newQuantity:a,onConfirm:i,onCancel:l,confirmText:u="确认修改",cancelText:c="取消"})=>e?t.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:t.jsxDEV("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 border border-gray-600",children:[t.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-gray-600",children:[t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center",children:t.jsxDEV(n,{className:"w-5 h-5 text-white"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:36,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:35,columnNumber:13},void 0),t.jsxDEV("h3",{className:"text-lg font-semibold text-white",children:s},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:38,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:34,columnNumber:11},void 0),t.jsxDEV("button",{onClick:l,className:"text-gray-400 hover:text-gray-300 transition-colors",children:t.jsxDEV(m,{size:20},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:44,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:40,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:33,columnNumber:9},void 0),t.jsxDEV("div",{className:"p-4",children:[t.jsxDEV("p",{className:"text-gray-300 mb-4",children:r},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:50,columnNumber:11},void 0),void 0!==o&&void 0!==a&&t.jsxDEV("div",{className:"bg-gray-700 rounded-lg p-3 mb-4",children:[t.jsxDEV("div",{className:"flex justify-between items-center",children:[t.jsxDEV("span",{className:"text-gray-400",children:"当前数量："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:56,columnNumber:17},void 0),t.jsxDEV("span",{className:"text-white font-mono",children:o},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:57,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:55,columnNumber:15},void 0),t.jsxDEV("div",{className:"flex justify-between items-center mt-2",children:[t.jsxDEV("span",{className:"text-gray-400",children:"修改为："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:60,columnNumber:17},void 0),t.jsxDEV("span",{className:"text-blue-400 font-mono font-bold",children:a},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:61,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:59,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:54,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:49,columnNumber:9},void 0),t.jsxDEV("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-gray-600",children:[t.jsxDEV("button",{onClick:l,className:"px-4 py-2 text-gray-300 bg-gray-600 border border-gray-500 rounded-md hover:bg-gray-500 transition-colors",children:c},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:69,columnNumber:11},void 0),t.jsxDEV("button",{onClick:i,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors flex items-center gap-2",children:[t.jsxDEV(n,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:79,columnNumber:13},void 0),u]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:75,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:68,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:31,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:30,columnNumber:5},void 0):null,A=()=>{var s,n,A;const{user:I,loading:S}=E(),F=r(),[$,q]=o.useState([]),[P,T]=o.useState([]),[Q,M]=o.useState(!0),[z,L]=o.useState(!1),[O,B]=o.useState({totalRecords:0,totalAmount:0,pendingCount:0,approvedCount:0,rejectedCount:0,supervisorApprovedCount:0,sectionChiefApprovedCount:0}),[W,Y]=o.useState({dailyStats:[],monthlyStats:[],userStats:[],workTypeStats:{production:[],nonProduction:[],productionTotal:0,nonProductionTotal:0},duplicateRecords:[],priceIssues:[],workDayStats:[]}),[H,U]=o.useState({key:"",direction:"asc"}),[Z,G]=o.useState(new Set),[J,K]=o.useState(!0),[X,ee]=o.useState(!1),[te,se]=o.useState(null),[me,ne]=o.useState(0),[re,oe]=o.useState(!1),[ae,ie]=o.useState(!1),[le,ue]=o.useState(null),[ce,de]=o.useState(null),[he,ge]=o.useState({startDate:"",endDate:"",userId:"",status:"",productionLine:"",workType:"",productName:"",productProcess:"",yearMonth:""}),[pe,Ne]=o.useState([]),[xe,ye]=o.useState([]),[ve,be]=o.useState([]),[fe,we]=o.useState([]),[De,ke]=o.useState([]);o.useEffect(()=>{if(!S&&!I)return V.error("请先登录"),void F("/login");I&&Ee()},[I,S,F]),o.useEffect(()=>{Ce()},[$,he]);const Ee=async()=>{I&&(je(),_e())},je=async()=>{var e;try{if(M(!0),!I)return void V.error("用户信息不存在");let t;if(j(I.role)){const{data:e,error:s}=await _.from("timesheet_records").select("\n            *,\n            user_name,\n            supervisor_name,\n            section_chief_name,\n            user:user_id(id, name, company_id),\n            supervisor:supervisor_id(id, name),\n            section_chief:section_chief_id(id, name)\n          ").neq("status","draft").order("created_at",{ascending:!1});if(s)throw s;t=e}else{if(!(null==(e=I.company)?void 0:e.id))return void V.error("用户没有关联的公司，请联系管理员");const{data:s,error:m}=await _.from("users").select("id").eq("company_id",I.company.id);if(m)throw m;const n=(null==s?void 0:s.map(e=>e.id))||[];if(0===n.length)return q([]),void Ve([]);const{data:r,error:o}=await _.from("timesheet_records").select("\n            *,\n            user_name,\n            supervisor_name,\n            section_chief_name,\n            user:user_id(id, name, company_id),\n            supervisor:supervisor_id(id, name),\n            section_chief:section_chief_id(id, name)\n          ").in("user_id",n).neq("status","draft").order("created_at",{ascending:!1});if(o)throw o;t=r}const s=(null==t?void 0:t.map(e=>e.id))||[],{data:m,error:n}=await _.from("timesheet_record_items").select("\n          *,\n          processes:process_id(\n            product_process,\n            product_name,\n            production_category,\n            production_line,\n            unit_price\n          )\n        ").in("timesheet_record_id",s);if(n)throw n;const{data:r,error:o}=await _.from("approval_history").select("\n          *,\n          approver_name,\n          approver:approver_id(name)\n        ").in("timesheet_record_id",s);if(o)throw o;const a=(null==m?void 0:m.map(e=>e.id))||[],{data:i,error:l}=await _.from("timesheet_item_modification_history").select("\n          *,\n          modifier_name,\n          modifier:modifier_id(\n            name,\n            role:role_id(name)\n          )\n        ").in("timesheet_record_item_id",a).order("created_at",{ascending:!1});if(l)throw l;i&&i.length;const u=(null==t?void 0:t.map(e=>{const t=(null==m?void 0:m.filter(t=>t.timesheet_record_id===e.id).map(e=>{const t=(null==i?void 0:i.filter(t=>t.timesheet_record_item_id===e.id))||[];return{...e,modification_history:t}}))||[],s=(null==r?void 0:r.filter(t=>t.timesheet_record_id===e.id))||[],n=t.reduce((e,t)=>e+t.quantity*t.unit_price,0);return{...e,items:t,approval_history:s,total_amount:n}}))||[];q(u),Ve(u),Re(u)}catch(t){V.error("获取报表数据失败")}finally{M(!1)}},_e=async()=>{var e;try{if(!I)return void V.error("用户信息不存在");let t=_.from("users").select("id, name, company_id").eq("is_active",!0);if(!j(I.role)){if(!(null==(e=I.company)?void 0:e.id))return void V.error("用户没有关联的公司，请联系管理员");t=t.eq("company_id",I.company.id)}const{data:s}=await t.order("name");s&&Ne(s);let m=_.from("processes").select("production_line, production_category, product_name, product_process").eq("is_active",!0);j(I.role)||(m=m.eq("company_id",I.company.id));const{data:n}=await m;if(n){const e=[...new Set(n.map(e=>e.production_line).filter(Boolean))];ye(e);const t=[...new Set(n.map(e=>e.production_category).filter(Boolean))];be(t);const s=[...new Set(n.map(e=>e.product_name).filter(Boolean))];we(s);const m=[...new Set(n.map(e=>e.product_process).filter(Boolean))];ke(m)}}catch(t){}},Ve=e=>{const t=e.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.quantity*t.unit_price,0),0),s={totalRecords:e.length,totalAmount:t,pendingCount:e.filter(e=>"pending"===e.status).length,approvedCount:e.filter(e=>"approved"===e.status).length,rejectedCount:e.filter(e=>"rejected"===e.status).length,supervisorApprovedCount:e.filter(e=>e.supervisor_approved_at).length,sectionChiefApprovedCount:e.filter(e=>e.section_chief_approved_at).length};B(s),Re(e)},Re=e=>{const t=Pe(e),s=Me(e),m=Qe(e),n=ze(e),r=Le(e),o=Oe(e).filter(e=>e.records.some((t,s)=>e.records.slice(s+1).some(e=>t.work_date===e.work_date&&t.user_id===e.user_id&&t.items.some(t=>e.items.some(e=>{var s,m;return(null==(s=t.processes)?void 0:s.product_process)===(null==(m=e.processes)?void 0:m.product_process)}))))),a=Be(e);Y({dailyStats:t,monthlyStats:s,workDayStats:m,userStats:n,workTypeStats:r,duplicateRecords:o,priceIssues:a})},Ce=()=>{let e=[...$];he.startDate&&(e=e.filter(e=>e.work_date>=he.startDate)),he.endDate&&(e=e.filter(e=>e.work_date<=he.endDate)),he.userId&&(e=e.filter(e=>e.user_id===he.userId)),he.status&&(e=e.filter(e=>e.status===he.status)),he.productionLine&&(e=e.filter(e=>e.items.some(e=>{var t;return(null==(t=e.processes)?void 0:t.production_line)===he.productionLine}))),he.workType&&(e=e.filter(e=>e.items.some(e=>{var t;return(null==(t=e.processes)?void 0:t.production_category)===he.workType}))),he.productName&&(e=e.filter(e=>e.items.some(e=>{var t;return(null==(t=e.processes)?void 0:t.product_name)===he.productName}))),he.productProcess&&(e=e.filter(e=>e.items.some(e=>{var t;return(null==(t=e.processes)?void 0:t.product_process)===he.productProcess}))),he.yearMonth&&(e=e.filter(e=>{const t=new Date(e.work_date);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`===he.yearMonth})),T(e),Ve(e),Re(e)},Ae=e=>new Date(e).toLocaleDateString("zh-CN"),Ie=e=>{switch(e){case"pending":return"待班长审核";case"approved":return"待段长审核";case"section_chief_approved":return"已通过";default:return"未知"}},Se=e=>{const s=(e=>{switch(e){case"pending":return{text:"待班长审核",icon:"⚠",color:"text-yellow-400"};case"approved":return{text:"待段长审核",icon:"⚠",color:"text-blue-400"};case"section_chief_approved":return{text:"已通过",icon:"✓",color:"text-green-400"};default:return{text:"未知",icon:"⚠",color:"text-gray-400"}}})(e);return t.jsxDEV("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ${s.color}`,children:[t.jsxDEV("span",{className:"w-3 h-3 text-center",children:s.icon},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:815,columnNumber:9},void 0),s.text]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:814,columnNumber:7},void 0)},Fe=e=>{var t,s,m;return`${(null==(t=e.processes)?void 0:t.production_category)||"未知工时类型"} - ${(null==(s=e.processes)?void 0:s.product_name)||"未知产品"} - ${(null==(m=e.processes)?void 0:m.product_process)||"未知工序"}`},$e=e=>e.modification_history&&0!==e.modification_history.length?e.modification_history.map(t=>{var s;const m=new Date(t.created_at).toLocaleDateString("zh-CN");let n="未知用户";return(null==(s=t.modifier)?void 0:s.name)?n=t.modifier.name:t.modifier_name?n=t.modifier_name:e.record&&t.modifier_id?t.modifier_id===e.record.supervisor_id&&e.record.supervisor_name?n=e.record.supervisor_name:t.modifier_id===e.record.section_chief_id&&e.record.section_chief_name&&(n=e.record.section_chief_name):e.record&&!t.modifier_id&&(e.record.supervisor_name?n=e.record.supervisor_name:e.record.section_chief_name&&(n=e.record.section_chief_name)),`${n} ${m} ${t.old_quantity}→${t.new_quantity}`}).join("; "):"暂无修改记录",qe=e=>{if(!e.modification_history||0===e.modification_history.length)return t.jsxDEV("span",{className:"text-gray-400",children:"暂无修改记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:867,columnNumber:14},void 0);const s=e.modification_history.filter((e,t,s)=>t===s.findIndex(t=>t.created_at===e.created_at&&t.old_quantity===e.old_quantity&&t.new_quantity===e.new_quantity&&t.modifier_id===e.modifier_id)).map(t=>{var s;const m=new Date(t.created_at).toLocaleDateString("zh-CN");let n="未知用户";return(null==(s=t.modifier)?void 0:s.name)?n=t.modifier.name:t.modifier_name?n=t.modifier_name:e.record&&t.modifier_id?t.modifier_id===e.record.supervisor_id&&e.record.supervisor_name?n=e.record.supervisor_name:t.modifier_id===e.record.section_chief_id&&e.record.section_chief_name&&(n=e.record.section_chief_name):e.record&&!t.modifier_id&&(e.record.supervisor_name?n=e.record.supervisor_name:e.record.section_chief_name&&(n=e.record.section_chief_name)),`${n} ${m} ${t.old_quantity}→${t.new_quantity}`});return t.jsxDEV("span",{className:"text-xs text-gray-300",children:s.join("; ")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:917,columnNumber:7},void 0)},Pe=e=>{const t=new Map;return e.forEach(e=>{var s,m,n;const r=`${null==(s=e.user)?void 0:s.id}-${e.work_date}`,o=t.get(r),a=e.items.reduce((e,t)=>e+t.quantity*t.unit_price,0);o?(o.totalAmount+=a,o.recordCount+=1):t.set(r,{userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,workDate:e.work_date,totalAmount:a,recordCount:1,items:e.items})}),Array.from(t.values()).sort((e,t)=>new Date(t.workDate).getTime()-new Date(e.workDate).getTime())},Te=e=>{const t=e.getDay();if(0===t||6===t)return!1;e.getFullYear();const s=e.getMonth()+1,m=e.getDate();return!(1===s&&1===m||1===s&&m>=21&&m<=27||2===s&&m>=10&&m<=16||4===s&&(4===m||5===m)||5===s&&m>=1&&m<=3||6===s&&m>=20&&m<=22||9===s&&m>=15&&m<=17||10===s&&m>=1&&m<=7)},Qe=e=>{const t=new Map;return e.forEach(e=>{var s,m,n;const r=new Date(e.work_date),o=null==(s=e.user)?void 0:s.id,a=t.get(o),i=Te(r),l=e.items.reduce((e,t)=>e+t.quantity*t.unit_price,0);a?(a.totalAmount+=l,a.workDates.add(e.work_date),i?(a.workingAmount+=l,a.workingDates.add(e.work_date)):(a.holidayAmount+=l,a.holidayDates.add(e.work_date))):t.set(o,{userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,totalAmount:l,workingAmount:i?l:0,holidayAmount:i?0:l,workDates:new Set([e.work_date]),workingDates:new Set(i?[e.work_date]:[]),holidayDates:new Set(i?[]:[e.work_date])})}),Array.from(t.values()).map(e=>({...e,actualWorkDays:e.workingDates.size,actualWorkingDays:e.workingDates.size,actualHolidayDays:e.holidayDates.size,avgDailyAmount:e.totalAmount/e.workDates.size,avgWorkingDayAmount:e.workingDates.size>0?e.workingAmount/e.workingDates.size:0,avgHolidayDayAmount:e.holidayDates.size>0?e.holidayAmount/e.holidayDates.size:0})).sort((e,t)=>t.totalAmount-e.totalAmount)},Me=e=>{const t=new Map;return e.forEach(e=>{var s,m,n;const r=new Date(e.work_date),o=`${null==(s=e.user)?void 0:s.id}-${r.getFullYear()}-${r.getMonth()+1}`,a=t.get(o),i=Te(r),l=e.items.reduce((e,t)=>e+t.quantity*t.unit_price,0);a?(a.totalAmount+=l,a.totalDays+=1,i?(a.workDays+=1,a.workAmount+=l):(a.holidayDays+=1,a.holidayAmount+=l)):t.set(o,{userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,year:r.getFullYear(),month:r.getMonth()+1,totalDays:1,workDays:i?1:0,holidayDays:i?0:1,totalAmount:l,workAmount:i?l:0,holidayAmount:i?0:l})}),Array.from(t.values()).map(e=>({...e,avgDailyAmount:e.totalAmount/e.totalDays})).sort((e,t)=>t.year-e.year||t.month-e.month)},ze=e=>{const t=new Map;return e.forEach(e=>{var s,m,n,r;if(!e.items||0===e.items.length)return;const o=t.get(null==(s=e.user)?void 0:s.id),a=e.items.reduce((e,t)=>e+t.quantity*t.unit_price,0),i=e.items.reduce((e,t)=>e+t.quantity,0);if(o)o.totalAmount+=a,o.totalQuantity+=i,o.recordCount+=1,o.dates.add(e.work_date);else{const s={userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,totalAmount:a,totalQuantity:i,recordCount:1,dates:new Set([e.work_date])};t.set(null==(r=e.user)?void 0:r.id,s)}}),Array.from(t.values()).map(e=>({...e,workDays:e.dates.size,avgDailyAmount:e.totalAmount/e.dates.size,avgDailyQuantity:e.totalQuantity/e.dates.size})).sort((e,t)=>t.totalAmount-e.totalAmount)},Le=e=>{const t=new Map,s=new Map;e.forEach(e=>{e.items.forEach(e=>{var m;const n=(null==(m=e.processes)?void 0:m.production_category)||"未知类型",r=n.includes("生产")||n.includes("加工"),o=r?t:s,a=o.get(n),i=e.quantity*e.unit_price;a?(a.totalAmount+=i,a.quantity+=e.quantity,a.recordCount+=1):o.set(n,{category:n,totalAmount:i,quantity:e.quantity,recordCount:1,isProduction:r})})});const m=Array.from(t.values()),n=Array.from(s.values());return{production:m.sort((e,t)=>t.totalAmount-e.totalAmount),nonProduction:n.sort((e,t)=>t.totalAmount-e.totalAmount),productionTotal:m.reduce((e,t)=>e+t.totalAmount,0),nonProductionTotal:n.reduce((e,t)=>e+t.totalAmount,0)}},Oe=e=>{const t=[],s=new Map;return e.forEach(e=>{e.items.forEach(m=>{var n,r,o;const a=`${null==(n=e.user)?void 0:n.id}-${e.work_date}-${m.process_id}`,i=s.get(a);i?t.push({userId:null==(r=e.user)?void 0:r.id,userName:null==(o=e.user)?void 0:o.name,workDate:e.work_date,processId:m.process_id,processName:Fe(m),records:[i.record,e],items:[i.item,m]}):s.set(a,{record:e,item:m})})}),t},Be=e=>{const t=[];return e.forEach(e=>{e.items.forEach(s=>{var m,n,r,o;(null==s.unit_price||s.unit_price<=0)&&t.push({recordId:e.id,userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,workDate:e.work_date,processId:s.process_id,processName:Fe(s),issue:"单价为空或无效",unitPrice:s.unit_price}),s.processes||t.push({recordId:e.id,userId:null==(r=e.user)?void 0:r.id,userName:null==(o=e.user)?void 0:o.name,workDate:e.work_date,processId:s.process_id,processName:"工序信息缺失",issue:"工序引用缺失",unitPrice:s.unit_price})})}),t},We=e=>{let t="asc";H.key===e&&"asc"===H.direction&&(t="desc"),U({...H,key:e,direction:t})},Ye=()=>{let e=W.userStats.filter(e=>e.totalQuantity>0||e.totalAmount>0);return H.key?[...e].sort((e,t)=>{const s=He(e,H.key),m=He(t,H.key);return"asc"===H.direction?s>m?1:-1:s<m?1:-1}):e},He=(e,t)=>{const s=P.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId}),m=Le(s),n=W.workDayStats.find(t=>t.userId===e.userId),r=W.duplicateRecords.filter(t=>t.userId===e.userId),o=W.priceIssues.filter(t=>t.userId===e.userId);switch(t){case"userName":return e.userName;case"totalQuantity":return e.totalQuantity;case"totalAmount":return e.totalAmount;case"workDays":return e.workDays;case"avgDailyQuantity":return e.avgDailyQuantity;case"workingDays":return(null==n?void 0:n.actualWorkingDays)||0;case"holidayDays":return(null==n?void 0:n.actualHolidayDays)||0;case"workingAmount":return(null==n?void 0:n.workingAmount)||0;case"holidayAmount":return(null==n?void 0:n.holidayAmount)||0;case"avgDailyAmount":return e.avgDailyAmount;case"productionTotal":return m.productionTotal||0;case"nonProductionTotal":return m.nonProductionTotal||0;case"duplicateCount":return r.length;case"priceIssueCount":return o.length;case"totalIssues":return r.length+o.length;default:return 0}},Ue=(e,t)=>{var s,m;const n=null==(s=e.approval_history)?void 0:s.find(e=>e.approver_type===t);return n?{name:(null==(m=n.approver)?void 0:m.name)||"未知",date:Ae(n.created_at)}:null};return Q?t.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:t.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1343,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1342,columnNumber:7},void 0):t.jsxDEV("div",{className:"min-h-screen bg-black text-green-300",children:[t.jsxDEV("header",{className:"bg-gray-900 border-b border-green-400 px-2 sm:px-4 lg:px-6 py-4",children:t.jsxDEV("div",{className:"w-full",children:t.jsxDEV("div",{className:"flex items-center justify-between",children:[t.jsxDEV("h1",{className:"text-2xl font-bold text-green-400 font-mono flex items-center gap-2",children:[t.jsxDEV(a,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1357,columnNumber:15},void 0),"查看报表"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1356,columnNumber:13},void 0),t.jsxDEV("div",{className:"flex items-center gap-3",children:[t.jsxDEV("button",{onClick:async()=>{try{L(!0),await Promise.all([je(),_e()]),V.success("数据刷新成功")}catch(e){V.error("刷新数据失败")}finally{L(!1)}},disabled:z,className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 disabled:from-gray-700 disabled:to-gray-800 text-green-300 hover:text-green-200 disabled:text-gray-400 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 disabled:border-gray-600",children:[t.jsxDEV(i,{className:"w-4 h-4 "+(z?"animate-spin":"")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1366,columnNumber:17},void 0),t.jsxDEV("span",{className:"hidden sm:inline",children:z?"刷新中...":"刷新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1367,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1361,columnNumber:15},void 0),t.jsxDEV(l,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[t.jsxDEV(u,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1374,columnNumber:17},void 0),t.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1375,columnNumber:17},void 0),t.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1376,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1370,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1360,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1355,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1354,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1353,columnNumber:7},void 0),t.jsxDEV("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-6",children:[t.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-4 mb-6",children:[t.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV(c,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1390,columnNumber:15},void 0),t.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono",children:"数据筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1391,columnNumber:15},void 0),t.jsxDEV("button",{onClick:()=>ee(!X),className:"p-1 text-green-400 hover:text-green-300 transition-colors duration-200",children:X?t.jsxDEV(d,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1397,columnNumber:19},void 0):t.jsxDEV(h,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1399,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1392,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1389,columnNumber:13},void 0),t.jsxDEV("button",{onClick:()=>{ge({startDate:"",endDate:"",userId:"",status:"",productionLine:"",workType:"",productName:"",productProcess:"",yearMonth:""})},className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 text-green-300 border border-green-400 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 font-mono text-sm",children:[t.jsxDEV(i,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1407,columnNumber:15},void 0),t.jsxDEV("span",{className:"hidden sm:inline",children:"重置筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1408,columnNumber:15},void 0),t.jsxDEV("span",{className:"sm:hidden",children:"重置"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1409,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1403,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1388,columnNumber:11},void 0),!X&&t.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:[t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1416,columnNumber:15},void 0),t.jsxDEV("input",{type:"month",value:he.yearMonth,onChange:e=>ge({...he,yearMonth:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1419,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1415,columnNumber:13},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"开始日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1428,columnNumber:15},void 0),t.jsxDEV("input",{type:"date",value:he.startDate,onChange:e=>ge({...he,startDate:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1431,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1427,columnNumber:13},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"结束日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1440,columnNumber:15},void 0),t.jsxDEV("input",{type:"date",value:he.endDate,onChange:e=>ge({...he,endDate:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1443,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1439,columnNumber:13},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1452,columnNumber:15},void 0),t.jsxDEV("select",{value:he.userId,onChange:e=>ge({...he,userId:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[t.jsxDEV("option",{value:"",children:"全部员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1460,columnNumber:17},void 0),pe.map(e=>t.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1462,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1455,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1451,columnNumber:13},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"状态"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1468,columnNumber:15},void 0),t.jsxDEV("select",{value:he.status,onChange:e=>ge({...he,status:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[t.jsxDEV("option",{value:"",children:"全部状态"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1476,columnNumber:17},void 0),t.jsxDEV("option",{value:"pending",children:"待班长审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1477,columnNumber:17},void 0),t.jsxDEV("option",{value:"approved",children:"待段长审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1478,columnNumber:17},void 0),t.jsxDEV("option",{value:"section_chief_approved",children:"已通过"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1479,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1471,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1467,columnNumber:13},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1484,columnNumber:15},void 0),t.jsxDEV("select",{value:he.productionLine,onChange:e=>ge({...he,productionLine:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[t.jsxDEV("option",{value:"",children:"全部生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1492,columnNumber:17},void 0),xe.map(e=>t.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1494,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1487,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1483,columnNumber:13},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1500,columnNumber:15},void 0),t.jsxDEV("select",{value:he.workType,onChange:e=>ge({...he,workType:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[t.jsxDEV("option",{value:"",children:"全部工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1508,columnNumber:17},void 0),ve.map(e=>t.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1510,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1503,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1499,columnNumber:13},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1516,columnNumber:15},void 0),t.jsxDEV("select",{value:he.productName,onChange:e=>ge({...he,productName:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[t.jsxDEV("option",{value:"",children:"全部产品"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1524,columnNumber:17},void 0),fe.map(e=>t.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1526,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1519,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1515,columnNumber:13},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1532,columnNumber:15},void 0),t.jsxDEV("select",{value:he.productProcess,onChange:e=>ge({...he,productProcess:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[t.jsxDEV("option",{value:"",children:"全部工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1540,columnNumber:17},void 0),De.map(e=>t.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1542,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1535,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1531,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1414,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1387,columnNumber:9},void 0),t.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg overflow-hidden",children:[t.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg overflow-hidden",children:[t.jsxDEV("div",{className:"bg-gray-800 border-b border-green-600 p-4",children:t.jsxDEV("div",{className:"flex items-center justify-between",children:[t.jsxDEV("h3",{className:"text-lg font-bold text-green-400 font-mono flex items-center gap-2",children:[t.jsxDEV(g,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1559,columnNumber:19},void 0),"统计分析"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1558,columnNumber:17},void 0),t.jsxDEV("div",{className:"flex items-center gap-4",children:t.jsxDEV("button",{onClick:async()=>{const t=await e(()=>import("./excel-ChPHbVhZ.js"),[]),s=Ye().map(e=>{var t,s;const m=P.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId}),n=Le(m),r=W.workDayStats.find(t=>t.userId===e.userId),o=W.duplicateRecords.filter(t=>t.userId===e.userId),a=W.priceIssues.filter(t=>t.userId===e.userId);return{"姓名":e.userName,"总额":e.totalAmount.toFixed(2),"天数":(null==r?void 0:r.actualWorkDays)||e.workDays,"日平均":e.avgDailyAmount.toFixed(2),"生产工时金额":(null==(t=n.productionTotal)?void 0:t.toFixed(2))||"0.00","非生产工时金额":(null==(s=n.nonProductionTotal)?void 0:s.toFixed(2))||"0.00","重复记录数":o.length,"单价问题数":a.length,"异常总数":o.length+a.length}}),m=P.flatMap(e=>e.items.map(t=>{var s,m,n,r,o,a,i;const l=Ue(e,"supervisor"),u=Ue(e,"section_chief");return{"工作日期":Ae(e.work_date),"员工姓名":(null==(s=e.user)?void 0:s.name)||"未知","班次":e.shift_type||"白班","生产线":(null==(m=t.processes)?void 0:m.production_line)||"未知","生产类别":(null==(n=t.processes)?void 0:n.production_category)||"未知","产品名称":(null==(r=t.processes)?void 0:r.product_name)||"未知","工序名称":(null==(o=t.processes)?void 0:o.product_process)||"未知","数量":t.quantity,"单价":null!=t.unit_price&&t.unit_price>0?t.unit_price.toFixed(2):"未定义","金额":t.amount.toFixed(2),"状态":Ie(e.status),"班长":l?l.name:(null==(a=e.supervisor)?void 0:a.name)||"未分配","段长":u?u.name:(null==(i=e.section_chief)?void 0:i.name)||"未分配","修改历史":$e({...t,record:e}),"创建时间":(c=e.created_at,new Date(c).toLocaleString("zh-CN"))};var c})),n=(()=>{const e=new Map;return P.forEach(t=>{t.items.forEach(t=>{var s,m,n,r,o,a,i,l;const u=`${(null==(s=t.processes)?void 0:s.production_line)||"未知"}-${(null==(m=t.processes)?void 0:m.production_category)||"未知"}-${(null==(n=t.processes)?void 0:n.product_name)||"未知"}-${(null==(r=t.processes)?void 0:r.product_process)||"未知"}`;e.has(u)||e.set(u,{productionLine:(null==(o=t.processes)?void 0:o.production_line)||"未知",productionCategory:(null==(a=t.processes)?void 0:a.production_category)||"未知",productName:(null==(i=t.processes)?void 0:i.product_name)||"未知",productProcess:(null==(l=t.processes)?void 0:l.product_process)||"未知",totalQuantity:0,totalAmount:0});const c=e.get(u);c.totalQuantity+=t.quantity,c.totalAmount+=t.amount})}),Array.from(e.values()).sort((e,t)=>e.productionCategory!==t.productionCategory?e.productionCategory.localeCompare(t.productionCategory):t.totalAmount-e.totalAmount).map(e=>({"生产线":e.productionLine,"生产类别":e.productionCategory,"产品名称":e.productName,"工序名称":e.productProcess,"总数量":e.totalQuantity.toFixed(1),"总金额":e.totalAmount.toFixed(2)}))})(),r=[];Ye().forEach(e=>{const t=P.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId}).flatMap(e=>e.items.map(t=>({...t,workDate:e.work_date}))),s=new Map;t.forEach(e=>{var t,m,n,r,o,a,i,l;const u=`${(null==(t=e.processes)?void 0:t.production_category)||"未知"}-${(null==(m=e.processes)?void 0:m.production_line)||"未知"}-${(null==(n=e.processes)?void 0:n.product_name)||"未知"}-${(null==(r=e.processes)?void 0:r.product_process)||"未知"}`;s.has(u)||s.set(u,{productionCategory:(null==(o=e.processes)?void 0:o.production_category)||"未知",productionLine:(null==(a=e.processes)?void 0:a.production_line)||"未知",productName:(null==(i=e.processes)?void 0:i.product_name)||"未知",productProcess:(null==(l=e.processes)?void 0:l.product_process)||"未知",totalQuantity:0,recordCount:0});const c=s.get(u);c.totalQuantity+=e.quantity,c.recordCount+=1}),Array.from(s.values()).forEach(t=>{r.push({"员工姓名":e.userName,"生产类别":t.productionCategory,"生产线":t.productionLine,"产品名称":t.productName,"工序名称":t.productProcess,"数量总计":t.totalQuantity.toFixed(1),"记录条数":t.recordCount})})});const o=t.utils.book_new(),a=t.utils.json_to_sheet(s);a["!cols"]=[{wch:12},{wch:10},{wch:8},{wch:10},{wch:15},{wch:15},{wch:12},{wch:12},{wch:10}];const i=t.utils.decode_range(a["!ref"]||"A1");for(let e=i.s.c;e<=i.e.c;e++){const s=t.utils.encode_cell({r:0,c:e});a[s]&&(a[s].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"4A5568"}},alignment:{horizontal:"center"}})}t.utils.book_append_sheet(o,a,"工时统计分析");const l=t.utils.json_to_sheet(n);l["!cols"]=[{wch:12},{wch:12},{wch:15},{wch:15},{wch:10},{wch:12}];const u=t.utils.decode_range(l["!ref"]||"A1");for(let e=u.s.c;e<=u.e.c;e++){const s=t.utils.encode_cell({r:0,c:e});l[s]&&(l[s].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2B6CB0"}},alignment:{horizontal:"center"}})}l["!autofilter"]={ref:l["!ref"]},t.utils.book_append_sheet(o,l,"工时统计分析汇总");const c=t.utils.json_to_sheet(m);c["!cols"]=[{wch:12},{wch:12},{wch:8},{wch:10},{wch:12},{wch:15},{wch:15},{wch:8},{wch:10},{wch:10},{wch:12},{wch:15},{wch:15},{wch:20},{wch:18}];const d=t.utils.decode_range(c["!ref"]||"A1");for(let e=d.s.c;e<=d.e.c;e++){const s=t.utils.encode_cell({r:0,c:e});c[s]&&(c[s].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2D3748"}},alignment:{horizontal:"center"}})}c["!autofilter"]={ref:c["!ref"]},t.utils.book_append_sheet(o,c,"详细工时记录");const h=t.utils.json_to_sheet(r);h["!cols"]=[{wch:12},{wch:12},{wch:10},{wch:15},{wch:15},{wch:10},{wch:10}];const g=t.utils.decode_range(h["!ref"]||"A1");for(let e=g.s.c;e<=g.e.c;e++){const s=t.utils.encode_cell({r:0,c:e});h[s]&&(h[s].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"1A202C"}},alignment:{horizontal:"center"}})}h["!autofilter"]={ref:h["!ref"]},t.utils.book_append_sheet(o,h,"数量统计汇总");const p=`工时报告_${(new Date).toISOString().split("T")[0]}.xlsx`;t.writeFile(o,p),V.success("报告导出成功！")},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded transition-colors font-mono text-sm",children:[t.jsxDEV(p,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1849,columnNumber:21},void 0),"导出报告"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1565,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1562,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1557,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1556,columnNumber:13},void 0),t.jsxDEV("div",{className:"overflow-x-auto",children:t.jsxDEV("table",{className:"w-full",children:[t.jsxDEV("thead",{className:"bg-gray-800 border-b border-green-600",children:t.jsxDEV("tr",{children:[t.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:t.jsxDEV("button",{onClick:()=>We("userName"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"员工姓名"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1862,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1861,columnNumber:21},void 0),t.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:t.jsxDEV("button",{onClick:()=>We("totalAmount"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"总额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1871,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1870,columnNumber:21},void 0),t.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:t.jsxDEV("button",{onClick:()=>We("workDays"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"天数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1879,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1878,columnNumber:21},void 0),t.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:t.jsxDEV("button",{onClick:()=>We("avgDailyAmount"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"日平均"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1889,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1888,columnNumber:21},void 0),t.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:t.jsxDEV("button",{onClick:()=>We("productionTotal"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"生产工时金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1897,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1896,columnNumber:21},void 0),t.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:t.jsxDEV("button",{onClick:()=>We("nonProductionTotal"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"非生产工时金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1905,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1904,columnNumber:21},void 0),t.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:t.jsxDEV("button",{onClick:()=>We("duplicateCount"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:["重复记录(",W.duplicateRecords.length,")"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1913,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1912,columnNumber:21},void 0),t.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:t.jsxDEV("button",{onClick:()=>We("priceIssueCount"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:["单价问题(",W.priceIssues.length,")"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1921,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1920,columnNumber:21},void 0),t.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:"操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1928,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1860,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1859,columnNumber:17},void 0),t.jsxDEV("tbody",{children:Ye().map((e,s)=>{var n,r;W.dailyStats.filter(t=>t.userId===e.userId),W.monthlyStats.filter(t=>t.userId===e.userId),W.workDayStats.find(t=>t.userId===e.userId);const o=W.duplicateRecords.filter(t=>t.userId===e.userId),i=W.priceIssues.filter(t=>t.userId===e.userId),l=P.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId}),u=Le(l),c=o.length>0||i.length>0;return t.jsxDEV(N.Fragment,{children:[t.jsxDEV("tr",{className:"border-b transition-colors "+(c?"border-red-500 bg-red-900 bg-opacity-20 hover:bg-red-900 hover:bg-opacity-30":"border-gray-700 hover:bg-gray-800"),children:[t.jsxDEV("td",{className:"px-4 py-3 text-green-300 font-mono text-sm font-medium",children:e.userName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1956,columnNumber:27},void 0),t.jsxDEV("td",{className:"px-4 py-3 text-green-300 font-mono text-sm font-bold",children:["¥",e.totalAmount.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1960,columnNumber:27},void 0),t.jsxDEV("td",{className:"px-4 py-3 text-green-300 font-mono text-sm",children:e.workDays},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1963,columnNumber:27},void 0),t.jsxDEV("td",{className:"px-4 py-3 text-purple-300 font-mono text-sm",children:["¥",e.avgDailyAmount.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1968,columnNumber:27},void 0),t.jsxDEV("td",{className:"px-4 py-3 text-blue-300 font-mono text-sm",children:["¥",(null==(n=u.productionTotal)?void 0:n.toFixed(2))||"0.00"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1971,columnNumber:27},void 0),t.jsxDEV("td",{className:"px-4 py-3 text-red-300 font-mono text-sm",children:["¥",(null==(r=u.nonProductionTotal)?void 0:r.toFixed(2))||"0.00"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1974,columnNumber:27},void 0),t.jsxDEV("td",{className:"px-4 py-3 font-mono text-sm",children:o.length>0?t.jsxDEV("span",{className:"text-yellow-400 font-bold",children:o.length},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1979,columnNumber:31},void 0):t.jsxDEV("span",{className:"text-green-400",children:"0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1981,columnNumber:31},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1977,columnNumber:27},void 0),t.jsxDEV("td",{className:"px-4 py-3 font-mono text-sm",children:i.length>0?t.jsxDEV("span",{className:"text-red-400 font-bold",children:i.length},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1986,columnNumber:31},void 0):t.jsxDEV("span",{className:"text-green-400",children:"0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1988,columnNumber:31},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1984,columnNumber:27},void 0),t.jsxDEV("td",{className:"px-4 py-3",children:t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV("button",{onClick:()=>{const t=new Set(Z);Z.has(e.userId)?t.delete(e.userId):t.add(e.userId),G(t)},className:"text-blue-400 hover:text-blue-300 transition-colors",title:Z.has(e.userId)?"收起详细记录":"展开详细记录",children:Z.has(e.userId)?t.jsxDEV(x,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2007,columnNumber:35},void 0):t.jsxDEV(y,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2009,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1993,columnNumber:31},void 0),c&&t.jsxDEV("span",{className:"text-red-400",title:"存在异常数据",children:"⚠"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2013,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1992,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1991,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1949,columnNumber:25},void 0),Z.has(e.userId)&&(()=>{const s=P.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId});return 0===s.length||s.every(e=>0===e.items.length)?null:t.jsxDEV("tr",{className:"bg-gray-800 border-b border-gray-600",children:t.jsxDEV("td",{colSpan:11,className:"px-4 py-4",children:t.jsxDEV("div",{className:"bg-gray-700 rounded-lg p-4",children:[t.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:t.jsxDEV("h4",{className:"text-lg font-bold text-green-400 font-mono flex items-center gap-2",children:[t.jsxDEV(v,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2035,columnNumber:37},void 0),e.userName," - 详细工时记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2034,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2033,columnNumber:33},void 0),t.jsxDEV("div",{className:"bg-gray-600 rounded-lg overflow-hidden",children:t.jsxDEV("div",{className:"overflow-x-auto",children:t.jsxDEV("table",{className:"w-full",children:[t.jsxDEV("thead",{className:"bg-gray-700",children:t.jsxDEV("tr",{children:[t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"工作日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2046,columnNumber:43},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"班次"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2047,columnNumber:43},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"日工时金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2048,columnNumber:43},void 0),J&&t.jsxDEV(t.Fragment,{children:[t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2051,columnNumber:47},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产类别"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2052,columnNumber:47},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2053,columnNumber:47},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"工序名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2054,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2050,columnNumber:45},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2057,columnNumber:43},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2058,columnNumber:43},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2059,columnNumber:43},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"状态"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2060,columnNumber:43},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"班长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2061,columnNumber:43},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"段长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2062,columnNumber:43},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"修改历史"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2063,columnNumber:43},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2064,columnNumber:43},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2045,columnNumber:41},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2044,columnNumber:39},void 0),t.jsxDEV("tbody",{children:(()=>{const e=s.reduce((e,t)=>{const s=t.work_date;return e[s]||(e[s]=[]),e[s].push(t),e},{});return Object.keys(e).sort((e,t)=>new Date(t).getTime()-new Date(e).getTime()).flatMap(s=>{const n=e[s],r=n.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.amount,0),0),a=n.flatMap(e=>e.items.map(t=>({...t,record:e})));return a.map((e,n)=>{var l,u,c,d,h;const g=o.some(t=>t.workDate===e.record.work_date&&t.processId===e.process_id),p=i.some(t=>t.workDate===e.record.work_date&&t.processId===e.process_id),N=g||p;return t.jsxDEV("tr",{className:"border-b border-gray-600 hover:bg-gray-600 transition-colors "+(N?"bg-red-900 bg-opacity-20":""),children:[0===n?t.jsxDEV(t.Fragment,{children:[t.jsxDEV("td",{className:"px-3 py-2 text-yellow-400 font-mono text-xs font-bold border-r border-gray-500",rowSpan:a.length,children:t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV(b,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2122,columnNumber:57},void 0),Ae(s)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2121,columnNumber:55},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2117,columnNumber:53},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-400 font-mono text-xs border-r border-gray-500",rowSpan:a.length,children:e.record.shift_type||"白班"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2126,columnNumber:53},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-400 font-mono text-xs font-bold border-r border-gray-500",rowSpan:a.length,children:["¥",r.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2132,columnNumber:53},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2116,columnNumber:51},void 0):null,J&&t.jsxDEV(t.Fragment,{children:[t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(null==(l=e.processes)?void 0:l.production_line)||"未知"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2144,columnNumber:53},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:t.jsxDEV("span",{className:"px-2 py-1 rounded text-xs font-bold "+("生产工时"===(null==(u=e.processes)?void 0:u.production_category)?"bg-blue-900 text-blue-300":"bg-red-900 text-red-300"),children:(null==(c=e.processes)?void 0:c.production_category)||"未知"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2148,columnNumber:55},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2147,columnNumber:53},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(null==(d=e.processes)?void 0:d.product_name)||"未知"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2156,columnNumber:53},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(null==(h=e.processes)?void 0:h.product_process)||"未知"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2159,columnNumber:53},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2143,columnNumber:51},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs font-bold",children:(null==te?void 0:te.recordId)===e.record.id&&(null==te?void 0:te.itemId)===e.id?t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV("input",{type:"number",value:me,onChange:e=>{e.stopPropagation(),ne(Number(e.target.value))},onClick:e=>e.stopPropagation(),onWheel:e=>e.preventDefault(),className:"w-16 px-2 py-1 bg-gray-700 border border-gray-600 rounded text-green-300 font-mono text-xs [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",min:"0",step:"0.1"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2167,columnNumber:55},void 0),t.jsxDEV("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),(()=>{if(!te)return void V.error("请先选择要编辑的项目");if(me<0)return void V.error("数量不能为负数");const e={recordId:te.recordId,itemId:te.itemId,newQuantity:me};ue(e),oe(!0)})()},className:"p-1 text-green-400 hover:text-green-300 transition-colors",title:"确认修改",children:t.jsxDEV(f,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2189,columnNumber:57},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2180,columnNumber:55},void 0),t.jsxDEV("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),se(null),ne(0)},className:"p-1 text-red-400 hover:text-red-300 transition-colors",title:"取消修改",children:t.jsxDEV(m,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2200,columnNumber:57},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2191,columnNumber:55},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2166,columnNumber:53},void 0):t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV("span",{children:e.quantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2205,columnNumber:55},void 0),t.jsxDEV("button",{onClick:t=>{var s,m,n;t.preventDefault(),t.stopPropagation(),s=e.record.id,m=e.id,n=e.quantity,se({recordId:s,itemId:m}),ne(n)},className:"p-1 text-blue-400 hover:text-blue-300 transition-colors",title:"编辑数量",children:t.jsxDEV(w,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2215,columnNumber:57},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2206,columnNumber:55},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2204,columnNumber:53},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2164,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:[null!=e.unit_price&&e.unit_price>0?`¥${e.unit_price.toFixed(2)}`:"未定义",p&&t.jsxDEV("span",{className:"ml-1 text-red-400",title:"单价异常",children:"⚠"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2223,columnNumber:53},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2220,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs font-bold",children:["¥",e.amount.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2228,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:t.jsxDEV("div",{className:"flex items-center gap-1",children:[Se(e.record.status),g&&t.jsxDEV("span",{className:"text-yellow-400",title:"重复记录",children:"⚠"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2235,columnNumber:55},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2232,columnNumber:51},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2231,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(()=>{var s;const m=Ue(e.record,"supervisor"),n=(null==(s=e.record.supervisor)?void 0:s.name)||"未分配";return m?t.jsxDEV("div",{className:"flex flex-col",children:[t.jsxDEV("div",{children:m.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2248,columnNumber:59},void 0),t.jsxDEV("div",{className:"text-xs text-gray-400",children:m.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2249,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2247,columnNumber:57},void 0):n})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2241,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(()=>{var s;const m=Ue(e.record,"section_chief"),n=(null==(s=e.record.section_chief)?void 0:s.name)||"未分配";return m?t.jsxDEV("div",{className:"flex flex-col",children:[t.jsxDEV("div",{children:m.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2263,columnNumber:59},void 0),t.jsxDEV("div",{className:"text-xs text-gray-400",children:m.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2264,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2262,columnNumber:57},void 0):n})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2256,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:qe(e)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2271,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:t.jsxDEV("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),((e,t)=>{var s,m;const n=$.find(t=>t.id===e),r=null==(s=null==n?void 0:n.items)?void 0:s.find(e=>e.id===t),o=(null==(m=null==n?void 0:n.user)?void 0:m.name)||"未知员工",a=(null==n?void 0:n.work_date)?Ae(n.work_date):"未知日期",i=r?Fe(r):"未知项目";de({recordId:e,itemId:t,employeeName:o,workDate:a,workProject:i}),ie(!0)})(e.record.id,e.id)},className:"p-1 text-red-400 hover:text-red-300 transition-colors",title:"删除工时项目",children:t.jsxDEV(D,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2284,columnNumber:53},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2275,columnNumber:51},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2274,columnNumber:49},void 0)]},`${s}-${e.record.id}-${n}`,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2108,columnNumber:47},void 0)})})})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2067,columnNumber:39},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2043,columnNumber:37},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2042,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2041,columnNumber:33},void 0),t.jsxDEV("div",{className:"mt-6 bg-gray-600 rounded-lg p-4",children:[t.jsxDEV("h5",{className:"text-md font-bold text-green-400 font-mono mb-4 flex items-center gap-2",children:[t.jsxDEV(a,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2300,columnNumber:37},void 0),e.userName," - 数量统计汇总"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2299,columnNumber:35},void 0),(()=>{const e=s.flatMap(e=>e.items.map(t=>({...t,workDate:e.work_date}))),m=new Map;e.forEach(e=>{var t,s,n,r,o,a,i,l;const u=`${(null==(t=e.processes)?void 0:t.production_category)||"未知"}-${(null==(s=e.processes)?void 0:s.production_line)||"未知"}-${(null==(n=e.processes)?void 0:n.product_name)||"未知"}-${(null==(r=e.processes)?void 0:r.product_process)||"未知"}`;m.has(u)||m.set(u,{productionCategory:(null==(o=e.processes)?void 0:o.production_category)||"未知",productionLine:(null==(a=e.processes)?void 0:a.production_line)||"未知",productName:(null==(i=e.processes)?void 0:i.product_name)||"未知",productProcess:(null==(l=e.processes)?void 0:l.product_process)||"未知",totalQuantity:0,recordCount:0});const c=m.get(u);c.totalQuantity+=e.quantity,c.recordCount+=1});const n=Array.from(m.values()).sort((e,t)=>e.productionCategory!==t.productionCategory?e.productionCategory.localeCompare(t.productionCategory):t.totalQuantity-e.totalQuantity);return 0===n.length?t.jsxDEV("div",{className:"text-center py-4 text-gray-400 font-mono text-sm",children:"暂无统计数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2345,columnNumber:41},void 0):t.jsxDEV("div",{className:"overflow-x-auto",children:t.jsxDEV("table",{className:"w-full",children:[t.jsxDEV("thead",{className:"bg-gray-700",children:t.jsxDEV("tr",{children:[t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产类别"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2356,columnNumber:47},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2357,columnNumber:47},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2358,columnNumber:47},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"工序名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2359,columnNumber:47},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"数量总计"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2360,columnNumber:47},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"记录条数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2361,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2355,columnNumber:45},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2354,columnNumber:43},void 0),t.jsxDEV("tbody",{children:n.map((e,s)=>t.jsxDEV("tr",{className:"border-b border-gray-600 hover:bg-gray-600 transition-colors",children:[t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:t.jsxDEV("span",{className:"px-2 py-1 rounded text-xs font-bold "+("生产工时"===e.productionCategory?"bg-blue-900 text-blue-300":"bg-red-900 text-red-300"),children:e.productionCategory},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2368,columnNumber:51},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2367,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productionLine},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2376,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2379,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productProcess},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2382,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-yellow-400 font-mono text-xs font-bold",children:e.totalQuantity.toFixed(1)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2385,columnNumber:49},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-blue-400 font-mono text-xs",children:e.recordCount},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2388,columnNumber:49},void 0)]},s,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2366,columnNumber:47},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2364,columnNumber:43},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2353,columnNumber:41},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2352,columnNumber:39},void 0)})()]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2298,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2032,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2031,columnNumber:31},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2030,columnNumber:29},void 0)})()]},s,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1948,columnNumber:23},void 0)})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1931,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1858,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1857,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1554,columnNumber:11},void 0),W.userStats.length>0&&t.jsxDEV("div",{className:"mt-6 bg-gray-900 rounded-lg border border-green-400 overflow-hidden",children:[t.jsxDEV("div",{className:"bg-gray-800 px-4 py-3 border-b border-gray-600",children:t.jsxDEV("h3",{className:"text-lg font-bold text-green-400 font-mono flex items-center gap-2",children:[t.jsxDEV(a,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2420,columnNumber:19},void 0),"汇总分析"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2419,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2418,columnNumber:15},void 0),t.jsxDEV("div",{className:"p-4",children:(()=>{const e=new Map;P.forEach(t=>{t.items.forEach(t=>{var s,m,n,r,o,a,i,l;const u=`${(null==(s=t.processes)?void 0:s.production_line)||"未知"}-${(null==(m=t.processes)?void 0:m.production_category)||"未知"}-${(null==(n=t.processes)?void 0:n.product_name)||"未知"}-${(null==(r=t.processes)?void 0:r.product_process)||"未知"}`;e.has(u)||e.set(u,{productionLine:(null==(o=t.processes)?void 0:o.production_line)||"未知",productionCategory:(null==(a=t.processes)?void 0:a.production_category)||"未知",productName:(null==(i=t.processes)?void 0:i.product_name)||"未知",productProcess:(null==(l=t.processes)?void 0:l.product_process)||"未知",totalQuantity:0,totalAmount:0});const c=e.get(u);c.totalQuantity+=t.quantity,c.totalAmount+=t.amount})});const s=Array.from(e.values()).sort((e,t)=>e.productionCategory!==t.productionCategory?e.productionCategory.localeCompare(t.productionCategory):t.totalAmount-e.totalAmount);return 0===s.length?t.jsxDEV("div",{className:"text-center py-4 text-gray-400 font-mono text-sm",children:"暂无汇总数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2461,columnNumber:23},void 0):t.jsxDEV("div",{className:"overflow-x-auto",children:t.jsxDEV("table",{className:"w-full",children:[t.jsxDEV("thead",{className:"bg-gray-700",children:t.jsxDEV("tr",{children:[t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2472,columnNumber:29},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产类别"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2473,columnNumber:29},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2474,columnNumber:29},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"工序名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2475,columnNumber:29},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"总数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2476,columnNumber:29},void 0),t.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"总金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2477,columnNumber:29},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2471,columnNumber:27},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2470,columnNumber:25},void 0),t.jsxDEV("tbody",{children:s.map((e,s)=>t.jsxDEV("tr",{className:"border-b border-gray-600 hover:bg-gray-600 transition-colors",children:[t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productionLine},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2483,columnNumber:31},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:t.jsxDEV("span",{className:"px-2 py-1 rounded text-xs font-bold "+("生产工时"===e.productionCategory?"bg-blue-900 text-blue-300":"bg-red-900 text-red-300"),children:e.productionCategory},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2487,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2486,columnNumber:31},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2495,columnNumber:31},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productProcess},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2498,columnNumber:31},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-yellow-400 font-mono text-xs font-bold",children:e.totalQuantity.toFixed(1)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2501,columnNumber:31},void 0),t.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs font-bold",children:["¥",e.totalAmount.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2504,columnNumber:31},void 0)]},s,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2482,columnNumber:29},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2480,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2469,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2468,columnNumber:21},void 0)})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2425,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2417,columnNumber:13},void 0),0===W.userStats.length&&t.jsxDEV("div",{className:"text-center py-12",children:[t.jsxDEV("div",{className:"text-blue-600 mb-4",children:t.jsxDEV(k,{className:"h-16 w-16 mx-auto"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2522,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2521,columnNumber:15},void 0),t.jsxDEV("h3",{className:"text-lg font-medium text-blue-400 mb-2 font-mono",children:"暂无统计数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2524,columnNumber:15},void 0),t.jsxDEV("p",{className:"text-blue-600 font-mono",children:"请调整筛选条件或刷新数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2525,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2520,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1552,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1383,columnNumber:7},void 0),t.jsxDEV(C,{isOpen:re,currentQuantity:te?null==(A=null==(n=null==(s=$.find(e=>e.id===te.recordId))?void 0:s.items)?void 0:n.find(e=>e.id===te.itemId))?void 0:A.quantity:void 0,newQuantity:null==le?void 0:le.newQuantity,onConfirm:async()=>{if(le)try{const e=$.find(e=>e.id===le.recordId),t=null==e?void 0:e.items.find(e=>e.id===le.itemId),s=(null==t?void 0:t.unit_price)||0,m=le.newQuantity*s,{error:n}=(null==t||t.quantity,null==t||t.amount,await _.rpc("update_timesheet_item_with_user",{item_id:le.itemId,new_quantity:le.newQuantity,new_amount:m,modifier_id:(null==I?void 0:I.id)||null,modifier_name:(null==I?void 0:I.name)||"未知用户"}));if(n)throw n;V.success("数量修改成功"),await je(),se(null),ne(0),ue(null),oe(!1)}catch(e){V.error("修改数量失败")}},onCancel:()=>{oe(!1),ue(null)}},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2532,columnNumber:7},void 0),t.jsxDEV(R,{isOpen:ae,employeeName:null==ce?void 0:ce.employeeName,workDate:null==ce?void 0:ce.workDate,workProject:null==ce?void 0:ce.workProject,onConfirm:async()=>{if(ce)try{const{data:e,error:t}=await _.from("timesheet_record_items").select("id").eq("timesheet_record_id",ce.recordId);if(t)throw t;const{error:s}=await _.from("timesheet_record_items").delete().eq("id",ce.itemId);if(s)throw s;if(e&&1===e.length){const{error:e}=await _.from("timesheet_records").delete().eq("id",ce.recordId)}V.success("工时项目删除成功"),await je(),de(null),ie(!1)}catch(e){V.error("删除工时项目失败")}},onCancel:()=>{ie(!1),de(null)}},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2544,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1351,columnNumber:5},void 0)};export{A as default};
