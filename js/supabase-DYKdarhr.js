import{H as e,n as t,A as s,P as n,S as a,F as i,R as r}from"./vendor-DiAOLeLW.js";let o="";o="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const c={headers:{"X-Client-Info":"supabase-js-".concat(o,"/").concat("2.75.0")}},h={schema:"public"},u={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},l={};const d=(s,n,a)=>{const i=(e=>{let s;return s=e||("undefined"==typeof fetch?t:fetch),(...e)=>s(...e)})(a),r="undefined"==typeof Headers?e:Headers;return(e,t)=>{return a=void 0,o=void 0,h=function*(){var a;const o=null!==(a=yield n())&&void 0!==a?a:s;let c=new r(null==t?void 0:t.headers);return c.has("apikey")||c.set("apikey",s),c.has("Authorization")||c.set("Authorization","Bearer ".concat(o)),i(e,Object.assign(Object.assign({},t),{headers:c}))},new((c=void 0)||(c=Promise))(function(e,t){function s(e){try{i(h.next(e))}catch(s){t(s)}}function n(e){try{i(h.throw(e))}catch(s){t(s)}}function i(t){var a;t.done?e(t.value):(a=t.value,a instanceof c?a:new c(function(e){e(a)})).then(s,n)}i((h=h.apply(a,o||[])).next())});var a,o,c,h}};class f extends s{constructor(e){super(e)}}class g{constructor(e,t,s){var i,r,o;this.supabaseUrl=e,this.supabaseKey=t;const f=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((s=t).endsWith("/")?s:s+"/")}catch(i){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var s}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const g="sb-".concat(f.hostname.split(".")[0],"-auth-token"),v=function(e,t){var s,n;const{db:a,auth:i,realtime:r,global:o}=e,{db:c,auth:h,realtime:u,global:l}=t,d={db:Object.assign(Object.assign({},c),a),auth:Object.assign(Object.assign({},h),i),realtime:Object.assign(Object.assign({},u),r),storage:{},global:Object.assign(Object.assign(Object.assign({},l),o),{headers:Object.assign(Object.assign({},null!==(s=null==l?void 0:l.headers)&&void 0!==s?s:{}),null!==(n=null==o?void 0:o.headers)&&void 0!==n?n:{})}),accessToken:()=>{return e=this,s=function*(){return""},new((t=void 0)||(t=Promise))(function(n,a){function i(e){try{o(s.next(e))}catch(t){a(t)}}function r(e){try{o(s.throw(e))}catch(t){a(t)}}function o(e){var s;e.done?n(e.value):(s=e.value,s instanceof t?s:new t(function(e){e(s)})).then(i,r)}o((s=s.apply(e,[])).next())});var e,t,s}};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=s?s:{},{db:h,realtime:l,auth:Object.assign(Object.assign({},u),{storageKey:g}),global:c});this.storageKey=null!==(i=v.auth.storageKey)&&void 0!==i?i:"",this.headers=null!==(r=v.global.headers)&&void 0!==r?r:{},v.accessToken?(this.accessToken=v.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!==(o=v.auth)&&void 0!==o?o:{},this.headers,v.global.fetch),this.fetch=d(t,this._getAccessToken.bind(this),v.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},v.realtime)),this.rest=new n(new URL("rest/v1",f).href,{headers:this.headers,schema:v.db.schema,fetch:this.fetch}),this.storage=new a(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),v.accessToken||this._listenForAuthEvents()}get functions(){return new i(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return e=this,s=function*(){var e,t;if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey},new((t=void 0)||(t=Promise))(function(n,a){function i(e){try{o(s.next(e))}catch(t){a(t)}}function r(e){try{o(s.throw(e))}catch(t){a(t)}}function o(e){var s;e.done?n(e.value):(s=e.value,s instanceof t?s:new t(function(e){e(s)})).then(i,r)}o((s=s.apply(e,[])).next())});var e,t,s}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:a,storageKey:i,flowType:r,lock:o,debug:c},h,u){const l={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new f({url:this.authUrl.href,headers:Object.assign(Object.assign({},l),h),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:a,flowType:r,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new r(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=s,this.realtime.setAuth(s))}}const v=(e,t,s)=>new g(e,t,s);!function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);t&&parseInt(t[1],10)}();export{v as c};
