import{r as e,j as m,w as s,m as t,k as n,u as r,t as a,q as i,x as o,T as l,X as u}from"./react-D6UPbbTV.js";import{u as c,h as d,s as h,P as g}from"./index-BidJgHLo.js";import{L as N}from"./vendor-CKbz-9sG.js";import"./react-dom-BT3gIiCK.js";import"./supabase-BE3bwnEA.js";import"./toast-C6NSsgfd.js";const x=()=>{const{user:x}=c(),[b,v]=e.useState([]),[y,p]=e.useState(!0),[f,w]=e.useState(""),[k,j]=e.useState({show:!1,role:null}),[E,L]=e.useState(!1);e.useEffect(()=>{var e;if(document.title="权限管理 - 工时管理系统",x&&(null==(e=x.role)?void 0:e.permissions)){if(!d(x,g.ROLE_MANAGE))return w("您没有权限访问角色管理页面"),void p(!1);D()}},[x]);const D=async()=>{try{const{data:e,error:m}=await h.from("user_roles").select("*").order("created_at",{ascending:!1});if(m)throw m;const{data:s,error:t}=await h.from("users").select("role_id");if(t){const m=(e||[]).map(e=>({...e,user_count:0}));return void v(m)}const n=new Map;null==s||s.forEach(e=>{const m=n.get(e.role_id)||0;n.set(e.role_id,m+1)});const r=(e||[]).map(e=>({...e,user_count:n.get(e.id)||0}));v(r)}catch(e){w("获取角色列表失败，请重试")}finally{p(!1)}},R=()=>{j({show:!1,role:null})};return y?m.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:m.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:131,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:130,columnNumber:7},void 0):f?m.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:m.jsxDEV("div",{className:"text-center",children:[m.jsxDEV(s,{className:"w-16 h-16 text-red-400 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:142,columnNumber:11},void 0),m.jsxDEV("div",{className:"text-red-400 text-xl font-mono mb-4",children:f},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:143,columnNumber:11},void 0),m.jsxDEV(N,{to:"/dashboard",className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:"返回首页"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:144,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:141,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:140,columnNumber:7},void 0):m.jsxDEV("div",{className:"min-h-screen bg-black text-green-400 p-6",children:m.jsxDEV("div",{className:"max-w-7xl mx-auto",children:[m.jsxDEV("div",{className:"mb-8",children:[m.jsxDEV("div",{className:"flex justify-between items-center mb-4",children:[m.jsxDEV("div",{className:"flex items-center",children:[m.jsxDEV(t,{className:"w-8 h-8 text-green-400 mr-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:162,columnNumber:15},void 0),m.jsxDEV("h1",{className:"text-4xl font-bold text-green-400 font-mono",children:"权限管理"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:163,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:161,columnNumber:13},void 0),m.jsxDEV(N,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[m.jsxDEV(n,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:169,columnNumber:15},void 0),m.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:170,columnNumber:15},void 0),m.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:171,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:165,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:160,columnNumber:11},void 0),m.jsxDEV("div",{className:"h-1 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:174,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:159,columnNumber:9},void 0),m.jsxDEV("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[m.jsxDEV("div",{className:"flex-1",children:m.jsxDEV("div",{className:"relative",children:[m.jsxDEV(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-green-400/60"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:181,columnNumber:15},void 0),m.jsxDEV("input",{type:"text",placeholder:"搜索角色名称...",className:"w-full bg-black border border-green-400/30 rounded px-10 py-2 text-green-400 placeholder-green-400/60 focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:182,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:180,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:179,columnNumber:11},void 0),m.jsxDEV(N,{to:"/role-permissions/create",className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:[m.jsxDEV(a,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:193,columnNumber:13},void 0),"创建角色"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:189,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:178,columnNumber:9},void 0),m.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg overflow-hidden",children:0===b.length?m.jsxDEV("div",{className:"p-8 text-center",children:[m.jsxDEV(t,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:205,columnNumber:15},void 0),m.jsxDEV("p",{className:"text-gray-400 font-mono",children:"暂无角色数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:206,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:204,columnNumber:13},void 0):m.jsxDEV("div",{className:"overflow-x-auto",children:m.jsxDEV("table",{className:"w-full",children:[m.jsxDEV("thead",{className:"bg-green-900/30",children:m.jsxDEV("tr",{children:[m.jsxDEV("th",{className:"px-6 py-3 text-left text-sm font-medium text-green-400 uppercase tracking-wider font-mono",children:"角色名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:213,columnNumber:21},void 0),m.jsxDEV("th",{className:"px-6 py-3 text-left text-sm font-medium text-green-400 uppercase tracking-wider font-mono",children:"用户数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:216,columnNumber:21},void 0),m.jsxDEV("th",{className:"px-6 py-3 text-left text-sm font-medium text-green-400 uppercase tracking-wider font-mono",children:"创建时间"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:219,columnNumber:21},void 0),m.jsxDEV("th",{className:"px-6 py-3 text-left text-sm font-medium text-green-400 uppercase tracking-wider font-mono",children:"操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:222,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:212,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:211,columnNumber:17},void 0),m.jsxDEV("tbody",{className:"divide-y divide-green-800",children:b.map(e=>{return m.jsxDEV("tr",{className:"hover:bg-green-900/10 transition-colors",children:[m.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV(t,{className:"w-4 h-4 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:232,columnNumber:27},void 0),m.jsxDEV("span",{className:"text-green-400 font-mono font-medium",children:e.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:233,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:231,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:230,columnNumber:23},void 0),m.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsxDEV("div",{className:"flex items-center gap-1",children:[m.jsxDEV(i,{className:"w-4 h-4 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:238,columnNumber:27},void 0),m.jsxDEV("span",{className:"text-green-400 font-mono",children:e.user_count},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:239,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:237,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:236,columnNumber:23},void 0),m.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsxDEV("span",{className:"text-green-300 font-mono text-sm",children:(s=e.created_at,new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:243,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:242,columnNumber:23},void 0),m.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV(N,{to:"/role-permissions/edit/".concat(e.id),className:"p-2 text-blue-400 hover:text-blue-300 hover:bg-gray-700 rounded transition-colors",title:"编辑角色",children:m.jsxDEV(o,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:254,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:249,columnNumber:27},void 0),m.jsxDEV("button",{onClick:()=>(e=>{j({show:!0,role:e})})(e),className:"p-2 text-red-400 hover:text-red-300 hover:bg-gray-700 rounded transition-colors",title:"删除角色",children:m.jsxDEV(l,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:261,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:256,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:248,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:247,columnNumber:23},void 0)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:229,columnNumber:21},void 0);var s})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:227,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:210,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:209,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:201,columnNumber:9},void 0),k.show&&k.role&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-gray-900 border border-red-400 rounded-lg p-6 max-w-md w-full mx-4",children:[m.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[m.jsxDEV("h3",{className:"text-xl font-bold text-red-400 font-mono",children:"确认删除角色"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:278,columnNumber:17},void 0),m.jsxDEV("button",{onClick:R,className:"text-gray-400 hover:text-gray-300 transition-colors",children:m.jsxDEV(u,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:283,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:279,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:277,columnNumber:15},void 0),m.jsxDEV("div",{className:"mb-6",children:[m.jsxDEV("p",{className:"text-green-300 font-mono mb-2",children:["您确定要删除角色 ",m.jsxDEV("span",{className:"text-red-400 font-bold",children:['"',k.role.name,'"']},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:289,columnNumber:28},void 0)," 吗？"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:288,columnNumber:17},void 0),m.jsxDEV("div",{className:"bg-gray-800 border border-gray-600 rounded p-3 mb-3",children:m.jsxDEV("p",{className:"text-green-300 font-mono text-sm",children:["使用用户数：",k.role.user_count]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:292,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:291,columnNumber:17},void 0),k.role.user_count>0&&m.jsxDEV("div",{className:"bg-red-900 border border-red-400 rounded p-3 mb-3",children:m.jsxDEV("p",{className:"text-red-300 font-mono text-sm",children:["⚠️ 该角色正被 ",k.role.user_count," 个用户使用，无法删除！"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:298,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:297,columnNumber:19},void 0),m.jsxDEV("p",{className:"text-gray-400 font-mono text-sm",children:"此操作不可撤销，请谨慎操作。"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:303,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:287,columnNumber:15},void 0),m.jsxDEV("div",{className:"flex gap-3 justify-end",children:[m.jsxDEV("button",{onClick:R,className:"px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white font-bold rounded transition-colors font-mono",disabled:E,children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:309,columnNumber:17},void 0),m.jsxDEV("button",{onClick:async()=>{if(!k.role)return;const e=k.role;if(e.user_count>0)return w('无法删除角色 "'.concat(e.name,'"，该角色正被 ').concat(e.user_count," 个用户使用")),void j({show:!1,role:null});L(!0);try{const{error:m}=await h.from("user_roles").delete().eq("id",e.id);if(m)throw m;await D(),j({show:!1,role:null}),w("")}catch(m){w("删除角色失败，请重试")}finally{L(!1)}},disabled:E||k.role.user_count>0,className:"px-4 py-2 bg-red-600 hover:bg-red-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold rounded transition-colors font-mono",children:E?"删除中...":"确认删除"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:316,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:308,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:276,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:275,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:157,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:156,columnNumber:5},void 0)};export{x as default};
