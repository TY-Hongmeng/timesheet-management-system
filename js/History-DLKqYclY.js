import{r as e,j as t,Z as s,t as m,k as n,F as r,f as a,O as o,s as i}from"./react-BhmEO67a.js";import{u as l,s as c}from"./index-ngKOTzXB.js";import{t as u}from"./vendor-CYH3FzT5.js";import{L as d}from"./router-DPJaSBR_.js";import"./react-dom-BHsP-6Eo.js";import"./supabase-yHu17Xhi.js";const h=()=>{const{user:h}=l(),[g,y]=e.useState([]),[N,x]=e.useState([]),[v,b]=e.useState(!0),[p,f]=e.useState({key:"work_date",direction:"desc"}),[w,k]=e.useState({yearMonth:"",startDate:"",endDate:"",userId:""}),[D,j]=e.useState([]),[E,H]=e.useState([]),[V,_]=e.useState(new Set),[S,C]=e.useState(!0),[M,q]=e.useState(!1);e.useEffect(()=>{h&&(P(),I())},[h]),e.useEffect(()=>{Q()},[g,w]);const I=async()=>{if(h)try{const{data:e,error:t}=await c.from("timesheet_records").select("user_id, user:users!timesheet_records_user_id_fkey(id, name)").or("supervisor_id.eq.".concat(h.id,",section_chief_id.eq.").concat(h.id)).neq("status","draft");if(t)return;const s=(null==e?void 0:e.filter(e=>e.user).reduce((e,t)=>{const s=t.user.id;return e.find(e=>e.id===s)||e.push({id:s,name:t.user.name}),e},[]))||[];H(s)}catch(e){}},P=async()=>{if(h)try{b(!0);const{data:e,error:t}=await c.from("timesheet_records").select("\n          *,\n          user:users!timesheet_records_user_id_fkey(id, name),\n          supervisor:users!timesheet_records_supervisor_id_fkey(id, name),\n          section_chief:users!timesheet_records_section_chief_id_fkey(id, name),\n          items:timesheet_record_items(\n            id,\n            process_id,\n            quantity,\n            unit_price,\n            amount,\n            processes:processes!timesheet_record_items_process_id_fkey(\n              product_process,\n              product_name,\n              production_category,\n              production_line,\n              unit_price\n            )\n          ),\n          approval_history(\n            approver_type,\n            approver_name,\n            created_at,\n            approver:approver_id(name)\n          )\n        ").or("user_id.eq.".concat(h.id,",supervisor_id.eq.").concat(h.id,",section_chief_id.eq.").concat(h.id)).neq("status","draft").order("work_date",{ascending:!1}),s=e?e.filter((e,t,s)=>t===s.findIndex(t=>t.id===e.id)):[];if(t)return void u.error("获取历史记录失败");y(s)}catch(e){u.error("获取历史记录失败")}finally{b(!1)}},Q=()=>{let e=[...g];if(w.yearMonth){const[t,s]=w.yearMonth.split("-");e=e.filter(e=>{const m=new Date(e.work_date),n=m.getFullYear(),r=m.getMonth()+1;return n===parseInt(t)&&r===parseInt(s)})}w.startDate&&(e=e.filter(e=>e.work_date>=w.startDate)),w.endDate&&(e=e.filter(e=>e.work_date<=w.endDate)),w.userId&&(e=e.filter(e=>e.user_id===w.userId)),p.key&&e.sort((e,t)=>{let s,m;switch(p.key){case"work_date":s=new Date(e.work_date),m=new Date(t.work_date);break;case"status":s=e.status,m=t.status;break;case"created_at":s=new Date(e.created_at),m=new Date(t.created_at);break;default:s=e[p.key],m=t[p.key]}return s<m?"asc"===p.direction?-1:1:s>m?"asc"===p.direction?1:-1:0}),x(e)},W=e=>{const t=new Set(V);t.has(e)?t.delete(e):t.add(e),_(t)},z=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),A=e=>{const s=(e=>{switch(e){case"pending":return{text:"待班长审核",icon:"⚠",color:"text-yellow-400"};case"approved":return{text:"待段长审核",icon:"⚠",color:"text-blue-400"};case"section_chief_approved":return{text:"已通过",icon:"✓",color:"text-green-400"};default:return{text:"未知",icon:"⚠",color:"text-gray-400"}}})(e);return t.jsxDEV("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ".concat(s.color),children:[t.jsxDEV("span",{className:"w-3 h-3 text-center",children:s.icon},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:397,columnNumber:9},void 0),s.text]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:396,columnNumber:7},void 0)},F=(e,t)=>{var s,m;const n=null==(s=e.approval_history)?void 0:s.find(e=>e.approver_type===t);return n?{name:n.approver_name||(null==(m=n.approver)?void 0:m.name)||"未知",date:z(n.created_at)}:null};return N.length,N.filter(e=>"pending"===e.status).length,N.filter(e=>"approved"===e.status).length,N.filter(e=>"section_chief_approved"===e.status).length,(()=>{const e=new Map;return N.forEach(t=>{var s;const m=t.user_id,n=t.work_date,r=(e=>{const t=e.getDay();if(0===t||6===t)return!1;e.getFullYear();const s=e.getMonth()+1,m=e.getDate();return!(1===s&&1===m||2===s&&m>=10&&m<=17||4===s&&m>=4&&m<=6||5===s&&m>=1&&m<=3||6===s&&m>=22&&m<=24||9===s&&m>=15&&m<=17||10===s&&m>=1&&m<=7)})(new Date(n));e.has(m)||e.set(m,{userId:m,userName:(null==(s=t.user)?void 0:s.name)||"未知",workDates:new Set,workingDates:new Set,holidayDates:new Set});const a=e.get(m);a.workDates.add(n),r?a.workingDates.add(n):a.holidayDates.add(n)}),Array.from(e.values()).map(e=>({...e,totalWorkDays:e.workDates.size,actualWorkDays:e.workingDates.size,holidayDays:e.holidayDates.size}))})().reduce((e,t)=>e+t.actualWorkDays,0),v?t.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:t.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:503,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:502,columnNumber:7},void 0):t.jsxDEV("div",{className:"min-h-screen bg-black text-green-300",children:[t.jsxDEV("header",{className:"bg-gray-900 border-b border-green-400 px-6 py-4",children:t.jsxDEV("div",{className:"max-w-7xl mx-auto",children:t.jsxDEV("div",{className:"flex items-center justify-between",children:[t.jsxDEV("h1",{className:"text-2xl font-bold text-green-400 font-mono flex items-center gap-2",children:[t.jsxDEV(s,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:517,columnNumber:15},void 0),"历史记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:516,columnNumber:13},void 0),t.jsxDEV("div",{className:"flex items-center gap-3",children:[t.jsxDEV("button",{onClick:async()=>{q(!0);try{await Promise.all([P(),I()]),u.success("数据刷新成功")}catch(e){u.error("刷新数据失败，请重试")}finally{q(!1)}},disabled:M,className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 disabled:from-gray-700 disabled:to-gray-800 text-green-300 hover:text-green-200 disabled:text-gray-400 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 disabled:border-gray-600",children:[t.jsxDEV(m,{className:"w-4 h-4 ".concat(M?"animate-spin":"")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:526,columnNumber:17},void 0),t.jsxDEV("span",{className:"hidden sm:inline",children:M?"刷新中...":"刷新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:527,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:521,columnNumber:15},void 0),t.jsxDEV(d,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[t.jsxDEV(n,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:534,columnNumber:17},void 0),t.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:535,columnNumber:17},void 0),t.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:536,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:530,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:520,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:515,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:514,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:513,columnNumber:7},void 0),t.jsxDEV("div",{className:"max-w-7xl mx-auto p-6",children:[t.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg mb-6",children:[t.jsxDEV("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-800 transition-colors",onClick:()=>C(!S),children:[t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV(r,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:552,columnNumber:15},void 0),t.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono",children:"数据筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:553,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:551,columnNumber:13},void 0),t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV("span",{className:"text-sm text-gray-400 font-mono",children:S?"展开筛选":"收起筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:556,columnNumber:15},void 0),S?t.jsxDEV(a,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:560,columnNumber:17},void 0):t.jsxDEV(o,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:562,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:555,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:547,columnNumber:11},void 0),!S&&t.jsxDEV("div",{className:"px-4 pb-4 border-t border-gray-700",children:t.jsxDEV("div",{className:"space-y-4 mt-4",children:[t.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:574,columnNumber:21},void 0),t.jsxDEV("input",{type:"month",value:w.yearMonth,onChange:e=>k({...w,yearMonth:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:577,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:573,columnNumber:19},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:586,columnNumber:21},void 0),t.jsxDEV("select",{value:w.userId,onChange:e=>k({...w,userId:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400",children:[t.jsxDEV("option",{value:"",children:"全部员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:594,columnNumber:23},void 0),E.map(e=>t.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:596,columnNumber:25},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:589,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:585,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:572,columnNumber:17},void 0),t.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"开始日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:605,columnNumber:21},void 0),t.jsxDEV("input",{type:"date",value:w.startDate,onChange:e=>k({...w,startDate:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:608,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:604,columnNumber:19},void 0),t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"结束日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:617,columnNumber:21},void 0),t.jsxDEV("input",{type:"date",value:w.endDate,onChange:e=>k({...w,endDate:e.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:620,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:616,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:603,columnNumber:17},void 0),t.jsxDEV("div",{className:"flex justify-start",children:t.jsxDEV("button",{onClick:()=>{k({yearMonth:"",startDate:"",endDate:"",userId:""}),f({key:"work_date",direction:"desc"}),u.success("筛选条件已重置")},className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 text-green-300 hover:text-green-200 rounded font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 flex items-center gap-2 text-xs sm:text-sm",children:[t.jsxDEV(m,{className:"w-3 h-3 sm:w-4 sm:h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:635,columnNumber:21},void 0),"重置筛选"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:631,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:630,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:570,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:569,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:545,columnNumber:9},void 0),t.jsxDEV("div",{className:"mb-4",children:t.jsxDEV("h2",{className:"text-xl font-bold text-green-400 font-mono flex items-center gap-2",children:[t.jsxDEV(s,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:649,columnNumber:13},void 0),"详细工时记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:648,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:647,columnNumber:9},void 0),0===N.length?t.jsxDEV("div",{className:"bg-gray-900 rounded-lg border border-gray-700 p-8 text-center",children:[t.jsxDEV("div",{className:"text-green-600 mb-4",children:t.jsxDEV(s,{className:"h-16 w-16 mx-auto"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:658,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:657,columnNumber:13},void 0),t.jsxDEV("h3",{className:"text-lg font-medium text-green-400 mb-2 font-mono",children:"暂无历史记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:660,columnNumber:13},void 0),t.jsxDEV("p",{className:"text-green-600 font-mono",children:"请调整筛选条件或添加新的工时记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:661,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:656,columnNumber:11},void 0):t.jsxDEV("div",{className:"space-y-6",children:(()=>{const e=new Map;return N.forEach(t=>{var s;const m=t.user_id;e.has(m)||e.set(m,{userName:(null==(s=t.user)?void 0:s.name)||"未知用户",records:[]}),e.get(m).records.push(t)}),Array.from(e.values()).sort((e,t)=>e.userName.localeCompare(t.userName)).map((e,s)=>{const m=new Map;e.records.forEach(e=>{const t=e.work_date;m.has(t)||m.set(t,[]),m.get(t).push(e)});const n=Array.from(m.keys()).sort((e,t)=>new Date(t).getTime()-new Date(e).getTime()),r=e.records.filter(e=>"pending"===e.status),l=e.records.filter(e=>"approved"===e.status),c=[...new Set(r.map(e=>e.work_date))],u=[...new Set(l.map(e=>e.work_date))],d={supervisorPending:c.length,sectionChiefPending:u.length,totalWorkDays:n.length};return t.jsxDEV("div",{className:"bg-gray-900 rounded-lg border border-gray-700 overflow-hidden",children:[t.jsxDEV("div",{className:"bg-gray-800 px-4 py-3 border-b border-gray-600 cursor-pointer hover:bg-gray-700 transition-colors",onClick:()=>W(e.userName),children:t.jsxDEV("div",{className:"flex items-center justify-between",children:t.jsxDEV("div",{className:"flex items-center gap-4",children:[t.jsxDEV("h3",{className:"text-lg font-bold text-green-400 font-mono flex items-center gap-2",children:[e.userName,V.has(e.userName)?t.jsxDEV(a,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:733,columnNumber:31},void 0):t.jsxDEV(o,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:735,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:730,columnNumber:27},void 0),t.jsxDEV("div",{className:"flex items-center gap-4 text-xs",children:[t.jsxDEV("div",{className:"text-center",children:[t.jsxDEV("div",{className:"text-yellow-400 font-mono font-bold",children:d.supervisorPending},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:742,columnNumber:31},void 0),t.jsxDEV("div",{className:"text-gray-400 font-mono",children:"班长待审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:743,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:741,columnNumber:29},void 0),t.jsxDEV("div",{className:"text-center",children:[t.jsxDEV("div",{className:"text-orange-400 font-mono font-bold",children:d.sectionChiefPending},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:746,columnNumber:31},void 0),t.jsxDEV("div",{className:"text-gray-400 font-mono",children:"段长待审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:747,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:745,columnNumber:29},void 0),t.jsxDEV("div",{className:"text-center",children:[t.jsxDEV("div",{className:"text-blue-400 font-mono font-bold",children:d.totalWorkDays},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:750,columnNumber:31},void 0),t.jsxDEV("div",{className:"text-gray-400 font-mono",children:"工作天数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:751,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:749,columnNumber:29},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:740,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:729,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:728,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:724,columnNumber:21},void 0),!V.has(e.userName)&&t.jsxDEV("div",{className:"p-4 space-y-4",children:n.map(s=>{const n=m.get(s),r="".concat(e.userName,"-").concat(s),i=V.has(r);return t.jsxDEV("div",{className:"space-y-3",children:[t.jsxDEV("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>W(r),children:[t.jsxDEV("div",{className:"w-2 h-2 bg-green-400 rounded-full"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:773,columnNumber:33},void 0),t.jsxDEV("h4",{className:"text-md font-semibold text-green-300 font-mono flex items-center gap-2",children:[z(s),i?t.jsxDEV(a,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:777,columnNumber:37},void 0):t.jsxDEV(o,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:779,columnNumber:37},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:774,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:769,columnNumber:31},void 0),!i&&t.jsxDEV("div",{className:"space-y-2",children:n.map(e=>e.items.map((s,m)=>{var n,r,a;return t.jsxDEV("div",{className:"bg-gray-800 rounded-lg p-3 border border-gray-600 hover:border-gray-500 transition-colors",children:t.jsxDEV("div",{className:"space-y-3",children:[t.jsxDEV("div",{className:"flex justify-between items-start gap-3",children:[t.jsxDEV("div",{className:"flex-1",children:[t.jsxDEV("div",{className:"text-xs text-gray-400 font-mono mb-1",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:794,columnNumber:47},void 0),t.jsxDEV("div",{className:"text-sm text-green-300 font-mono break-words",children:"".concat((null==(n=s.processes)?void 0:n.production_line)||"未知"," - ").concat((null==(r=s.processes)?void 0:r.product_name)||"未知"," - ").concat((null==(a=s.processes)?void 0:a.product_process)||"未知")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:795,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:793,columnNumber:45},void 0),t.jsxDEV("div",{className:"text-right",children:[t.jsxDEV("div",{className:"text-xs text-gray-400 font-mono mb-1",children:"数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:800,columnNumber:47},void 0),t.jsxDEV("div",{className:"text-sm text-yellow-400 font-mono font-semibold",children:s.quantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:801,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:799,columnNumber:45},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:792,columnNumber:43},void 0),t.jsxDEV("div",{className:"flex justify-between items-start gap-2 text-xs",children:[t.jsxDEV("div",{className:"flex gap-4 flex-1",children:[t.jsxDEV("div",{className:"flex-1",children:[t.jsxDEV("div",{className:"text-gray-400 font-mono mb-1",children:"班长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:811,columnNumber:49},void 0),t.jsxDEV("div",{className:"text-green-300 font-mono",children:(()=>{var s;const m=F(e,"supervisor"),n=(null==(s=e.supervisor)?void 0:s.name)||"未分配";return m?t.jsxDEV("div",{className:"flex flex-col",children:[t.jsxDEV("div",{className:"truncate",children:m.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:819,columnNumber:59},void 0),t.jsxDEV("div",{className:"text-xs text-gray-400",children:m.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:820,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:818,columnNumber:57},void 0):t.jsxDEV("div",{className:"truncate",children:n},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:824,columnNumber:60},void 0)})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:812,columnNumber:49},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:810,columnNumber:47},void 0),t.jsxDEV("div",{className:"flex-1",children:[t.jsxDEV("div",{className:"text-gray-400 font-mono mb-1",children:"段长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:829,columnNumber:49},void 0),t.jsxDEV("div",{className:"text-green-300 font-mono",children:(()=>{var s;const m=F(e,"section_chief"),n=(null==(s=e.section_chief)?void 0:s.name)||"未分配";return m?t.jsxDEV("div",{className:"flex flex-col",children:[t.jsxDEV("div",{className:"truncate",children:m.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:837,columnNumber:59},void 0),t.jsxDEV("div",{className:"text-xs text-gray-400",children:m.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:838,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:836,columnNumber:57},void 0):t.jsxDEV("div",{className:"truncate",children:n},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:842,columnNumber:60},void 0)})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:830,columnNumber:49},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:828,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:809,columnNumber:45},void 0),t.jsxDEV("div",{className:"text-right",children:[t.jsxDEV("div",{className:"text-gray-400 font-mono mb-1",children:"状态"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:848,columnNumber:47},void 0),t.jsxDEV("div",{className:"flex items-center justify-end",children:A(e.status)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:849,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:847,columnNumber:45},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:808,columnNumber:43},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:790,columnNumber:41},void 0)},"".concat(e.id,"-").concat(m),!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:789,columnNumber:39},void 0)}))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:786,columnNumber:33},void 0)]},s,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:767,columnNumber:29},void 0)})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:760,columnNumber:23},void 0),!V.has(e.userName)&&(()=>{const s=e.records.flatMap(e=>e.items.map(t=>({...t,workDate:e.work_date}))),m=new Map;s.forEach(e=>{var t,s,n,r,a,o,i;const l="".concat((null==(t=e.processes)?void 0:t.production_line)||"未知","-").concat((null==(s=e.processes)?void 0:s.product_name)||"未知","-").concat((null==(n=e.processes)?void 0:n.product_process)||"未知");m.has(l)||m.set(l,{productionLine:(null==(r=e.processes)?void 0:r.production_line)||"未知",productName:(null==(a=e.processes)?void 0:a.product_name)||"未知",productProcess:(null==(o=e.processes)?void 0:o.product_process)||"未知",productionCategory:(null==(i=e.processes)?void 0:i.production_category)||"未知",totalQuantity:0,recordCount:0});const c=m.get(l);c.totalQuantity+=e.quantity,c.recordCount+=1});const n=Array.from(m.values()).sort((e,t)=>t.totalQuantity-e.totalQuantity);return 0===n.length?null:t.jsxDEV("div",{className:"mt-4 bg-gray-900 rounded-lg p-3 border border-gray-600",children:[t.jsxDEV("h6",{className:"text-sm font-bold text-blue-400 font-mono mb-3 flex items-center gap-2",children:[t.jsxDEV(i,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:910,columnNumber:29},void 0),e.userName," - 数量统计汇总"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:909,columnNumber:27},void 0),t.jsxDEV("div",{className:"w-full",children:t.jsxDEV("table",{className:"w-full table-fixed",children:[t.jsxDEV("thead",{className:"bg-gray-800",children:t.jsxDEV("tr",{children:[t.jsxDEV("th",{className:"px-1 py-2 text-left text-blue-400 font-mono text-xs w-[50%] sm:w-[60%]",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:918,columnNumber:35},void 0),t.jsxDEV("th",{className:"px-1 py-2 text-left text-blue-400 font-mono text-xs w-[25%] sm:w-[20%]",children:"数量总计"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:919,columnNumber:35},void 0),t.jsxDEV("th",{className:"px-1 py-2 text-left text-blue-400 font-mono text-xs w-[25%] sm:w-[20%]",children:"记录条数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:920,columnNumber:35},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:917,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:916,columnNumber:31},void 0),t.jsxDEV("tbody",{children:n.map((e,s)=>t.jsxDEV("tr",{className:"border-b border-gray-700 hover:bg-gray-800 transition-colors",children:[t.jsxDEV("td",{className:"px-1 py-2 text-green-300 font-mono text-xs",children:t.jsxDEV("div",{className:"break-words text-xs leading-tight",children:"".concat(e.productionLine," - ").concat(e.productName," - ").concat(e.productProcess)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:927,columnNumber:39},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:926,columnNumber:37},void 0),t.jsxDEV("td",{className:"px-1 py-2 text-yellow-400 font-mono text-xs font-bold",children:e.totalQuantity.toFixed(1)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:931,columnNumber:37},void 0),t.jsxDEV("td",{className:"px-1 py-2 text-blue-400 font-mono text-xs",children:e.recordCount},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:934,columnNumber:37},void 0)]},s,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:925,columnNumber:35},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:923,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:915,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:914,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:908,columnNumber:25},void 0)})()]},s,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:722,columnNumber:19},void 0)})})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:664,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:543,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:511,columnNumber:5},void 0)};export{h as default};
