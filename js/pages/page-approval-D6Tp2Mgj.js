import{r as e,j as m,C as t,m as s,c as r,a as n,h as i,n as a,e as o,X as l,o as u,f as c,p as d,M as h,q as p}from"../libs/lib-react-CmVvENop.js";import{u as g,s as v}from"./page-admin-DIiCL3HX.js";import{t as N}from"../libs/lib-toast-BLtamXt4.js";import{u as x,L as y}from"../vendor-BPcnth7H.js";const b=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{user:p}=g(),b=x(),[f,w]=e.useState([]),[k,S]=e.useState([]),[j,D]=e.useState(!0),[A,E]=e.useState(null),[V,_]=e.useState(""),[C,L]=e.useState(!1),[I,z]=e.useState([]),[M,q]=e.useState(!1),[Q,B]=e.useState(null),[W,R]=e.useState(0),[O,T]=e.useState(0),[F,K]=e.useState(!1),[H,P]=e.useState(null),[G,J]=e.useState(!1),[U,X]=e.useState(null),[Y,Z]=e.useState(null),[$,ee]=e.useState(new Set),[me,te]=e.useState(!1),[se,re]=e.useState(!1),[ne,ie]=e.useState(!1),[ae,oe]=e.useState(null),[le,ue]=e.useState(!1),[ce,de]=e.useState(null);e.useEffect(()=>{ve()},[]);const he=new Map,pe=async(e,m)=>{try{const{error:t}=await v.from("timesheet_records").update({status:m,updated_at:(new Date).toISOString()}).in("id",e);return!t||(N.error("更新记录状态失败"),!1)}catch(t){return N.error("更新记录状态失败"),!1}},ge=async e=>{try{const{error:m}=await v.from("approval_history").insert(e);return!m||(N.error("插入审核历史失败"),!1)}catch(m){return N.error("插入审核历史失败"),!1}},ve=async()=>{var e;if(p)try{D(!0);let m=v.from("timesheet_records").select("\n          *,\n          supervisor:supervisor_id(id, name),\n          section_chief:section_chief_id(id, name),\n          user:user_id(id, name, phone),\n          timesheet_record_items(*, processes(unit_price))\n        ").eq("status","pending");"超级管理员"!==(null==(e=p.role)?void 0:e.name)&&(m=m.eq("supervisor_id",p.id));const{data:t,error:s}=await m.order("created_at",{ascending:!1});if(s)throw s;const r=(null==t?void 0:t.flatMap(e=>e.timesheet_record_items||[]))||[],n=[...new Set(r.map(e=>e.process_id).filter(Boolean))],i=n.filter(e=>!he.has(e));if(i.length>0){const{data:e,error:m}=await v.from("processes").select("id, product_process, product_name, production_category, production_line").in("id",i);m||(e||[]).forEach(e=>{he.set(e.id,e)})}const a=n.map(e=>he.get(e)).filter(Boolean),o=new Map(a.map(e=>[e.id,e])),l=((null==t?void 0:t.map(e=>{const m=e.timesheet_record_items||[],t=m.length>0?o.get(m[0].process_id):null,s=t?{name:t.production_line}:{name:"未知生产线"};return{...e,production_line:s,user:{name:e.user_name||(e.user?e.user.name:"未知用户"),phone:e.user?e.user.phone:""},supervisor:e.supervisor_name?{id:e.supervisor_id,name:e.supervisor_name}:e.supervisor||null,section_chief:e.section_chief_name?{id:e.section_chief_id,name:e.section_chief_name}:e.section_chief||null,items:m.map(e=>{var m;const t=o.get(e.process_id),s=(null==(m=e.processes)?void 0:m.unit_price)||0,r=e.quantity*s;return{id:e.id,timesheet_record_id:e.timesheet_record_id,work_type:{name:(null==t?void 0:t.production_category)||"未知工时类型"},product:{name:(null==t?void 0:t.product_name)||"未知产品",code:""},process:{name:(null==t?void 0:t.product_process)||"未知工序"},quantity:e.quantity,unit:e.unit||"件",unit_price:s,amount:r}})}}))||[]).filter(e=>e.items&&e.items.length>0);w(l);const u=(e=>{const m=new Map;e.forEach(e=>{if(e.items&&e.items.length>0){const t="".concat(e.user_id,"_").concat(e.work_date),s=m.get(t);s?s.push(e):m.set(t,[e])}});const t=[];return m.forEach((e,m)=>{const s=e[0];let r=[],n=new Date(s.updated_at).getTime();e.forEach(e=>{r=r.concat(e.items);const m=new Date(e.updated_at).getTime();m>n&&(n=m)}),t.push({groupKey:m,user_id:s.user_id,work_date:s.work_date,user:s.user,production_line:s.production_line,supervisor:s.supervisor,section_chief:s.section_chief,originalRecords:e,totalItems:r.length,allItems:r,status:s.status,created_at:s.created_at,updated_at:n.toString()})}),t.sort((e,m)=>{const t=new Date(e.created_at).getTime();return new Date(m.created_at).getTime()-t})})(l);S(u)}catch(m){N.error("获取待审核记录失败")}finally{D(!1)}},Ne=async(e,m)=>{if(Q){const t=ye();if(t)return de({itemId:Q,itemName:t.itemName,userName:t.userName,workDate:t.workDate,originalQuantity:O,newQuantity:W,unit:t.item.unit||"件",pendingApprovalData:{type:"grouped",groupedRecord:e,comment:m}}),void ue(!0)}try{L(!0);const t=e.originalRecords.map(e=>e.id);if(!(await pe(t,"approved")))return;const s=t.map(e=>({timesheet_record_id:e,approver_id:null==p?void 0:p.id,approver_type:"supervisor",action:"approved",comment:m||null,created_at:(new Date).toISOString()}));if(!(await ge(s)))return;N.success("审核通过成功"),ve(),ee(new Set)}catch(t){N.error("审核操作失败，请重试")}finally{L(!1)}},xe=()=>{B(null),R(0)},ye=()=>{var e,m,t,s;if(!Q)return null;for(const r of k){const n=r.allItems.find(e=>e.id===Q);if(n)return{item:n,groupedRecord:r,itemName:"".concat((null==(e=n.work_type)?void 0:e.name)||"未知类型"," | ").concat((null==(m=n.product)?void 0:m.name)||"未知产品"," | ").concat((null==(t=n.process)?void 0:t.name)||"未知工序"),userName:(null==(s=r.user)?void 0:s.name)||"未知用户",workDate:r.work_date}}return null},[be,fe]=e.useState(null);return j?m.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:m.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1223,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1222,columnNumber:7},void 0):m.jsxDEV("div",{className:"min-h-screen bg-black text-green-400 font-mono",children:[m.jsxDEV("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[m.jsxDEV("div",{className:"mb-8",children:[m.jsxDEV("div",{className:"flex justify-between items-center mb-4",children:[m.jsxDEV("div",{className:"flex items-center",children:[m.jsxDEV(t,{className:"w-8 h-8 text-green-400 mr-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1237,columnNumber:15},void 0),m.jsxDEV("h1",{className:"text-4xl font-bold text-green-400 font-mono",children:"班长审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1238,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1236,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV("button",{onClick:async()=>{re(!0);try{await ve(),N.success("数据刷新成功")}catch(e){N.error("刷新数据失败，请重试")}finally{re(!1)}},disabled:se,className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 disabled:from-gray-700 disabled:to-gray-800 text-green-300 hover:text-green-200 disabled:text-gray-400 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 disabled:border-gray-600",children:[m.jsxDEV(s,{className:"w-4 h-4 ".concat(se?"animate-spin":"")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1246,columnNumber:17},void 0),m.jsxDEV("span",{className:"hidden sm:inline",children:se?"刷新中...":"刷新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1247,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1241,columnNumber:15},void 0),m.jsxDEV(y,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[m.jsxDEV(r,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1253,columnNumber:17},void 0),m.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1254,columnNumber:17},void 0),m.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1255,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1249,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1240,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1235,columnNumber:11},void 0),m.jsxDEV("div",{className:"h-1 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1259,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1234,columnNumber:9},void 0),m.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-3 mb-4",children:m.jsxDEV("div",{className:"flex items-center gap-3",children:[m.jsxDEV("span",{className:"text-green-300 font-mono text-base bg-gray-800 px-2 py-1 rounded",children:[k.length," 条记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1265,columnNumber:13},void 0),$.size>0&&m.jsxDEV("span",{className:"text-green-400 font-mono text-base",children:["已选择 ",$.size," 条"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1269,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1264,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1263,columnNumber:9},void 0),0===k.length?m.jsxDEV("div",{className:"text-center py-12",children:[m.jsxDEV(n,{className:"w-16 h-16 text-green-600 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1278,columnNumber:15},void 0),m.jsxDEV("h3",{className:"text-lg font-medium text-green-400 mb-2 font-mono",children:"暂无待审核记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1279,columnNumber:15},void 0),m.jsxDEV("p",{className:"text-green-600 font-mono",children:"当前没有需要审核的工时记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1280,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1277,columnNumber:13},void 0):m.jsxDEV("div",{className:"space-y-4",children:k.map(e=>{return m.jsxDEV("div",{className:"border border-green-400 bg-gray-800 rounded-lg p-4 sm:p-6 hover:bg-gray-700 transition-all duration-200",children:[m.jsxDEV("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:m.jsxDEV("div",{className:"flex items-center gap-3",children:[m.jsxDEV("input",{type:"checkbox",checked:$.has(e.groupKey),onChange:()=>(e=>{const m=new Set($);m.has(e)?m.delete(e):m.add(e),ee(m)})(e.groupKey),className:"w-4 h-4 text-green-600 border-green-400 rounded focus:ring-green-500 bg-gray-700 flex-shrink-0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1289,columnNumber:23},void 0),m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV(i,{className:"w-4 h-4 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1296,columnNumber:25},void 0),m.jsxDEV("span",{className:"font-medium text-green-300 font-mono",children:e.user.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1297,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1295,columnNumber:23},void 0),m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV(a,{className:"w-4 h-4 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1300,columnNumber:25},void 0),m.jsxDEV("span",{className:"text-green-300 font-mono text-base",children:(t=e.work_date,t?new Date(t).toISOString().split("T")[0]:"")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1301,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1299,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1288,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1287,columnNumber:19},void 0),m.jsxDEV("div",{className:"grid grid-cols-1 gap-3 mb-4",children:m.jsxDEV("div",{className:"flex items-center gap-2 text-base",children:[m.jsxDEV("span",{className:"text-gray-400",children:"记录总数:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1311,columnNumber:23},void 0),m.jsxDEV("span",{className:"text-green-300 font-medium",children:e.allItems.length},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1312,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1310,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1309,columnNumber:19},void 0),m.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-4",children:e.allItems.map(e=>{var t,s,r,n;return m.jsxDEV("div",{className:"bg-gray-900 rounded-lg p-2 border border-gray-700",children:[m.jsxDEV("div",{className:"mb-1",children:[m.jsxDEV("div",{className:"text-green-200 font-mono text-sm font-medium leading-tight",children:"".concat((null==(t=e.work_type)?void 0:t.name)||"未知类型"," | ").concat((null==(s=e.product)?void 0:s.name)||"未知产品"," | ").concat((null==(r=e.process)?void 0:r.name)||"未知工序")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1322,columnNumber:27},void 0),(null==(n=e.product)?void 0:n.code)&&m.jsxDEV("div",{className:"text-green-500 font-mono text-sm mt-1",children:["产品编码: ",e.product.code]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1326,columnNumber:29},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1321,columnNumber:25},void 0),m.jsxDEV("div",{className:"flex items-center justify-between gap-1",children:[m.jsxDEV("div",{className:"flex items-center gap-1",children:[m.jsxDEV("span",{className:"text-sm text-gray-400",children:"数量:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1333,columnNumber:29},void 0),Q===e.id?m.jsxDEV("div",{className:"flex items-center gap-1",children:[m.jsxDEV("input",{type:"number",value:W,onChange:e=>R(Number(e.target.value)),onWheel:e=>e.preventDefault(),className:"w-16 px-2 py-1 bg-gray-600 border border-green-400 rounded text-green-300 font-mono text-sm [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",min:"1"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1336,columnNumber:33},void 0),m.jsxDEV("span",{className:"text-green-300 text-sm",children:e.unit},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1344,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1335,columnNumber:31},void 0):m.jsxDEV("span",{className:"text-yellow-300 font-medium text-sm",children:[e.quantity," ",e.unit]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1347,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1332,columnNumber:27},void 0),m.jsxDEV("div",{className:"flex items-center gap-0.5",children:Q===e.id?m.jsxDEV(m.Fragment,{children:[m.jsxDEV("button",{onClick:()=>{const m=k.find(m=>m.allItems.some(m=>m.id===e.id));m&&((e,m)=>{var t,s,r,n;if(W<=0)return void N.error("数量必须大于0");const i=(null==(t=e.work_type)?void 0:t.name)||"",a=i.includes("生产");if(a&&!Number.isInteger(W))return void N.error("生产工时数量必须为整数");if(!a&&W<0)return void N.error("非生产工时数量不能为负数");const o="".concat((null==(s=e.work_type)?void 0:s.name)||"未知类型"," | ").concat((null==(r=e.product)?void 0:r.name)||"未知产品"," | ").concat((null==(n=e.process)?void 0:n.name)||"未知工序");P({itemId:e.id,itemName:o,userName:m.user.name,workDate:m.work_date,originalQuantity:O,newQuantity:W,unit:e.unit,workType:i}),K(!0)})(e,m)},className:"p-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-xs transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center",title:"确认保存",children:m.jsxDEV(o,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1366,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1354,columnNumber:33},void 0),m.jsxDEV("button",{onClick:xe,className:"p-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md text-xs transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center",title:"取消",children:m.jsxDEV(l,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1373,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1368,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1353,columnNumber:31},void 0):m.jsxDEV(m.Fragment,{children:[m.jsxDEV("button",{onClick:()=>(e=>{if(Q&&W!==O){const m=ye();if(m){const t=k.find(m=>m.allItems.some(m=>m.id===e.id));if(t)return de({itemId:Q,itemName:m.itemName,userName:m.userName,workDate:m.workDate,originalQuantity:O,newQuantity:W,unit:m.item.unit,pendingApprovalData:{type:"edit_switch",newEditTarget:{item:e,groupedRecord:t}}}),void ue(!0)}}B(e.id),R(e.quantity),T(e.quantity)})(e),className:"p-2 text-blue-400 hover:text-blue-300 transition-colors rounded-md hover:bg-blue-400/10 min-w-[44px] min-h-[44px] flex items-center justify-center",title:"编辑数量",children:m.jsxDEV(u,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1383,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1378,columnNumber:33},void 0),m.jsxDEV("button",{onClick:()=>{var m,t,s,r;const n=k.find(m=>m.allItems.some(m=>m.id===e.id)),i="".concat((null==(m=e.work_type)?void 0:m.name)||"未知工时类型"," | ").concat((null==(t=e.product)?void 0:t.name)||"未知产品"," | ").concat((null==(s=e.process)?void 0:s.name)||"未知工序");X(e.id),Z({itemName:i,userName:(null==(r=null==n?void 0:n.user)?void 0:r.name)||"未知用户",workDate:(null==n?void 0:n.work_date)||"未知日期",recordId:e.timesheet_record_id}),J(!0)},className:"p-2 text-red-400 hover:text-red-300 transition-colors rounded-md hover:bg-red-400/10 min-w-[44px] min-h-[44px] flex items-center justify-center",title:"删除",children:m.jsxDEV(c,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1403,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1385,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1377,columnNumber:31},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1351,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1331,columnNumber:25},void 0)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1319,columnNumber:23},void 0)})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1317,columnNumber:19},void 0)]},e.groupKey,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1285,columnNumber:17},void 0);var t})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1283,columnNumber:13},void 0),$.size>0&&m.jsxDEV("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-green-400 p-4 z-40",children:m.jsxDEV("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[m.jsxDEV("span",{className:"text-green-400 font-mono text-sm",children:["已选择 ",$.size," 条记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1424,columnNumber:15},void 0),m.jsxDEV("div",{className:"flex items-center gap-3",children:[m.jsxDEV("button",{onClick:()=>ee(new Set),className:"px-4 py-2 bg-gray-600 text-white font-medium rounded hover:bg-gray-700 font-mono",children:"取消选择"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1428,columnNumber:17},void 0),m.jsxDEV("button",{onClick:async()=>{if(0!==$.size){if(Q){const e=ye();if(e)return de({itemId:Q,itemName:e.itemName,userName:e.userName,workDate:e.workDate,originalQuantity:O,newQuantity:W,unit:e.item.unit||"件",pendingApprovalData:{type:"batch",selectedRecords:Array.from($)}}),void ue(!0)}L(!0);try{const e=k.filter(e=>$.has(e.groupKey));for(const m of e)await Ne(m,"");N.success("成功审核通过 ".concat(e.length," 条记录")),ee(new Set),b("/")}catch(e){N.error("批量审核失败，请重试")}finally{L(!1)}}else N.error("请先选择要审核的记录")},disabled:C,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white font-medium rounded hover:bg-green-700 disabled:opacity-50 font-mono",children:[m.jsxDEV(t,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1439,columnNumber:19},void 0),C?"处理中...":"通过审核"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1434,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1427,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1423,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1422,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1232,columnNumber:7},void 0),M&&A&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[m.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[m.jsxDEV("h3",{className:"text-lg font-semibold",children:"审核历史"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1455,columnNumber:15},void 0),m.jsxDEV("button",{onClick:()=>q(!1),className:"text-gray-400 hover:text-gray-600",children:m.jsxDEV(d,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1460,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1456,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1454,columnNumber:13},void 0),m.jsxDEV("div",{className:"space-y-4",children:0===I.length?m.jsxDEV("p",{className:"text-gray-500 text-center py-4",children:"暂无审核历史"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1465,columnNumber:17},void 0):I.map(e=>m.jsxDEV("div",{className:"border border-gray-200 rounded-lg p-4",children:[m.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV("span",{className:"font-medium",children:e.approver.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1471,columnNumber:25},void 0),m.jsxDEV("span",{className:"text-sm text-gray-500",children:["(","supervisor"===e.approver_type?"班长":"段长",")"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1472,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1470,columnNumber:23},void 0),m.jsxDEV("span",{className:"px-2 py-1 rounded text-sm bg-green-100 text-green-800",children:"通过"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1474,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1469,columnNumber:21},void 0),e.comments&&m.jsxDEV("div",{className:"mb-2",children:[m.jsxDEV("div",{className:"flex items-center gap-1 mb-1",children:[m.jsxDEV(h,{className:"w-4 h-4 text-gray-500"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1481,columnNumber:27},void 0),m.jsxDEV("span",{className:"text-sm text-gray-700",children:"审核意见:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1482,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1480,columnNumber:25},void 0),m.jsxDEV("p",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:e.comments},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1484,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1479,columnNumber:23},void 0),m.jsxDEV("div",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1487,columnNumber:21},void 0)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1468,columnNumber:19},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1463,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1453,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1452,columnNumber:9},void 0),F&&H&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-6 w-full max-w-md",children:[m.jsxDEV("div",{className:"flex items-center gap-3 mb-4",children:[m.jsxDEV("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-900 rounded-full flex items-center justify-center",children:m.jsxDEV("svg",{className:"w-6 h-6 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1505,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1504,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1503,columnNumber:15},void 0),m.jsxDEV("div",{children:[m.jsxDEV("h3",{className:"text-lg font-semibold text-gray-100",children:"确认修改数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1509,columnNumber:17},void 0),m.jsxDEV("p",{className:"text-sm text-gray-400",children:"请确认数量变更"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1510,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1508,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1502,columnNumber:13},void 0),m.jsxDEV("div",{className:"mb-6",children:[m.jsxDEV("p",{className:"text-gray-300 mb-2",children:"您确定要修改以下工时记录的数量吗？"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1515,columnNumber:15},void 0),m.jsxDEV("div",{className:"bg-gray-700 border border-gray-600 p-3 rounded-lg",children:m.jsxDEV("div",{className:"text-sm",children:[m.jsxDEV("div",{className:"flex justify-between mb-1",children:[m.jsxDEV("span",{className:"text-gray-400",children:"员工姓名:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1521,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:H.userName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1522,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1520,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between mb-1",children:[m.jsxDEV("span",{className:"text-gray-400",children:"工作日期:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1525,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:H.workDate},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1526,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1524,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between mb-1",children:[m.jsxDEV("span",{className:"text-gray-400",children:"工时项目:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1529,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:H.itemName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1530,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1528,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"数量变更:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1533,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-yellow-300",children:[H.originalQuantity," ",H.unit," → ",H.newQuantity," ",H.unit]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1534,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1532,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1519,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1518,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1514,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex justify-end gap-3",children:[m.jsxDEV("button",{onClick:()=>{K(!1),P(null)},className:"px-4 py-2 text-gray-300 hover:text-gray-100 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1544,columnNumber:15},void 0),m.jsxDEV("button",{onClick:async()=>{if(H)try{let e=null;for(const r of k){const m=r.allItems.find(e=>e.id===H.itemId);if(m){e=m;break}}if(!e)return void N.error("找不到对应的工时项目");const m=e.unit_price||0,t=H.newQuantity*m,{error:s}=await v.rpc("update_timesheet_item_with_user",{item_id:H.itemId,new_quantity:H.newQuantity,new_amount:t,modifier_id:(null==p?void 0:p.id)||null,modifier_name:(null==p?void 0:p.name)||"未知用户"});if(s)throw s;N.success("数量修改成功"),B(null),R(0),T(0),K(!1),P(null),ve()}catch(e){N.error("修改数量失败，请重试")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1555,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1554,columnNumber:17},void 0),"确认修改"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1550,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1543,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1501,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1500,columnNumber:9},void 0),G&&Y&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-6 w-full max-w-md",children:[m.jsxDEV("div",{className:"flex items-center gap-3 mb-4",children:[m.jsxDEV("div",{className:"flex-shrink-0 w-10 h-10 bg-red-900 rounded-full flex items-center justify-center",children:m.jsxDEV("svg",{className:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1571,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1570,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1569,columnNumber:15},void 0),m.jsxDEV("div",{children:[m.jsxDEV("h3",{className:"text-lg font-semibold text-gray-100",children:"确认删除"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1575,columnNumber:17},void 0),m.jsxDEV("p",{className:"text-sm text-gray-400",children:"此操作不可恢复"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1576,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1574,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1568,columnNumber:13},void 0),m.jsxDEV("div",{className:"mb-6",children:[m.jsxDEV("p",{className:"text-gray-300 mb-2",children:"您确定要删除以下工时记录项吗？"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1581,columnNumber:15},void 0),m.jsxDEV("div",{className:"bg-gray-700 border border-gray-600 p-3 rounded-lg",children:m.jsxDEV("div",{className:"text-sm",children:[m.jsxDEV("div",{className:"flex justify-between mb-1",children:[m.jsxDEV("span",{className:"text-gray-400",children:"员工姓名:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1587,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:Y.userName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1588,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1586,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between mb-1",children:[m.jsxDEV("span",{className:"text-gray-400",children:"工作日期:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1591,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:Y.workDate},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1592,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1590,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"工时项目:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1595,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:Y.itemName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1596,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1594,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1585,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1584,columnNumber:15},void 0),m.jsxDEV("p",{className:"text-red-400 text-sm mt-3 flex items-center gap-1",children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1602,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1601,columnNumber:17},void 0),"删除后数据将无法恢复，请谨慎操作"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1600,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1580,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex justify-end gap-3",children:[m.jsxDEV("button",{onClick:()=>{J(!1),X(null),Z(null)},className:"px-4 py-2 text-gray-300 hover:text-gray-100 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1609,columnNumber:15},void 0),m.jsxDEV("button",{onClick:async()=>{if(U&&Y)try{const{data:e,error:m}=await v.from("timesheet_record_items").select("id").eq("timesheet_record_id",Y.recordId);if(m)throw m;const{error:t}=await v.from("timesheet_record_items").delete().eq("id",U);if(t)return void N.error("删除失败，请重试");if(e&&1===e.length){const{error:e}=await v.from("timesheet_records").delete().eq("id",Y.recordId)}N.success("删除成功"),await ve()}catch(e){N.error("删除失败，请重试")}finally{J(!1),X(null),Z(null)}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1620,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1619,columnNumber:17},void 0),"确认删除"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1615,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1608,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1567,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1566,columnNumber:9},void 0),ne&&ae&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-6 w-full max-w-md",children:[m.jsxDEV("div",{className:"flex items-center gap-3 mb-4",children:[m.jsxDEV("div",{className:"flex-shrink-0 w-10 h-10 bg-yellow-900 rounded-full flex items-center justify-center",children:m.jsxDEV("svg",{className:"w-6 h-6 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1636,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1635,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1634,columnNumber:15},void 0),m.jsxDEV("div",{children:[m.jsxDEV("h3",{className:"text-lg font-semibold text-gray-100",children:"检测到未保存的修改"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1640,columnNumber:17},void 0),m.jsxDEV("p",{className:"text-sm text-gray-400",children:"您有数量修改尚未保存"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1641,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1639,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1633,columnNumber:13},void 0),m.jsxDEV("div",{className:"mb-6",children:[m.jsxDEV("p",{className:"text-gray-300 mb-3",children:"您修改了数量但尚未保存。是否要自动保存修改并继续审核？"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1646,columnNumber:15},void 0),m.jsxDEV("div",{className:"bg-gray-700 border border-gray-600 p-3 rounded-lg",children:m.jsxDEV("div",{className:"text-sm",children:[m.jsxDEV("div",{className:"flex justify-between mb-1",children:[m.jsxDEV("span",{className:"text-gray-400",children:"原数量:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1652,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:O},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1653,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1651,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"新数量:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1656,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-green-400",children:W},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1657,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1655,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1650,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1649,columnNumber:15},void 0),m.jsxDEV("p",{className:"text-yellow-400 text-sm mt-3 flex items-center gap-1",children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1663,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1662,columnNumber:17},void 0),'选择"保存并审核"将自动保存修改然后继续审核流程']},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1661,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1645,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex justify-end gap-3",children:[m.jsxDEV("button",{onClick:()=>{ie(!1),oe(null)},className:"px-4 py-2 text-gray-300 hover:text-gray-100 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1670,columnNumber:15},void 0),m.jsxDEV("button",{onClick:async()=>{if(ae&&H)try{L(!0);const{error:e}=await v.from("timesheet_record_items").update({quantity:W,updated_at:(new Date).toISOString()}).eq("id",Q);if(e)return void N.error("保存数量修改失败，请重试");if(B(null),R(0),T(0),K(!1),P(null),"single"===ae.type&&ae.record){if(!(await pe([ae.record.id],"approved")))return;const e={timesheet_record_id:ae.record.id,approver_id:null==p?void 0:p.id,approver_type:"supervisor",action:"approved",comment:ae.comment||"",created_at:(new Date).toISOString()};if(!(await ge([e])))return;te(!1),E(null),_("")}else if("grouped"===ae.type&&ae.groupedRecord){const e=ae.groupedRecord.originalRecords.map(e=>e.id);if(!(await pe(e,"approved")))return;const m=e.map(e=>({timesheet_record_id:e,approver_id:null==p?void 0:p.id,approver_type:"supervisor",action:"approved",comment:ae.comment||null,created_at:(new Date).toISOString()}));if(!(await ge(m)))return;ee(new Set)}N.success("保存并审核成功"),ve()}catch(e){N.error("保存并审核失败，请重试")}finally{L(!1),ie(!1),oe(null)}},disabled:C,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:C?m.jsxDEV(m.Fragment,{children:[m.jsxDEV("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[m.jsxDEV("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1684,columnNumber:23},void 0),m.jsxDEV("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1685,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1683,columnNumber:21},void 0),"处理中..."]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1682,columnNumber:19},void 0):m.jsxDEV(m.Fragment,{children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1692,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1691,columnNumber:21},void 0),"保存并审核"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1690,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1676,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1669,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1632,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1631,columnNumber:9},void 0),le&&ce&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-6 w-full max-w-md",children:[m.jsxDEV("div",{className:"flex items-center gap-3 mb-4",children:[m.jsxDEV("div",{className:"flex-shrink-0 w-10 h-10 bg-orange-900 rounded-full flex items-center justify-center",children:m.jsxDEV("svg",{className:"w-6 h-6 text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1710,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1709,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1708,columnNumber:15},void 0),m.jsxDEV("div",{children:[m.jsxDEV("h3",{className:"text-lg font-semibold text-gray-100",children:"检测到未保存的修改"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1714,columnNumber:17},void 0),m.jsxDEV("p",{className:"text-sm text-gray-400",children:"您有数量修改尚未保存"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1715,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1713,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1707,columnNumber:13},void 0),m.jsxDEV("div",{className:"mb-6",children:[m.jsxDEV("p",{className:"text-gray-300 mb-3",children:"您修改了数量但尚未保存。请选择如何处理这个未保存的修改："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1720,columnNumber:15},void 0),m.jsxDEV("div",{className:"bg-gray-700 border border-gray-600 p-3 rounded-lg",children:[m.jsxDEV("h4",{className:"font-medium text-gray-200 mb-3",children:"未保存的修改项目："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1724,columnNumber:17},void 0),m.jsxDEV("div",{className:"space-y-2 text-sm",children:[m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"项目："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1728,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:ce.itemName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1729,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1727,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"用户："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1733,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:ce.userName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1734,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1732,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"日期："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1738,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:ce.workDate},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1739,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1737,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between items-center pt-2 border-t border-gray-600",children:[m.jsxDEV("span",{className:"text-gray-400",children:"数量变更："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1743,columnNumber:21},void 0),m.jsxDEV("div",{className:"flex items-center space-x-2",children:[m.jsxDEV("span",{className:"text-gray-300",children:ce.originalQuantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1745,columnNumber:23},void 0),m.jsxDEV("span",{className:"text-orange-400",children:"→"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1746,columnNumber:23},void 0),m.jsxDEV("span",{className:"font-medium text-orange-400",children:ce.newQuantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1747,columnNumber:23},void 0),m.jsxDEV("span",{className:"text-gray-400 text-xs",children:ce.unit},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1748,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1744,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1742,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1726,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1723,columnNumber:15},void 0),m.jsxDEV("p",{className:"text-orange-400 text-sm mt-3 flex items-center gap-1",children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1755,columnNumber:20},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1754,columnNumber:18},void 0),'选择"保存修改"将自动保存修改然后继续审核流程']},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1753,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1719,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex justify-end gap-3",children:[m.jsxDEV("button",{onClick:()=>{ue(!1),de(null)},className:"px-4 py-2 text-gray-300 hover:text-gray-100 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1762,columnNumber:15},void 0),m.jsxDEV("button",{onClick:async()=>{if(ce)try{L(!0);const{error:e}=await v.from("timesheet_record_items").update({quantity:ce.newQuantity,updated_at:(new Date).toISOString()}).eq("id",ce.itemId);if(e)return void N.error("保存数量修改失败，请重试");B(null),R(0),T(0),ue(!1);const m=ce.pendingApprovalData;if("single"===m.type&&m.record){if(!(await pe([m.record.id],"approved")))return;const e={timesheet_record_id:m.record.id,approver_id:null==p?void 0:p.id,approver_type:"supervisor",action:"approved",comment:m.comment||"",created_at:(new Date).toISOString()};if(!(await ge([e])))return;te(!1),E(null),_("")}else if("grouped"===m.type&&m.groupedRecord){const e=m.groupedRecord.originalRecords.map(e=>e.id);if(!(await pe(e,"approved")))return;const t=e.map(e=>({timesheet_record_id:e,approver_id:null==p?void 0:p.id,approver_type:"supervisor",action:"approved",comment:m.comment||null,created_at:(new Date).toISOString()}));if(!(await ge(t)))return;ee(new Set)}N.success("保存并审核成功"),ve()}catch(e){N.error("保存并审核失败，请重试")}finally{L(!1),de(null)}},disabled:C,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:C?m.jsxDEV(m.Fragment,{children:[m.jsxDEV("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[m.jsxDEV("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1776,columnNumber:23},void 0),m.jsxDEV("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1777,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1775,columnNumber:21},void 0),"处理中..."]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1774,columnNumber:19},void 0):m.jsxDEV(m.Fragment,{children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1784,columnNumber:24},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1783,columnNumber:21},void 0),"保存修改"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1782,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1768,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1761,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1706,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1705,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SupervisorApproval.tsx",lineNumber:1231,columnNumber:5},void 0)}},Symbol.toStringTag,{value:"Module"})),f=e=>e?new Date(e).toISOString().split("T")[0]:"",w=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{user:b}=g(),w=x(),[k,S]=e.useState([]),[j,D]=e.useState([]),[A,E]=e.useState(!0),[V,_]=e.useState(null),[C,L]=e.useState(""),[I,z]=e.useState(!1),[M,q]=e.useState([]),[Q,B]=e.useState(!1),[W,R]=e.useState(null),[O,T]=e.useState(0),[F,K]=e.useState(0),[H,P]=e.useState(new Set),[G,J]=e.useState(!1),[U,X]=e.useState(null),[Y,Z]=e.useState(!1),[$,ee]=e.useState(null),[me,te]=e.useState(!1),[se,re]=e.useState(!1),[ne,ie]=e.useState(!1),[ae,oe]=e.useState(null),[le,ue]=e.useState(!1),[ce,de]=e.useState(null);e.useEffect(()=>{ve()},[]);const he=new Map,pe=async(e,m)=>{try{const{error:t}=await v.from("timesheet_records").update({status:m,updated_at:(new Date).toISOString()}).in("id",e);return!t||(N.error("更新记录状态失败"),!1)}catch(t){return N.error("更新记录状态失败"),!1}},ge=async e=>{try{const{error:m}=await v.from("approval_history").insert(e);return!m||(N.error("插入审核历史失败"),!1)}catch(m){return N.error("插入审核历史失败"),!1}},ve=async()=>{var e;if(b)try{E(!0);let m=v.from("timesheet_records").select("\n          *,\n          supervisor:supervisor_id(id, name),\n          section_chief:section_chief_id(id, name),\n          user:user_id(id, name, phone),\n          timesheet_record_items(*, processes(unit_price))\n        ").eq("status","approved");"超级管理员"!==(null==(e=b.role)?void 0:e.name)&&(m=m.eq("section_chief_id",b.id));const{data:t,error:s}=await m.order("created_at",{ascending:!1});if(s)throw s;const r=(null==t?void 0:t.flatMap(e=>e.timesheet_record_items||[]))||[],n=[...new Set(r.map(e=>e.process_id).filter(Boolean))],i=n.filter(e=>!he.has(e));if(i.length>0){const{data:e,error:m}=await v.from("processes").select("id, product_process, product_name, production_category, production_line").in("id",i);m||(e||[]).forEach(e=>{he.set(e.id,e)})}const a=n.map(e=>he.get(e)).filter(Boolean),o=new Map(a.map(e=>[e.id,e])),l=((null==t?void 0:t.map(e=>{const m=e.timesheet_record_items||[],t=m.length>0?o.get(m[0].process_id):null,s=t?{name:t.production_line}:{name:"未知生产线"};return{...e,production_line:s,user:{name:e.user_name||(e.user?e.user.name:"未知用户"),phone:e.user?e.user.phone:""},supervisor:e.supervisor_name?{id:e.supervisor_id,name:e.supervisor_name}:e.supervisor||null,section_chief:e.section_chief_name?{id:e.section_chief_id,name:e.section_chief_name}:e.section_chief||null,items:m.map(e=>{var m;const t=o.get(e.process_id),s=(null==(m=e.processes)?void 0:m.unit_price)||0,r=e.quantity*s;return{id:e.id,work_type:{name:(null==t?void 0:t.production_category)||"未知工时类型"},product:{name:(null==t?void 0:t.product_name)||"未知产品",code:""},process:{name:(null==t?void 0:t.product_process)||"未知工序"},quantity:e.quantity,unit:e.unit||"件",unit_price:s,amount:r}})}}))||[]).filter(e=>e.items&&e.items.length>0);S(l);const u=(e=>{const m=new Map;e.forEach(e=>{const t="".concat(e.user_id,"_").concat(e.work_date),s=m.get(t);s?s.push(e):m.set(t,[e])});const t=[];return m.forEach((e,m)=>{const s=e[0];let r=[],n=new Date(s.updated_at).getTime();e.forEach(e=>{r=r.concat(e.items);const m=new Date(e.updated_at).getTime();m>n&&(n=m)}),r.length>0&&t.push({groupKey:m,user_id:s.user_id,work_date:s.work_date,user:s.user,production_line:s.production_line,supervisor:s.supervisor,section_chief:s.section_chief,originalRecords:e,totalItems:r.length,allItems:r,status:s.status,created_at:s.created_at,updated_at:n.toString()})}),t.sort((e,m)=>{const t=new Date(e.created_at).getTime();return new Date(m.created_at).getTime()-t})})(l);D(u)}catch(m){N.error("获取待审核记录失败")}finally{E(!1)}},Ne=async(e,m)=>{if(W){const t=ye();if(t)return de({itemId:W,itemName:t.itemName,userName:t.userName,workDate:t.workDate,originalQuantity:F,newQuantity:O,unit:t.item.unit,pendingApprovalData:{type:"grouped",groupedRecord:e,comment:m}}),void ue(!0)}try{z(!0);const t=e.originalRecords.map(e=>e.id);if(!(await pe(t,"section_chief_approved")))return;const s=t.map(e=>({timesheet_record_id:e,approver_id:null==b?void 0:b.id,approver_type:"section_chief",action:"approved",comment:m||null,created_at:(new Date).toISOString()}));if(!(await ge(s)))return;N.success("审核通过成功"),ve(),P(new Set)}catch(t){N.error("审核操作失败，请重试")}finally{z(!1)}},xe=()=>{R(null),T(0)},ye=()=>{var e,m,t,s;if(!W)return null;for(const r of j){const n=r.allItems.find(e=>e.id===W);if(n)return{item:n,groupedRecord:r,itemName:"".concat((null==(e=n.work_type)?void 0:e.name)||"未知类型"," | ").concat((null==(m=n.product)?void 0:m.name)||"未知产品"," | ").concat((null==(t=n.process)?void 0:t.name)||"未知工序"),userName:(null==(s=r.user)?void 0:s.name)||"未知用户",workDate:r.work_date}}return null},[be,fe]=e.useState(null),we=e=>{switch(e){case"pending":return"text-yellow-600 bg-yellow-50";case"approved":case"section_chief_approved":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},ke=e=>{switch(e){case"pending":return"待审核";case"approved":return"班长已通过";case"section_chief_approved":return"段长已通过";default:return"草稿"}};return A?m.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:m.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1227,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1226,columnNumber:7},void 0):m.jsxDEV("div",{className:"min-h-screen bg-black text-green-400 font-mono",children:[m.jsxDEV("div",{className:"max-w-6xl mx-auto px-3 py-4",children:[m.jsxDEV("div",{className:"mb-4",children:[m.jsxDEV("div",{className:"flex justify-between items-center mb-3",children:[m.jsxDEV("div",{className:"flex items-center",children:[m.jsxDEV(p,{className:"w-6 h-6 text-green-400 mr-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1241,columnNumber:15},void 0),m.jsxDEV("h1",{className:"text-2xl font-bold text-green-400 font-mono",children:"段长审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1242,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1240,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV("button",{onClick:async()=>{re(!0);try{await ve(),N.success("数据刷新成功")}catch(e){N.error("刷新数据失败，请重试")}finally{re(!1)}},disabled:se,className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 disabled:from-gray-700 disabled:to-gray-800 text-green-300 hover:text-green-200 disabled:text-gray-400 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 disabled:border-gray-600",children:[m.jsxDEV(s,{className:"w-4 h-4 ".concat(se?"animate-spin":"")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1250,columnNumber:17},void 0),m.jsxDEV("span",{className:"hidden sm:inline",children:se?"刷新中...":"刷新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1251,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1245,columnNumber:15},void 0),m.jsxDEV(y,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[m.jsxDEV(r,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1257,columnNumber:17},void 0),m.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1258,columnNumber:17},void 0),m.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1259,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1253,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1244,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1239,columnNumber:11},void 0),m.jsxDEV("div",{className:"h-0.5 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1263,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1238,columnNumber:9},void 0),m.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-3 mb-4",children:m.jsxDEV("div",{className:"flex items-center gap-3",children:[m.jsxDEV("span",{className:"text-green-300 font-mono text-base bg-gray-800 px-2 py-1 rounded",children:[j.length," 条记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1269,columnNumber:13},void 0),H.size>0&&m.jsxDEV("span",{className:"text-green-400 font-mono text-base",children:["已选择 ",H.size," 条"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1273,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1268,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1267,columnNumber:9},void 0),0===j.length?m.jsxDEV("div",{className:"text-center py-8",children:[m.jsxDEV(n,{className:"w-12 h-12 text-green-600 mx-auto mb-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1282,columnNumber:13},void 0),m.jsxDEV("h3",{className:"text-lg font-medium text-green-400 mb-2 font-mono",children:"暂无待审核记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1283,columnNumber:13},void 0),m.jsxDEV("p",{className:"text-green-600 font-mono text-sm",children:"当前没有需要段长审核的工时记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1284,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1281,columnNumber:11},void 0):m.jsxDEV("div",{className:"space-y-3",children:j.map(e=>m.jsxDEV("div",{className:"border border-green-400 bg-gray-800 rounded-lg p-4 hover:bg-gray-700 transition-all duration-200",children:[m.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[m.jsxDEV("div",{className:"flex items-center gap-3",children:[m.jsxDEV("input",{type:"checkbox",checked:H.has(e.groupKey),onChange:()=>(e=>{const m=new Set(H);m.has(e)?m.delete(e):m.add(e),P(m)})(e.groupKey),className:"w-4 h-4 text-green-600 border-green-400 rounded focus:ring-green-500 bg-gray-700 flex-shrink-0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1293,columnNumber:21},void 0),m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV(i,{className:"w-4 h-4 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1300,columnNumber:23},void 0),m.jsxDEV("span",{className:"font-medium text-green-300 font-mono",children:e.user.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1301,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1299,columnNumber:21},void 0),m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV(a,{className:"w-4 h-4 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1304,columnNumber:23},void 0),m.jsxDEV("span",{className:"text-green-300 font-mono text-base",children:f(e.work_date)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1305,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1303,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1292,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex items-center gap-2",children:m.jsxDEV("span",{className:"px-2 py-1 rounded text-xs font-medium font-mono ".concat(we(e.status)),children:ke(e.status)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1309,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1308,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1291,columnNumber:17},void 0),m.jsxDEV("div",{className:"grid grid-cols-1 gap-2 mb-3 text-base",children:m.jsxDEV("div",{className:"flex items-center gap-1",children:m.jsxDEV("span",{className:"text-green-400 font-mono text-sm",children:["共 ",e.totalItems," 项"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1318,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1317,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1316,columnNumber:17},void 0),m.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 mb-3",children:e.allItems.map(t=>{var s,r,n,i;return m.jsxDEV("div",{className:"bg-gray-700 border border-green-500 rounded p-2 hover:bg-gray-600 transition-colors",children:[m.jsxDEV("div",{className:"mb-1.5",children:[m.jsxDEV("div",{className:"text-green-200 font-mono text-sm font-medium leading-tight",children:"".concat((null==(s=t.work_type)?void 0:s.name)||"未知类型"," | ").concat((null==(r=t.product)?void 0:r.name)||"未知产品"," | ").concat((null==(n=t.process)?void 0:n.name)||"未知工序")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1328,columnNumber:25},void 0),(null==(i=t.product)?void 0:i.code)&&m.jsxDEV("div",{className:"text-green-500 font-mono text-sm mt-0.5",children:["编码: ",t.product.code]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1332,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1327,columnNumber:23},void 0),m.jsxDEV("div",{className:"flex items-center justify-between",children:[m.jsxDEV("div",{className:"text-green-200 font-mono text-sm font-medium",children:W===t.id?m.jsxDEV("div",{className:"flex items-center gap-1",children:[m.jsxDEV("input",{type:"number",value:O,onChange:e=>T(Number(e.target.value)),onWheel:e=>e.preventDefault(),className:"w-16 px-2 py-1 bg-gray-600 border border-green-400 rounded text-green-300 font-mono text-sm [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",min:"1"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1341,columnNumber:31},void 0),m.jsxDEV("span",{className:"text-green-300 text-sm",children:t.unit},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1349,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1340,columnNumber:29},void 0):"".concat(t.quantity," ").concat(t.unit)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1338,columnNumber:25},void 0),m.jsxDEV("div",{className:"flex items-center gap-0.5",children:W===t.id?m.jsxDEV(m.Fragment,{children:[m.jsxDEV("button",{onClick:()=>((e,m)=>{var t,s,r,n;if(O<=0)return void N.error("数量必须大于0");const i=(null==(t=e.work_type)?void 0:t.name)||"",a=i.includes("生产");if(a&&!Number.isInteger(O))return void N.error("生产工时数量必须为整数");if(!a&&O<0)return void N.error("非生产工时数量不能为负数");const o="".concat((null==(s=e.work_type)?void 0:s.name)||"未知类型"," | ").concat((null==(r=e.product)?void 0:r.name)||"未知产品"," | ").concat((null==(n=e.process)?void 0:n.name)||"未知工序");ee({itemId:e.id,itemName:o,userName:m.user.name,workDate:m.work_date,originalQuantity:F,newQuantity:O,unit:e.unit,workType:i}),Z(!0)})(t,e),className:"p-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center",title:"确认保存",children:m.jsxDEV(o,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1363,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1358,columnNumber:31},void 0),m.jsxDEV("button",{onClick:xe,className:"p-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center",title:"取消",children:m.jsxDEV(l,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1370,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1365,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1357,columnNumber:29},void 0):m.jsxDEV(m.Fragment,{children:[m.jsxDEV("button",{onClick:()=>(e=>{if(W&&O!==F){const m=ye();if(m){const t=j.find(m=>m.allItems.some(m=>m.id===e.id));if(t)return de({itemId:W,itemName:m.itemName,userName:m.userName,workDate:m.workDate,originalQuantity:F,newQuantity:O,unit:m.item.unit,pendingApprovalData:{type:"edit_switch",newEditTarget:{item:e,groupedRecord:t}}}),void ue(!0)}}R(e.id),T(e.quantity),K(e.quantity)})(t),className:"p-2 text-blue-400 hover:text-blue-300 transition-colors rounded-md hover:bg-blue-400/10 min-w-[44px] min-h-[44px] flex items-center justify-center",title:"编辑数量",children:m.jsxDEV(u,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1380,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1375,columnNumber:31},void 0),m.jsxDEV("button",{onClick:()=>{var m,s,r,n;const i="".concat((null==(m=t.work_type)?void 0:m.name)||"未知工时类型"," | ").concat((null==(s=t.product)?void 0:s.name)||"未知产品"," | ").concat((null==(r=t.process)?void 0:r.name)||"未知工序");((e,m,t,s)=>{X({itemId:e,itemName:m,userName:t,workDate:s}),J(!0)})(t.id,i,(null==(n=null==e?void 0:e.user)?void 0:n.name)||"未知用户",(null==e?void 0:e.work_date)||"未知日期")},className:"p-2 text-red-400 hover:text-red-300 transition-colors rounded-md hover:bg-red-400/10 min-w-[44px] min-h-[44px] flex items-center justify-center",title:"删除",children:m.jsxDEV(c,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1395,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1382,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1374,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1355,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1337,columnNumber:23},void 0)]},t.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1325,columnNumber:21},void 0)})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1323,columnNumber:17},void 0)]},e.groupKey,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1289,columnNumber:15},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1287,columnNumber:11},void 0),H.size>0&&m.jsxDEV("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-green-400 p-4 z-40",children:m.jsxDEV("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[m.jsxDEV("span",{className:"text-green-400 font-mono text-sm",children:["已选择 ",H.size," 条记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1413,columnNumber:15},void 0),m.jsxDEV("div",{className:"flex items-center gap-3",children:[m.jsxDEV("button",{onClick:()=>P(new Set),className:"px-4 py-2 bg-gray-600 text-white font-medium rounded hover:bg-gray-700 font-mono",children:"取消选择"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1417,columnNumber:17},void 0),m.jsxDEV("button",{onClick:async()=>{if(0!==H.size){if(W){const e=ye();if(e)return de({itemId:W,itemName:e.itemName,userName:e.userName,workDate:e.workDate,originalQuantity:F,newQuantity:O,unit:e.item.unit,pendingApprovalData:{type:"batch",selectedRecords:Array.from(H)}}),void ue(!0)}z(!0);try{const e=j.filter(e=>H.has(e.groupKey));for(const m of e)await Ne(m,"");N.success("成功审核通过 ".concat(e.length," 条记录")),P(new Set),w("/")}catch(e){N.error("批量审核失败，请重试")}finally{z(!1)}}else N.error("请先选择要审核的记录")},disabled:I,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white font-medium rounded hover:bg-green-700 disabled:opacity-50 font-mono",children:[m.jsxDEV(t,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1428,columnNumber:19},void 0),I?"处理中...":"通过审核"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1423,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1416,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1412,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1411,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1236,columnNumber:7},void 0),Y&&$&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-6 max-w-md w-full mx-4",children:[m.jsxDEV("div",{className:"flex items-center mb-4",children:[m.jsxDEV(u,{className:"w-6 h-6 text-blue-400 mr-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1444,columnNumber:15},void 0),m.jsxDEV("h3",{className:"text-lg font-semibold text-green-400 font-mono",children:"确认修改数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1445,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1443,columnNumber:13},void 0),m.jsxDEV("div",{className:"mb-4 text-green-300 font-mono text-sm",children:[m.jsxDEV("p",{children:"您确定要修改以下工时记录的数量吗？"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1449,columnNumber:15},void 0),m.jsxDEV("div",{className:"mt-3 p-3 bg-gray-700 rounded border border-green-500",children:[m.jsxDEV("div",{className:"text-green-200",children:["员工姓名：",$.userName]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1451,columnNumber:17},void 0),m.jsxDEV("div",{className:"text-green-200",children:["工作日期：",$.workDate]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1452,columnNumber:17},void 0),m.jsxDEV("div",{className:"text-green-200",children:["工时项目：",$.itemName]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1453,columnNumber:17},void 0),m.jsxDEV("div",{className:"text-yellow-300",children:["数量变更：",$.originalQuantity," ",$.unit," → ",$.newQuantity," ",$.unit]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1454,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1450,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1448,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex justify-end space-x-3",children:[m.jsxDEV("button",{onClick:()=>{Z(!1),ee(null)},className:"px-4 py-2 bg-gray-600 hover:bg-gray-500 text-green-300 rounded font-mono transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1459,columnNumber:15},void 0),m.jsxDEV("button",{onClick:async()=>{if($)try{let e=null;for(const r of j){const m=r.allItems.find(e=>e.id===$.itemId);if(m){e=m;break}}if(!e)return void N.error("找不到对应的工时项目");const m=e.unit_price||0,t=$.newQuantity*m,{error:s}=await v.rpc("update_timesheet_item_with_user",{item_id:$.itemId,new_quantity:$.newQuantity,new_amount:t,modifier_id:(null==b?void 0:b.id)||null,modifier_name:(null==b?void 0:b.name)||"未知用户"});if(s)throw s;N.success("数量修改成功"),R(null),T(0),K(0),Z(!1),ee(null),ve()}catch(e){N.error("修改数量失败，请重试")}},className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded font-mono transition-colors",children:"✓ 确认修改"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1465,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1458,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1442,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1441,columnNumber:9},void 0),G&&U&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-6 w-full max-w-md",children:[m.jsxDEV("div",{className:"flex items-center gap-3 mb-4",children:[m.jsxDEV("div",{className:"flex-shrink-0 w-10 h-10 bg-red-900 rounded-full flex items-center justify-center",children:m.jsxDEV("svg",{className:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1483,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1482,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1481,columnNumber:15},void 0),m.jsxDEV("div",{children:[m.jsxDEV("h3",{className:"text-lg font-semibold text-gray-100",children:"确认删除"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1487,columnNumber:17},void 0),m.jsxDEV("p",{className:"text-sm text-gray-400",children:"此操作不可恢复"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1488,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1486,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1480,columnNumber:13},void 0),m.jsxDEV("div",{className:"mb-6",children:[m.jsxDEV("p",{className:"text-gray-300 mb-2",children:"您确定要删除以下工时记录项吗？"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1493,columnNumber:15},void 0),m.jsxDEV("div",{className:"bg-gray-700 border border-gray-600 p-3 rounded-lg",children:m.jsxDEV("div",{className:"text-sm",children:[m.jsxDEV("div",{className:"flex justify-between mb-1",children:[m.jsxDEV("span",{className:"text-gray-400",children:"员工姓名:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1499,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:U.userName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1500,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1498,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between mb-1",children:[m.jsxDEV("span",{className:"text-gray-400",children:"工作日期:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1503,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:f(U.workDate)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1504,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1502,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"工时项目:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1507,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:U.itemName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1508,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1506,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1497,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1496,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1492,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex justify-end gap-3",children:[m.jsxDEV("button",{onClick:()=>{J(!1),X(null)},className:"px-4 py-2 text-gray-300 hover:text-gray-100 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1516,columnNumber:15},void 0),m.jsxDEV("button",{onClick:async()=>{if(U)try{const{data:e,error:m}=await v.from("timesheet_record_items").select("timesheet_record_id").eq("id",U.itemId).single();if(m)throw m;const{error:t}=await v.from("timesheet_record_items").delete().eq("id",U.itemId);if(t)throw t;const{data:s,error:r}=await v.from("timesheet_record_items").select("id").eq("timesheet_record_id",e.timesheet_record_id);if(r)throw r;if(0===s.length){const{error:m}=await v.from("timesheet_records").delete().eq("id",e.timesheet_record_id);if(m)throw m}N.success("记录项删除成功"),J(!1),X(null),ve()}catch(e){N.error("删除记录项失败，请重试")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1527,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1526,columnNumber:17},void 0),"确认删除"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1522,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1515,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1479,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1478,columnNumber:9},void 0),ne&&ae&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-6 w-full max-w-md",children:[m.jsxDEV("div",{className:"flex items-center gap-3 mb-4",children:[m.jsxDEV("div",{className:"flex-shrink-0 w-10 h-10 bg-yellow-900 rounded-full flex items-center justify-center",children:m.jsxDEV("svg",{className:"w-6 h-6 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1543,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1542,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1541,columnNumber:15},void 0),m.jsxDEV("div",{children:[m.jsxDEV("h3",{className:"text-lg font-semibold text-gray-100",children:"检测到未保存的修改"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1547,columnNumber:17},void 0),m.jsxDEV("p",{className:"text-sm text-gray-400",children:"您有数量修改尚未保存"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1548,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1546,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1540,columnNumber:13},void 0),m.jsxDEV("div",{className:"mb-6",children:[m.jsxDEV("p",{className:"text-gray-300 mb-3",children:"您修改了数量但尚未保存。是否要自动保存修改并继续审核？"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1553,columnNumber:15},void 0),m.jsxDEV("div",{className:"bg-gray-700 border border-gray-600 p-3 rounded-lg",children:m.jsxDEV("div",{className:"text-sm",children:[m.jsxDEV("div",{className:"flex justify-between mb-1",children:[m.jsxDEV("span",{className:"text-gray-400",children:"原数量:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1559,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:F},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1560,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1558,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"新数量:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1563,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-green-400",children:O},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1564,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1562,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1557,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1556,columnNumber:15},void 0),m.jsxDEV("p",{className:"text-yellow-400 text-sm mt-3 flex items-center gap-1",children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1570,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1569,columnNumber:17},void 0),'选择"保存并审核"将自动保存修改然后继续审核流程']},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1568,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1552,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex justify-end gap-3",children:[m.jsxDEV("button",{onClick:()=>{ie(!1),oe(null)},className:"px-4 py-2 text-gray-300 hover:text-gray-100 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1577,columnNumber:15},void 0),m.jsxDEV("button",{onClick:async()=>{if(ae&&$)try{z(!0);let e=null;for(const r of j){const m=r.allItems.find(e=>e.id===$.itemId);if(m){e=m;break}}if(!e)return void N.error("找不到对应的工时项目");const m=e.unit_price||0,t=$.newQuantity*m,{error:s}=await v.rpc("update_timesheet_item_with_user",{item_id:$.itemId,new_quantity:$.newQuantity,new_amount:t,modifier_id:(null==b?void 0:b.id)||null,modifier_name:(null==b?void 0:b.name)||"未知用户"});if(s)return void N.error("保存数量修改失败，请重试");if(R(null),T(0),K(0),Z(!1),ee(null),"single"===ae.type&&ae.record){if(!(await pe([ae.record.id],"section_chief_approved")))return;const e={timesheet_record_id:ae.record.id,approver_id:null==b?void 0:b.id,approver_type:"section_chief",action:"approved",comment:ae.comment||"",created_at:(new Date).toISOString()};if(!(await ge([e])))return;te(!1),_(null),L("")}else if("grouped"===ae.type&&ae.groupedRecord){const e=ae.groupedRecord.originalRecords.map(e=>e.id);if(!(await pe(e,"section_chief_approved")))return;const m=e.map(e=>({timesheet_record_id:e,approver_id:null==b?void 0:b.id,approver_type:"section_chief",action:"approved",comment:ae.comment||null,created_at:(new Date).toISOString()}));if(!(await ge(m)))return;P(new Set)}N.success("保存并审核成功"),ve()}catch(e){N.error("保存并审核失败，请重试")}finally{z(!1),ie(!1),oe(null)}},disabled:I,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:I?m.jsxDEV(m.Fragment,{children:[m.jsxDEV("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[m.jsxDEV("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1591,columnNumber:23},void 0),m.jsxDEV("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1592,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1590,columnNumber:21},void 0),"处理中..."]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1589,columnNumber:19},void 0):m.jsxDEV(m.Fragment,{children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1599,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1598,columnNumber:21},void 0),"保存并审核"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1597,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1583,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1576,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1539,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1538,columnNumber:9},void 0),le&&ce&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-6 w-full max-w-md",children:[m.jsxDEV("div",{className:"flex items-center gap-3 mb-4",children:[m.jsxDEV("div",{className:"flex-shrink-0 w-10 h-10 bg-orange-900 rounded-full flex items-center justify-center",children:m.jsxDEV("svg",{className:"w-6 h-6 text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1617,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1616,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1615,columnNumber:15},void 0),m.jsxDEV("div",{children:[m.jsxDEV("h3",{className:"text-lg font-semibold text-gray-100",children:"检测到未保存的修改"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1621,columnNumber:17},void 0),m.jsxDEV("p",{className:"text-sm text-gray-400",children:"您有数量修改尚未保存"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1622,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1620,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1614,columnNumber:13},void 0),m.jsxDEV("div",{className:"mb-6",children:[m.jsxDEV("p",{className:"text-gray-300 mb-3",children:"您修改了数量但尚未保存。请选择如何处理这个未保存的修改："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1627,columnNumber:15},void 0),m.jsxDEV("div",{className:"bg-gray-700 border border-gray-600 p-3 rounded-lg",children:[m.jsxDEV("h4",{className:"font-medium text-gray-200 mb-3",children:"未保存的修改项目："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1631,columnNumber:17},void 0),m.jsxDEV("div",{className:"space-y-2 text-sm",children:[m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"项目："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1635,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:ce.itemName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1636,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1634,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"用户："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1640,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:ce.userName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1641,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1639,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between",children:[m.jsxDEV("span",{className:"text-gray-400",children:"日期："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1645,columnNumber:21},void 0),m.jsxDEV("span",{className:"font-medium text-gray-200",children:ce.workDate},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1646,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1644,columnNumber:19},void 0),m.jsxDEV("div",{className:"flex justify-between items-center pt-2 border-t border-gray-600",children:[m.jsxDEV("span",{className:"text-gray-400",children:"数量变更："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1650,columnNumber:21},void 0),m.jsxDEV("div",{className:"flex items-center space-x-2",children:[m.jsxDEV("span",{className:"text-gray-300",children:ce.originalQuantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1652,columnNumber:23},void 0),m.jsxDEV("span",{className:"text-orange-400",children:"→"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1653,columnNumber:23},void 0),m.jsxDEV("span",{className:"font-medium text-orange-400",children:ce.newQuantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1654,columnNumber:23},void 0),m.jsxDEV("span",{className:"text-gray-400 text-xs",children:ce.unit},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1655,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1651,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1649,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1633,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1630,columnNumber:15},void 0),m.jsxDEV("p",{className:"text-orange-400 text-sm mt-3 flex items-center gap-1",children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1662,columnNumber:20},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1661,columnNumber:18},void 0),'选择"保存修改"将自动保存修改然后继续审核流程']},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1660,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1626,columnNumber:13},void 0),m.jsxDEV("div",{className:"flex justify-end gap-3",children:[m.jsxDEV("button",{onClick:()=>{ue(!1),de(null)},className:"px-4 py-2 text-gray-300 hover:text-gray-100 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1669,columnNumber:15},void 0),m.jsxDEV("button",{onClick:async()=>{if(ce)try{z(!0);let e=null;for(const n of j){const m=n.allItems.find(e=>e.id===ce.itemId);if(m){e=m;break}}if(!e)return void N.error("找不到对应的工时项目");const m=e.unit_price||0,t=ce.newQuantity*m,{error:s}=await v.rpc("update_timesheet_item_with_user",{item_id:ce.itemId,new_quantity:ce.newQuantity,new_amount:t,modifier_id:(null==b?void 0:b.id)||null,modifier_name:(null==b?void 0:b.name)||"未知用户"});if(s)return void N.error("保存数量修改失败，请重试");R(null),T(0),K(0),ue(!1);const r=ce.pendingApprovalData;if("edit_switch"===r.type&&r.newEditTarget){const{item:e,groupedRecord:m}=r.newEditTarget;return R(e.id),T(e.quantity),K(e.quantity),N.success("已保存修改，现在可以编辑新项目"),de(null),void z(!1)}N.success("数量修改已保存"),ve()}catch(e){N.error("保存并审核失败，请重试")}finally{z(!1),de(null)}},disabled:I,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:I?m.jsxDEV(m.Fragment,{children:[m.jsxDEV("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[m.jsxDEV("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1683,columnNumber:23},void 0),m.jsxDEV("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1684,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1682,columnNumber:21},void 0),"处理中..."]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1681,columnNumber:19},void 0):m.jsxDEV(m.Fragment,{children:[m.jsxDEV("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1691,columnNumber:24},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1690,columnNumber:21},void 0),"保存修改"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1689,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1675,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1668,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1613,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1612,columnNumber:9},void 0),Q&&V&&m.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:m.jsxDEV("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[m.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[m.jsxDEV("h3",{className:"text-lg font-semibold",children:"审核历史"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1707,columnNumber:15},void 0),m.jsxDEV("button",{onClick:()=>B(!1),className:"text-gray-400 hover:text-gray-600",children:m.jsxDEV(d,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1712,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1708,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1706,columnNumber:13},void 0),m.jsxDEV("div",{className:"space-y-4",children:0===M.length?m.jsxDEV("p",{className:"text-gray-500 text-center py-4",children:"暂无审核历史"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1717,columnNumber:17},void 0):M.map(e=>m.jsxDEV("div",{className:"border border-gray-200 rounded-lg p-4",children:[m.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV("span",{className:"font-medium",children:e.approver.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1723,columnNumber:25},void 0),m.jsxDEV("span",{className:"text-sm text-gray-500",children:["(","supervisor"===e.approver_type?"班长":"段长",")"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1724,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1722,columnNumber:23},void 0),m.jsxDEV("span",{className:"px-2 py-1 rounded text-sm bg-green-100 text-green-800",children:"通过"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1726,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1721,columnNumber:21},void 0),e.comments&&m.jsxDEV("div",{className:"mb-2",children:[m.jsxDEV("div",{className:"flex items-center gap-1 mb-1",children:[m.jsxDEV(h,{className:"w-4 h-4 text-gray-500"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1733,columnNumber:27},void 0),m.jsxDEV("span",{className:"text-sm text-gray-700",children:"审核意见:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1734,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1732,columnNumber:25},void 0),m.jsxDEV("p",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:e.comments},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1736,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1731,columnNumber:23},void 0),m.jsxDEV("div",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1739,columnNumber:21},void 0)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1720,columnNumber:19},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1715,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1705,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1704,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/SectionChiefApproval.tsx",lineNumber:1235,columnNumber:5},void 0)}},Symbol.toStringTag,{value:"Module"}));export{b as S,w as a};
