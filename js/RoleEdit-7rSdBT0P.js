import{a8 as e,r as m,f as s,j as t,T as n,i as r,n as i,v as a,H as o,X as l}from"./react-vendor-DJh0NlN6.js";import{u as h,h as c,s as u,S as d,D as g,P as N}from"./index-DZuSn6T7.js";import"./vendor-BiPrETSv.js";import"./supabase-BfQEXDvU.js";import"./ui-components-C7XcqZ4h.js";function b(){const{id:b}=e(),[x,y]=m.useState(null),[f,p]=m.useState({name:"",permissions:[]}),[E,v]=m.useState(!0),[w,k]=m.useState(!1),[j,D]=m.useState(""),{user:R,loading:V}=h(),S=s();if(m.useEffect(()=>{var e;if(V||R)return R&&(null==(e=R.role)?void 0:e.permissions)&&!c(R,N.ROLE_MANAGE)?(D("您没有权限访问角色管理功能"),void v(!1)):void 0;S("/login")},[R,V,S]),V)return t.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:t.jsxDEV("div",{className:"text-center",children:[t.jsxDEV("div",{className:"text-green-400 text-2xl font-mono mb-4",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:54,columnNumber:11},this),t.jsxDEV("div",{className:"text-green-600 font-mono",children:"正在验证用户身份"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:55,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:53,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:52,columnNumber:7},this);m.useEffect(()=>{var e;R&&(null==(e=R.role)?void 0:e.permissions)&&c(R,N.ROLE_MANAGE)&&b&&_()},[R,b]);const _=async()=>{if(b)try{const{data:e,error:m}=await u.from("user_roles").select("*").eq("id",b).single();if(m)throw m;if(!e)throw new Error("角色不存在");y(e),p({name:e.name,permissions:e.permissions||[]})}catch(e){D(e.message||"获取角色信息失败")}finally{v(!1)}};return E?t.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:t.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:158,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:157,columnNumber:7},this):j?t.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:t.jsxDEV("div",{className:"text-center",children:[t.jsxDEV(n,{className:"w-16 h-16 text-red-400 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:169,columnNumber:11},this),t.jsxDEV("div",{className:"text-red-400 text-xl font-mono mb-4",children:j},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:170,columnNumber:11},this),t.jsxDEV(r,{to:"/role-permissions",className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:"返回角色列表"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:171,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:168,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:167,columnNumber:7},this):x?t.jsxDEV("div",{className:"min-h-screen bg-black text-green-300 p-4 sm:p-6",children:t.jsxDEV("div",{className:"max-w-4xl mx-auto",children:[t.jsxDEV("div",{className:"mb-6",children:t.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[t.jsxDEV("h1",{className:"text-xl sm:text-2xl font-bold text-green-400 font-mono truncate",children:["编辑角色 - ",x.name]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:203,columnNumber:13},this),t.jsxDEV(r,{to:"/role-permissions",className:"flex items-center text-green-400 hover:text-green-300 transition-colors flex-shrink-0 font-mono",children:[t.jsxDEV(i,{className:"h-5 w-5 mr-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:210,columnNumber:15},this),"返回"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:206,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:202,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:201,columnNumber:9},this),j&&t.jsxDEV("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-400/60 rounded text-red-200 text-sm font-mono",children:j},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:217,columnNumber:11},this),t.jsxDEV("form",{onSubmit:async e=>{e.preventDefault(),k(!0),D("");try{if(!b)throw new Error("角色ID不存在");const{data:e}=await u.from("user_roles").select("id").eq("name",f.name).neq("id",b).single();if(e)throw new Error("角色名称已存在");const{data:m,error:s}=await u.from("user_roles").update({name:f.name,permissions:f.permissions,updated_at:(new Date).toISOString()}).eq("id",b).select("*");if(s)throw s;if(!m||0===m.length)throw new Error("更新失败：无法获取更新后的数据，请检查权限设置");S("/role-permissions")}catch(m){D(m.message||"保存失败")}finally{k(!1)}},className:"space-y-4 sm:space-y-6",children:[t.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[t.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"基本信息"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:225,columnNumber:13},this),t.jsxDEV("div",{className:"space-y-4",children:t.jsxDEV("div",{children:[t.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-2",children:"角色名称 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:229,columnNumber:17},this),t.jsxDEV("div",{className:"relative",children:[t.jsxDEV(a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400/70 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:233,columnNumber:19},this),t.jsxDEV("input",{type:"text",value:f.name,onChange:e=>p(m=>({...m,name:e.target.value})),required:!0,className:"w-full pl-10 pr-4 py-2 sm:py-3 bg-black border border-green-400/30 rounded text-green-200 placeholder-green-700 focus:outline-none focus:border-green-400 focus:bg-gray-900/30 font-mono text-sm transition-all",placeholder:"请输入角色名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:234,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:232,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:228,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:227,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:224,columnNumber:11},this),x&&x.name!==d&&t.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[t.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"权限设置"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:252,columnNumber:15},this),t.jsxDEV("div",{className:"space-y-3",children:[t.jsxDEV("div",{className:"text-green-300 font-mono text-sm mb-4",children:"选择该角色可以访问的Dashboard模块："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:255,columnNumber:17},this),t.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:g.map(e=>t.jsxDEV("label",{className:"flex flex-col items-start gap-2 p-3 border border-green-400/20 rounded transition-colors cursor-pointer hover:bg-gray-800/30",children:[t.jsxDEV("div",{className:"flex items-center gap-2",children:[t.jsxDEV("input",{type:"checkbox",checked:f.permissions.includes(e.permission),onChange:()=>{return m=e.permission,void p(e=>({...e,permissions:e.permissions.includes(m)?e.permissions.filter(e=>e!==m):[...e.permissions,m]}));var m},className:"w-4 h-4 text-green-600 bg-black border-green-400 rounded focus:ring-green-500 focus:ring-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:263,columnNumber:25},this),t.jsxDEV("div",{className:"text-green-300 font-mono text-sm font-medium",children:e.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:269,columnNumber:25},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:262,columnNumber:23},this),t.jsxDEV("div",{className:"text-green-600 font-mono text-xs ml-6",children:e.description},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:273,columnNumber:23},this)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:261,columnNumber:21},this))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:259,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:254,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:251,columnNumber:13},this),x&&x.name===d&&t.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[t.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"权限设置"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:286,columnNumber:15},this),t.jsxDEV("div",{className:"p-4 bg-yellow-900/30 border border-yellow-400/60 rounded",children:[t.jsxDEV("div",{className:"flex items-center gap-2 mb-2",children:[t.jsxDEV(a,{className:"w-5 h-5 text-yellow-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:289,columnNumber:19},this),t.jsxDEV("span",{className:"text-yellow-400 font-mono font-bold",children:"超级管理员"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:290,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:288,columnNumber:17},this),t.jsxDEV("p",{className:"text-yellow-300 font-mono text-sm",children:"超级管理员自动拥有系统所有权限，可以访问所有Dashboard模块，无需手动设置。"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:292,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:287,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:285,columnNumber:13},this),t.jsxDEV("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[t.jsxDEV("button",{type:"submit",disabled:w,className:"flex items-center justify-center gap-2 px-4 py-2 sm:py-3 bg-green-600 hover:bg-green-500 disabled:bg-green-800 disabled:opacity-50 text-black font-medium rounded transition-all font-mono text-sm",children:[t.jsxDEV(o,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:308,columnNumber:15},this),w?"保存中...":"保存"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:303,columnNumber:13},this),t.jsxDEV(r,{to:"/role-permissions",className:"flex items-center justify-center gap-2 px-4 py-2 sm:py-3 border border-gray-500 hover:border-gray-400 hover:bg-gray-800/30 text-gray-300 font-medium rounded transition-all font-mono text-sm",children:[t.jsxDEV(l,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:315,columnNumber:15},this),"取消"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:311,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:302,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:222,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:199,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:198,columnNumber:5},this):t.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:t.jsxDEV("div",{className:"text-center",children:[t.jsxDEV(n,{className:"w-16 h-16 text-red-400 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:184,columnNumber:11},this),t.jsxDEV("div",{className:"text-red-400 text-xl font-mono mb-4",children:"角色不存在"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:185,columnNumber:11},this),t.jsxDEV(r,{to:"/role-permissions",className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:"返回角色列表"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:186,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:183,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:182,columnNumber:7},this)}export{b as default};
