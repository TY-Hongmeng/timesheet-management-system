import{j as e,X as m,r as t,V as n,I as s,Y as r,f as a,S as o,i,n as l,H as c,G as u,M as d,F as g,Q as h,T as N}from"./react-vendor-BvbWYXYX.js";import{u as b,c as p,s as y,i as v,P as x}from"./index-Quidhet4.js";import{t as f}from"./ui-components-GSsZJvGg.js";import{utils as w,writeFile as k,read as P}from"./excel-CwtzAf-t.js";import"./vendor-CZo_Kprg.js";import"./supabase-C9osPZeg.js";const M=({isOpen:t,title:n,message:s,onConfirm:r,onCancel:a,confirmText:o="确定",cancelText:i="取消",type:l="warning"})=>{if(!t)return null;const c=(()=>{switch(l){case"danger":return{confirmButton:"bg-red-600 hover:bg-red-700 text-white",icon:"text-red-400"};case"warning":return{confirmButton:"bg-yellow-600 hover:bg-yellow-700 text-white",icon:"text-yellow-400"};default:return{confirmButton:"bg-green-600 hover:bg-green-700 text-white",icon:"text-green-400"}}})();return e.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxDEV("div",{className:"bg-gray-900 border border-green-500 rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxDEV("div",{className:"flex items-center justify-between p-6 border-b border-green-500",children:[e.jsxDEV("h3",{className:"text-lg font-semibold text-green-400",children:n},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:54,columnNumber:11},void 0),e.jsxDEV("button",{onClick:a,className:"text-green-400 hover:text-green-300 transition-colors",children:e.jsxDEV(m,{size:20},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:59,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:55,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:53,columnNumber:9},void 0),e.jsxDEV("div",{className:"p-6",children:e.jsxDEV("p",{className:"text-green-300 leading-relaxed",children:s},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:65,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:64,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-green-500 bg-gray-800",children:[e.jsxDEV("button",{onClick:a,className:"px-4 py-2 text-green-400 bg-gray-700 border border-green-500 rounded-md hover:bg-gray-600 transition-colors",children:i},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:70,columnNumber:11},void 0),e.jsxDEV("button",{onClick:r,className:"px-4 py-2 rounded-md transition-colors "+c.confirmButton,children:o},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:76,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:69,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:51,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:50,columnNumber:5},void 0)},_=({isOpen:a,onClose:o,onImport:i,companies:l,currentUser:c,existingProcesses:u=[]})=>{const[d,g]=t.useState(null),[h,N]=t.useState([]),[b,p]=t.useState(!1),[y,v]=t.useState([]),[x,f]=t.useState(null);if(!a)return null;const M=e=>{if(!e)return"";if("number"==typeof e){const m=new Date(864e5*(e-25569));return`${m.getFullYear()}-${(m.getMonth()+1+"").padStart(2,"0")}`}const m=(e+"").trim();if(m.match(/^\d{4}-\d{2}$/))return m;if(m.match(/^\d{4}-\d{2}-\d{2}$/))return m.substring(0,7);if(m.match(/^\d{4}\/\d{1,2}$/)){const[e,t]=m.split("/");return`${e}-${t.padStart(2,"0")}`}if(m.match(/^\d{4}\/\d{1,2}\/\d{1,2}$/)){const[e,t]=m.split("/");return`${e}-${t.padStart(2,"0")}`}return m},_=()=>{g(null),N([]),v([]),f(null),o()};return e.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxDEV("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-6",children:[e.jsxDEV("h2",{className:"text-xl font-bold text-green-400",children:"批量导入工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:303,columnNumber:11},void 0),e.jsxDEV("button",{onClick:_,className:"text-gray-400 hover:text-white transition-colors",children:e.jsxDEV(m,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:308,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:304,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:302,columnNumber:9},void 0),x?e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("div",{className:"mb-6",children:[e.jsxDEV("h3",{className:"text-xl font-semibold text-green-400 mb-4",children:"导入完成"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:415,columnNumber:15},void 0),e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV("p",{className:"text-white",children:["成功导入：",e.jsxDEV("span",{className:"text-green-400 font-semibold",children:x.success},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:417,columnNumber:48},void 0)," 条"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:417,columnNumber:17},void 0),e.jsxDEV("p",{className:"text-white",children:["导入失败：",e.jsxDEV("span",{className:"text-red-400 font-semibold",children:x.failed},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:418,columnNumber:48},void 0)," 条"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:418,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:416,columnNumber:15},void 0),x.errors.length>0&&e.jsxDEV("div",{className:"mt-4 p-4 bg-red-900 border border-red-600 rounded text-left",children:[e.jsxDEV("h4",{className:"text-red-400 font-semibold mb-2",children:"错误信息："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:423,columnNumber:19},void 0),e.jsxDEV("ul",{className:"text-red-300 text-sm space-y-1",children:x.errors.map((m,t)=>e.jsxDEV("li",{children:["• ",m]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:426,columnNumber:23},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:424,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:422,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:414,columnNumber:13},void 0),e.jsxDEV("button",{onClick:_,className:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded transition-colors",children:"关闭"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:433,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:413,columnNumber:11},void 0):e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"mb-6",children:[e.jsxDEV("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxDEV("label",{className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded cursor-pointer transition-colors",children:[e.jsxDEV(n,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:318,columnNumber:19},void 0),"选择Excel文件",e.jsxDEV("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var m;const t=null==(m=e.target.files)?void 0:m[0];t&&(g(t),(async e=>{p(!0),v([]);try{const m=await e.arrayBuffer(),t=P(m,{type:"array"}),n=t.SheetNames[0],s=t.Sheets[n],r=w.sheet_to_json(s).map(e=>({...e,"生效年月":M(e.生效年月)})),a=(e=>{const m=[],t=l.map(e=>e.name),n=new Map;return e.forEach((e,s)=>{const r=s+2;if(e.公司名称?t.includes(e.公司名称)||m.push(`第${r}行：公司"${e.公司名称}"不存在`):m.push(`第${r}行：公司名称不能为空`),e.生产线||m.push(`第${r}行：生产线不能为空`),e.工时类型&&["生产工时","非生产工时"].includes(e.工时类型)||m.push(`第${r}行：工时类型必须是"生产工时"或"非生产工时"`),e.产品名称||m.push(`第${r}行：产品名称不能为空`),e.产品工序||m.push(`第${r}行：产品工序不能为空`),e.单价&&""!==e.单价&&"string"==typeof e.单价&&isNaN(+e.单价)&&m.push(`第${r}行：单价必须是有效数字`),e.生效年月||m.push(`第${r}行：生效年月不能为空`),e.公司名称&&e.生产线&&e.工时类型&&e.产品名称&&e.产品工序){const m=`${e.公司名称.trim()}_${e.生产线.trim()}_${e.工时类型}_${e.产品名称.trim()}_${e.产品工序.trim()}`;n.has(m)?n.get(m).push(r):n.set(m,[r])}if(e.公司名称&&e.生产线&&e.工时类型&&e.产品名称&&e.产品工序){const t=l.find(m=>m.name===e.公司名称);if(t){const n=u.find(m=>m.company_id===t.id&&m.production_line.trim()===e.生产线.trim()&&m.production_category===e.工时类型&&m.product_name.trim()===e.产品名称.trim()&&m.product_process.trim()===e.产品工序.trim());n&&m.push(`第${r}行：与现有工序重复！（公司：${n.company_name||e.公司名称}，生产线：${n.production_line}，工时类型：${n.production_category}，产品名称：${n.product_name}，产品工序：${n.product_process}）`)}}}),n.forEach((e,t)=>{if(e.length>1){const[n,s,r,a,o]=t.split("_");m.push(`导入数据内部重复：第${e.join("、")}行（公司：${n}，生产线：${s}，工时类型：${r}，产品名称：${a}，产品工序：${o}）`)}}),m})(r);a.length>0&&v(a),N(r.slice(0,10))}catch(m){v(["Excel文件解析失败，请检查文件格式"])}finally{p(!1)}})(t))},className:"hidden"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:320,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:317,columnNumber:17},void 0),e.jsxDEV("button",{onClick:()=>{var e;const m=[{"公司名称":(null==(e=null==c?void 0:c.company)?void 0:e.name)||"示例公司","生产线":"生产线A","工时类型":"生产工时","产品名称":"示例产品","产品工序":"示例工序","单价":"","生效年月":(new Date).toISOString().slice(0,7)}],t=w.json_to_sheet(m),n=w.book_new();w.book_append_sheet(n,t,"工序导入模板"),k(n,"工序导入模板.xlsx")},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors",children:[e.jsxDEV(s,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:331,columnNumber:19},void 0),"下载模板"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:327,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:316,columnNumber:15},void 0),d&&e.jsxDEV("div",{className:"flex items-center gap-2 text-green-400",children:[e.jsxDEV(r,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:338,columnNumber:19},void 0),e.jsxDEV("span",{children:d.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:339,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:337,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:315,columnNumber:13},void 0),y.length>0&&e.jsxDEV("div",{className:"mb-6 p-4 bg-red-900 border border-red-600 rounded",children:[e.jsxDEV("h3",{className:"text-red-400 font-semibold mb-2",children:"数据验证错误："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:347,columnNumber:17},void 0),e.jsxDEV("ul",{className:"text-red-300 text-sm space-y-1",children:[y.slice(0,10).map((m,t)=>e.jsxDEV("li",{children:["• ",m]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:350,columnNumber:21},void 0)),y.length>10&&e.jsxDEV("li",{className:"text-red-400",children:["... 还有 ",y.length-10," 个错误"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:353,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:348,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:346,columnNumber:15},void 0),h.length>0&&e.jsxDEV("div",{className:"mb-6",children:[e.jsxDEV("h3",{className:"text-green-400 font-semibold mb-3",children:"数据预览（前10行）："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:362,columnNumber:17},void 0),e.jsxDEV("div",{className:"overflow-x-auto",children:e.jsxDEV("table",{className:"w-full border border-gray-600 rounded",children:[e.jsxDEV("thead",{children:e.jsxDEV("tr",{className:"bg-gray-700",children:[e.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"公司名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:367,columnNumber:25},void 0),e.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:368,columnNumber:25},void 0),e.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:369,columnNumber:25},void 0),e.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:370,columnNumber:25},void 0),e.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:371,columnNumber:25},void 0),e.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:372,columnNumber:25},void 0),e.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"生效年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:373,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:366,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:365,columnNumber:21},void 0),e.jsxDEV("tbody",{children:h.map((m,t)=>e.jsxDEV("tr",{className:"hover:bg-gray-700",children:[e.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:m.公司名称},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:379,columnNumber:27},void 0),e.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:m.生产线},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:380,columnNumber:27},void 0),e.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:m.工时类型},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:381,columnNumber:27},void 0),e.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:m.产品名称},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:382,columnNumber:27},void 0),e.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:m.产品工序},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:383,columnNumber:27},void 0),e.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:m.单价},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:384,columnNumber:27},void 0),e.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:m.生效年月},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:385,columnNumber:27},void 0)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:378,columnNumber:25},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:376,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:364,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:363,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:361,columnNumber:15},void 0),e.jsxDEV("div",{className:"flex justify-end gap-4",children:[e.jsxDEV("button",{onClick:_,className:"px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:396,columnNumber:15},void 0),e.jsxDEV("button",{onClick:async()=>{if(d&&0>=y.length){p(!0);try{const e=await d.arrayBuffer(),m=P(e,{type:"array"}),t=m.SheetNames[0],n=m.Sheets[t],s=w.sheet_to_json(n).map(e=>({...e,"生效年月":M(e.生效年月)})).map(e=>{const m=l.find(m=>m.name===e.公司名称);return{company_id:(null==m?void 0:m.id)||"",production_line:e.生产线,production_category:e.工时类型,product_name:e.产品名称,product_process:e.产品工序,unit_price:e.单价&&""!==e.单价&&void 0!==e.单价?+e.单价:null,effective_date:e.生效年月||null}});await i(s),f({success:s.length,failed:0,errors:[]})}catch(e){f({success:0,failed:h.length,errors:["导入失败："+e.message]})}finally{p(!1)}}},disabled:!d||y.length>0||b,className:"px-6 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded transition-colors",children:b?"导入中...":"确认导入"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:402,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:395,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:313,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:301,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:300,columnNumber:5},void 0)},D=()=>{var s;const{user:r,loading:w}=b(),k=a(),[P,D]=t.useState([]),[I,E]=t.useState([]),[C,$]=t.useState(!0),[j,B]=t.useState(""),[z,S]=t.useState(""),[T,F]=t.useState(""),[O,W]=t.useState(""),[U,A]=t.useState(!1),[G,H]=t.useState(!1),[Q,V]=t.useState(null),[Y,q]=t.useState(!1),[J,K]=t.useState([]),[L,R]=t.useState([]),[X,Z]=t.useState([]),[ee,me]=t.useState([]),[te,ne]=t.useState([]),[se,re]=t.useState([]),[ae,oe]=t.useState(!1),[ie,le]=t.useState(!1),[ce,ue]=t.useState(!1),[de,ge]=t.useState({production_line:"",production_category:"",product_name:""}),[he,Ne]=t.useState({company_id:"",production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"}),[be,pe]=t.useState(null),[ye,ve]=t.useState(!1),[xe,fe]=t.useState(null),[we,ke]=t.useState(!1),[Pe,Me]=t.useState(!1);t.useEffect(()=>{if(!w&&!r)return f.error("请先登录"),void k("/login");r&&_e()},[r,w,k]);const _e=async()=>{if(r)return await p(r.id,x.PROCESS_MANAGEMENT)?(De(),void $e()):(f.error("您没有权限访问工序管理功能"),void k("/dashboard"))},De=async()=>{var e;try{if($(!0),!r)return void f.error("用户信息不存在");let m=y.from("processes").select("\n          *,\n          companies!inner(\n            name\n          )\n        ").eq("is_active",!0);if(!v(r.role)){if(!(null==(e=r.company)?void 0:e.id))return void f.error("用户没有关联的公司，请联系管理员");m=m.eq("company_id",r.company.id)}const{data:t,error:n}=await m.order("created_at",{ascending:!1});if(n)return void f.error("获取工序列表失败: "+n.message);const s=(t||[]).map(e=>{var m;return{...e,company_name:(null==(m=e.companies)?void 0:m.name)||"未知公司"}});D(s),Ie(s)}catch(m){f.error("获取工序列表失败: "+(m.message||"未知错误"))}finally{$(!1)}},Ie=e=>{var m;if(!(null==(m=null==r?void 0:r.company)?void 0:m.id))return;const t=e.filter(e=>{var m;return e.company_id===(null==(m=r.company)?void 0:m.id)}),n=[...new Set(t.map(e=>e.production_line).filter(Boolean))];K(n);const s=[...new Set(t.map(e=>e.product_name).filter(Boolean))];R(s);const a=[...new Set(t.map(e=>e.product_process).filter(Boolean))];Z(a)},Ee=(e,m)=>{switch(Ne(t=>({...t,[e]:m})),e){case"production_line":const e=J.filter(e=>e.toLowerCase().includes(m.toLowerCase()));me(e),oe(m.length>0&&e.length>0);break;case"product_name":const t=L.filter(e=>e.toLowerCase().includes(m.toLowerCase()));ne(t),le(m.length>0&&t.length>0);break;case"product_process":const n=X.filter(e=>e.toLowerCase().includes(m.toLowerCase()));re(n),ue(m.length>0&&n.length>0)}},Ce=(e,m)=>{switch(Ne(t=>({...t,[e]:m})),e){case"production_line":oe(!1);break;case"product_name":le(!1);break;case"product_process":ue(!1)}},$e=async()=>{var e,m;try{if(!r)return void f.error("用户信息不存在");let t=y.from("companies").select("id, name");v(r.role)||(t=t.eq("id",null==(e=r.company)?void 0:e.id));const{data:n,error:s}=await t.order("name");if(s)return void f.error("获取公司列表失败");E(n||[]),!v(r.role)&&(null==(m=r.company)?void 0:m.id)&&Ne(e=>({...e,company_id:r.company.id}))}catch(t){f.error("获取公司列表失败")}},je=()=>{var e;return!v(null==r?void 0:r.role)&&(null==(e=null==r?void 0:r.company)?void 0:e.id)?r.company.id:""},Be=P.reduce((e,m)=>{var t,n,s;const r=`${m.company_id}_${null==(t=m.production_line)?void 0:t.trim()}_${m.production_category}_${null==(n=m.product_name)?void 0:n.trim()}_${null==(s=m.product_process)?void 0:s.trim()}`;return e[r]&&new Date(m.created_at)<=new Date(e[r].created_at)||(e[r]=m),e},{}),ze=Object.values(Be).filter(e=>{if(Pe)return!e.unit_price||0>=e.unit_price;const m=""===j||e.production_line.toLowerCase().includes(j.toLowerCase())||e.product_name.toLowerCase().includes(j.toLowerCase())||e.production_category&&e.production_category.toLowerCase().includes(j.toLowerCase())||e.product_process&&e.product_process.toLowerCase().includes(j.toLowerCase()),t=""===de.production_line||e.production_line===de.production_line,n=""===de.production_category||e.production_category===de.production_category,s=!O||e.effective_date===O;return m&&t&&n&&s}),Se=[...new Set(P.map(e=>e.production_line).filter(Boolean))],Te=[...new Set(P.map(e=>e.production_category).filter(Boolean))];return e.jsxDEV("div",{className:"min-h-screen bg-black text-green-400 font-mono",children:[e.jsxDEV("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxDEV("div",{className:"mb-8",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-4",children:[e.jsxDEV("div",{className:"flex items-center",children:[e.jsxDEV(o,{className:"w-8 h-8 text-green-400 mr-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:781,columnNumber:15},void 0),e.jsxDEV("h1",{className:"text-4xl font-bold text-green-400 font-mono",children:"工序管理"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:782,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:780,columnNumber:13},void 0),e.jsxDEV(i,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[e.jsxDEV(l,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:788,columnNumber:15},void 0),e.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:789,columnNumber:15},void 0),e.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:790,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:784,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:779,columnNumber:11},void 0),e.jsxDEV("div",{className:"h-1 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:793,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:778,columnNumber:9},void 0),e.jsxDEV("div",{className:"mb-6 space-y-4",children:[e.jsxDEV("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsxDEV("div",{className:"flex-1",children:e.jsxDEV("div",{className:"relative",children:[e.jsxDEV(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-green-400/60"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:801,columnNumber:17},void 0),e.jsxDEV("input",{type:"text",placeholder:"搜索工序内容、生产线、产品名称...",value:j,onChange:e=>B(e.target.value),className:"w-full bg-black border border-green-400/30 rounded px-10 py-2 text-green-400 placeholder-green-400/60 focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:802,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:800,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:799,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:798,columnNumber:11},void 0),e.jsxDEV("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4",children:[e.jsxDEV("button",{onClick:()=>q(!Y),className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono text-sm sm:text-base",children:[e.jsxDEV(u,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:819,columnNumber:15},void 0),e.jsxDEV("span",{className:"hidden sm:inline",children:"筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:820,columnNumber:15},void 0),e.jsxDEV("span",{className:"sm:hidden",children:"筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:821,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:815,columnNumber:13},void 0),e.jsxDEV("button",{onClick:()=>{0===P.filter(e=>!e.unit_price||0>=e.unit_price).length?f.info("当前没有未定价的工序"):(B(""),ge({production_line:"",production_category:"",product_name:""}),W(""),Me(!Pe))},className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 font-bold rounded transition-colors font-mono text-sm sm:text-base "+(Pe?"bg-red-600 hover:bg-red-500 text-white":"bg-orange-600 hover:bg-orange-500 text-white"),children:[e.jsxDEV(d,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:842,columnNumber:15},void 0),e.jsxDEV("span",{className:"hidden sm:inline",children:Pe?"显示全部":"未定价工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:843,columnNumber:15},void 0),e.jsxDEV("span",{className:"sm:hidden",children:Pe?"全部":"未定价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:844,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:823,columnNumber:13},void 0),e.jsxDEV("button",{onClick:()=>ke(!0),className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono text-sm sm:text-base",children:[e.jsxDEV(n,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:850,columnNumber:15},void 0),e.jsxDEV("span",{className:"hidden sm:inline",children:"批量导入"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:851,columnNumber:15},void 0),e.jsxDEV("span",{className:"sm:hidden",children:"导入"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:852,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:846,columnNumber:13},void 0),e.jsxDEV("button",{onClick:()=>{U||(be?Ne({...be,unit_price:""}):(()=>{const e=je();Ne({company_id:e,production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"})})()),A(!U)},className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono text-sm sm:text-base",children:[e.jsxDEV(g,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:872,columnNumber:15},void 0),e.jsxDEV("span",{className:"hidden sm:inline",children:"添加工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:873,columnNumber:15},void 0),e.jsxDEV("span",{className:"sm:hidden",children:"添加"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:874,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:854,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:814,columnNumber:11},void 0),Y&&e.jsxDEV("div",{className:"bg-green-900/10 border border-green-400/30 rounded p-4",children:[e.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-green-400 mb-2",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:883,columnNumber:19},void 0),e.jsxDEV("select",{value:de.production_line,onChange:e=>ge({...de,production_line:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[e.jsxDEV("option",{value:"",children:"全部生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:891,columnNumber:21},void 0),Se.map(m=>e.jsxDEV("option",{value:m,children:m},m,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:893,columnNumber:23},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:886,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:882,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-green-400 mb-2",children:"工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:898,columnNumber:19},void 0),e.jsxDEV("select",{value:de.production_category,onChange:e=>ge({...de,production_category:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[e.jsxDEV("option",{value:"",children:"全部类别"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:906,columnNumber:21},void 0),Te.map(m=>e.jsxDEV("option",{value:m,children:m},m,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:908,columnNumber:23},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:901,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:897,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:881,columnNumber:15},void 0),e.jsxDEV("div",{className:"flex justify-start mt-4",children:e.jsxDEV("button",{onClick:()=>{ge({production_line:"",production_category:"",product_name:""}),B(""),W(""),Me(!1)},className:"flex items-center space-x-2 bg-gray-900/20 border border-gray-400/30 px-4 py-2 rounded hover:bg-gray-900/30 transition-colors text-gray-400",children:[e.jsxDEV(m,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:923,columnNumber:19},void 0),e.jsxDEV("span",{children:"清除筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:924,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:914,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:913,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:880,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:797,columnNumber:9},void 0),U&&e.jsxDEV("div",{className:"mb-6 p-4 border border-green-400/30 rounded bg-green-900/10",children:[e.jsxDEV("h3",{className:"text-lg font-semibold mb-4 text-green-400",children:["为 ",e.jsxDEV("strong",{children:(null==(s=null==r?void 0:r.company)?void 0:s.name)||"未设置公司"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:935,columnNumber:17},void 0)," 添加新工序"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:934,columnNumber:13},void 0),e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxDEV("div",{className:"relative",children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:["生产线 ",e.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:942,columnNumber:88},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:942,columnNumber:19},void 0),e.jsxDEV("input",{type:"text",value:he.production_line,onChange:e=>Ee("production_line",e.target.value),onFocus:()=>{he.production_line&&ee.length>0&&oe(!0)},onBlur:()=>{setTimeout(()=>oe(!1),200)},className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:943,columnNumber:19},void 0),ae&&ee.length>0&&e.jsxDEV("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-green-400/30 rounded-md shadow-lg max-h-40 overflow-y-auto",children:ee.map((m,t)=>e.jsxDEV("div",{onClick:()=>Ce("production_line",m),className:"px-3 py-2 text-green-400 hover:bg-green-900/20 cursor-pointer border-b border-green-400/10 last:border-b-0",children:m},t,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:961,columnNumber:25},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:959,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:941,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:["工时类型 ",e.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:973,columnNumber:89},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:973,columnNumber:19},void 0),e.jsxDEV("select",{value:he.work_time_type,onChange:e=>Ne({...he,work_time_type:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[e.jsxDEV("option",{value:"生产工时",children:"生产工时"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:979,columnNumber:21},void 0),e.jsxDEV("option",{value:"非生产工时",children:"非生产工时"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:980,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:974,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:972,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:940,columnNumber:15},void 0),e.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxDEV("div",{className:"relative",children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:["产品名称 ",e.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:988,columnNumber:89},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:988,columnNumber:19},void 0),e.jsxDEV("input",{type:"text",value:he.product_name,onChange:e=>Ee("product_name",e.target.value),onFocus:()=>{he.product_name&&te.length>0&&le(!0)},onBlur:()=>{setTimeout(()=>le(!1),200)},className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:989,columnNumber:19},void 0),ie&&te.length>0&&e.jsxDEV("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-green-400/30 rounded-md shadow-lg max-h-40 overflow-y-auto",children:te.map((m,t)=>e.jsxDEV("div",{onClick:()=>Ce("product_name",m),className:"px-3 py-2 text-green-400 hover:bg-green-900/20 cursor-pointer border-b border-green-400/10 last:border-b-0",children:m},t,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1007,columnNumber:23},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1005,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:987,columnNumber:17},void 0),e.jsxDEV("div",{className:"relative",children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:["产品工序 ",e.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1019,columnNumber:89},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1019,columnNumber:19},void 0),e.jsxDEV("input",{type:"text",value:he.product_process,onChange:e=>Ee("product_process",e.target.value),onFocus:()=>{he.product_process&&se.length>0&&ue(!0)},onBlur:()=>{setTimeout(()=>ue(!1),200)},className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1020,columnNumber:19},void 0),ce&&se.length>0&&e.jsxDEV("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-green-400/30 rounded-md shadow-lg max-h-40 overflow-y-auto",children:se.map((m,t)=>e.jsxDEV("div",{onClick:()=>Ce("product_process",m),className:"px-3 py-2 text-green-400 hover:bg-green-900/20 cursor-pointer border-b border-green-400/10 last:border-b-0",children:m},t,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1038,columnNumber:25},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1036,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1018,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:986,columnNumber:15},void 0),e.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:"单价（可选）"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1054,columnNumber:19},void 0),e.jsxDEV("input",{type:"number",step:"0.01",value:he.unit_price,onChange:e=>Ne({...he,unit_price:e.target.value}),onWheel:e=>e.currentTarget.blur(),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400 [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]",placeholder:"请输入单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1055,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1053,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:"生效年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1066,columnNumber:19},void 0),e.jsxDEV("input",{type:"month",value:he.effective_date,onChange:e=>Ne({...he,effective_date:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1067,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1065,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1052,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:938,columnNumber:13},void 0),e.jsxDEV("div",{className:"flex space-x-4 mt-4",children:[e.jsxDEV("button",{type:"button",onClick:async()=>{var e,m;if(!r)return f.error("用户未登录，请重新登录"),void k("/login");const t=null==(e=r.company)?void 0:e.id;if(t)if(he.production_line.trim())if(he.product_name.trim())if(he.product_process.trim())if(P.find(e=>e.company_id===t&&e.production_line.trim()===he.production_line.trim()&&e.production_category===he.work_time_type&&e.product_name.trim()===he.product_name.trim()&&e.product_process.trim()===he.product_process.trim()))f.error("该工序已存在，请检查输入信息！",{duration:4e3,style:{fontSize:"16px",fontWeight:"bold"}});else try{const e={company_id:t,production_line:he.production_line,production_category:he.work_time_type,product_name:he.product_name,product_process:he.product_process,unit_price:he.unit_price&&""!==he.unit_price.trim()?parseFloat(he.unit_price):null,effective_date:he.effective_date?he.effective_date+"-01":null,is_active:!0},{data:n,error:s}=await y.from("processes").insert(e).select("\n          *,\n          companies!inner(\n            name\n          )\n        ").single();if(s)return void f.error("添加工序失败: "+s.message);const r={...n,company_name:(null==(m=n.companies)?void 0:m.name)||"未知公司"};D([r,...P]),pe({...he}),Ne({...he,product_process:""}),A(!1),f.success("工序添加成功")}catch(n){f.error("添加工序失败: "+(n.message||"未知错误"))}else f.error("请填写产品工序");else f.error("请填写产品名称");else f.error("请填写生产线");else f.error("用户没有关联的公司，请联系管理员")},className:"bg-green-900/20 border border-green-400/30 px-4 py-2 rounded hover:bg-green-900/30 transition-colors text-green-400",children:"确认添加"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1077,columnNumber:15},void 0),e.jsxDEV("button",{onClick:()=>{A(!1);const e=je();Ne({company_id:e,production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"})},className:"border border-green-400/30 px-4 py-2 rounded hover:bg-green-900/20 transition-colors text-green-400",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1082,columnNumber:15},void 0),e.jsxDEV("button",{onClick:()=>{const e=je();Ne({company_id:e,production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"}),f.success("表单内容已清除")},className:"bg-red-900/20 border border-red-400/30 px-4 py-2 rounded hover:bg-red-900/30 transition-colors text-red-400",children:"清除内容"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1101,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1076,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:933,columnNumber:11},void 0),G&&Q&&e.jsxDEV("div",{className:"bg-gray-800 border border-green-500 rounded-lg p-6 mb-6",children:[e.jsxDEV("h3",{className:"text-lg font-semibold text-green-400 mb-4",children:"编辑工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1127,columnNumber:13},void 0),e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["公司 ",e.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1131,columnNumber:22},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1130,columnNumber:17},void 0),e.jsxDEV("select",{value:he.company_id,onChange:e=>Ne({...he,company_id:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[e.jsxDEV("option",{value:"",children:"请选择公司"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1138,columnNumber:19},void 0),I.map(m=>e.jsxDEV("option",{value:m.id,children:m.name},m.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1140,columnNumber:21},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1133,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1129,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["生产线 ",e.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1148,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1147,columnNumber:17},void 0),e.jsxDEV("input",{type:"text",value:he.production_line,onChange:e=>Ne({...he,production_line:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1150,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1146,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["工时类型 ",e.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1160,columnNumber:24},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1159,columnNumber:17},void 0),e.jsxDEV("select",{value:he.work_time_type,onChange:e=>Ne({...he,work_time_type:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[e.jsxDEV("option",{value:"生产工时",children:"生产工时"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1167,columnNumber:19},void 0),e.jsxDEV("option",{value:"非生产工时",children:"非生产工时"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1168,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1162,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1158,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["产品名称 ",e.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1173,columnNumber:24},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1172,columnNumber:17},void 0),e.jsxDEV("input",{type:"text",value:he.product_name,onChange:e=>Ne({...he,product_name:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1175,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1171,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["产品工序 ",e.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1185,columnNumber:24},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1184,columnNumber:17},void 0),e.jsxDEV("input",{type:"text",value:he.product_process,onChange:e=>Ne({...he,product_process:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1187,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1183,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1196,columnNumber:17},void 0),e.jsxDEV("input",{type:"number",step:"0.01",value:he.unit_price,onChange:e=>Ne({...he,unit_price:e.target.value}),onWheel:e=>e.currentTarget.blur(),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400 [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]",placeholder:"请输入单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1199,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1195,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"生效年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1210,columnNumber:17},void 0),e.jsxDEV("input",{type:"month",value:he.effective_date,onChange:e=>Ne({...he,effective_date:e.target.value}),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1213,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1209,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1128,columnNumber:13},void 0),e.jsxDEV("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsxDEV("button",{onClick:()=>{H(!1),V(null),Ne({company_id:"",production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"})},className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1222,columnNumber:15},void 0),e.jsxDEV("button",{onClick:async()=>{var e,m,t;if(Q){if(!r)return f.error("用户未登录，请重新登录"),void k("/login");if(v(r.role)||Q.company_id===(null==(e=r.company)?void 0:e.id))if(v(r.role)||he.company_id===(null==(m=r.company)?void 0:m.id))if(he.company_id)if(he.production_line.trim())if(he.product_name.trim())if(P.find(e=>e.id!==Q.id&&e.company_id===he.company_id&&e.production_line.trim()===he.production_line.trim()&&e.production_category===he.work_time_type&&e.product_name.trim()===he.product_name.trim()&&e.product_process.trim()===he.product_process.trim()))f.error("该工序已存在，请检查输入信息！",{duration:4e3,style:{fontSize:"16px",fontWeight:"bold"}});else try{const{data:e,error:m}=await y.from("processes").update({company_id:he.company_id,production_line:he.production_line,production_category:he.work_time_type,product_name:he.product_name,product_process:he.product_process,unit_price:he.unit_price?parseFloat(he.unit_price):null,effective_date:he.effective_date?he.effective_date+"-01":null}).eq("id",Q.id).select("\n          *,\n          companies!inner(\n            name\n          )\n        ").single();if(m)return void f.error("更新工序失败");const n={...e,company_name:(null==(t=e.companies)?void 0:t.name)||"未知公司"};D(P.map(e=>e.id===Q.id?n:e)),pe({...he}),H(!1),V(null),f.success("工序更新成功")}catch(n){f.error("更新工序失败")}else f.error("请输入产品名称");else f.error("请输入生产线");else f.error("请选择公司");else f.error("您只能将工序分配给自己的公司");else f.error("您只能编辑自己公司的工序")}},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"更新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1241,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1221,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1126,columnNumber:11},void 0),e.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg overflow-hidden",children:C?e.jsxDEV("div",{className:"p-8 text-center text-green-400/60",children:e.jsxDEV("div",{className:"animate-pulse",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1256,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1255,columnNumber:13},void 0):0===ze.length?e.jsxDEV("div",{className:"p-8 text-center text-green-400/60",children:j?"未找到匹配的工序":"暂无工序数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1259,columnNumber:13},void 0):e.jsxDEV("div",{className:"overflow-x-auto",children:e.jsxDEV("table",{className:"w-full",children:[e.jsxDEV("thead",{className:"bg-green-900/30",children:e.jsxDEV("tr",{children:[e.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"公司"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1267,columnNumber:21},void 0),e.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1270,columnNumber:21},void 0),e.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1273,columnNumber:21},void 0),e.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1274,columnNumber:21},void 0),e.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1277,columnNumber:21},void 0),e.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1280,columnNumber:21},void 0),e.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"生效年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1283,columnNumber:21},void 0),e.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1286,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1266,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1265,columnNumber:17},void 0),e.jsxDEV("tbody",{className:"divide-y divide-green-800",children:ze.map(m=>e.jsxDEV("tr",{className:"hover:bg-green-900/10",children:[e.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:m.company_name,children:m.company_name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1295,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1294,columnNumber:23},void 0),e.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:m.production_line,children:m.production_line},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1300,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1299,columnNumber:23},void 0),e.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:m.production_category||"-",children:m.production_category||"-"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1305,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1304,columnNumber:23},void 0),e.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:m.product_name,children:m.product_name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1310,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1309,columnNumber:23},void 0),e.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:m.product_process||"-",children:m.product_process||"-"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1315,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1314,columnNumber:23},void 0),e.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxDEV("span",{className:"text-sm font-mono "+(m.unit_price&&m.unit_price>0?"text-green-300":"text-red-400 font-bold"),title:m.unit_price?"¥"+m.unit_price.toFixed(2):"未定价",children:m.unit_price&&m.unit_price>0?"¥"+m.unit_price.toFixed(2):"未定价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1320,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1319,columnNumber:23},void 0),e.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:m.effective_date,children:m.effective_date?m.effective_date.substring(0,7):""},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1325,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1324,columnNumber:23},void 0),e.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxDEV("div",{className:"flex justify-center space-x-1",children:[e.jsxDEV("button",{onClick:()=>(e=>{var m;V(e);let t="";t=e.effective_date?e.effective_date.includes("-")&&e.effective_date.length>=7?e.effective_date.substring(0,7):e.effective_date:(new Date).toISOString().slice(0,7),Ne({company_id:e.company_id,production_line:e.production_line,production_category:e.production_category,product_name:e.product_name,product_process:e.product_process,unit_price:(null==(m=e.unit_price)?void 0:m.toString())||"",effective_date:t,work_time_type:e.production_category}),H(!0)})(m),className:"p-1 text-blue-400/60 hover:text-blue-400 hover:bg-blue-900/20 rounded transition-colors",title:"编辑工序",children:e.jsxDEV(h,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1336,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1331,columnNumber:27},void 0),e.jsxDEV("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),fe(m),ve(!0)},className:"p-1 text-red-400/60 hover:text-red-400 hover:bg-red-900/20 rounded transition-colors",title:"删除工序",children:e.jsxDEV(N,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1348,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1338,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1330,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1329,columnNumber:23},void 0)]},m.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1293,columnNumber:21},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1291,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1264,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1263,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1252,columnNumber:9},void 0),e.jsxDEV("div",{className:"mt-6 text-center text-green-400/60 text-sm",children:["共 ",ze.length," 个工序",j&&` (从 ${P.length} 个工序中筛选)`,Pe&&e.jsxDEV("span",{className:"ml-2 text-red-400 font-bold",children:"(显示未定价工序)"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1365,columnNumber:13},void 0),!Pe&&e.jsxDEV("span",{className:"ml-2 text-orange-400",children:["(未定价: ",P.filter(e=>!e.unit_price||0>=e.unit_price).length," 个)"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1370,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1361,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:776,columnNumber:7},void 0),e.jsxDEV(M,{isOpen:ye,title:"确认删除",message:xe?`确定要删除工序"${xe.product_name}"吗？\n\n此操作不可撤销！`:"",onConfirm:()=>{xe&&((async e=>{var m;if(!r)return f.error("用户未登录，请重新登录"),void k("/login");const t=P.find(m=>m.id===e);if(t)if(v(r.role)||t.company_id===(null==(m=r.company)?void 0:m.id))try{const{error:m}=await y.from("processes").update({is_active:!1}).eq("id",e);if(m)return void f.error("删除工序失败: "+m.message);D(P.filter(m=>m.id!==e)),f.success("工序删除成功")}catch(n){f.error("删除工序失败")}else f.error("您只能删除自己公司的工序");else f.error("工序不存在")})(xe.id),ve(!1),fe(null))},onCancel:()=>{ve(!1),fe(null)},confirmText:"删除",cancelText:"取消",type:"danger"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1378,columnNumber:7},void 0),e.jsxDEV(_,{isOpen:we,onClose:()=>ke(!1),onImport:async e=>{var m,t;if(!r)return f.error("用户未登录，请重新登录"),void k("/login");let n=0,s=0;const a=[];try{for(let i=0;i<e.length;i++){const l=e[i];try{const e=null==(m=r.company)?void 0:m.id;if(!e){a.push(`第 ${i+1} 行: 无法获取用户公司信息`),s++;continue}if(!v(r.role)&&l.company_id!==e){a.push(`第 ${i+1} 行: 您只能导入自己公司的工序`),s++;continue}const{data:o,error:c}=await y.from("processes").insert({company_id:e,production_line:l.production_line,production_category:l.production_category,product_name:l.product_name,product_process:l.product_process,unit_price:l.unit_price,effective_date:l.effective_date?l.effective_date.match(/^\d{4}-\d{2}$/)?l.effective_date+"-01":l.effective_date:null,is_active:!0}).select("\n              *,\n              companies!inner(\n                name\n              )\n            ").single();if(c)a.push(`第 ${i+1} 行: ${c.message}`),s++;else{const e={...o,company_name:(null==(t=o.companies)?void 0:t.name)||"未知公司"};D(m=>[e,...m]),n++}}catch(o){a.push(`第 ${i+1} 行: ${o.message||"未知错误"}`),s++}}n>0&&0===s?f.success(`批量导入成功！共导入 ${n} 条工序`):n>0&&s>0?f.warning(`部分导入成功！成功 ${n} 条，失败 ${s} 条`):f.error(`导入失败！共 ${s} 条数据导入失败`)}catch(i){f.error("批量导入失败: "+(i.message||"未知错误"))}},companies:I,currentUser:r,existingProcesses:P},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1399,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:775,columnNumber:5},void 0)};export{D as default};
