var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(t,s,m)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:m}):t[s]=m,o=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&a(e,s,t[s]);if(m)for(var s of m(t))n.call(t,s)&&a(e,s,t[s]);return e},i=(e,m)=>t(e,s(m)),l=(e,t,s)=>new Promise((m,r)=>{var n=e=>{try{o(s.next(e))}catch(t){r(t)}},a=e=>{try{o(s.throw(e))}catch(t){r(t)}},o=e=>e.done?m(e.value):Promise.resolve(e.value).then(n,a);o((s=s.apply(e,t)).next())});import{r as u,j as d,a7 as c,z as h,f as g,l as y,F as N,a1 as x,a2 as v,y as b}from"./react-core-CEw6lU7H.js";import{u as p,s as f}from"./index-D4m2Xi5e.js";import{t as w}from"./ui-BmDV7GQB.js";import"./vendor-Dj0T90Ik.js";import"./supabase-DInoECZ_.js";const k=()=>{const{user:e}=p(),[t,s]=u.useState([]),[m,r]=u.useState([]),[n,a]=u.useState(!0),[k,D]=u.useState({key:"work_date",direction:"desc"}),[j,E]=u.useState({yearMonth:"",startDate:"",endDate:"",userId:""}),[H,V]=u.useState([]),[_,S]=u.useState([]),[$,C]=u.useState(new Set),[P,M]=u.useState(!0),[I,q]=u.useState(!1);u.useEffect(()=>{e&&(A(),O())},[e]),u.useEffect(()=>{z()},[t,j]);const O=()=>l(void 0,null,function*(){if(e)try{const{data:t,error:s}=yield f.from("timesheet_records").select("user_id, user:users!timesheet_records_user_id_fkey(id, name)").or(`supervisor_id.eq.${e.id},section_chief_id.eq.${e.id}`).neq("status","draft");if(s)return void console.error("fetchApprovedUsers error:",s);const m=(null==t?void 0:t.filter(e=>e.user).reduce((e,t)=>{const s=t.user.id;return e.find(e=>e.id===s)||e.push({id:s,name:t.user.name}),e},[]))||[];S(m)}catch(t){console.error("fetchApprovedUsers catch error:",t)}}),A=()=>l(void 0,null,function*(){if(e)try{a(!0);const{data:t,error:m}=yield f.from("timesheet_records").select("\n          *,\n          user:users!timesheet_records_user_id_fkey(id, name),\n          supervisor:users!timesheet_records_supervisor_id_fkey(id, name),\n          section_chief:users!timesheet_records_section_chief_id_fkey(id, name),\n          items:timesheet_record_items(\n            id,\n            process_id,\n            quantity,\n            unit_price,\n            amount,\n            processes:processes!timesheet_record_items_process_id_fkey(\n              product_process,\n              product_name,\n              production_category,\n              production_line,\n              unit_price\n            )\n          ),\n          approval_history(\n            approver_type,\n            approver_name,\n            created_at,\n            approver:approver_id(name)\n          )\n        ").or(`user_id.eq.${e.id},supervisor_id.eq.${e.id},section_chief_id.eq.${e.id}`).neq("status","draft").order("work_date",{ascending:!1}),r=t?t.filter((e,t,s)=>t===s.findIndex(t=>t.id===e.id)):[];if(m)return console.error("fetchHistoryData error:",m),void w.error("获取历史记录失败");s(r)}catch(t){console.error("fetchHistoryData catch error:",t),w.error("获取历史记录失败")}finally{a(!1)}else console.error("fetchHistoryData: 用户信息不存在")}),z=()=>{let e=[...t];if(j.yearMonth){const[t,s]=j.yearMonth.split("-");e=e.filter(e=>{const m=new Date(e.work_date),r=m.getFullYear(),n=m.getMonth()+1;return r===parseInt(t)&&n===parseInt(s)})}j.startDate&&(e=e.filter(e=>e.work_date>=j.startDate)),j.endDate&&(e=e.filter(e=>e.work_date<=j.endDate)),j.userId&&(e=e.filter(e=>e.user_id===j.userId)),k.key&&e.sort((e,t)=>{let s,m;switch(k.key){case"work_date":s=new Date(e.work_date),m=new Date(t.work_date);break;case"status":s=e.status,m=t.status;break;case"created_at":s=new Date(e.created_at),m=new Date(t.created_at);break;default:s=e[k.key],m=t[k.key]}return s<m?"asc"===k.direction?-1:1:s>m?"asc"===k.direction?1:-1:0}),r(e)},Q=e=>{const t=new Set($);t.has(e)?t.delete(e):t.add(e),C(t)},W=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),F=e=>{const t=(e=>{switch(e){case"pending":return{text:"待班长审核",icon:"⚠",color:"text-yellow-400"};case"approved":return{text:"待段长审核",icon:"⚠",color:"text-blue-400"};case"section_chief_approved":return{text:"已通过",icon:"✓",color:"text-green-400"};default:return{text:"未知",icon:"⚠",color:"text-gray-400"}}})(e);return d.jsxDEV("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ${t.color}`,children:[d.jsxDEV("span",{className:"w-3 h-3 text-center",children:t.icon},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:397,columnNumber:9},void 0),t.text]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:396,columnNumber:7},void 0)},L=(e,t)=>{var s,m;const r=null==(s=e.approval_history)?void 0:s.find(e=>e.approver_type===t);return r?{name:r.approver_name||(null==(m=r.approver)?void 0:m.name)||"未知",date:W(r.created_at)}:null};return m.length,m.filter(e=>"pending"===e.status).length,m.filter(e=>"approved"===e.status).length,m.filter(e=>"section_chief_approved"===e.status).length,(()=>{const e=new Map;return m.forEach(t=>{var s;const m=t.user_id,r=t.work_date,n=(e=>{const t=e.getDay();if(0===t||6===t)return!1;e.getFullYear();const s=e.getMonth()+1,m=e.getDate();return!(1===s&&1===m||2===s&&m>=10&&m<=17||4===s&&m>=4&&m<=6||5===s&&m>=1&&m<=3||6===s&&m>=22&&m<=24||9===s&&m>=15&&m<=17||10===s&&m>=1&&m<=7)})(new Date(r));e.has(m)||e.set(m,{userId:m,userName:(null==(s=t.user)?void 0:s.name)||"未知",workDates:new Set,workingDates:new Set,holidayDates:new Set});const a=e.get(m);a.workDates.add(r),n?a.workingDates.add(r):a.holidayDates.add(r)}),Array.from(e.values()).map(e=>i(o({},e),{totalWorkDays:e.workDates.size,actualWorkDays:e.workingDates.size,holidayDays:e.holidayDates.size}))})().reduce((e,t)=>e+t.actualWorkDays,0),n?d.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:d.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:503,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:502,columnNumber:7},void 0):d.jsxDEV("div",{className:"min-h-screen bg-black text-green-300",children:[d.jsxDEV("header",{className:"bg-gray-900 border-b border-green-400 px-6 py-4",children:d.jsxDEV("div",{className:"max-w-7xl mx-auto",children:d.jsxDEV("div",{className:"flex items-center justify-between",children:[d.jsxDEV("h1",{className:"text-2xl font-bold text-green-400 font-mono flex items-center gap-2",children:[d.jsxDEV(c,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:517,columnNumber:15},void 0),"历史记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:516,columnNumber:13},void 0),d.jsxDEV("div",{className:"flex items-center gap-3",children:[d.jsxDEV("button",{onClick:()=>l(void 0,null,function*(){q(!0);try{yield Promise.all([A(),O()]),w.success("数据刷新成功")}catch(e){console.error("刷新数据失败:",e),w.error("刷新数据失败，请重试")}finally{q(!1)}}),disabled:I,className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 disabled:from-gray-700 disabled:to-gray-800 text-green-300 hover:text-green-200 disabled:text-gray-400 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 disabled:border-gray-600",children:[d.jsxDEV(h,{className:"w-4 h-4 "+(I?"animate-spin":"")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:526,columnNumber:17},void 0),d.jsxDEV("span",{className:"hidden sm:inline",children:I?"刷新中...":"刷新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:527,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:521,columnNumber:15},void 0),d.jsxDEV(g,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[d.jsxDEV(y,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:534,columnNumber:17},void 0),d.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:535,columnNumber:17},void 0),d.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:536,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:530,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:520,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:515,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:514,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:513,columnNumber:7},void 0),d.jsxDEV("div",{className:"max-w-7xl mx-auto p-6",children:[d.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg mb-6",children:[d.jsxDEV("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-800 transition-colors",onClick:()=>M(!P),children:[d.jsxDEV("div",{className:"flex items-center gap-2",children:[d.jsxDEV(N,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:552,columnNumber:15},void 0),d.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono",children:"数据筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:553,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:551,columnNumber:13},void 0),d.jsxDEV("div",{className:"flex items-center gap-2",children:[d.jsxDEV("span",{className:"text-sm text-gray-400 font-mono",children:P?"展开筛选":"收起筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:556,columnNumber:15},void 0),P?d.jsxDEV(x,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:560,columnNumber:17},void 0):d.jsxDEV(v,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:562,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:555,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:547,columnNumber:11},void 0),!P&&d.jsxDEV("div",{className:"px-4 pb-4 border-t border-gray-700",children:d.jsxDEV("div",{className:"space-y-4 mt-4",children:[d.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[d.jsxDEV("div",{children:[d.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:574,columnNumber:21},void 0),d.jsxDEV("input",{type:"month",value:j.yearMonth,onChange:e=>E(i(o({},j),{yearMonth:e.target.value})),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:577,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:573,columnNumber:19},void 0),d.jsxDEV("div",{children:[d.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:586,columnNumber:21},void 0),d.jsxDEV("select",{value:j.userId,onChange:e=>E(i(o({},j),{userId:e.target.value})),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400",children:[d.jsxDEV("option",{value:"",children:"全部员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:594,columnNumber:23},void 0),_.map(e=>d.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:596,columnNumber:25},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:589,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:585,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:572,columnNumber:17},void 0),d.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[d.jsxDEV("div",{children:[d.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"开始日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:605,columnNumber:21},void 0),d.jsxDEV("input",{type:"date",value:j.startDate,onChange:e=>E(i(o({},j),{startDate:e.target.value})),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:608,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:604,columnNumber:19},void 0),d.jsxDEV("div",{children:[d.jsxDEV("label",{className:"block text-green-300 text-xs sm:text-sm font-medium mb-1 sm:mb-2 font-mono",children:"结束日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:617,columnNumber:21},void 0),d.jsxDEV("input",{type:"date",value:j.endDate,onChange:e=>E(i(o({},j),{endDate:e.target.value})),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono text-xs sm:text-sm focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:620,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:616,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:603,columnNumber:17},void 0),d.jsxDEV("div",{className:"flex justify-start",children:d.jsxDEV("button",{onClick:()=>{E({yearMonth:"",startDate:"",endDate:"",userId:""}),D({key:"work_date",direction:"desc"}),w.success("筛选条件已重置")},className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 text-green-300 hover:text-green-200 rounded font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 flex items-center gap-2 text-xs sm:text-sm",children:[d.jsxDEV(h,{className:"w-3 h-3 sm:w-4 sm:h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:635,columnNumber:21},void 0),"重置筛选"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:631,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:630,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:570,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:569,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:545,columnNumber:9},void 0),d.jsxDEV("div",{className:"mb-4",children:d.jsxDEV("h2",{className:"text-xl font-bold text-green-400 font-mono flex items-center gap-2",children:[d.jsxDEV(c,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:649,columnNumber:13},void 0),"详细工时记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:648,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:647,columnNumber:9},void 0),0===m.length?d.jsxDEV("div",{className:"bg-gray-900 rounded-lg border border-gray-700 p-8 text-center",children:[d.jsxDEV("div",{className:"text-green-600 mb-4",children:d.jsxDEV(c,{className:"h-16 w-16 mx-auto"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:658,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:657,columnNumber:13},void 0),d.jsxDEV("h3",{className:"text-lg font-medium text-green-400 mb-2 font-mono",children:"暂无历史记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:660,columnNumber:13},void 0),d.jsxDEV("p",{className:"text-green-600 font-mono",children:"请调整筛选条件或添加新的工时记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:661,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:656,columnNumber:11},void 0):d.jsxDEV("div",{className:"space-y-6",children:(()=>{const e=new Map;m.forEach(t=>{var s;const m=t.user_id;e.has(m)||e.set(m,{userName:(null==(s=t.user)?void 0:s.name)||"未知用户",records:[]}),e.get(m).records.push(t)});return Array.from(e.values()).sort((e,t)=>e.userName.localeCompare(t.userName)).map((e,t)=>{const s=new Map;e.records.forEach(e=>{const t=e.work_date;s.has(t)||s.set(t,[]),s.get(t).push(e)});const m=Array.from(s.keys()).sort((e,t)=>new Date(t).getTime()-new Date(e).getTime()),r=e.records.filter(e=>"pending"===e.status),n=e.records.filter(e=>"approved"===e.status),a=[...new Set(r.map(e=>e.work_date))],l=[...new Set(n.map(e=>e.work_date))],u={supervisorPending:a.length,sectionChiefPending:l.length,totalWorkDays:m.length};return d.jsxDEV("div",{className:"bg-gray-900 rounded-lg border border-gray-700 overflow-hidden",children:[d.jsxDEV("div",{className:"bg-gray-800 px-4 py-3 border-b border-gray-600 cursor-pointer hover:bg-gray-700 transition-colors",onClick:()=>Q(e.userName),children:d.jsxDEV("div",{className:"flex items-center justify-between",children:d.jsxDEV("div",{className:"flex items-center gap-4",children:[d.jsxDEV("h3",{className:"text-lg font-bold text-green-400 font-mono flex items-center gap-2",children:[e.userName,$.has(e.userName)?d.jsxDEV(x,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:733,columnNumber:31},void 0):d.jsxDEV(v,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:735,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:730,columnNumber:27},void 0),d.jsxDEV("div",{className:"flex items-center gap-4 text-xs",children:[d.jsxDEV("div",{className:"text-center",children:[d.jsxDEV("div",{className:"text-yellow-400 font-mono font-bold",children:u.supervisorPending},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:742,columnNumber:31},void 0),d.jsxDEV("div",{className:"text-gray-400 font-mono",children:"班长待审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:743,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:741,columnNumber:29},void 0),d.jsxDEV("div",{className:"text-center",children:[d.jsxDEV("div",{className:"text-orange-400 font-mono font-bold",children:u.sectionChiefPending},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:746,columnNumber:31},void 0),d.jsxDEV("div",{className:"text-gray-400 font-mono",children:"段长待审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:747,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:745,columnNumber:29},void 0),d.jsxDEV("div",{className:"text-center",children:[d.jsxDEV("div",{className:"text-blue-400 font-mono font-bold",children:u.totalWorkDays},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:750,columnNumber:31},void 0),d.jsxDEV("div",{className:"text-gray-400 font-mono",children:"工作天数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:751,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:749,columnNumber:29},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:740,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:729,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:728,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:724,columnNumber:21},void 0),!$.has(e.userName)&&d.jsxDEV("div",{className:"p-4 space-y-4",children:m.map(t=>{const m=s.get(t),r=`${e.userName}-${t}`,n=$.has(r);return d.jsxDEV("div",{className:"space-y-3",children:[d.jsxDEV("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>Q(r),children:[d.jsxDEV("div",{className:"w-2 h-2 bg-green-400 rounded-full"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:773,columnNumber:33},void 0),d.jsxDEV("h4",{className:"text-md font-semibold text-green-300 font-mono flex items-center gap-2",children:[W(t),n?d.jsxDEV(x,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:777,columnNumber:37},void 0):d.jsxDEV(v,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:779,columnNumber:37},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:774,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:769,columnNumber:31},void 0),!n&&d.jsxDEV("div",{className:"space-y-2",children:m.map(e=>e.items.map((t,s)=>{var m,r,n;return d.jsxDEV("div",{className:"bg-gray-800 rounded-lg p-3 border border-gray-600 hover:border-gray-500 transition-colors",children:d.jsxDEV("div",{className:"space-y-3",children:[d.jsxDEV("div",{className:"flex justify-between items-start gap-3",children:[d.jsxDEV("div",{className:"flex-1",children:[d.jsxDEV("div",{className:"text-xs text-gray-400 font-mono mb-1",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:794,columnNumber:47},void 0),d.jsxDEV("div",{className:"text-sm text-green-300 font-mono break-words",children:`${(null==(m=t.processes)?void 0:m.production_line)||"未知"} - ${(null==(r=t.processes)?void 0:r.product_name)||"未知"} - ${(null==(n=t.processes)?void 0:n.product_process)||"未知"}`},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:795,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:793,columnNumber:45},void 0),d.jsxDEV("div",{className:"text-right",children:[d.jsxDEV("div",{className:"text-xs text-gray-400 font-mono mb-1",children:"数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:800,columnNumber:47},void 0),d.jsxDEV("div",{className:"text-sm text-yellow-400 font-mono font-semibold",children:t.quantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:801,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:799,columnNumber:45},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:792,columnNumber:43},void 0),d.jsxDEV("div",{className:"flex justify-between items-start gap-2 text-xs",children:[d.jsxDEV("div",{className:"flex gap-4 flex-1",children:[d.jsxDEV("div",{className:"flex-1",children:[d.jsxDEV("div",{className:"text-gray-400 font-mono mb-1",children:"班长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:811,columnNumber:49},void 0),d.jsxDEV("div",{className:"text-green-300 font-mono",children:(()=>{var t;const s=L(e,"supervisor"),m=(null==(t=e.supervisor)?void 0:t.name)||"未分配";return s?d.jsxDEV("div",{className:"flex flex-col",children:[d.jsxDEV("div",{className:"truncate",children:s.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:819,columnNumber:59},void 0),d.jsxDEV("div",{className:"text-xs text-gray-400",children:s.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:820,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:818,columnNumber:57},void 0):d.jsxDEV("div",{className:"truncate",children:m},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:824,columnNumber:60},void 0)})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:812,columnNumber:49},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:810,columnNumber:47},void 0),d.jsxDEV("div",{className:"flex-1",children:[d.jsxDEV("div",{className:"text-gray-400 font-mono mb-1",children:"段长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:829,columnNumber:49},void 0),d.jsxDEV("div",{className:"text-green-300 font-mono",children:(()=>{var t;const s=L(e,"section_chief"),m=(null==(t=e.section_chief)?void 0:t.name)||"未分配";return s?d.jsxDEV("div",{className:"flex flex-col",children:[d.jsxDEV("div",{className:"truncate",children:s.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:837,columnNumber:59},void 0),d.jsxDEV("div",{className:"text-xs text-gray-400",children:s.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:838,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:836,columnNumber:57},void 0):d.jsxDEV("div",{className:"truncate",children:m},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:842,columnNumber:60},void 0)})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:830,columnNumber:49},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:828,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:809,columnNumber:45},void 0),d.jsxDEV("div",{className:"text-right",children:[d.jsxDEV("div",{className:"text-gray-400 font-mono mb-1",children:"状态"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:848,columnNumber:47},void 0),d.jsxDEV("div",{className:"flex items-center justify-end",children:F(e.status)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:849,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:847,columnNumber:45},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:808,columnNumber:43},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:790,columnNumber:41},void 0)},`${e.id}-${s}`,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:789,columnNumber:39},void 0)}))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:786,columnNumber:33},void 0)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:767,columnNumber:29},void 0)})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:760,columnNumber:23},void 0),!$.has(e.userName)&&(()=>{const t=e.records.flatMap(e=>e.items.map(t=>i(o({},t),{workDate:e.work_date}))),s=new Map;t.forEach(e=>{var t,m,r,n,a,o,i;const l=`${(null==(t=e.processes)?void 0:t.production_line)||"未知"}-${(null==(m=e.processes)?void 0:m.product_name)||"未知"}-${(null==(r=e.processes)?void 0:r.product_process)||"未知"}`;s.has(l)||s.set(l,{productionLine:(null==(n=e.processes)?void 0:n.production_line)||"未知",productName:(null==(a=e.processes)?void 0:a.product_name)||"未知",productProcess:(null==(o=e.processes)?void 0:o.product_process)||"未知",productionCategory:(null==(i=e.processes)?void 0:i.production_category)||"未知",totalQuantity:0,recordCount:0});const u=s.get(l);u.totalQuantity+=e.quantity,u.recordCount+=1});const m=Array.from(s.values()).sort((e,t)=>t.totalQuantity-e.totalQuantity);return 0===m.length?null:d.jsxDEV("div",{className:"mt-4 bg-gray-900 rounded-lg p-3 border border-gray-600",children:[d.jsxDEV("h6",{className:"text-sm font-bold text-blue-400 font-mono mb-3 flex items-center gap-2",children:[d.jsxDEV(b,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:910,columnNumber:29},void 0),e.userName," - 数量统计汇总"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:909,columnNumber:27},void 0),d.jsxDEV("div",{className:"w-full",children:d.jsxDEV("table",{className:"w-full table-fixed",children:[d.jsxDEV("thead",{className:"bg-gray-800",children:d.jsxDEV("tr",{children:[d.jsxDEV("th",{className:"px-1 py-2 text-left text-blue-400 font-mono text-xs w-[50%] sm:w-[60%]",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:918,columnNumber:35},void 0),d.jsxDEV("th",{className:"px-1 py-2 text-left text-blue-400 font-mono text-xs w-[25%] sm:w-[20%]",children:"数量总计"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:919,columnNumber:35},void 0),d.jsxDEV("th",{className:"px-1 py-2 text-left text-blue-400 font-mono text-xs w-[25%] sm:w-[20%]",children:"记录条数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:920,columnNumber:35},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:917,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:916,columnNumber:31},void 0),d.jsxDEV("tbody",{children:m.map((e,t)=>d.jsxDEV("tr",{className:"border-b border-gray-700 hover:bg-gray-800 transition-colors",children:[d.jsxDEV("td",{className:"px-1 py-2 text-green-300 font-mono text-xs",children:d.jsxDEV("div",{className:"break-words text-xs leading-tight",children:`${e.productionLine} - ${e.productName} - ${e.productProcess}`},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:927,columnNumber:39},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:926,columnNumber:37},void 0),d.jsxDEV("td",{className:"px-1 py-2 text-yellow-400 font-mono text-xs font-bold",children:e.totalQuantity.toFixed(1)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:931,columnNumber:37},void 0),d.jsxDEV("td",{className:"px-1 py-2 text-blue-400 font-mono text-xs",children:e.recordCount},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:934,columnNumber:37},void 0)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:925,columnNumber:35},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:923,columnNumber:31},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:915,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:914,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:908,columnNumber:25},void 0)})()]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:722,columnNumber:19},void 0)})})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:664,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:543,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/History.tsx",lineNumber:511,columnNumber:5},void 0)};export{k as default};
