var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,s,m)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:m}):t[s]=m,o=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&i(e,s,t[s]);if(m)for(var s of m(t))r.call(t,s)&&i(e,s,t[s]);return e},a=(e,m)=>t(e,s(m)),l=(e,t,s)=>new Promise((m,n)=>{var r=e=>{try{o(s.next(e))}catch(t){n(t)}},i=e=>{try{o(s.throw(e))}catch(t){n(t)}},o=e=>e.done?m(e.value):Promise.resolve(e.value).then(r,i);o((s=s.apply(e,t)).next())});import{j as c,X as d,d as u,r as h,i as g,z as p,f as y,l as x,U as N,D as f}from"./react-core-CEw6lU7H.js";import{t as b}from"./ui-BmDV7GQB.js";import{u as v,i as _,s as w}from"./index-D4m2Xi5e.js";import"./vendor-Dj0T90Ik.js";import"./supabase-DInoECZ_.js";function k({isOpen:e,onClose:t,onConfirm:s,record:m,items:n,productionLines:r,supervisors:i,sectionLeaders:o,workTypes:a,products:l,processes:u}){if(!e)return null;const h=e=>{var t;return(null==(t=a.find(t=>t.id===e))?void 0:t.name)||"未知工时类型"},g=e=>{var t;return(null==(t=l.find(t=>t.id===e))?void 0:t.name)||"未知产品"},p=e=>{var t;return(null==(t=u.find(t=>t.id===e))?void 0:t.product_process)||"未知工序"};return c.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[c.jsxDEV("div",{className:"flex justify-between items-center mb-6",children:[c.jsxDEV("h2",{className:"text-xl font-bold text-green-400",children:"确认提交工时记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:86,columnNumber:11},this),c.jsxDEV("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:c.jsxDEV(d,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:91,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:87,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:85,columnNumber:9},this),c.jsxDEV("div",{className:"space-y-6",children:[c.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-4",children:[c.jsxDEV("h3",{className:"text-lg font-semibold text-green-300 mb-4",children:"基本信息"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:98,columnNumber:13},this),c.jsxDEV("div",{className:"space-y-2",children:[c.jsxDEV("div",{className:"flex justify-between",children:[c.jsxDEV("div",{children:[c.jsxDEV("span",{className:"text-green-300 font-medium",children:"记录日期："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:103,columnNumber:19},this),c.jsxDEV("span",{className:"text-white",children:m.record_date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:104,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:102,columnNumber:17},this),c.jsxDEV("div",{children:[c.jsxDEV("span",{className:"text-green-300 font-medium",children:"生产线："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:107,columnNumber:19},this),c.jsxDEV("span",{className:"text-white",children:(x=m.production_line_id,x?(null==(N=r.find(e=>e.id===x))?void 0:N.name)||"未知生产线":"未选择")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:108,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:106,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:101,columnNumber:15},this),c.jsxDEV("div",{className:"flex justify-between",children:[c.jsxDEV("div",{children:[c.jsxDEV("span",{className:"text-green-300 font-medium",children:"班次："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:114,columnNumber:19},this),c.jsxDEV("span",{className:"text-white",children:(y=m.shift_type,"白班"===y||"day"===y?"白班":"夜班"===y||"night"===y?"夜班":"未知班次")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:115,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:113,columnNumber:17},this),c.jsxDEV("div",{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:117,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:112,columnNumber:15},this),c.jsxDEV("div",{className:"flex justify-between",children:[c.jsxDEV("div",{children:[c.jsxDEV("span",{className:"text-green-300 font-medium",children:"班长："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:122,columnNumber:19},this),c.jsxDEV("span",{className:"text-white",children:(e=>{var t;return e?(null==(t=i.find(t=>t.id.toString()===e))?void 0:t.name)||"未知班长":"未选择"})(m.supervisor_id)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:123,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:121,columnNumber:17},this),c.jsxDEV("div",{children:[c.jsxDEV("span",{className:"text-green-300 font-medium",children:"段长："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:126,columnNumber:19},this),c.jsxDEV("span",{className:"text-white",children:(e=>{var t;return e?(null==(t=o.find(t=>t.id.toString()===e))?void 0:t.name)||"未知段长":"未选择"})(m.section_chief_id)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:127,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:125,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:120,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:99,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:97,columnNumber:11},this),c.jsxDEV("div",{className:"bg-gray-800 border border-green-400 rounded-lg p-4",children:[c.jsxDEV("h3",{className:"text-lg font-semibold text-green-300 mb-4",children:["工时记录项 (",n.length,"项)"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:135,columnNumber:13},this),c.jsxDEV("div",{className:"overflow-x-auto",children:c.jsxDEV("table",{className:"w-full text-sm",children:[c.jsxDEV("thead",{children:c.jsxDEV("tr",{className:"border-b border-green-400",children:[c.jsxDEV("th",{className:"text-left text-green-300 py-2 px-2",children:"序号"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:140,columnNumber:21},this),c.jsxDEV("th",{className:"text-left text-green-300 py-2 px-2",children:"工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:141,columnNumber:21},this),c.jsxDEV("th",{className:"text-left text-green-300 py-2 px-2",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:142,columnNumber:21},this),c.jsxDEV("th",{className:"text-left text-green-300 py-2 px-2",children:"工序名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:143,columnNumber:21},this),c.jsxDEV("th",{className:"text-left text-green-300 py-2 px-2",children:"数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:144,columnNumber:21},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:139,columnNumber:19},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:138,columnNumber:17},this),c.jsxDEV("tbody",{children:n.map((e,t)=>c.jsxDEV("tr",{className:"border-b border-gray-600",children:[c.jsxDEV("td",{className:"py-2 px-2 text-white",children:t+1},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:150,columnNumber:23},this),c.jsxDEV("td",{className:"py-2 px-2 text-white",children:h(e.work_type_id)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:151,columnNumber:23},this),c.jsxDEV("td",{className:"py-2 px-2 text-white",children:g(e.product_id)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:152,columnNumber:23},this),c.jsxDEV("td",{className:"py-2 px-2 text-white",children:p(e.process_id)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:153,columnNumber:23},this),c.jsxDEV("td",{className:"py-2 px-2 text-white",children:e.quantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:154,columnNumber:23},this)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:149,columnNumber:21},this))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:147,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:137,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:136,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:134,columnNumber:11},this),c.jsxDEV("div",{className:"bg-yellow-900/30 border border-yellow-600 rounded-lg p-2 mb-4",children:c.jsxDEV("p",{className:"text-yellow-300 text-xs",children:"⚠️ 数据提交后将不可修改，请仔细核对以上信息是否正确。数据确认提交后，需要等待班长和段长审核通过。"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:164,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:163,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:95,columnNumber:9},this),c.jsxDEV("div",{className:"flex justify-end gap-4 mt-6",children:[c.jsxDEV("button",{onClick:t,className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:172,columnNumber:11},this),c.jsxDEV("button",{onClick:s,className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors",children:"确认提交"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:178,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:171,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:84,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/TimesheetConfirmDialog.tsx",lineNumber:83,columnNumber:5},this);var y,x,N}function D(){var e,t,s;const{user:m,isAuthenticated:n,refreshUser:r}=v(),i=u(),[d,D]=h.useState(!0),[j,T]=h.useState([]),[E,V]=h.useState([]),[C,R]=h.useState([]),[S,q]=h.useState([]),[L,P]=h.useState([]),[O,I]=h.useState([]),[W,F]=h.useState([]),[z,$]=h.useState(null),[B,M]=h.useState([]),[A,U]=h.useState([]),[G,H]=h.useState({user_id:(null==m?void 0:m.id)||"",record_date:(new Date).toISOString().split("T")[0],production_line_id:0,supervisor_id:null,section_chief_id:null,shift_type:"白班",status:"draft",items:[]}),[J,K]=h.useState({work_type_id:0,product_id:0,process_id:"",quantity:0}),[Q,X]=h.useState(""),Y=()=>({work_type_id:E.length>0?E[0].id:1,product_id:0,process_id:"",quantity:0}),[Z,ee]=h.useState([Y()]),[te,se]=h.useState({}),[me,ne]=h.useState({}),[re,ie]=h.useState(""),[oe,ae]=h.useState(!1),[le,ce]=h.useState(""),[de,ue]=h.useState(!1),[he,ge]=h.useState(""),[pe,ye]=h.useState(!1),[xe,Ne]=h.useState(""),[fe,be]=h.useState(!1),[ve,_e]=h.useState({}),[we,ke]=h.useState({}),[De,je]=h.useState({}),[Te,Ee]=h.useState({}),[Ve,Ce]=h.useState(!1),[Re,Se]=h.useState(!1),qe=()=>l(this,null,function*(){if(m)try{const{data:e,error:t}=yield w.from("users").select("company_id").eq("id",m.id).single();if(t)throw t;$(e.company_id)}catch(e){b.error("获取用户公司信息失败")}});h.useEffect(()=>{const e=e=>{const t=e.target;t.closest(".production-line-dropdown")||ae(!1),t.closest(".supervisor-dropdown")||ue(!1),t.closest(".section-leader-dropdown")||ye(!1),t.closest(".shift-dropdown")||be(!1),t.closest(".work-type-dropdown")||ke({}),t.closest(".process-dropdown")||Ee({}),t.closest(".product-dropdown")||ne({})};return(oe||de||pe||fe||Object.values(we).some(Boolean)||Object.values(Te).some(Boolean)||Object.values(me).some(Boolean))&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[oe,de,pe,fe,we,Te,me]),h.useEffect(()=>{m&&Le()},[m]),h.useEffect(()=>{G.production_line_id?(H(e=>a(o({},e),{supervisor_id:null,section_chief_id:null})),ze(G.production_line_id.toString()),$e(G.production_line_id.toString())):(I([]),F([]),H(e=>a(o({},e),{supervisor_id:null,section_chief_id:null})))},[G.production_line_id,j]),h.useEffect(()=>{G.production_line_id?(K(e=>a(o({},e),{work_type_id:0,product_id:0,process_id:""})),X(""),Oe(),Ie(),We()):(console.log("🧹 清空所有三级联动数据"),V([]),R([]),q([]),K(e=>a(o({},e),{work_type_id:0,product_id:0,process_id:""})),X(""))},[G.production_line_id,j]),h.useEffect(()=>{1===j.length&&0===G.production_line_id&&H(e=>a(o({},e),{production_line_id:j[0].id}))},[j,G.production_line_id]),h.useEffect(()=>{if(G.production_line_id&&!G.supervisor_id&&L.length>0&&z){const e=L.filter(e=>{var t;if("班长"!==(null==(t=e.role)?void 0:t.name))return!1;if(e.company_id!==z)return!1;if(G.production_line_id){const e=j.find(e=>e.id===G.production_line_id);if(e){return S.filter(t=>t.production_line===e.name).length>0}}return!0});1===e.length&&H(t=>a(o({},t),{supervisor_id:e[0].id}))}},[G.production_line_id,G.supervisor_id,L,z,j,S]),h.useEffect(()=>{if(G.production_line_id&&!G.section_chief_id&&L.length>0&&z){const e=L.filter(e=>{var t;if("段长"!==(null==(t=e.role)?void 0:t.name))return!1;if(e.company_id!==z)return!1;if(G.production_line_id){const e=j.find(e=>e.id===G.production_line_id);if(e){return S.filter(t=>t.production_line===e.name).length>0}}return!0});1===e.length&&H(t=>a(o({},t),{section_chief_id:e[0].id}))}},[G.production_line_id,G.section_chief_id,L,z,j,S]),h.useEffect(()=>{if(E.length>0&&G.production_line_id&&S.length>0){const e=E.find(e=>e.id===J.work_type_id);if(!e&&E.length>0)return void K(e=>a(o({},e),{work_type_id:E[0].id}));if(e){const e=J.work_type_id;Me(e)}}},[E,G.production_line_id,S,J.work_type_id]),h.useEffect(()=>{1===C.length&&0===J.product_id&&K(e=>a(o({},e),{product_id:C[0].id}))},[C,J.product_id]),h.useEffect(()=>{1===S.length&&""===J.process_id&&K(e=>a(o({},e),{process_id:S[0].id}))},[S,J.process_id]);const Le=()=>l(this,null,function*(){if(m)try{D(!0),yield Promise.all([qe(),Pe(),Fe()])}catch(e){b.error("加载数据失败")}finally{D(!1)}}),Pe=()=>l(this,null,function*(){if(m)try{const e=_(m.role);let t=w.from("processes").select("id, production_line, company_id, is_active").eq("is_active",!0).order("production_line");if(e);else{const{data:e,error:s}=yield w.from("users").select("company_id").eq("id",m.id).single();if(s)throw console.error("loadProductionLines: 获取用户公司信息失败:",s),s;console.log("loadProductionLines: 用户公司ID:",e.company_id),t=t.eq("company_id",e.company_id)}const{data:s,error:n}=yield t;if(n)throw console.error("loadProductionLines: 查询processes表失败:",n),n;console.log("loadProductionLines: 查询到的processes数据:",s);const r=new Map;null==s||s.forEach(e=>{e.production_line&&r.set(e.production_line,{company_id:e.company_id,is_active:e.is_active})});const i=Array.from(r.entries()).map(([e,t],s)=>({id:s+1,name:e,is_active:t.is_active,company_id:t.company_id}));T(i)}catch(e){b.error("加载生产线信息失败")}}),Oe=()=>l(this,null,function*(){if(m)try{if(!G.production_line_id)return void V([]);const e=j.find(e=>e.id===G.production_line_id);if(!e)return void V([]);let t;if(_(m.role)){if(!e.company_id)return console.error("loadWorkTypes: 生产线缺少company_id信息"),void V([]);t=e.company_id}else{const{data:e,error:s}=yield w.from("users").select("company_id").eq("id",m.id).single();if(s)throw s;t=e.company_id}const{data:s,error:n}=yield w.from("processes").select("production_category").eq("company_id",t).eq("production_line",e.name).eq("is_active",!0).not("production_category","is",null);if(n)throw n;const r=[...new Set((null==s?void 0:s.map(e=>e.production_category))||[])].filter(e=>e&&isNaN(Number(e))).sort().map((e,t)=>({id:t+1,name:e,is_active:!0}));V(r)}catch(e){b.error("加载工时类型数据失败")}}),Ie=()=>l(this,null,function*(){if(m)try{if(console.log("loadProducts: 开始加载产品数据，用户ID:",m.id),!G.production_line_id)return console.log("loadProducts: 未选择生产线，清空产品"),void R([]);const e=j.find(e=>e.id===G.production_line_id);if(!e)return console.log("loadProducts: 未找到对应的生产线信息"),void R([]);console.log("loadProducts: 当前选择的生产线:",e.name);let t;if(_(m.role)){if(!e.company_id)return console.error("loadProducts: 生产线缺少company_id信息"),void R([]);t=e.company_id,console.log("loadProducts: 超级管理员使用生产线公司ID:",t)}else{const{data:e,error:s}=yield w.from("users").select("company_id").eq("id",m.id).single();if(s)throw console.error("loadProducts: 获取用户公司信息失败:",s),s;t=e.company_id,console.log("loadProducts: 普通用户使用自己的公司ID:",t)}const{data:s,error:n}=yield w.from("processes").select("id, product_name, production_line").eq("company_id",t).eq("production_line",e.name).eq("is_active",!0);if(n)throw console.error("loadProducts: 查询processes表失败:",n),n;console.log("loadProducts: 查询到的原始产品数据:",s);const r=[...new Set((null==s?void 0:s.map(e=>e.product_name))||[])].filter(Boolean).sort().map((e,t)=>({id:t+1,name:e,code:"",is_active:!0}));console.log("loadProducts: 去重后的产品数据:",r),R(r)}catch(e){console.error("loadProducts: 加载产品数据失败:",e),b.error("加载产品数据失败")}}),We=()=>l(this,null,function*(){if(m)try{if(console.log("loadProcesses: 开始加载工序数据，用户ID:",m.id),!G.production_line_id)return console.log("loadProcesses: 未选择生产线，清空工序"),void q([]);const e=j.find(e=>e.id===G.production_line_id);if(!e)return console.log("loadProcesses: 未找到对应的生产线信息"),void q([]);console.log("loadProcesses: 当前选择的生产线:",e.name);let t;if(_(m.role)){if(!e.company_id)return console.error("loadProcesses: 生产线缺少company_id信息"),void q([]);t=e.company_id,console.log("loadProcesses: 超级管理员使用生产线公司ID:",t)}else{const{data:e,error:s}=yield w.from("users").select("company_id").eq("id",m.id).single();if(s)throw console.error("loadProcesses: 获取用户公司信息失败:",s),s;t=e.company_id,console.log("loadProcesses: 普通用户使用自己的公司ID:",t)}const{data:s,error:n}=yield w.from("processes").select("id, product_process, product_name, company_id, production_line, production_category, unit_price, is_active").eq("company_id",t).eq("production_line",e.name).eq("is_active",!0).order("product_process");if(n)throw console.error("loadProcesses: 查询processes表失败:",n),n;console.log("loadProcesses: 查询到的原始数据:",s);const r=(null==s?void 0:s.map(e=>({id:e.id,name:e.product_process,product_name:e.product_name,company_id:e.company_id,production_line:e.production_line,production_category:e.production_category,product_process:e.product_process,unit_price:e.unit_price,is_active:e.is_active})))||[];q(r)}catch(e){b.error("加载工序数据失败")}}),Fe=()=>l(this,null,function*(){const{data:e,error:t}=yield w.from("users").select("id, name, company_id, production_line, role:user_roles!inner(name)").eq("is_active",!0).order("name");if(t)throw t;P(e||[])}),ze=e=>l(this,null,function*(){if(e)try{const t=j.find(t=>t.id===parseInt(e));if(!t)return void I([]);const{data:s,error:m}=yield w.from("users").select("\n          id, \n          name, \n          production_line,\n          role:user_roles!inner(name)\n        ").eq("production_line",t.name).eq("user_roles.name","班长").eq("is_active",!0).order("name");if(m)throw m;I(s||[]),s&&1===s.length&&!G.supervisor_id&&H(e=>a(o({},e),{supervisor_id:s[0].id}))}catch(t){b.error("加载班长数据失败"),I([])}else I([])}),$e=e=>l(this,null,function*(){if(e)try{const t=j.find(t=>t.id===parseInt(e));if(!t)return void F([]);const{data:s,error:m}=yield w.from("users").select("\n          id, \n          name, \n          production_line,\n          role:user_roles!inner(name)\n        ").eq("production_line",t.name).eq("user_roles.name","段长").eq("is_active",!0).order("name");if(m)throw m;F(s||[]),s&&1===s.length&&!G.section_chief_id&&H(e=>a(o({},e),{section_chief_id:s[0].id}))}catch(t){b.error("加载段长数据失败"),F([])}else F([])}),Be=(e,t)=>{H(s=>{let m=t;"production_line_id"===e?m=parseInt(t)||0:"supervisor_id"!==e&&"section_chief_id"!==e||(m=t||null);const n=a(o({},s),{[e]:m});return"production_line_id"===e&&(n.supervisor_id=null,n.section_chief_id=null),n})},Me=e=>{if(K(t=>a(o({},t),{work_type_id:e,product_id:0,process_id:""})),X(""),0===e)return M([]),void U([]);const t=E.find(t=>t.id===e);if(!t)return console.error("handleWorkTypeChange: 未找到对应的工时类型:",e),M([]),void U([]);console.log("handleWorkTypeChange: 选择的工时类型名称:",t.name);const s=Ae();if(console.log("handleWorkTypeChange: 用户生产线:",s),console.log("handleWorkTypeChange: 所有工序数据:",S),console.log("handleWorkTypeChange: 所有产品数据:",C),s){const e=S.filter(e=>{const m=e.production_line===s,n=e.production_category===t.name,r=m&&n;return console.log(`handleWorkTypeChange: 工序 ${e.product_process} 生产线匹配:${m} 工时类型匹配:${n} 总匹配:${r}`),r});console.log("handleWorkTypeChange: 按生产线和工时类型过滤的工序:",e);const m=e.map(e=>e.product_name).filter((e,t,s)=>e&&s.indexOf(e)===t).filter(Boolean);console.log("handleWorkTypeChange: 可用产品列表:",m),M(m)}else console.log("handleWorkTypeChange: 用户生产线为空，清空产品列表"),M([]);U([])},Ae=()=>{if(G.production_line_id){const e=j.find(e=>e.id===G.production_line_id);return null==e?void 0:e.name}return null},Ue=(e,t,s)=>{ee(m=>{const n=[...m];let r=s;return"work_type_id"===t||"product_id"===t?r=parseInt(s)||0:"process_id"===t?r=s||"":"quantity"===t&&(r=parseFloat(s)||0),n[e]=a(o({},n[e]),{[t]:r}),"work_type_id"===t?(n[e].product_id=0,n[e].process_id="",se(t=>a(o({},t),{[e]:""}))):"product_id"===t&&(n[e].process_id=""),n})},Ge=e=>{if(!e||!G.production_line_id)return[];const t=E.find(t=>t.id===e),s=Ae();if(!t||!s)return[];const m=S.filter(e=>e.production_line===s&&e.production_category===t.name&&e.is_active);return[...new Set(m.map(e=>e.product_name))].map((e,t)=>({id:t+1,name:e}))},He=(e,t)=>{if(!e)return[];const s=Ae();if(!s)return[];const m=(t?Ge(t):[]).find(t=>t.id===e);if(!m)return[];return S.filter(e=>e.production_line===s&&e.product_name===m.name&&e.is_active)},Je=()=>l(this,null,function*(){const e=Z.filter(e=>e.work_type_id&&e.process_id&&e.quantity>0),t=[...G.items,...e.map(e=>a(o({},e),{total_amount:e.quantity}))];e.length>0&&b.success(`成功添加 ${e.length} 条工时记录`),yield Ke(t)}),Ke=e=>l(this,null,function*(){var t,s;let n;if(!m)return void b.error("❌ 用户未登录，请重新登录后再试",{duration:5e3,description:"登录状态已过期，请刷新页面重新登录"});if(!G.supervisor_id)return void b.error("❌ 请选择班长",{duration:4e3,description:"班长是必填项，请在基本信息中选择班长"});if(!G.section_chief_id)return void b.error("❌ 请选择段长",{duration:4e3,description:"段长是必填项，请在基本信息中选择段长"});const r=e||G.items;if(0!==r.length){b.loading("🔄 正在提交工时记录，请稍候...",{id:"submit-loading",description:`正在提交 ${r.length} 条工时记录到审核系统`});try{D(!0);try{const{data:e,error:t}=yield w.from("users").select("id").limit(1);if(t)throw new Error(`数据库连接失败: ${t.message}`)}catch(o){return void b.error("数据库连接失败，请检查网络连接")}if(!(null==m?void 0:m.id))return void b.error("用户信息无效，请重新登录");n={user_id:m.id,work_date:G.record_date,supervisor_id:G.supervisor_id,section_chief_id:G.section_chief_id,shift_type:G.shift_type,status:"pending"};const{data:t,error:s}=yield w.from("timesheet_records").insert(n).select().single();if(s)throw s;const r=(e||G.items).map(e=>{const s=S.find(t=>t.id===e.process_id),m=s&&null!==s.unit_price?parseFloat(s.unit_price.toString()):0;return{timesheet_record_id:t.id,process_id:e.process_id,quantity:e.quantity,unit_price:m,amount:e.quantity*m}}),{error:a}=yield w.from("timesheet_record_items").insert(r);if(a)throw a;const l=O.find(e=>e.id===G.supervisor_id);null==l||l.name;b.dismiss("submit-loading"),b.success("数据提交成功返回首页",{duration:1500}),setTimeout(()=>{i("/dashboard")},1500),ee([Y()]),H({user_id:m.id,record_date:(new Date).toISOString().split("T")[0],production_line_id:0,supervisor_id:null,section_chief_id:null,shift_type:"白班",status:"draft",items:[]})}catch(a){b.dismiss("submit-loading");let e="❌ 工时记录提交失败",n="请检查网络连接后重试，如问题持续请联系管理员";"42501"===(null==a?void 0:a.code)?(e="❌ 权限不足，提交失败",n="您没有权限创建工时记录，请联系管理员检查数据库权限配置。如果您是新员工，可能需要管理员为您分配相应权限。"):"23502"===(null==a?void 0:a.code)?(e="❌ 数据验证失败",n="提交的数据缺少必填字段，请检查所有必填项（生产线、班长、段长、工时记录项）是否已正确填写。"):"23503"===(null==a?void 0:a.code)?(e="❌ 数据关联错误",n="您选择的生产线、班长或段长可能已被删除或无效，请重新选择后再试。如问题持续，请联系管理员。"):"42703"===(null==a?void 0:a.code)?(e="❌ 数据格式错误",n="提交的数据格式不正确，这可能是系统版本问题，请联系技术支持。"):(null==(t=null==a?void 0:a.message)?void 0:t.includes("网络"))||(null==(s=null==a?void 0:a.message)?void 0:s.includes("连接"))?(e="❌ 网络连接失败",n="无法连接到服务器，请检查您的网络连接，稍后再试。如果问题持续，请联系IT支持。"):(null==a?void 0:a.message)&&(e="❌ 提交失败",n=`错误详情: ${a.message}。请截图此错误信息并联系管理员。`),b.error(e,{duration:8e3,description:n,action:{label:"重试",onClick:()=>{Ce(!0)}}}),console.error("工时记录提交失败:",{error:a,errorCode:null==a?void 0:a.code,errorMessage:null==a?void 0:a.message,timestamp:(new Date).toISOString(),userId:null==m?void 0:m.id,recordData:{production_line_id:G.production_line_id,supervisor_id:G.supervisor_id,section_chief_id:G.section_chief_id,itemsCount:r.length}})}finally{D(!1)}}else b.error("❌ 请至少添加一条工时记录",{duration:4e3,description:"工时记录不能为空，请添加至少一条有效的工时记录"})});return c.jsxDEV("div",{className:"min-h-screen bg-black text-green-400 font-mono",children:[c.jsxDEV("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[c.jsxDEV("div",{className:"mb-4 sm:mb-8",children:[c.jsxDEV("div",{className:"flex justify-between items-center mb-2 sm:mb-4",children:[c.jsxDEV("div",{className:"flex items-center",children:[c.jsxDEV(g,{className:"w-5 h-5 sm:w-8 sm:h-8 text-green-400 mr-2 sm:mr-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1648,columnNumber:15},this),c.jsxDEV("h1",{className:"text-xl sm:text-4xl font-bold text-green-400 font-mono",children:"工时记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1649,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1647,columnNumber:13},this),c.jsxDEV("div",{className:"flex items-center space-x-2",children:[c.jsxDEV("button",{onClick:()=>l(this,null,function*(){Se(!0);try{H({user_id:(null==m?void 0:m.id)||"",record_date:(new Date).toISOString().split("T")[0],production_line_id:0,supervisor_id:null,section_chief_id:null,shift_type:"白班",status:"draft",items:[]}),ee([Y()]),se({}),ne({}),X(""),K({work_type_id:0,product_id:0,process_id:"",quantity:0}),yield Le(),b.success("数据已刷新")}catch(e){b.error("刷新失败，请重试")}finally{Se(!1)}}),disabled:Re,className:"flex items-center space-x-1 sm:space-x-2 px-2 py-1 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 disabled:from-gray-600 disabled:to-gray-800 text-green-300 border border-green-400 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 font-mono text-sm sm:text-base disabled:cursor-not-allowed",children:[c.jsxDEV(p,{className:"w-4 h-4 sm:w-5 sm:h-5 "+(Re?"animate-spin":"")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1657,columnNumber:17},this),c.jsxDEV("span",{className:"hidden sm:inline",children:Re?"刷新中...":"刷新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1658,columnNumber:17},this),c.jsxDEV("span",{className:"sm:hidden",children:Re?"...":"刷新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1659,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1652,columnNumber:15},this),c.jsxDEV(y,{to:"/dashboard",className:"flex items-center space-x-1 sm:space-x-2 px-2 py-1 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 text-green-300 border border-green-400 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 font-mono text-sm sm:text-base",children:[c.jsxDEV(x,{className:"w-4 h-4 sm:w-5 sm:h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1665,columnNumber:17},this),c.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1666,columnNumber:17},this),c.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1667,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1661,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1651,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1646,columnNumber:11},this),c.jsxDEV("div",{className:"h-0.5 sm:h-1 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1671,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1645,columnNumber:9},this),c.jsxDEV("div",{className:"space-y-3 sm:space-y-6",children:c.jsxDEV("div",{className:"flex flex-col lg:flex-row gap-3 sm:gap-6",children:[c.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-3 sm:p-6 flex-1",children:[c.jsxDEV("h2",{className:"text-lg sm:text-xl font-bold text-green-400 mb-2 sm:mb-4 flex items-center gap-2",children:[c.jsxDEV(N,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1679,columnNumber:17},this),"基本信息"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1678,columnNumber:15},this),c.jsxDEV("div",{className:"space-y-3",children:[c.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-xs font-medium mb-1",children:"记录日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1688,columnNumber:21},this),c.jsxDEV("input",{type:"date",value:G.record_date,onChange:e=>Be("record_date",e.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 bg-gray-800 border border-green-400 text-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-300 text-xs sm:text-sm"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1689,columnNumber:21},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1687,columnNumber:19},this),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-xs font-medium mb-1",children:["生产线 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1699,columnNumber:27},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1698,columnNumber:21},this),c.jsxDEV("div",{className:"relative production-line-dropdown",children:[c.jsxDEV("input",{type:"text",value:(null==(e=j.find(e=>e.id===G.production_line_id))?void 0:e.name)||"",onChange:e=>{ie(e.target.value),ae(!0)},onFocus:()=>ae(!0),placeholder:"搜索或选择生产线",className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 bg-gray-800 border border-green-400 text-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-300 text-xs sm:text-sm"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1702,columnNumber:23},this),oe&&c.jsxDEV("div",{className:"absolute z-50 w-full mt-1 bg-gray-800 border border-green-400 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[j.filter(e=>e.name.toLowerCase().includes(re.toLowerCase())).slice(0,10).map(e=>c.jsxDEV("div",{onClick:()=>{Be("production_line_id",e.id),ie(""),ae(!1)},className:"px-2 py-1.5 sm:px-3 sm:py-2 text-green-300 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0 text-xs sm:text-sm",children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1721,columnNumber:29},this)),0===j.filter(e=>e.name.toLowerCase().includes(re.toLowerCase())).length&&c.jsxDEV("div",{className:"px-2 py-1.5 sm:px-3 sm:py-2 text-gray-400 text-xs sm:text-sm",children:"未找到匹配的生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1736,columnNumber:29},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1714,columnNumber:25},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1701,columnNumber:21},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1697,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1686,columnNumber:17},this),c.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-xs font-medium mb-1",children:["班长 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1750,columnNumber:26},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1749,columnNumber:21},this),c.jsxDEV("div",{className:"relative supervisor-dropdown",children:[c.jsxDEV("input",{type:"text",value:(null==(t=O.find(e=>e.id===G.supervisor_id))?void 0:t.name)||le,onChange:e=>{ce(e.target.value),ue(!0)},onFocus:()=>ue(!0),disabled:!G.production_line_id,placeholder:G.production_line_id?"搜索或选择班长":"请先选择生产线",className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 bg-gray-800 border border-green-400 text-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-300 text-xs sm:text-sm "+(G.production_line_id?"":"opacity-50 cursor-not-allowed")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1753,columnNumber:23},this),de&&G.production_line_id&&c.jsxDEV("div",{className:"absolute z-50 w-full mt-1 bg-gray-800 border border-green-400 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[O.filter(e=>e.name.toLowerCase().includes(le.toLowerCase())).slice(0,10).map(e=>c.jsxDEV("div",{onClick:()=>{Be("supervisor_id",e.id),ce(""),ue(!1)},className:"px-2 py-1.5 sm:px-3 sm:py-2 text-green-300 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0 text-xs sm:text-sm",children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1775,columnNumber:29},this)),0===O.filter(e=>e.name.toLowerCase().includes(le.toLowerCase())).length&&c.jsxDEV("div",{className:"px-2 py-1.5 sm:px-3 sm:py-2 text-gray-400 text-xs sm:text-sm",children:"未找到匹配的班长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1790,columnNumber:29},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1768,columnNumber:26},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1752,columnNumber:21},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1748,columnNumber:19},this),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-xs font-medium mb-1",children:["段长 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1801,columnNumber:26},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1800,columnNumber:21},this),c.jsxDEV("div",{className:"relative section-leader-dropdown",children:[c.jsxDEV("input",{type:"text",value:(null==(s=W.find(e=>e.id===G.section_chief_id))?void 0:s.name)||he,onChange:e=>{ge(e.target.value),ye(!0)},onFocus:()=>ye(!0),disabled:!G.production_line_id,placeholder:G.production_line_id?"搜索或选择段长":"请先选择生产线",className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 bg-gray-800 border border-green-400 text-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-300 text-xs sm:text-sm "+(G.production_line_id?"":"opacity-50 cursor-not-allowed")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1804,columnNumber:23},this),pe&&G.production_line_id&&c.jsxDEV("div",{className:"absolute z-50 w-full mt-1 bg-gray-800 border border-green-400 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[W.filter(e=>e.name.toLowerCase().includes(he.toLowerCase())).slice(0,10).map(e=>c.jsxDEV("div",{onClick:()=>{Be("section_chief_id",e.id),ge(""),ye(!1)},className:"px-2 py-1.5 sm:px-3 sm:py-2 text-green-300 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0 text-xs sm:text-sm",children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1826,columnNumber:29},this)),0===W.filter(e=>e.name.toLowerCase().includes(he.toLowerCase())).length&&c.jsxDEV("div",{className:"px-2 py-1.5 sm:px-3 sm:py-2 text-gray-400 text-xs sm:text-sm",children:"未找到匹配的段长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1841,columnNumber:29},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1819,columnNumber:26},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1803,columnNumber:21},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1799,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1747,columnNumber:17},this),c.jsxDEV("div",{className:"grid grid-cols-1 gap-2 sm:gap-4",children:c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-xs font-medium mb-1",children:["班次 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1855,columnNumber:26},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1854,columnNumber:21},this),c.jsxDEV("div",{className:"relative shift-dropdown",children:[c.jsxDEV("input",{type:"text",value:G.shift_type||xe,onChange:e=>{Ne(e.target.value),be(!0)},onFocus:()=>be(!0),placeholder:"搜索或选择班次",className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 bg-gray-800 border border-green-400 text-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-300 text-xs sm:text-sm"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1858,columnNumber:23},this),fe&&c.jsxDEV("div",{className:"absolute z-50 w-full mt-1 bg-gray-800 border border-green-400 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[["白班","夜班"].filter(e=>e.toLowerCase().includes(xe.toLowerCase())).map(e=>c.jsxDEV("div",{onClick:()=>{Be("shift_type",e),Ne(""),be(!1)},className:"px-2 py-1.5 sm:px-3 sm:py-2 text-green-300 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0 text-xs sm:text-sm",children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1876,columnNumber:29},this)),0===["白班","夜班"].filter(e=>e.toLowerCase().includes(xe.toLowerCase())).length&&c.jsxDEV("div",{className:"px-2 py-1.5 sm:px-3 sm:py-2 text-gray-400 text-xs sm:text-sm",children:"未找到匹配的班次"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1891,columnNumber:29},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1870,columnNumber:26},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1857,columnNumber:21},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1853,columnNumber:19},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1852,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1684,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1677,columnNumber:13},this),c.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-3 sm:p-6 flex-1",children:[c.jsxDEV("h2",{className:"text-lg sm:text-xl font-bold text-green-400 mb-2 sm:mb-4 flex items-center gap-2",children:[c.jsxDEV(f,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1906,columnNumber:17},this),"添加记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1905,columnNumber:15},this),c.jsxDEV("div",{className:"space-y-3 sm:space-y-4",children:Z.map((e,t)=>{var s,m;return c.jsxDEV("div",{className:"bg-gray-800/50 p-3 sm:p-4 rounded-lg border border-gray-700",children:[c.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[c.jsxDEV("span",{className:"text-green-400 font-medium text-sm",children:["记录 ",t+1]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1917,columnNumber:23},this),c.jsxDEV("button",{onClick:()=>(e=>{ee(t=>{const s=t.filter((t,s)=>s!==e);return 0===s.length?[Y()]:s}),se(t=>{const s=o({},t);delete s[e];const m={};return Object.keys(s).map(e=>parseInt(e)).filter(t=>t>e).forEach(e=>{m[e-1]=s[e]}),Object.keys(s).map(e=>parseInt(e)).filter(t=>t<e).forEach(e=>{m[e]=s[e]}),m}),ne(t=>{const s=o({},t);delete s[e];const m={};return Object.keys(s).map(e=>parseInt(e)).filter(t=>t>e).forEach(e=>{m[e-1]=s[e]}),Object.keys(s).map(e=>parseInt(e)).filter(t=>t<e).forEach(e=>{m[e]=s[e]}),m})})(t),className:"px-3 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors",title:"删除此行",children:"删除"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1918,columnNumber:23},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1916,columnNumber:21},this),c.jsxDEV("div",{className:"space-y-3",children:[c.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-xs font-medium mb-1",children:["工时类型 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1933,columnNumber:34},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1932,columnNumber:27},this),c.jsxDEV("div",{className:"relative work-type-dropdown",children:[c.jsxDEV("input",{type:"text",value:(null==(s=E.find(t=>t.id===e.work_type_id))?void 0:s.name)||ve[t]||"",onChange:e=>{_e(s=>a(o({},s),{[t]:e.target.value})),ke(e=>a(o({},e),{[t]:!0}))},onFocus:()=>ke(e=>a(o({},e),{[t]:!0})),placeholder:"搜索或选择工时类型",className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 bg-gray-800 border border-green-400 text-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-300 text-xs sm:text-sm"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1936,columnNumber:29},this),we[t]&&c.jsxDEV("div",{className:"absolute z-50 w-full mt-1 bg-gray-800 border border-green-400 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[E.filter(e=>e.name.toLowerCase().includes((ve[t]||"").toLowerCase())).slice(0,10).map(e=>c.jsxDEV("div",{onClick:()=>{Ue(t,"work_type_id",e.id),_e(e=>a(o({},e),{[t]:""})),ke(e=>a(o({},e),{[t]:!1}))},className:"px-2 py-1.5 sm:px-3 sm:py-2 text-green-300 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0 text-xs sm:text-sm",children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1955,columnNumber:35},this)),0===E.filter(e=>e.name.toLowerCase().includes((ve[t]||"").toLowerCase())).length&&c.jsxDEV("div",{className:"px-2 py-1.5 sm:px-3 sm:py-2 text-gray-400 text-xs sm:text-sm",children:"未找到匹配的工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1970,columnNumber:35},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1948,columnNumber:32},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1935,columnNumber:27},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1931,columnNumber:25},this),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-xs font-medium mb-1",children:["产品名称 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1981,columnNumber:34},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1980,columnNumber:27},this),c.jsxDEV("div",{className:"relative",children:[c.jsxDEV("input",{type:"text",value:te[t]||"",onChange:e=>{const s=e.target.value;se(e=>a(o({},e),{[t]:s})),s||Ue(t,"product_id",0)},onBlur:s=>{setTimeout(()=>{ne(e=>a(o({},e),{[t]:!1}))},300);const m=s.target.value,n=Ge(e.work_type_id).find(e=>e.name===m);n&&Ue(t,"product_id",n.id)},onClick:s=>{e.work_type_id&&(s.currentTarget.focus(),ne(e=>a(o({},e),{[t]:!0})))},onFocus:()=>{e.work_type_id&&ne(e=>a(o({},e),{[t]:!0}))},className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 bg-gray-800 border border-green-400 text-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-300 text-xs sm:text-sm "+(e.work_type_id?"":"opacity-50 cursor-not-allowed"),placeholder:e.work_type_id?"请输入产品名称":"请先选择工时类型",disabled:!e.work_type_id},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1984,columnNumber:29},this),me[t]&&e.work_type_id&&c.jsxDEV("div",{className:"absolute z-50 w-full mt-1 bg-gray-800 border border-green-400 rounded-md shadow-lg max-h-60 overflow-y-auto",children:Ge(e.work_type_id).filter(e=>e.name.toLowerCase().includes((te[t]||"").toLowerCase())).map(e=>c.jsxDEV("div",{onMouseDown:s=>{s.preventDefault(),se(s=>a(o({},s),{[t]:e.name})),Ue(t,"product_id",e.id),ne(e=>a(o({},e),{[t]:!1}))},className:"px-2 py-1.5 sm:px-3 sm:py-2 text-green-300 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0 text-xs sm:text-sm",children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2037,columnNumber:35},this))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2031,columnNumber:31},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1983,columnNumber:27},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1979,columnNumber:25},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1930,columnNumber:23},this),c.jsxDEV("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-xs font-medium mb-1",children:["工序名称 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2060,columnNumber:34},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2059,columnNumber:27},this),c.jsxDEV("div",{className:"relative process-dropdown",children:[c.jsxDEV("input",{type:"text",value:(null==(m=He(e.product_id,e.work_type_id).find(t=>t.id===e.process_id))?void 0:m.product_process)||De[t]||"",onChange:e=>{je(s=>a(o({},s),{[t]:e.target.value})),Ee(e=>a(o({},e),{[t]:!0}))},onFocus:()=>Ee(e=>a(o({},e),{[t]:!0})),disabled:!e.product_id,placeholder:e.product_id?"搜索或选择工序名称":"请先选择产品",className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 bg-gray-800 border border-green-400 text-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-300 text-xs sm:text-sm "+(e.product_id?"":"opacity-50 cursor-not-allowed")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2063,columnNumber:29},this),Te[t]&&e.product_id&&c.jsxDEV("div",{className:"absolute z-50 w-full mt-1 bg-gray-800 border border-green-400 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[He(e.product_id,e.work_type_id).filter(e=>e.product_process.toLowerCase().includes((De[t]||"").toLowerCase())).slice(0,10).map(e=>c.jsxDEV("div",{onClick:()=>{Ue(t,"process_id",e.id),je(e=>a(o({},e),{[t]:""})),Ee(e=>a(o({},e),{[t]:!1}))},className:"px-2 py-1.5 sm:px-3 sm:py-2 text-green-300 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0 text-xs sm:text-sm",children:e.product_process},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2085,columnNumber:35},this)),0===He(e.product_id,e.work_type_id).filter(e=>e.product_process.toLowerCase().includes((De[t]||"").toLowerCase())).length&&c.jsxDEV("div",{className:"px-2 py-1.5 sm:px-3 sm:py-2 text-gray-400 text-xs sm:text-sm",children:"未找到匹配的工序名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2100,columnNumber:35},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2078,columnNumber:32},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2062,columnNumber:27},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2058,columnNumber:25},this),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-xs font-medium mb-1",children:["数量 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2111,columnNumber:32},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2110,columnNumber:27},this),c.jsxDEV("input",{type:"number",value:e.quantity||"",onChange:e=>Ue(t,"quantity",parseFloat(e.target.value)||0),onWheel:e=>e.currentTarget.blur(),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 bg-gray-800 border border-green-400 text-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-300 text-xs sm:text-sm [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"请输入数量",min:"0",step:"0.01"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2113,columnNumber:27},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2109,columnNumber:25},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2057,columnNumber:23},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1928,columnNumber:21},this)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1915,columnNumber:19},this)})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1913,columnNumber:15},this),c.jsxDEV("div",{className:"mt-4 sm:mt-6 grid grid-cols-2 gap-2 sm:flex sm:justify-between sm:items-center",children:[c.jsxDEV("button",{onClick:()=>{ee(e=>[...e,Y()]);const e=Z.length;se(t=>a(o({},t),{[e]:""})),ne(t=>a(o({},t),{[e]:!1}))},className:"px-2 py-2 sm:px-4 sm:py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors flex items-center justify-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[c.jsxDEV(f,{className:"w-3 h-3 sm:w-4 sm:h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2136,columnNumber:19},this),c.jsxDEV("span",{className:"hidden sm:inline",children:"添加新记录项"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2137,columnNumber:19},this),c.jsxDEV("span",{className:"sm:hidden",children:"添加记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2138,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2132,columnNumber:17},this),c.jsxDEV("button",{onClick:()=>{if(!G.supervisor_id)return void b.error("❌ 请选择班长",{duration:4e3,description:"班长是必填项，请在基本信息中选择班长"});if(!G.section_chief_id)return void b.error("❌ 请选择段长",{duration:4e3,description:"段长是必填项，请在基本信息中选择段长"});const e=Z.filter(e=>e.work_type_id&&e.process_id&&e.quantity>0);for(let t=0;t<e.length;t++){const s=e[t],m=C.find(e=>e.id===s.product_id);if(!m||!m.name||""===m.name.trim())return void b.error("❌ 产品名称不完整",{duration:4e3,description:`第 ${Z.indexOf(s)+1} 条记录的产品名称不完整，请重新选择产品`})}Ce(!0)},className:"px-2 py-2 sm:px-6 sm:py-2 rounded-md focus:outline-none focus:ring-2 transition-colors text-xs sm:text-sm font-medium "+(0!==Z.filter(e=>e.work_type_id&&e.process_id&&e.quantity>0).length&&G.supervisor_id&&G.section_chief_id?"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":"bg-gray-500 text-gray-300 cursor-not-allowed"),disabled:0===Z.filter(e=>e.work_type_id&&e.process_id&&e.quantity>0).length||!G.supervisor_id||!G.section_chief_id,children:"提交审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2140,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2131,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1904,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1675,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1673,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1643,columnNumber:7},this),c.jsxDEV(k,{isOpen:Ve,onClose:()=>Ce(!1),onConfirm:()=>l(this,null,function*(){Ce(!1),yield Je()}),record:G,items:Z.filter(e=>e.work_type_id&&e.process_id&&e.quantity>0),productionLines:j,supervisors:O,sectionLeaders:W,workTypes:E,products:C,processes:S},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:2163,columnNumber:7},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/TimesheetRecord.tsx",lineNumber:1642,columnNumber:5},this)}export{D as default};
