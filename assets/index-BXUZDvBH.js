const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-Bno8VAdT.js","assets/vendor-J95WCW4x.js","assets/sortable.esm-Cxm1fFaN.js","assets/ui-CHDxits7.js","assets/router-BSPfhsUn.js","assets/TimesheetRecord-CHEeKV7y.js","assets/TimesheetHistory-CKlr4ANu.js","assets/CompanyManagement-CmNdExes.js","assets/UserManagement-SeFYZHUV.js","assets/ProcessManagement-DxA0ZQ6o.js","assets/xlsx-DfDjAMCE.js","assets/RoleList-YsIargfQ.js","assets/RoleEdit-CUNWBjWE.js","assets/RoleCreate-CbHGUUEw.js","assets/SupervisorApproval-IbExJNJd.js","assets/SectionChiefApproval-nX6w7trm.js","assets/Reports-Nnue_S1q.js","assets/History-BcorryoA.js","assets/ToastTest-DfU7oSmR.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,a=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&o(e,s,t[s]);if(n)for(var s of n(t))i.call(t,s)&&o(e,s,t[s]);return e},l=(e,n)=>t(e,s(n)),c=(e,t,s)=>o(e,"symbol"!=typeof t?t+"":t,s),u=(e,t,s)=>new Promise((n,r)=>{var i=e=>{try{a(s.next(e))}catch(t){r(t)}},o=e=>{try{a(s.throw(e))}catch(t){r(t)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,o);a((s=s.apply(e,t)).next())});import{r as m,b as h,g as d,c as g}from"./vendor-J95WCW4x.js";import{u as f,N as p,a as y,L as b,B as v,R as w,b as N}from"./router-BSPfhsUn.js";import{P as x,L as _,E as k,a as E,X as S,U as j,C as R,b as T,c as O,A as D,d as A,B as P,S as I,e as C,T as V}from"./ui-CHDxits7.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var L={exports:{}},$={};!function(){var e=m,t=Symbol.for("react.element"),s=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.suspense_list"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),g=Symbol.for("react.offscreen"),f=Symbol.iterator;var p=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function y(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];!function(e,t,s){var n=p.ReactDebugCurrentFrame.getStackAddendum();""!==n&&(t+="%s",s=s.concat([n]));var r=s.map(function(e){return String(e)});r.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,r)}("error",e,s)}var b;function v(e){return e.displayName||"Context"}function w(e){if(null==e)return null;if("number"==typeof e.tag&&y("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case n:return"Fragment";case s:return"Portal";case i:return"Profiler";case r:return"StrictMode";case c:return"Suspense";case u:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case a:return v(e)+".Consumer";case o:return v(e._context)+".Provider";case l:return function(e,t,s){var n=e.displayName;if(n)return n;var r=t.displayName||t.name||"";return""!==r?s+"("+r+")":s}(e,e.render,"ForwardRef");case h:var t=e.displayName||null;return null!==t?t:w(e.type)||"Memo";case d:var m=e,g=m._payload,f=m._init;try{return w(f(g))}catch(p){return null}}return null}b=Symbol.for("react.module.reference");var N,x,_,k,E,S,j,R=Object.assign,T=0;function O(){}O.__reactDisabledLog=!0;var D,A=p.ReactCurrentDispatcher;function P(e,t,s){if(void 0===D)try{throw Error()}catch(r){var n=r.stack.trim().match(/\n( *(at )?)/);D=n&&n[1]||""}return"\n"+D+e}var I,C=!1,V="function"==typeof WeakMap?WeakMap:Map;function L(e,t){if(!e||C)return"";var s,n=I.get(e);if(void 0!==n)return n;C=!0;var r,i=Error.prepareStackTrace;Error.prepareStackTrace=void 0,r=A.current,A.current=null,function(){if(0===T){N=console.log,x=console.info,_=console.warn,k=console.error,E=console.group,S=console.groupCollapsed,j=console.groupEnd;var e={configurable:!0,enumerable:!0,value:O,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}T++}();try{if(t){var o=function(){throw Error()};if(Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(o,[])}catch(g){s=g}Reflect.construct(e,[],o)}else{try{o.call()}catch(g){s=g}e.call(o.prototype)}}else{try{throw Error()}catch(g){s=g}e()}}catch(f){if(f&&s&&"string"==typeof f.stack){for(var a=f.stack.split("\n"),l=s.stack.split("\n"),c=a.length-1,u=l.length-1;c>=1&&u>=0&&a[c]!==l[u];)u--;for(;c>=1&&u>=0;c--,u--)if(a[c]!==l[u]){if(1!==c||1!==u)do{if(c--,--u<0||a[c]!==l[u]){var m="\n"+a[c].replace(" at new "," at ");return e.displayName&&m.includes("<anonymous>")&&(m=m.replace("<anonymous>",e.displayName)),"function"==typeof e&&I.set(e,m),m}}while(c>=1&&u>=0);break}}}finally{C=!1,A.current=r,function(){if(0===--T){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:R({},e,{value:N}),info:R({},e,{value:x}),warn:R({},e,{value:_}),error:R({},e,{value:k}),group:R({},e,{value:E}),groupCollapsed:R({},e,{value:S}),groupEnd:R({},e,{value:j})})}T<0&&y("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=i}var h=e?e.displayName||e.name:"",d=h?P(h):"";return"function"==typeof e&&I.set(e,d),d}function U(e,t,s){if(null==e)return"";if("function"==typeof e)return L(e,!(!(n=e.prototype)||!n.isReactComponent));var n;if("string"==typeof e)return P(e);switch(e){case c:return P("Suspense");case u:return P("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case l:return L(e.render,!1);case h:return U(e.type,t,s);case d:var r=e,i=r._payload,o=r._init;try{return U(o(i),t,s)}catch(a){}}return""}I=new V;var M=Object.prototype.hasOwnProperty,q={},z=p.ReactDebugCurrentFrame;function W(e){if(e){var t=e._owner,s=U(e.type,e._source,t?t.type:null);z.setExtraStackFrame(s)}else z.setExtraStackFrame(null)}var B=Array.isArray;function F(e){return B(e)}function J(e){return""+e}function K(e){if(function(e){try{return J(e),!1}catch(t){return!0}}(e))return y("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",function(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}(e)),J(e)}var H,G,Y,X=p.ReactCurrentOwner,Q={key:!0,ref:!0,__self:!0,__source:!0};Y={};function Z(e,s,n,r,i){var o,a={},l=null,c=null;for(o in void 0!==n&&(K(n),l=""+n),function(e){if(M.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(s)&&(K(s.key),l=""+s.key),function(e){if(M.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return void 0!==e.ref}(s)&&(c=s.ref,function(e,t){if("string"==typeof e.ref&&X.current&&t&&X.current.stateNode!==t){var s=w(X.current.type);Y[s]||(y('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',w(X.current.type),e.ref),Y[s]=!0)}}(s,i)),s)M.call(s,o)&&!Q.hasOwnProperty(o)&&(a[o]=s[o]);if(e&&e.defaultProps){var u=e.defaultProps;for(o in u)void 0===a[o]&&(a[o]=u[o])}if(l||c){var m="function"==typeof e?e.displayName||e.name||"Unknown":e;l&&function(e,t){var s=function(){H||(H=!0,y("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};s.isReactWarning=!0,Object.defineProperty(e,"key",{get:s,configurable:!0})}(a,m),c&&function(e,t){var s=function(){G||(G=!0,y("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};s.isReactWarning=!0,Object.defineProperty(e,"ref",{get:s,configurable:!0})}(a,m)}return function(e,s,n,r,i,o,a){var l={$$typeof:t,type:e,key:s,ref:n,props:a,_owner:o,_store:{}};return Object.defineProperty(l._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(l,"_self",{configurable:!1,enumerable:!1,writable:!1,value:r}),Object.defineProperty(l,"_source",{configurable:!1,enumerable:!1,writable:!1,value:i}),Object.freeze&&(Object.freeze(l.props),Object.freeze(l)),l}(e,l,c,i,r,X.current,a)}var ee,te=p.ReactCurrentOwner,se=p.ReactDebugCurrentFrame;function ne(e){if(e){var t=e._owner,s=U(e.type,e._source,t?t.type:null);se.setExtraStackFrame(s)}else se.setExtraStackFrame(null)}function re(e){return"object"==typeof e&&null!==e&&e.$$typeof===t}function ie(){if(te.current){var e=w(te.current.type);if(e)return"\n\nCheck the render method of `"+e+"`."}return""}ee=!1;var oe={};function ae(e,t){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;var s=function(e){var t=ie();if(!t){var s="string"==typeof e?e:e.displayName||e.name;s&&(t="\n\nCheck the top-level render call using <"+s+">.")}return t}(t);if(!oe[s]){oe[s]=!0;var n="";e&&e._owner&&e._owner!==te.current&&(n=" It was passed a child from "+w(e._owner.type)+"."),ne(e),y('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',s,n),ne(null)}}}function le(e,t){if("object"==typeof e)if(F(e))for(var s=0;s<e.length;s++){var n=e[s];re(n)&&ae(n,t)}else if(re(e))e._store&&(e._store.validated=!0);else if(e){var r=function(e){if(null===e||"object"!=typeof e)return null;var t=f&&e[f]||e["@@iterator"];return"function"==typeof t?t:null}(e);if("function"==typeof r&&r!==e.entries)for(var i,o=r.call(e);!(i=o.next()).done;)re(i.value)&&ae(i.value,t)}}function ce(e){var t,s=e.type;if(null!=s&&"string"!=typeof s){if("function"==typeof s)t=s.propTypes;else{if("object"!=typeof s||s.$$typeof!==l&&s.$$typeof!==h)return;t=s.propTypes}if(t){var n=w(s);!function(e,t,s,n,r){var i=Function.call.bind(M);for(var o in e)if(i(e,o)){var a=void 0;try{if("function"!=typeof e[o]){var l=Error((n||"React class")+": "+s+" type `"+o+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[o]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw l.name="Invariant Violation",l}a=e[o](t,o,n,s,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(c){a=c}!a||a instanceof Error||(W(r),y("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",n||"React class",s,o,typeof a),W(null)),a instanceof Error&&!(a.message in q)&&(q[a.message]=!0,W(r),y("Failed %s type: %s",s,a.message),W(null))}}(t,e.props,"prop",n,e)}else if(void 0!==s.PropTypes&&!ee){ee=!0,y("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",w(s)||"Unknown")}"function"!=typeof s.getDefaultProps||s.getDefaultProps.isReactClassApproved||y("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}var ue={};var me=function(e,s,m,f,p,v){var N=function(e){return"string"==typeof e||"function"==typeof e||e===n||e===i||e===r||e===c||e===u||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===d||e.$$typeof===h||e.$$typeof===o||e.$$typeof===a||e.$$typeof===l||e.$$typeof===b||void 0!==e.getModuleId)}(e);if(!N){var x="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(x+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var _,k=function(e){return void 0!==e?"\n\nCheck your code at "+e.fileName.replace(/^.*[\\\/]/,"")+":"+e.lineNumber+".":""}(p);x+=k||ie(),null===e?_="null":F(e)?_="array":void 0!==e&&e.$$typeof===t?(_="<"+(w(e.type)||"Unknown")+" />",x=" Did you accidentally export a JSX literal instead of a component?"):_=typeof e,y("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",_,x)}var E=Z(e,s,m,p,v);if(null==E)return E;if(N){var S=s.children;if(void 0!==S)if(f)if(F(S)){for(var j=0;j<S.length;j++)le(S[j],e);Object.freeze&&Object.freeze(S)}else y("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else le(S,e)}if(M.call(s,"key")){var R=w(e),T=Object.keys(s).filter(function(e){return"key"!==e}),O=T.length>0?"{key: someKey, "+T.join(": ..., ")+": ...}":"{key: someKey}";if(!ue[R+O])y('A props object containing a "key" prop is being spread into JSX:\n  let props = %s;\n  <%s {...props} />\nReact keys must be passed directly to JSX without using spread:\n  let props = %s;\n  <%s key={someKey} {...props} />',O,R,T.length>0?"{"+T.join(": ..., ")+": ...}":"{}",R),ue[R+O]=!0}return e===n?function(e){for(var t=Object.keys(e.props),s=0;s<t.length;s++){var n=t[s];if("children"!==n&&"key"!==n){ne(e),y("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",n),ne(null);break}}null!==e.ref&&(ne(e),y("Invalid attribute `ref` supplied to `React.Fragment`."),ne(null))}(E):ce(E),E};$.Fragment=n,$.jsxDEV=me}(),L.exports=$;var U,M=L.exports,q=h,z=q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;U=function(e,t){z.usingClientEntryPoint=!0;try{return q.createRoot(e,t)}finally{z.usingClientEntryPoint=!1}};const W={},B=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));n=Promise.allSettled(t.map(e=>{if((e=function(e){return"/timesheet-management-system/"+e}(e))in W)return;W[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,s&&r.setAttribute("nonce",s),document.head.appendChild(r),t?new Promise((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})};class F extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class J extends F{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class K extends F{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class H extends F{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var G,Y;(Y=G||(G={})).Any="any",Y.ApNortheast1="ap-northeast-1",Y.ApNortheast2="ap-northeast-2",Y.ApSouth1="ap-south-1",Y.ApSoutheast1="ap-southeast-1",Y.ApSoutheast2="ap-southeast-2",Y.CaCentral1="ca-central-1",Y.EuCentral1="eu-central-1",Y.EuWest1="eu-west-1",Y.EuWest2="eu-west-2",Y.EuWest3="eu-west-3",Y.SaEast1="sa-east-1",Y.UsEast1="us-east-1",Y.UsWest1="us-west-1",Y.UsWest2="us-west-2";var X=function(e,t,s,n){return new(s||(s=Promise))(function(r,i){function o(e){try{l(n.next(e))}catch(t){i(t)}}function a(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Q{constructor(e,{headers:t={},customFetch:s,region:n=G.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>B(()=>u(void 0,null,function*(){const{default:e}=yield Promise.resolve().then(()=>me);return{default:e}}),void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return X(this,arguments,void 0,function*(e,t={}){var s;try{const{headers:n,method:r,body:i,signal:o}=t;let a={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);let u;l&&"any"!==l&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l)),i&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):"string"==typeof i?(a["Content-Type"]="text/plain",u=i):"undefined"!=typeof FormData&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const m=yield this.fetch(c.toString(),{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:u,signal:o}).catch(e=>{if("AbortError"===e.name)throw e;throw new J(e)}),h=m.headers.get("x-relay-error");if(h&&"true"===h)throw new K(m);if(!m.ok)throw new H(m);let d,g=(null!==(s=m.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return d="application/json"===g?yield m.json():"application/octet-stream"===g?yield m.blob():"text/event-stream"===g?m:"multipart/form-data"===g?yield m.formData():yield m.text(),{data:d,error:null,response:m}}catch(n){return n instanceof Error&&"AbortError"===n.name?{data:null,error:new J(n)}:{data:null,error:n,response:n instanceof H||n instanceof K?n.context:void 0}}})}}var Z={},ee={},te={},se={},ne={},re={},ie=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof globalThis)return globalThis;throw new Error("unable to locate global object")}();const oe=ie.fetch,ae=ie.fetch.bind(ie),le=ie.Headers,ce=ie.Request,ue=ie.Response,me=Object.freeze(Object.defineProperty({__proto__:null,Headers:le,Request:ce,Response:ue,default:ae,fetch:oe},Symbol.toStringTag,{value:"Module"})),he=d(me);var de={};Object.defineProperty(de,"__esModule",{value:!0});let ge=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};de.default=ge;var fe=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(re,"__esModule",{value:!0});const pe=fe(he),ye=fe(de);re.default=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(s=e.isMaybeSingle)&&void 0!==s&&s,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=pe.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(e=>u(this,null,function*(){var t,s,n,r;let i=null,o=null,a=null,l=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){const s=yield e.text();""===s||(o="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?s:JSON.parse(s))}const r=null===(s=this.headers.get("Prefer"))||void 0===s?void 0:s.match(/count=(exact|planned|estimated)/),u=null===(n=e.headers.get("content-range"))||void 0===n?void 0:n.split("/");r&&u&&u.length>1&&(a=parseInt(u[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(i={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,l=406,c="Not Acceptable"):o=1===o.length?o[0]:null)}else{const t=yield e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(o=[],i=null,l=200,c="OK")}catch(u){404===e.status&&""===t?(l=204,c="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(r=null==i?void 0:i.details)||void 0===r?void 0:r.includes("0 rows"))&&(i=null,l=200,c="OK"),i&&this.shouldThrowOnError)throw new ye.default(i)}return{error:i,data:o,count:a,status:l,statusText:c}}));return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,n;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(n=null==e?void 0:e.code)&&void 0!==n?n:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var be=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ne,"__esModule",{value:!0});const ve=be(re);let we=class extends ve.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:r=n}={}){const i=r?`${r}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const n=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){const r=void 0===n?"offset":`${n}.offset`,i=void 0===n?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:r=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,r?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};ne.default=we;var Ne=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(se,"__esModule",{value:!0});const xe=Ne(ne);let _e=class extends xe.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let r="";"plain"===n?r="pl":"phrase"===n?r="ph":"websearch"===n&&(r="w");const i=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${r}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};se.default=_e;var ke=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(te,"__esModule",{value:!0});const Ee=ke(se);te.default=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=n}select(e,t){const{head:s=!1,count:n}=null!=t?t:{},r=s?"HEAD":"GET";let i=!1;const o=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new Ee.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var n;if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Ee.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:r=!0}={}){var i;if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Ee.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}update(e,{count:t}={}){var s;return t&&this.headers.append("Prefer",`count=${t}`),new Ee.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new Ee.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}};var Se=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ee,"__esModule",{value:!0});const je=Se(te),Re=Se(se);ee.default=class e{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new je.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:r}={}){var i;let o;const a=new URL(`${this.url}/rpc/${e}`);let l;s||n?(o=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{a.searchParams.append(e,t)})):(o="POST",l=t);const c=new Headers(this.headers);return r&&c.set("Prefer",`count=${r}`),new Re.default({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}};var Te=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Z,"__esModule",{value:!0}),Z.PostgrestError=Z.PostgrestBuilder=Z.PostgrestTransformBuilder=Z.PostgrestFilterBuilder=Z.PostgrestQueryBuilder=Z.PostgrestClient=void 0;const Oe=Te(ee);Z.PostgrestClient=Oe.default;const De=Te(te);Z.PostgrestQueryBuilder=De.default;const Ae=Te(se);Z.PostgrestFilterBuilder=Ae.default;const Pe=Te(ne);Z.PostgrestTransformBuilder=Pe.default;const Ie=Te(re);Z.PostgrestBuilder=Ie.default;const Ce=Te(de);Z.PostgrestError=Ce.default;var Ve=Z.default={PostgrestClient:Oe.default,PostgrestQueryBuilder:De.default,PostgrestFilterBuilder:Ae.default,PostgrestTransformBuilder:Pe.default,PostgrestBuilder:Ie.default,PostgrestError:Ce.default};const{PostgrestClient:Le,PostgrestQueryBuilder:$e,PostgrestFilterBuilder:Ue,PostgrestTransformBuilder:Me,PostgrestBuilder:qe,PostgrestError:ze}=Ve;class We{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,s=parseInt(t.replace(/^v/,"").split(".")[0]);return s>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const Be=1e4;var Fe,Je,Ke,He,Ge,Ye,Xe,Qe,Ze,et,tt;(Je=Fe||(Fe={}))[Je.connecting=0]="connecting",Je[Je.open=1]="open",Je[Je.closing=2]="closing",Je[Je.closed=3]="closed",(He=Ke||(Ke={})).closed="closed",He.errored="errored",He.joined="joined",He.joining="joining",He.leaving="leaving",(Ye=Ge||(Ge={})).close="phx_close",Ye.error="phx_error",Ye.join="phx_join",Ye.reply="phx_reply",Ye.leave="phx_leave",Ye.access_token="access_token",(Xe||(Xe={})).websocket="websocket",(Ze=Qe||(Qe={})).Connecting="connecting",Ze.Open="open",Ze.Closing="closing",Ze.Closed="closed";class st{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),r=t.getUint8(2);let i=this.HEADER_LENGTH+2;const o=s.decode(e.slice(i,i+n));i+=n;const a=s.decode(e.slice(i,i+r));i+=r;return{ref:null,topic:o,event:a,payload:JSON.parse(s.decode(e.slice(i,e.byteLength)))}}}class nt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(tt=et||(et={})).abstime="abstime",tt.bool="bool",tt.date="date",tt.daterange="daterange",tt.float4="float4",tt.float8="float8",tt.int2="int2",tt.int4="int4",tt.int4range="int4range",tt.int8="int8",tt.int8range="int8range",tt.json="json",tt.jsonb="jsonb",tt.money="money",tt.numeric="numeric",tt.oid="oid",tt.reltime="reltime",tt.text="text",tt.time="time",tt.timestamp="timestamp",tt.timestamptz="timestamptz",tt.timetz="timetz",tt.tsrange="tsrange",tt.tstzrange="tstzrange";const rt=(e,t,s={})=>{var n;const r=null!==(n=s.skipTypes)&&void 0!==n?n:[];return t?Object.keys(t).reduce((s,n)=>(s[n]=it(n,e,t,r),s),{}):{}},it=(e,t,s,n)=>{const r=t.find(t=>t.name===e),i=null==r?void 0:r.type,o=s[e];return i&&!n.includes(i)?ot(i,o):at(o)},ot=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return mt(t,s)}switch(e){case et.bool:return lt(t);case et.float4:case et.float8:case et.int2:case et.int4:case et.int8:case et.numeric:case et.oid:return ct(t);case et.json:case et.jsonb:return ut(t);case et.timestamp:return ht(t);case et.abstime:case et.date:case et.daterange:case et.int4range:case et.int8range:case et.money:case et.reltime:case et.text:case et.time:case et.timestamptz:case et.timetz:case et.tsrange:case et.tstzrange:default:return at(t)}},at=e=>e,lt=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},ct=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},ut=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},mt=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,n=e[s];if("{"===e[0]&&"}"===n){let n;const i=e.slice(1,s);try{n=JSON.parse("["+i+"]")}catch(r){n=i?i.split(","):[]}return n.map(e=>ot(t,e))}return e},ht=e=>"string"==typeof e?e.replace(" ","T"):e,dt=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class gt{constructor(e,t,s={},n=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ft,pt,yt,bt,vt,wt,Nt,xt;(pt=ft||(ft={})).SYNC="sync",pt.JOIN="join",pt.LEAVE="leave";class _t{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:n}=this.caller;this.joinRef=this.channel._joinRef(),this.state=_t.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=_t.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],n()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:n}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=_t.syncDiff(this.state,e,t,s),n())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const r=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(r,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const s=r[e];if(s){const n=t.map(e=>e.presence_ref),r=s.map(e=>e.presence_ref),i=t.filter(e=>r.indexOf(e.presence_ref)<0),l=s.filter(e=>n.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),l.length>0&&(a[e]=l)}else o[e]=t}),this.syncDiff(r,{joins:o,leaves:a},s,n)}static syncDiff(e,t,s,n){const{joins:r,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(r,(t,n)=>{var r;const i=null!==(r=e[t])&&void 0!==r?r:[];if(e[t]=this.cloneDeep(n),i.length>0){const s=e[t].map(e=>e.presence_ref),n=i.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...n)}s(t,i,n)}),this.map(i,(t,s)=>{let r=e[t];if(!r)return;const i=s.map(e=>e.presence_ref);r=r.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=r,n(t,r,s),0===r.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return t[s]="metas"in n?n.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(bt=yt||(yt={})).ALL="*",bt.INSERT="INSERT",bt.UPDATE="UPDATE",bt.DELETE="DELETE",(wt=vt||(vt={})).BROADCAST="broadcast",wt.PRESENCE="presence",wt.POSTGRES_CHANGES="postgres_changes",wt.SYSTEM="system",(xt=Nt||(Nt={})).SUBSCRIBED="SUBSCRIBED",xt.TIMED_OUT="TIMED_OUT",xt.CLOSED="CLOSED",xt.CHANNEL_ERROR="CHANNEL_ERROR";class kt{constructor(e,t={config:{}},s){var n,r;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Ke.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new gt(this,Ge.join,this.params,this.timeout),this.rejoinTimer=new nt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ke.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ke.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Ke.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ke.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Ke.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ge.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new _t(this),this.broadcastEndpointURL=dt(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(r=null===(n=this.params.config)||void 0===n?void 0:n.broadcast)||void 0===r?void 0:r.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,n,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Ke.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params,l=null!==(n=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==n?n:[],c=!!this.bindings[vt.PRESENCE]&&this.bindings[vt.PRESENCE].length>0||!0===(null===(r=this.params.config.presence)||void 0===r?void 0:r.enabled),m={},h={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:c}),postgres_changes:l,private:a};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(Nt.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Nt.CLOSED)),this.updateJoinPayload(Object.assign({config:h},m)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",t=>u(this,[t],function*({postgres_changes:t}){var s;if(this.socket.setAuth(),void 0!==t){const n=this.bindings.postgres_changes,r=null!==(s=null==n?void 0:n.length)&&void 0!==s?s:0,i=[];for(let s=0;s<r;s++){const r=n[s],{filter:{event:o,schema:a,table:l,filter:c}}=r,u=t&&t[s];if(!u||u.event!==o||u.schema!==a||u.table!==l||u.filter!==c)return this.unsubscribe(),this.state=Ke.errored,void(null==e||e(Nt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},r),{id:u.id}))}return this.bindings.postgres_changes=i,void(e&&e(Nt.SUBSCRIBED))}null==e||e(Nt.SUBSCRIBED)})).receive("error",t=>{this.state=Ke.errored,null==e||e(Nt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Nt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(e){return u(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return u(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,s){return this.state===Ke.joined&&e===vt.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}send(e){return u(this,arguments,function*(e,t={}){var s,n;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var n,r,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(r=null===(n=this.params)||void 0===n?void 0:n.config)||void 0===r?void 0:r.broadcast)||void 0===i?void 0:i.ack)||s("ok"),o.receive("ok",()=>s("ok")),o.receive("error",()=>s("error")),o.receive("timeout",()=>s("timed out"))});{const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const e=yield this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return yield null===(n=e.body)||void 0===n?void 0:n.cancel(),e.ok?"ok":"error"}catch(r){return"AbortError"===r.name?"timed out":"error"}}})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ke.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ge.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new gt(this,Ge.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ke.closed,this.bindings={}}_fetchWithTimeout(e,t,s){return u(this,null,function*(){const n=new AbortController,r=setTimeout(()=>n.abort(),s),i=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(r),i})}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new gt(this,e,t,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,r;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=Ge;if(s&&[o,a,l,c].indexOf(i)>=0&&s!==this._joinRef())return;let u=this._onMessage(i,t,s);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(e=>{var t,s,n;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(n=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===n?void 0:n.toLocaleLowerCase())===i}).map(e=>e.callback(u,s)):null===(r=this.bindings[i])||void 0===r||r.filter(e=>{var s,n,r,o,a,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(s=e.filter)||void 0===s?void 0:s.event;return i&&(null===(n=t.ids)||void 0===n?void 0:n.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(r=t.data)||void 0===r?void 0:r.type.toLocaleLowerCase()))}{const s=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:s,commit_timestamp:n,type:r,errors:i}=e,o={schema:t,table:s,commit_timestamp:n,eventType:r,new:{},old:{},errors:i};u=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(u,s)})}_isClosed(){return this.state===Ke.closed}_isJoined(){return this.state===Ke.joined}_isJoining(){return this.state===Ke.joining}_isLeaving(){return this.state===Ke.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),r={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(r):this.bindings[n]=[r],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var n;return!((null===(n=e.type)||void 0===n?void 0:n.toLocaleLowerCase())===s&&kt.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ge.close,{},e)}_onError(e){this._on(Ge.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ke.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=rt(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=rt(e.columns,e.old_record)),t}}const Et=()=>{},St=25e3,jt=10,Rt=100,Tt=[1e3,2e3,5e3,1e4];class Ot{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Be,this.transport=null,this.heartbeatIntervalMs=St,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Et,this.ref=0,this.reconnectTimer=null,this.logger=Et,this.conn=null,this.sendBuffer=[],this.serializer=new st,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>B(()=>u(this,null,function*(){const{default:e}=yield Promise.resolve().then(()=>me);return{default:e}}),void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Xe.websocket}`,this.httpEndpoint=dt(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=We.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(e){return u(this,null,function*(){const t=yield e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t})}removeAllChannels(){return u(this,null,function*(){const e=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Fe.connecting:return Qe.Connecting;case Fe.open:return Qe.Open;case Fe.closing:return Qe.Closing;default:return Qe.Closed}}isConnected(){return this.connectionState()===Qe.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(e=>e.topic===s);if(n)return n;{const s=new kt(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:n,ref:r}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${r})`,n),this.isConnected()?i():this.sendBuffer.push(i)}setAuth(e=null){return u(this,null,function*(){this._authPromise=this._performAuth(e);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return u(this,null,function*(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},Rt)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(a){this.log("error","error in heartbeat callback",a)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:s,payload:n,ref:r}=e,i=r?`(${r})`:"",o=n.status||"";this.log("receive",`${o} ${t} ${s} ${i}`.trim(),n),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,n,r)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ge.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}_performAuth(e=null){return u(this,null,function*(){let t;t=e||(this.accessToken?yield this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const s={access_token:t,version:"realtime-js/2.75.0"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(Ge.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return u(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new nt(()=>u(this,null,function*(){setTimeout(()=>u(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),jt)}),this.reconnectAfterMs)}_initializeOptions(e){var t,s,n,r,i,o,a,l,c;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:Be,this.heartbeatIntervalMs=null!==(n=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==n?n:St,this.worker=null!==(r=null==e?void 0:e.worker)&&void 0!==r&&r,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(o=null==e?void 0:e.heartbeatCallback)&&void 0!==o?o:Et,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(a=null==e?void 0:e.reconnectAfterMs)&&void 0!==a?a:e=>Tt[e-1]||1e4,this.encode=null!==(l=null==e?void 0:e.encode)&&void 0!==l?l:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null==e?void 0:e.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class Dt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function At(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Pt extends Dt{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class It extends Dt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ct=function(e,t,s,n){return new(s||(s=Promise))(function(r,i){function o(e){try{l(n.next(e))}catch(t){i(t)}}function a(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const Vt=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>B(()=>u(void 0,null,function*(){const{default:e}=yield Promise.resolve().then(()=>me);return{default:e}}),void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Lt=e=>{if(Array.isArray(e))return e.map(e=>Lt(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const n=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[n]=Lt(s)}),t};var $t=function(e,t,s,n){return new(s||(s=Promise))(function(r,i){function o(e){try{l(n.next(e))}catch(t){i(t)}}function a(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const Ut=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Mt=(e,t,s)=>$t(void 0,void 0,void 0,function*(){const n=yield Ct(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield B(()=>Promise.resolve().then(()=>me),void 0)).Response:Response});e instanceof n&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{const n=e.status||500,r=(null==s?void 0:s.statusCode)||n+"";t(new Pt(Ut(s),n,r))}).catch(e=>{t(new It(Ut(e),e))}):t(new It(Ut(e),e))}),qt=(e,t,s,n)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&n?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(n)?(r.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),r.body=JSON.stringify(n)):r.body=n,(null==t?void 0:t.duplex)&&(r.duplex=t.duplex),Object.assign(Object.assign({},r),s)):r};function zt(e,t,s,n,r,i){return $t(this,void 0,void 0,function*(){return new Promise((o,a)=>{e(s,qt(t,n,r,i)).then(e=>{if(!e.ok)throw e;return(null==n?void 0:n.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>Mt(e,a,n))})})}function Wt(e,t,s,n){return $t(this,void 0,void 0,function*(){return zt(e,"GET",t,s,n)})}function Bt(e,t,s,n,r){return $t(this,void 0,void 0,function*(){return zt(e,"POST",t,n,r,s)})}function Ft(e,t,s,n,r){return $t(this,void 0,void 0,function*(){return zt(e,"PUT",t,n,r,s)})}function Jt(e,t,s,n,r){return $t(this,void 0,void 0,function*(){return zt(e,"DELETE",t,n,r,s)})}var Kt=function(e,t,s,n){return new(s||(s=Promise))(function(r,i){function o(e){try{l(n.next(e))}catch(t){i(t)}}function a(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Ht{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return Kt(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(At(e))return{data:null,error:e};throw e}})}}var Gt=function(e,t,s,n){return new(s||(s=Promise))(function(r,i){function o(e){try{l(n.next(e))}catch(t){i(t)}}function a(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Yt{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}asStream(){return new Ht(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.execute().then(e,t)}execute(){return Gt(this,void 0,void 0,function*(){try{const e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(At(e))return{data:null,error:e};throw e}})}}var Xt=function(e,t,s,n){return new(s||(s=Promise))(function(r,i){function o(e){try{l(n.next(e))}catch(t){i(t)}}function a(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const Qt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Zt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class es{constructor(e,t={},s,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=Vt(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,n){return Xt(this,void 0,void 0,function*(){try{let r;const i=Object.assign(Object.assign({},Zt),n);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const a=i.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(r=new FormData,r.append("cacheControl",i.cacheControl),a&&r.append("metadata",this.encodeMetadata(a)),r.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(r=s,r.append("cacheControl",i.cacheControl),a&&r.append("metadata",this.encodeMetadata(a))):(r=s,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==n?void 0:n.headers)&&(o=Object.assign(Object.assign({},o),n.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield("PUT"==e?Ft:Bt)(this.fetch,`${this.url}/object/${c}`,r,Object.assign({headers:o},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(At(r))return{data:null,error:r};throw r}})}upload(e,t,s){return Xt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return Xt(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),i=this._getFinalPath(r),o=new URL(this.url+`/object/upload/sign/${i}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Zt.upsert},n),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);return{data:{path:r,fullPath:(yield Ft(this.fetch,o.toString(),e,{headers:i})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(At(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return Xt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(n["x-upsert"]="true");const r=yield Bt(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),i=new URL(this.url+r.url),o=i.searchParams.get("token");if(!o)throw new Dt("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(At(s))return{data:null,error:s};throw s}})}update(e,t,s){return Xt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Xt(this,void 0,void 0,function*(){try{return{data:yield Bt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}copy(e,t,s){return Xt(this,void 0,void 0,function*(){try{return{data:{path:(yield Bt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return Xt(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),r=yield Bt(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${i}`)},{data:r,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return Xt(this,void 0,void 0,function*(){try{const n=yield Bt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:n.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${r}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}download(e,t){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),r=n?`?${n}`:"",i=this._getFinalPath(e);return new Yt(()=>Wt(this.fetch,`${this.url}/${s}/${i}${r}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return Xt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield Wt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Lt(e),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(At(s))return{data:null,error:s};throw s}})}exists(e){return Xt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,n){return $t(this,void 0,void 0,function*(){return zt(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),n)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(At(s)&&s instanceof It){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],r=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==r&&n.push(r);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&n.push(o);let a=n.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${s}${a}`)}}}remove(e){return Xt(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(At(t))return{data:null,error:t};throw t}})}list(e,t,s){return Xt(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Qt),t),{prefix:e||""});return{data:yield Bt(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}listV2(e,t){return Xt(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield Bt(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(At(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ts={"X-Client-Info":"storage-js/2.75.0"};var ss=function(e,t,s,n){return new(s||(s=Promise))(function(r,i){function o(e){try{l(n.next(e))}catch(t){i(t)}}function a(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};class ns{constructor(e,t={},s,n){this.shouldThrowOnError=!1;const r=new URL(e);if(null==n?void 0:n.useNewHostname){/supabase\.(co|in|red)$/.test(r.hostname)&&!r.hostname.includes("storage.supabase.")&&(r.hostname=r.hostname.replace("supabase.","storage.supabase."))}this.url=r.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},ts),t),this.fetch=Vt(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return ss(this,void 0,void 0,function*(){try{return{data:yield Wt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(At(e))return{data:null,error:e};throw e}})}getBucket(e){return ss(this,void 0,void 0,function*(){try{return{data:yield Wt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(At(t))return{data:null,error:t};throw t}})}createBucket(e){return ss(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield Bt(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(At(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ss(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(At(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ss(this,void 0,void 0,function*(){try{return{data:yield Bt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(At(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ss(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(At(t))return{data:null,error:t};throw t}})}}class rs extends ns{constructor(e,t={},s,n){super(e,t,s,n)}from(e){return new es(this.url,this.headers,e,this.fetch)}}let is="";is="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const os={headers:{"X-Client-Info":`supabase-js-${is}/2.75.0`}},as={schema:"public"},ls={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},cs={};var us=function(e,t,s,n){return new(s||(s=Promise))(function(r,i){function o(e){try{l(n.next(e))}catch(t){i(t)}}function a(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})};const ms=(e,t,s)=>{const n=(e=>{let t;return t=e||("undefined"==typeof fetch?ae:fetch),(...e)=>t(...e)})(s),r="undefined"==typeof Headers?le:Headers;return(s,i)=>us(void 0,void 0,void 0,function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new r(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),n(s,Object.assign(Object.assign({},i),{headers:l}))})};var hs=function(e,t,s,n){return new(s||(s=Promise))(function(t,r){function i(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s(function(e){e(n)})).then(i,o)}a((n=n.apply(e,[])).next())})};const ds="2.75.0",gs=3e4,fs=9e4,ps={"X-Client-Info":`gotrue-js/${ds}`},ys="X-Supabase-Api-Version",bs={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},vs=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class ws extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Ns(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class xs extends ws{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class _s extends ws{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ks extends ws{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class Es extends ks{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Ss extends ks{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class js extends ks{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Rs extends ks{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ts extends ks{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Os extends ks{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ds(e){return Ns(e)&&"AuthRetryableFetchError"===e.name}class As extends ks{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ps extends ks{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Is="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Cs=" \t\n\r=".split(""),Vs=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Cs.length;t+=1)e[Cs[t].charCodeAt(0)]=-2;for(let t=0;t<Is.length;t+=1)e[Is[t].charCodeAt(0)]=t;return e})();function Ls(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Is[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Is[e]),t.queuedBits-=6}}function $s(e,t,s){const n=Vs[e];if(!(n>-1)){if(-2===n)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Us(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},n={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},i=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,n,s)};for(let o=0;o<e.length;o+=1)$s(e.charCodeAt(o),r,i);return t.join("")}function Ms(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function qs(e){const t=[],s={queue:0,queuedBits:0},n=e=>{t.push(e)};for(let r=0;r<e.length;r+=1)$s(e.charCodeAt(r),s,n);return new Uint8Array(t)}function zs(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let n=e.charCodeAt(s);if(n>55295&&n<=56319){const t=1024*(n-55296)&65535;n=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Ms(n,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function Ws(e){const t=[],s={queue:0,queuedBits:0},n=e=>{t.push(e)};return e.forEach(e=>Ls(e,s,n)),Ls(null,s,n),t.join("")}const Bs=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Fs={tested:!1,writable:!1},Js=()=>{if(!Bs())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(Fs.tested)return Fs.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Fs.tested=!0,Fs.writable=!0}catch(t){Fs.tested=!0,Fs.writable=!1}return Fs.writable};const Ks=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>B(()=>u(void 0,null,function*(){const{default:e}=yield Promise.resolve().then(()=>me);return{default:e}}),void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Hs=(e,t,s)=>u(void 0,null,function*(){yield e.setItem(t,JSON.stringify(s))}),Gs=(e,t)=>u(void 0,null,function*(){const s=yield e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(n){return s}}),Ys=(e,t)=>u(void 0,null,function*(){yield e.removeItem(t)});class Xs{constructor(){this.promise=new Xs.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Qs(e){const t=e.split(".");if(3!==t.length)throw new Ps("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!vs.test(t[s]))throw new Ps("JWT not in base64url format");return{header:JSON.parse(Us(t[0])),payload:JSON.parse(Us(t[1])),signature:qs(t[2]),raw:{header:t[0],payload:t[1]}}}function Zs(e){return("0"+e.toString(16)).substr(-2)}function en(e){return u(this,null,function*(){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=yield function(e){return u(this,null,function*(){const t=(new TextEncoder).encode(e),s=yield crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(e=>String.fromCharCode(e)).join("")})}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function tn(e,t,s=!1){return u(this,null,function*(){const n=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let n=0;n<56;n++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Zs).join("")}();let r=n;s&&(r+="/PASSWORD_RECOVERY"),yield Hs(e,`${t}-code-verifier`,r);const i=yield en(n);return[i,n===i?"plain":"s256"]})}Xs.promiseConstructor=Promise;const sn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const nn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function rn(e){if(!nn.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function on(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function an(e){return JSON.parse(JSON.stringify(e))}const ln=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),cn=[502,503,504];function un(e){return u(this,null,function*(){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Os(ln(e),0);if(cn.includes(e.status))throw new Os(ln(e),e.status);let n,r;try{n=yield e.json()}catch(o){throw new _s(ln(o),o)}const i=function(e){const t=e.headers.get(ys);if(!t)return null;if(!t.match(sn))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(o){return null}}(e);if(i&&i.getTime()>=bs.timestamp&&"object"==typeof n&&n&&"string"==typeof n.code?r=n.code:"object"==typeof n&&n&&"string"==typeof n.error_code&&(r=n.error_code),r){if("weak_password"===r)throw new As(ln(n),e.status,(null===(t=n.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===r)throw new Es}else if("object"==typeof n&&n&&"object"==typeof n.weak_password&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new As(ln(n),e.status,n.weak_password.reasons);throw new xs(ln(n),e.status||500,r)})}function mn(e,t,s,n){return u(this,null,function*(){var r;const i=Object.assign({},null==n?void 0:n.headers);i[ys]||(i[ys]=bs.name),(null==n?void 0:n.jwt)&&(i.Authorization=`Bearer ${n.jwt}`);const o=null!==(r=null==n?void 0:n.query)&&void 0!==r?r:{};(null==n?void 0:n.redirectTo)&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=yield function(e,t,s,n,r,i){return u(this,null,function*(){const o=((e,t,s,n)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),r.body=JSON.stringify(n),Object.assign(Object.assign({},r),s))})(t,n,r,i);let a;try{a=yield e(s,Object.assign({},o))}catch(l){throw console.error(l),new Os(ln(l),0)}if(a.ok||(yield un(a)),null==n?void 0:n.noResolveJson)return a;try{return yield a.json()}catch(l){yield un(l)}})}(e,t,s+a,{headers:i,noResolveJson:null==n?void 0:n.noResolveJson},{},null==n?void 0:n.body);return(null==n?void 0:n.xform)?null==n?void 0:n.xform(l):{data:Object.assign({},l),error:null}})}function hn(e){var t;let s=null;var n;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(n=e.expires_in,Math.round(Date.now()/1e3)+n)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function dn(e){const t=hn(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function gn(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function fn(e){return{data:e,error:null}}function pn(e){const{action_link:t,email_otp:s,hashed_token:n,redirect_to:r,verification_type:i}=e,o=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(s[n[r]]=e[n[r]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:n,redirect_to:r,verification_type:i},user:Object.assign({},o)},error:null}}function yn(e){return e}const bn=["global","local","others"];class vn{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Ks(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}signOut(e){return u(this,arguments,function*(e,t=bn[0]){if(bn.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${bn.join(", ")}`);try{return yield mn(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ns(s))return{data:null,error:s};throw s}})}inviteUserByEmail(e){return u(this,arguments,function*(e,t={}){try{return yield mn(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:gn})}catch(s){if(Ns(s))return{data:{user:null},error:s};throw s}})}generateLink(e){return u(this,null,function*(){try{const{options:t}=e,s=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(s[n[r]]=e[n[r]])}return s}(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=null==s?void 0:s.newEmail,delete n.newEmail),yield mn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:pn,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Ns(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return u(this,null,function*(){try{return yield mn(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:gn})}catch(t){if(Ns(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return u(this,null,function*(){var t,s,n,r,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=yield mn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(r=null===(n=null==e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==r?r:""},xform:yn});if(c.error)throw c.error;const u=yield c.json(),m=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(m)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Ns(l))return{data:{users:[]},error:l};throw l}})}getUserById(e){return u(this,null,function*(){rn(e);try{return yield mn(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:gn})}catch(t){if(Ns(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return u(this,null,function*(){rn(e);try{return yield mn(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:gn})}catch(s){if(Ns(s))return{data:{user:null},error:s};throw s}})}deleteUser(e,t=!1){return u(this,null,function*(){rn(e);try{return yield mn(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:gn})}catch(s){if(Ns(s))return{data:{user:null},error:s};throw s}})}_listFactors(e){return u(this,null,function*(){rn(e.userId);try{const{data:t,error:s}=yield mn(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return u(this,null,function*(){rn(e.userId),rn(e.id);try{return{data:yield mn(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}_listOAuthClients(e){return u(this,null,function*(){var t,s,n,r,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=yield mn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(r=null===(n=null==e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==r?r:""},xform:yn});if(c.error)throw c.error;const u=yield c.json(),m=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(m)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Ns(l))return{data:{clients:[]},error:l};throw l}})}_createOAuthClient(e){return u(this,null,function*(){try{return yield mn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}_getOAuthClient(e){return u(this,null,function*(){try{return yield mn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}_deleteOAuthClient(e){return u(this,null,function*(){try{return yield mn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}_regenerateOAuthClientSecret(e){return u(this,null,function*(){try{return yield mn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}}function wn(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Nn=!!(globalThis&&Js()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class xn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class _n extends xn{}function kn(e,t,s){return u(this,null,function*(){Nn&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Nn&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},n=>u(this,null,function*(){if(!n){if(0===t)throw Nn&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new _n(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Nn)try{const e=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield s()}Nn&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,n.name);try{return yield s()}finally{Nn&&console.log("@supabase/gotrue-js: navigatorLock: released",e,n.name)}})))})}function En(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Sn(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class jn extends Error{constructor({message:e,code:t,cause:s,name:n}){var r;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=null!==(r=null!=n?n:s instanceof Error?s.name:void 0)&&void 0!==r?r:"Unknown Error",this.code=t}}class Rn extends jn{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Tn({error:e,options:t}){var s,n,r;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new jn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.requireResidentKey))return new jn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(n=i.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new jn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.userVerification))return new jn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new jn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new jn({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name){return 0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new jn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new jn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e})}if("SecurityError"===e.name){const t=window.location.hostname;if(!Ln(t))return new jn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new jn({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new jn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new jn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new jn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function On({error:e,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new jn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new jn({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!Ln(t))return new jn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(s.rpId!==t)return new jn({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new jn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new jn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}var Dn=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(s[n[r]]=e[n[r]])}return s};const An=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Pn(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:s,excludeCredentials:n}=e,r=Dn(e,["challenge","user","excludeCredentials"]),i=qs(t).buffer,o=Object.assign(Object.assign({},s),{id:qs(s.id).buffer}),a=Object.assign(Object.assign({},r),{challenge:i,user:o});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let e=0;e<n.length;e++){const t=n[e];a.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:qs(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return a}function In(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:s}=e,n=Dn(e,["challenge","allowCredentials"]),r=qs(t).buffer,i=Object.assign(Object.assign({},n),{challenge:r});if(s&&s.length>0){i.allowCredentials=new Array(s.length);for(let e=0;e<s.length;e++){const t=s[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:qs(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}function Cn(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e;return{id:e.id,rawId:e.id,response:{attestationObject:Ws(new Uint8Array(e.response.attestationObject)),clientDataJSON:Ws(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function Vn(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e,n=e.getClientExtensionResults(),r=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Ws(new Uint8Array(r.authenticatorData)),clientDataJSON:Ws(new Uint8Array(r.clientDataJSON)),signature:Ws(new Uint8Array(r.signature)),userHandle:r.userHandle?Ws(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function Ln(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function $n(){var e,t;return!!(Bs()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const Un={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},Mn={userVerification:"preferred",hints:["security-key"]};function qn(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),s=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),n={};for(const r of e)if(r)for(const e in r){const i=r[e];if(void 0!==i)if(Array.isArray(i))n[e]=i;else if(s(i))n[e]=i;else if(t(i)){const s=n[e];t(s)?n[e]=qn(s,i):n[e]=qn(i)}else n[e]=i}return n}class zn{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}_enroll(e){return u(this,null,function*(){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))})}_challenge(e,t){return u(this,arguments,function*({factorId:e,webauthn:t,friendlyName:s,signal:n},r){try{const{data:i,error:o}=yield this.client.mfa.challenge({factorId:e,webauthn:t});if(!i)return{data:null,error:o};const a=null!=n?n:An.createNewAbortSignal();if("create"===i.webauthn.type){const{user:e}=i.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${s}`),e.displayName||(e.displayName=e.name)}switch(i.webauthn.type){case"create":{const t=function(e,t){return qn(Un,e,t||{})}(i.webauthn.credential_options.publicKey,null==r?void 0:r.create),{data:s,error:n}=yield function(e){return u(this,null,function*(){try{const t=yield navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Rn("Browser returned unexpected credential type",t)}:{data:null,error:new Rn("Empty credential response",t)}}catch(t){return{data:null,error:Tn({error:t,options:e})}}})}({publicKey:t,signal:a});return s?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:s}},error:null}:{data:null,error:n}}case"request":{const t=function(e,t){return qn(Mn,e,t||{})}(i.webauthn.credential_options.publicKey,null==r?void 0:r.request),{data:s,error:n}=yield function(e){return u(this,null,function*(){try{const t=yield navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Rn("Browser returned unexpected credential type",t)}:{data:null,error:new Rn("Empty credential response",t)}}catch(t){return{data:null,error:On({error:t,options:e})}}})}(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:t,signal:a}));return s?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:s}},error:null}:{data:null,error:n}}}}catch(i){return Ns(i)?{data:null,error:i}:{data:null,error:new _s("Unexpected error in challenge",i)}}})}_verify(e){return u(this,arguments,function*({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})})}_authenticate(e,t){return u(this,arguments,function*({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n}},r){if(!t)return{data:null,error:new ws("rpId is required for WebAuthn authentication")};try{if(!$n())return{data:null,error:new _s("Browser does not support WebAuthn",null)};const{data:i,error:o}=yield this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:n},{request:r});if(!i)return{data:null,error:o};const{webauthn:a}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:a.type,rpId:t,rpOrigins:s,credential_response:a.credential_response}})}catch(i){return Ns(i)?{data:null,error:i}:{data:null,error:new _s("Unexpected error in authenticate",i)}}})}_register(e,t){return u(this,arguments,function*({friendlyName:e,rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n},r){if(!t)return{data:null,error:new ws("rpId is required for WebAuthn registration")};try{if(!$n())return{data:null,error:new _s("Browser does not support WebAuthn",null)};const{data:i,error:o}=yield this._enroll({friendlyName:e});if(!i)return yield this.client.mfa.listFactors().then(t=>{var s;return null===(s=t.data)||void 0===s?void 0:s.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:o};const{data:a,error:l}=yield this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:n},{create:r});return a?this._verify({factorId:i.id,challengeId:a.challengeId,webauthn:{rpId:t,rpOrigins:s,type:a.webauthn.type,credential_response:a.webauthn.credential_response}}):{data:null,error:l}}catch(i){return Ns(i)?{data:null,error:i}:{data:null,error:new _s("Unexpected error in register",i)}}})}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Wn={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ps,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function Bn(e,t,s){return u(this,null,function*(){return yield s()})}const Fn={};class Jn{get jwks(){var e,t;return null!==(t=null===(e=Fn[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Fn[this.storageKey]=Object.assign(Object.assign({},Fn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Fn[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Fn[this.storageKey]=Object.assign(Object.assign({},Fn[this.storageKey]),{cachedAt:e})}constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jn.nextInstanceID,Jn.nextInstanceID+=1,this.instanceID>0&&Bs()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Wn),e);if(this.logDebugMessages=!!n.debug,"function"==typeof n.debug&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new vn({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Ks(n.fetch),this.lock=n.lock||Bn,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:Bs()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=kn:this.lock=Bn,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new zn(this)},this.persistSession?(n.storage?this.storage=n.storage:Js()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=wn(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=wn(this.memoryStorage)),Bs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",e=>u(this,null,function*(){this._debug("received broadcast notification from other tab or client",e),yield this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ds}) ${(new Date).toISOString()}`,...e),this}initialize(){return u(this,null,function*(){return this.initializePromise||(this.initializePromise=(()=>u(this,null,function*(){return yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._initialize()}))}))()),yield this.initializePromise})}_initialize(){return u(this,null,function*(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(n){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":(yield this._isPKCECallback(t))&&(s="pkce"),Bs()&&this.detectSessionInUrl&&"none"!==s){const{data:n,error:r}=yield this._getSessionFromURL(t,s);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),function(e){return Ns(e)&&"AuthImplicitGrantRedirectError"===e.name}(r)){const t=null===(e=r.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:r}}return yield this._removeSession(),{error:r}}const{session:i,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),yield this._saveSession(i),setTimeout(()=>u(this,null,function*(){"recovery"===o?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",i):yield this._notifyAllSubscribers("SIGNED_IN",i)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(t){return Ns(t)?{error:t}:{error:new _s("Unexpected error during initialization",t)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return u(this,null,function*(){var t,s,n;try{const r=yield mn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.captchaToken}},xform:hn}),{data:i,error:o}=r;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(r){if(Ns(r))return{data:{user:null,session:null},error:r};throw r}})}signUp(e){return u(this,null,function*(){var t,s,n;try{let r;if("email"in e){const{email:s,password:n,options:i}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=yield tn(this.storage,this.storageKey)),r=yield mn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:s,password:n,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:hn})}else{if(!("phone"in e))throw new js("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;r=yield mn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(s=null==o?void 0:o.data)&&void 0!==s?s:{},channel:null!==(n=null==o?void 0:o.channel)&&void 0!==n?n:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:hn})}}const{data:i,error:o}=r;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(r){if(Ns(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithPassword(e){return u(this,null,function*(){try{let t;if("email"in e){const{email:s,password:n,options:r}=e;t=yield mn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:dn})}else{if(!("phone"in e))throw new js("You must provide either an email or phone number and a password");{const{phone:s,password:n,options:r}=e;t=yield mn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:dn})}}const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:s&&s.session&&s.user?(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n}):{data:{user:null,session:null},error:new Ss}}catch(t){if(Ns(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){return u(this,null,function*(){var t,s,n,r;return yield this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:null===(r=e.options)||void 0===r?void 0:r.skipBrowserRedirect})})}exchangeCodeForSession(e){return u(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>u(this,null,function*(){return this._exchangeCodeForSession(e)}))})}signInWithWeb3(e){return u(this,null,function*(){const{chain:t}=e;switch(t){case"ethereum":return yield this.signInWithEthereum(e);case"solana":return yield this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}})}signInWithEthereum(e){return u(this,null,function*(){var t,s,n,r,i,o,a,l,c,u,m;let h,d;if("message"in e)h=e.message,d=e.signature;else{const{chain:u,wallet:m,statement:g,options:f}=e;let p;if(Bs())if("object"==typeof m)p=m;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");p=e.ethereum}else{if("object"!=typeof m||!(null==f?void 0:f.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");p=m}const y=new URL(null!==(t=null==f?void 0:f.url)&&void 0!==t?t:window.location.href),b=yield p.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!b||0===b.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const v=En(b[0]);let w=null===(s=null==f?void 0:f.signInWithEthereum)||void 0===s?void 0:s.chainId;if(!w){const e=yield p.request({method:"eth_chainId"});w=parseInt(e,16)}h=function(e){var t;const{chainId:s,domain:n,expirationTime:r,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:m,version:h}=e;if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const d=`${u?`${u}://${n}`:n} wants you to sign in with your Ethereum account:\n${En(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let g=`URI: ${m}\nVersion: ${h}\nChain ID: ${s}${o?`\nNonce: ${o}`:""}\nIssued At: ${i.toISOString()}`;if(r&&(g+=`\nExpiration Time: ${r.toISOString()}`),a&&(g+=`\nNot Before: ${a.toISOString()}`),l&&(g+=`\nRequest ID: ${l}`),c){let e="\nResources:";for(const t of c){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}g+=e}return`${d}\n${g}`}({domain:y.host,address:v,statement:g,uri:y.href,version:"1",chainId:w,nonce:null===(n=null==f?void 0:f.signInWithEthereum)||void 0===n?void 0:n.nonce,issuedAt:null!==(i=null===(r=null==f?void 0:f.signInWithEthereum)||void 0===r?void 0:r.issuedAt)&&void 0!==i?i:new Date,expirationTime:null===(o=null==f?void 0:f.signInWithEthereum)||void 0===o?void 0:o.expirationTime,notBefore:null===(a=null==f?void 0:f.signInWithEthereum)||void 0===a?void 0:a.notBefore,requestId:null===(l=null==f?void 0:f.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null==f?void 0:f.signInWithEthereum)||void 0===c?void 0:c.resources}),d=yield p.request({method:"personal_sign",params:[Sn(h),v]})}try{const{data:t,error:s}=yield mn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:d},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(m=e.options)||void 0===m?void 0:m.captchaToken}}:null),xform:hn});if(s)throw s;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Ss}}catch(g){if(Ns(g))return{data:{user:null,session:null},error:g};throw g}})}signInWithSolana(e){return u(this,null,function*(){var t,s,n,r,i,o,a,l,c,u,m,h;let d,g;if("message"in e)d=e.message,g=e.signature;else{const{chain:m,wallet:h,statement:f,options:p}=e;let y;if(Bs())if("object"==typeof h)y=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=e.solana}else{if("object"!=typeof h||!(null==p?void 0:p.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=h}const b=new URL(null!==(t=null==p?void 0:p.url)&&void 0!==t?t:window.location.href);if("signIn"in y&&y.signIn){const e=yield y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==p?void 0:p.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),f?{statement:f}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");d="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),g=t.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");d=[`${b.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(n=null===(s=null==p?void 0:p.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==n?n:(new Date).toISOString()}`,...(null===(r=null==p?void 0:p.signInWithSolana)||void 0===r?void 0:r.notBefore)?[`Not Before: ${p.signInWithSolana.notBefore}`]:[],...(null===(i=null==p?void 0:p.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${p.signInWithSolana.expirationTime}`]:[],...(null===(o=null==p?void 0:p.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${p.signInWithSolana.chainId}`]:[],...(null===(a=null==p?void 0:p.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${p.signInWithSolana.nonce}`]:[],...(null===(l=null==p?void 0:p.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${p.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==p?void 0:p.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...p.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=yield y.signMessage((new TextEncoder).encode(d),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=e}}try{const{data:t,error:s}=yield mn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:d,signature:Ws(g)},(null===(m=e.options)||void 0===m?void 0:m.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:hn});if(s)throw s;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Ss}}catch(f){if(Ns(f))return{data:{user:null,session:null},error:f};throw f}})}_exchangeCodeForSession(e){return u(this,null,function*(){const t=yield Gs(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(null!=t?t:"").split("/");try{const{data:t,error:r}=yield mn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:hn});if(yield Ys(this.storage,`${this.storageKey}-code-verifier`),r)throw r;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=n?n:null}),error:r}):{data:{user:null,session:null,redirectType:null},error:new Ss}}catch(r){if(Ns(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}})}signInWithIdToken(e){return u(this,null,function*(){try{const{options:t,provider:s,token:n,access_token:r,nonce:i}=e,o=yield mn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:r,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:hn}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new Ss}}catch(t){if(Ns(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){return u(this,null,function*(){var t,s,n,r,i;try{if("email"in e){const{email:n,options:r}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=yield tn(this.storage,this.storageKey));const{error:a}=yield mn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:n,data:null!==(t=null==r?void 0:r.data)&&void 0!==t?t:{},create_user:null===(s=null==r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:s}=e,{data:o,error:a}=yield mn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(n=null==s?void 0:s.data)&&void 0!==n?n:{},create_user:null===(r=null==s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(i=null==s?void 0:s.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new js("You must provide either an email or phone number.")}catch(o){if(Ns(o))return{data:{user:null,session:null},error:o};throw o}})}verifyOtp(e){return u(this,null,function*(){var t,s;try{let n,r;"options"in e&&(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo,r=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:i,error:o}=yield mn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:n,xform:hn});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,l=i.user;return(null==a?void 0:a.access_token)&&(yield this._saveSession(a),yield this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(Ns(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithSSO(e){return u(this,null,function*(){var t,s,n;try{let r=null,i=null;return"pkce"===this.flowType&&([r,i]=yield tn(this.storage,this.storageKey)),yield mn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:i}),headers:this.headers,xform:fn})}catch(r){if(Ns(r))return{data:null,error:r};throw r}})}reauthenticate(){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return u(this,null,function*(){try{return yield this._useSession(e=>u(this,null,function*(){const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Es;const{error:n}=yield mn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}}))}catch(e){if(Ns(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return u(this,null,function*(){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:r}=e,{error:i}=yield mn(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:s,type:n,options:r}=e,{data:i,error:o}=yield mn(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new js("You must provide either an email or phone number and a type")}catch(t){if(Ns(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return u(this,null,function*(){yield this.initializePromise;return yield this._acquireLock(-1,()=>u(this,null,function*(){return this._useSession(e=>u(this,null,function*(){return e}))}))})}_acquireLock(e,t){return u(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(()=>u(this,null,function*(){return yield e,yield t()}))();return this.pendingInLock.push((()=>u(this,null,function*(){try{yield s}catch(e){}}))()),s}return yield this.lock(`lock:${this.storageKey}`,e,()=>u(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((()=>u(this,null,function*(){try{yield e}catch(t){}}))()),yield e;this.pendingInLock.length;){const e=[...this.pendingInLock];yield Promise.all(e),this.pendingInLock.splice(0,e.length)}return yield e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return u(this,null,function*(){this._debug("#_useSession","begin");try{const t=yield this.__loadSession();return yield e(t)}finally{this._debug("#_useSession","end")}})}__loadSession(){return u(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=yield Gs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<fs;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=yield Gs(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=on()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,n)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,n))})}return{data:{session:e},error:null}}const{data:n,error:r}=yield this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return u(this,null,function*(){if(e)return yield this._getUser(e);yield this.initializePromise;return yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._getUser()}))})}_getUser(e){return u(this,null,function*(){try{return e?yield mn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:gn}):yield this._useSession(e=>u(this,null,function*(){var t,s,n;const{data:r,error:i}=e;if(i)throw i;return(null===(t=r.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?yield mn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(n=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==n?n:void 0,xform:gn}):{data:{user:null},error:new Es}}))}catch(t){if(Ns(t))return function(e){return Ns(e)&&"AuthSessionMissingError"===e.name}(t)&&(yield this._removeSession(),yield Ys(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}})}updateUser(e){return u(this,arguments,function*(e,t={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._updateUser(e,t)}))})}_updateUser(e){return u(this,arguments,function*(e,t={}){try{return yield this._useSession(s=>u(this,null,function*(){const{data:n,error:r}=s;if(r)throw r;if(!n.session)throw new Es;const i=n.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=yield tn(this.storage,this.storageKey));const{data:l,error:c}=yield mn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:gn});if(c)throw c;return i.user=l.user,yield this._saveSession(i),yield this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}))}catch(s){if(Ns(s))return{data:{user:null},error:s};throw s}})}setSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return u(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new Es;const t=Date.now()/1e3;let s=t,n=!0,r=null;const{payload:i}=Qs(e.access_token);if(i.exp&&(s=i.exp,n=s<=t),n){const{data:t,error:s}=yield this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};r=t}else{const{data:n,error:i}=yield this._getUser(e.access_token);if(i)throw i;r={access_token:e.access_token,refresh_token:e.refresh_token,user:n.user,token_type:"bearer",expires_in:s-t,expires_at:s},yield this._saveSession(r),yield this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(Ns(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;if(!e){const{data:n,error:r}=t;if(r)throw r;e=null!==(s=n.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new Es;const{data:n,error:r}=yield this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(Ns(t))return{data:{user:null,session:null},error:t};throw t}})}_getSessionFromURL(e,t){return u(this,null,function*(){try{if(!Bs())throw new Rs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Rs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Ts("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Rs("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ts("No code detected.");const{data:t,error:s}=yield this._exchangeCodeForSession(e.code);if(s)throw s;const n=new URL(window.location.href);return n.searchParams.delete("code"),window.history.replaceState(window.history.state,"",n.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:r,refresh_token:i,expires_in:o,expires_at:a,token_type:l}=e;if(!(r&&o&&i&&l))throw new Rs("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(o);let m=c+u;a&&(m=parseInt(a));const h=m-c;1e3*h<=gs&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${u}s`);const d=m-u;c-d>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",d,m,c):c-d<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",d,m,c);const{data:g,error:f}=yield this._getUser(r);if(f)throw f;const p={provider_token:s,provider_refresh_token:n,access_token:r,expires_in:u,expires_at:m,refresh_token:i,token_type:l,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:p,redirectType:e.type},error:null}}catch(s){if(Ns(s))return{data:{session:null,redirectType:null},error:s};throw s}})}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}_isPKCECallback(e){return u(this,null,function*(){const t=yield Gs(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)})}signOut(){return u(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return u(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(t=>u(this,null,function*(){var s;const{data:n,error:r}=t;if(r)return{error:r};const i=null===(s=n.session)||void 0===s?void 0:s.access_token;if(i){const{error:t}=yield this.admin.signOut(i,e);if(t&&(!function(e){return Ns(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(yield this._removeSession(),yield Ys(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(()=>{u(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){this._emitInitialSession(t)}))})})(),{data:{subscription:s}}}_emitInitialSession(e){return u(this,null,function*(){return yield this._useSession(t=>u(this,null,function*(){var s,n;try{const{data:{session:n},error:r}=t;if(r)throw r;yield null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",n),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(r){yield null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}}))})}resetPasswordForEmail(e){return u(this,arguments,function*(e,t={}){let s=null,n=null;"pkce"===this.flowType&&([s,n]=yield tn(this.storage,this.storageKey,!0));try{return yield mn(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(Ns(r))return{data:null,error:r};throw r}})}getUserIdentities(){return u(this,null,function*(){var e;try{const{data:t,error:s}=yield this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}linkIdentity(e){return u(this,null,function*(){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)})}linkIdentityOAuth(e){return u(this,null,function*(){var t;try{const{data:s,error:n}=yield this._useSession(t=>u(this,null,function*(){var s,n,r,i,o;const{data:a,error:l}=t;if(l)throw l;const c=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:!0});return yield mn(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})}));if(n)throw n;return Bs()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(Ns(s))return{data:{provider:e.provider,url:null},error:s};throw s}})}linkIdentityIdToken(e){return u(this,null,function*(){return yield this._useSession(t=>u(this,null,function*(){var s;try{const{error:n,data:{session:r}}=t;if(n)throw n;const{options:i,provider:o,token:a,access_token:l,nonce:c}=e,u=yield mn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(s=null==r?void 0:r.access_token)&&void 0!==s?s:void 0,body:{provider:o,id_token:a,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:hn}),{data:m,error:h}=u;return h?{data:{user:null,session:null},error:h}:m&&m.session&&m.user?(m.session&&(yield this._saveSession(m.session),yield this._notifyAllSubscribers("USER_UPDATED",m.session)),{data:m,error:h}):{data:{user:null,session:null},error:new Ss}}catch(n){if(Ns(n))return{data:{user:null,session:null},error:n};throw n}}))})}unlinkIdentity(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s,n;const{data:r,error:i}=t;if(i)throw i;return yield mn(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(n=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==n?n:void 0})}))}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}_refreshAccessToken(e){return u(this,null,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return yield function(e,t){return new Promise((s,n)=>{(()=>{u(this,null,function*(){for(let i=0;i<1/0;i++)try{const n=yield e(i);if(!t(i,null,n))return void s(n)}catch(r){if(!t(i,r))return void n(r)}})})()})}(s=>u(this,null,function*(){return s>0&&(yield function(e){return u(this,null,function*(){return yield new Promise(t=>{setTimeout(()=>t(null),e)})})}(200*Math.pow(2,s-1))),this._debug(t,"refreshing attempt",s),yield mn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:hn})}),(e,t)=>{const n=200*Math.pow(2,e);return t&&Ds(t)&&Date.now()+n-s<gs})}catch(s){if(this._debug(t,"error",s),Ns(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}})}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return u(this,null,function*(){const s=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Bs()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}})}_recoverAndRefresh(){return u(this,null,function*(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const r=yield Gs(this.storage,this.storageKey);if(r&&this.userStorage){let t=yield Gs(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:r.user},yield Hs(this.userStorage,this.storageKey+"-user",t)),r.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:on()}else if(r&&!r.user&&!r.user){const e=yield Gs(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(r.user=e.user,yield Ys(this.storage,this.storageKey+"-user"),yield Hs(this.storage,this.storageKey,r)):r.user=on()}if(this._debug(s,"session from storage",r),!this._isValidSession(r))return this._debug(s,"session is not valid"),void(null!==r&&(yield this._removeSession()));const i=1e3*(null!==(t=r.expires_at)&&void 0!==t?t:1/0)-Date.now()<fs;if(this._debug(s,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=yield this._callRefreshToken(r.refresh_token);e&&(console.error(e),Ds(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),yield this._removeSession()))}}else if(r.user&&!0===r.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=yield this._getUser(r.access_token);!t&&(null==e?void 0:e.user)?(r.user=e.user,yield this._saveSession(r),yield this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(n){console.error("Error getting user data:",n),this._debug(s,"error getting user data, skipping SIGNED_IN notification",n)}else yield this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){return this._debug(s,"error",r),void console.error(r)}finally{this._debug(s,"end")}})}_callRefreshToken(e){return u(this,null,function*(){var t,s;if(!e)throw new Es;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Xs;const{data:t,error:s}=yield this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Es;yield this._saveSession(t.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const n={data:t.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(r){if(this._debug(n,"error",r),Ns(r)){const e={data:null,error:r};return Ds(r)||(yield this._removeSession()),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(n,"end")}})}_notifyAllSubscribers(e,t,s=!0){return u(this,null,function*(){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],r=Array.from(this.stateChangeEmitters.values()).map(s=>u(this,null,function*(){try{yield s.callback(e,t)}catch(r){n.push(r)}}));if(yield Promise.all(r),n.length>0){for(let e=0;e<n.length;e+=1)console.error(n[e]);throw n[0]}}finally{this._debug(n,"end")}})}_saveSession(e){return u(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&(yield Hs(this.userStorage,this.storageKey+"-user",{user:t.user}));const e=Object.assign({},t);delete e.user;const n=an(e);yield Hs(this.storage,this.storageKey,n)}else{const e=an(t);yield Hs(this.storage,this.storageKey,e)}})}_removeSession(){return u(this,null,function*(){this._debug("#_removeSession()"),yield Ys(this.storage,this.storageKey),yield Ys(this.storage,this.storageKey+"-code-verifier"),yield Ys(this.storage,this.storageKey+"-user"),this.userStorage&&(yield Ys(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Bs()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return u(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),gs);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(()=>u(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return u(this,null,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return u(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>u(this,null,function*(){try{const t=Date.now();try{return yield this._useSession(e=>u(this,null,function*(){const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const n=Math.floor((1e3*s.expires_at-t)/gs);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),n<=3&&(yield this._callRefreshToken(s.refresh_token))}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof xn))throw e;this._debug("auto refresh token tick lock not available")}})}_handleVisibilityChange(){return u(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!Bs()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>u(this,null,function*(){return yield this._onVisibilityChanged(!1)}),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return u(this,null,function*(){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){"visible"===document.visibilityState?yield this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t,s){return u(this,null,function*(){const n=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=yield tn(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});n.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);n.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`})}_unenroll(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;const{data:n,error:r}=t;return r?{data:null,error:r}:yield mn(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==n?void 0:n.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}_enroll(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s,n;const{data:r,error:i}=t;if(i)return{data:null,error:i};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:a,error:l}=yield mn(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&"totp"===a.type&&(null===(n=null==a?void 0:a.totp)||void 0===n?void 0:n.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(t){if(Ns(t))return{data:null,error:t};throw t}})}_verify(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;const{data:n,error:r}=t;if(r)return{data:null,error:r};const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?Cn(e.webauthn.credential_response):Vn(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:a}=yield mn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:null===(s=null==n?void 0:n.session)||void 0===s?void 0:s.access_token});return a?{data:null,error:a}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})}))}catch(t){if(Ns(t))return{data:null,error:t};throw t}}))})}_challenge(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;const{data:n,error:r}=t;if(r)return{data:null,error:r};const i=yield mn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(s=null==n?void 0:n.session)||void 0===s?void 0:s.access_token});if(i.error)return i;const{data:o}=i;if("webauthn"!==o.type)return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Pn(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:In(o.webauthn.credential_options.publicKey)})})}),error:null}}}))}catch(t){if(Ns(t))return{data:null,error:t};throw t}}))})}_challengeAndVerify(e){return u(this,null,function*(){const{data:t,error:s}=yield this._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return u(this,null,function*(){var e;const{data:{user:t},error:s}=yield this.getUser();if(s)return{data:null,error:s};const n={all:[],phone:[],totp:[],webauthn:[]};for(const r of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])n.all.push(r),"verified"===r.status&&n[r.factor_type].push(r);return{data:n,error:null}})}_getAuthenticatorAssuranceLevel(){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){return yield this._useSession(e=>u(this,null,function*(){var t,s;const{data:{session:n},error:r}=e;if(r)return{data:null,error:r};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Qs(n.access_token);let o=null;i.aal&&(o=i.aal);let a=o;(null!==(s=null===(t=n.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:i.amr||[]},error:null}}))}))})}fetchJwk(e){return u(this,arguments,function*(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>n)return s;const{data:r,error:i}=yield mn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return r.keys&&0!==r.keys.length?(this.jwks=r,this.jwks_cached_at=n,s=r.keys.find(t=>t.kid===e),s||null):null})}getClaims(e){return u(this,arguments,function*(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=yield this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:n,payload:r,signature:i,raw:{header:o,payload:a}}=Qs(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(r.exp);const l=n.alg&&!n.alg.startsWith("HS")&&n.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?yield this.fetchJwk(n.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=yield this.getUser(s);if(e)throw e;return{data:{claims:r,header:n,signature:i},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(n.alg),u=yield crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(yield crypto.subtle.verify(c,u,i,zs(`${o}.${a}`))))throw new Ps("Invalid JWT signature");return{data:{claims:r,header:n,signature:i},error:null}}catch(s){if(Ns(s))return{data:null,error:s};throw s}})}}Jn.nextInstanceID=0;const Kn=Jn;class Hn extends Kn{constructor(e){super(e)}}var Gn=function(e,t,s,n){return new(s||(s=Promise))(function(t,r){function i(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s(function(e){e(n)})).then(i,o)}a((n=n.apply(e,[])).next())})};class Yn{constructor(e,t,s){var n,r,i;this.supabaseUrl=e,this.supabaseKey=t;const o=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((s=t).endsWith("/")?s:s+"/")}catch(n){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var s}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const a=`sb-${o.hostname.split(".")[0]}-auth-token`,l=function(e,t){var s,n;const{db:r,auth:i,realtime:o,global:a}=e,{db:l,auth:c,realtime:u,global:m}=t,h={db:Object.assign(Object.assign({},l),r),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},m),a),{headers:Object.assign(Object.assign({},null!==(s=null==m?void 0:m.headers)&&void 0!==s?s:{}),null!==(n=null==a?void 0:a.headers)&&void 0!==n?n:{})}),accessToken:()=>hs(this,0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:as,realtime:cs,auth:Object.assign(Object.assign({},ls),{storageKey:a}),global:os});this.storageKey=null!==(n=l.auth.storageKey)&&void 0!==n?n:"",this.headers=null!==(r=l.global.headers)&&void 0!==r?r:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=l.auth)&&void 0!==i?i:{},this.headers,l.global.fetch),this.fetch=ms(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new Le(new URL("rest/v1",o).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new rs(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Q(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return Gn(this,0,void 0,function*(){var e,t;if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:r,storageKey:i,flowType:o,lock:a,debug:l},c,u){const m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Hn({url:this.authUrl.href,headers:Object.assign(Object.assign({},m),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:r,flowType:o,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Ot(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=s,this.realtime.setAuth(s))}}(function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Xn="https://agesdprmugyybtqrvqks.supabase.co";console.log("Supabase配置详情:",{url:"已配置",urlValue:"https://agesdprmugyybtqrvqks.supabase.co".substring(0,50)+"...",key:"已配置",keyValue:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFnZXNkcHJtdWd5eWJ0cXJ2cWtzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNDY0OTIsImV4cCI6MjA3MDcyMjQ5Mn0.bfo_xb818yMd7-u6cJhDoJrqmDwcGY1nBDJIesFSfWk".substring(0,50)+"...",env:"production",isDev:!0,isProd:!1}),console.log("✅ Supabase配置正常，连接到:",Xn);const Qn=new Yn(Xn,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFnZXNkcHJtdWd5eWJ0cXJ2cWtzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNDY0OTIsImV4cCI6MjA3MDcyMjQ5Mn0.bfo_xb818yMd7-u6cJhDoJrqmDwcGY1nBDJIesFSfWk",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"supabase-js-web-mobile-safari-optimized"},fetch:(e,t)=>u(void 0,null,function*(){try{const s=new AbortController,n=setTimeout(()=>s.abort(),1e4),r=yield fetch(e,l(a({},t),{signal:s.signal}));return clearTimeout(n),r}catch(s){throw console.error("Fetch failed:",s),s}})},db:{schema:"public"},realtime:{params:{eventsPerSecond:3}}});function Zn(e){return u(this,null,function*(){try{return yield function(e,t=3,s=1e3){return u(this,null,function*(){let n;for(let i=1;i<=t;i++)try{return yield e()}catch(r){if(n=r,console.warn(`操作失败，第 ${i} 次尝试:`,r),i===t)break;const e=s*Math.pow(2,i-1);yield new Promise(t=>setTimeout(t,e))}throw n})}(e,2,500)}catch(t){return console.error("数据库查询失败:",t),{data:null,error:{message:"网络连接异常，请检查网络设置或稍后重试",code:"NETWORK_ERROR",details:t}}}})}const er={USER_READ:"user:read",USER_MANAGE:"user:manage",USER_CREATE:"user:create",USER_DELETE:"user:delete",COMPANY_READ:"company:read",COMPANY_MANAGE:"company:manage",COMPANY_CREATE:"company:create",COMPANY_DELETE:"company:delete",PROCESS_READ:"process:read",PROCESS_MANAGE:"process:manage",PROCESS_CREATE:"process:create",PROCESS_DELETE:"process:delete",ROLE_MANAGE:"role:manage",SYSTEM_CONFIG:"system:config",TIME_RECORD:"time_record",REPORTS:"reports",HISTORY:"history",PROCESS_MANAGEMENT:"process_management",USER_MANAGEMENT:"user_management",COMPANY_MANAGEMENT:"company_management",SUPERVISOR_REVIEW:"supervisor_review",MANAGER_REVIEW:"manager_review",PERMISSION_MANAGEMENT:"permission_management"},tr="超级管理员",sr=[{id:"time_record",name:"记录工时",description:"记录和管理工作时间",icon:"Clock",path:"/timesheet-record",permission:er.TIME_RECORD,color:"from-green-400 to-green-600"},{id:"reports",name:"查看报表",description:"查看工时统计和分析报表",icon:"BarChart3",path:"/reports",permission:er.REPORTS,color:"from-blue-400 to-blue-600"},{id:"history",name:"历史记录",description:"查看个人工时历史记录",icon:"Activity",path:"/history",permission:er.HISTORY,color:"from-cyan-400 to-cyan-600"},{id:"process_management",name:"工序管理",description:"管理生产工序和流程",icon:"Settings",path:"/process-management",permission:er.PROCESS_MANAGEMENT,color:"from-purple-400 to-purple-600"},{id:"user_management",name:"用户管理",description:"管理系统用户和权限",icon:"Users",path:"/user-management",permission:er.USER_MANAGEMENT,color:"from-orange-400 to-orange-600"},{id:"company_management",name:"公司管理",description:"管理公司信息和部门",icon:"Building2",path:"/company-management",permission:er.COMPANY_MANAGEMENT,color:"from-teal-400 to-teal-600"},{id:"supervisor_review",name:"班长审核",description:"班长审核工时记录",icon:"CheckCircle",path:"/supervisor-approval",permission:er.SUPERVISOR_REVIEW,color:"from-indigo-400 to-indigo-600"},{id:"section_chief_review",name:"段长审核",description:"段长审核工时记录",icon:"Shield",path:"/section-chief-approval",permission:er.MANAGER_REVIEW,color:"from-pink-400 to-pink-600"},{id:"permission_management",name:"权限管理",description:"管理用户角色和权限",icon:"Key",path:"/role-permissions",permission:er.PERMISSION_MANAGEMENT,color:"from-red-400 to-red-600"}];function nr(e,t){return u(this,null,function*(){try{return(yield or(e)).includes(t)}catch(s){return console.error("权限检查异常:",s),!1}})}let rr=null;const ir=6e5;function or(e){return u(this,null,function*(){try{if(rr&&rr.userId===e&&Date.now()-rr.timestamp<ir)return rr.permissions;const{data:t,error:s}=yield Zn(()=>u(this,null,function*(){return yield Qn.from("users").select("\n          id,\n          role_id,\n          user_roles (\n            id,\n            name,\n            permissions\n          )\n        ").eq("id",e).single()}));if(s||!t)return console.error("获取用户信息失败:",s),[];let n=[];return t.user_roles&&lr(t.user_roles.name)?n=mr():t.user_roles&&t.user_roles.permissions&&(n=t.user_roles.permissions),rr={permissions:n,timestamp:Date.now(),userId:e},n}catch(t){return console.error("获取用户权限异常:",t),[]}})}function ar(e){return sr.filter(t=>e.includes(t.permission))}function lr(e){return"object"==typeof e&&null!==e?"超级管理员"===e.name:"超级管理员"===e}function cr(){return sr}const ur=(e,t)=>{if(!e)return!1;if(lr(e.role||e.user_roles))return!0;const s=e.role||e.user_roles;return!(!s||!s.permissions)&&s.permissions.includes(t)},mr=()=>Object.values(er),hr=m.createContext(void 0);function dr({children:e}){const[t,s]=m.useState(null),[n,r]=m.useState(!0);m.useEffect(()=>{(()=>{u(this,null,function*(){try{const t=localStorage.getItem("auth_user"),n=localStorage.getItem("last_login_time");if(t&&n){const i=JSON.parse(t),o=parseInt(n),a=Date.now();if(a-o>864e5)return console.warn("会话已过期，清除本地数据"),localStorage.removeItem("auth_user"),localStorage.removeItem("last_login_time"),s(null),void r(!1);if(!navigator.onLine)return s(i),void r(!1);try{const{data:e,error:t}=yield Promise.race([Qn.from("users").select("\n                  *,\n                  company:companies(*),\n                  role:user_roles(*)\n                ").eq("id",i.id).eq("is_active",!0).single(),new Promise((e,t)=>setTimeout(()=>t(new Error("验证超时")),8e3))]);if(e&&!t){const t=yield or(e.id),n={id:e.id,phone:e.phone,name:e.name,id_card:e.id_card,company:e.company,role:e.role,department_id:e.department_id,is_active:e.is_active,permissions:t};s(n),localStorage.setItem("auth_user",JSON.stringify(n)),localStorage.setItem("last_login_time",a.toString())}else console.warn("用户验证失败，清除本地数据"),localStorage.removeItem("auth_user"),localStorage.removeItem("last_login_time"),s(null)}catch(e){console.warn("用户验证网络错误，使用本地数据:",e),s(i)}}else s(null)}catch(t){console.error("检查用户状态失败:",t),localStorage.removeItem("auth_user"),localStorage.removeItem("last_login_time"),s(null)}finally{r(!1)}})})();const e=setInterval(()=>{const e=localStorage.getItem("last_login_time");if(e){const t=parseInt(e);Date.now()-t>864e5&&(console.warn("会话过期，自动登出"),localStorage.removeItem("auth_user"),localStorage.removeItem("last_login_time"),s(null),window.location.href="/login")}},6e4),{data:{subscription:t}}=Qn.auth.onAuthStateChange((e,t)=>u(this,null,function*(){"SIGNED_OUT"===e&&(s(null),localStorage.removeItem("auth_user"),localStorage.removeItem("last_login_time"))}));return()=>{t.unsubscribe(),clearInterval(e)}},[]);const i=(e,t,n=0)=>u(this,null,function*(){var r,o,a,l,c,m,h,d;try{if(!navigator.onLine)return{success:!1,error:"网络连接已断开，请检查网络后重试"};const{data:n,error:r}=yield Promise.race([Qn.from("users").select("\n            *,\n            company:companies(*),\n            role:user_roles(*)\n          ").eq("phone",e).eq("is_active",!0).single(),new Promise((e,t)=>setTimeout(()=>t(new Error("请求超时")),1e4))]);if(r){if(console.error("用户查询错误:",r),"PGRST116"===r.code)return{success:!1,error:"用户不存在或已被禁用"};throw r}if(!n)return{success:!1,error:"用户不存在或已被禁用"};if(n.password_hash!==t)return{success:!1,error:"密码错误"};let i=[];n.role&&"超级管理员"===n.role.name?i=Object.values(er):setTimeout(()=>u(this,null,function*(){try{const e=yield or(n.id),t=JSON.parse(localStorage.getItem("auth_user")||"{}");t.id===n.id&&(t.permissions=e,localStorage.setItem("auth_user",JSON.stringify(t)),s(t))}catch(e){console.warn("异步获取权限失败:",e)}}),100);const o={id:n.id,phone:n.phone,name:n.name,id_card:n.id_card,company:n.company,role:n.role,department_id:n.department_id,is_active:n.is_active,permissions:i};return s(o),localStorage.setItem("auth_user",JSON.stringify(o)),localStorage.setItem("last_login_time",Date.now().toString()),{success:!0}}catch(g){console.error("登录失败:",g);const s=(null==(r=g.message)?void 0:r.includes("fetch"))||(null==(o=g.message)?void 0:o.includes("network"))||(null==(a=g.message)?void 0:a.includes("CONNECTION_CLOSED"))||(null==(l=g.message)?void 0:l.includes("ERR_NETWORK_CHANGED"))||(null==(c=g.message)?void 0:c.includes("ERR_ABORTED"))||(null==(m=g.message)?void 0:m.includes("ERR_CONNECTION_CLOSED"))||(null==(h=g.message)?void 0:h.includes("请求超时"))||(null==(d=g.message)?void 0:d.includes("Failed to fetch"))||"NETWORK_ERROR"===g.code||"TypeError"===g.name||!navigator.onLine;return n<5&&s?(console.log(`网络错误，重试登录，第 ${n+1} 次，错误:`,g.message),yield new Promise(e=>setTimeout(e,1e3*Math.pow(2,n))),i(e,t,n+1)):s?{success:!1,error:`网络连接不稳定，已重试${n}次，请检查网络后重试`}:{success:!1,error:g.message||"登录失败，请稍后重试"}}}),o={user:t,loading:n,login:i,register:e=>u(this,null,function*(){try{const{data:t,error:s}=yield Qn.from("users").select("id").eq("id_card",e.id_card).maybeSingle();if(s&&"PGRST116"!==s.code)return{success:!1,error:"系统错误，请稍后重试"};const{data:n,error:r}=yield Qn.from("users").select("id").eq("phone",e.phone).maybeSingle();if(r&&"PGRST116"!==r.code)return{success:!1,error:"系统错误，请稍后重试"};if(t||n){if(t)return{success:!1,error:"该身份证号已被注册"};if(n)return{success:!1,error:"该手机号已被注册"}}const i=crypto.randomUUID();console.log("创建用户账号，用户ID:",i);const{error:o}=yield Qn.from("users").insert({id:i,phone:e.phone,id_card:e.id_card,name:e.name,company_id:e.company_id,role_id:e.role_id,password_hash:e.password,production_line:e.production_line,is_active:!1});if(o)return{success:!1,error:"用户信息创建失败"};const{data:a}=yield Qn.from("users").select("\n          *,\n          company:companies(*),\n          role:user_roles(*)\n        ").eq("id",i).single();return console.log("用户注册成功，账号状态为禁用，需要管理员激活"),{success:!0}}catch(t){return{success:!1,error:t.message||"注册失败，请重试"}}}),logout:()=>u(this,null,function*(){try{s(null),localStorage.removeItem("auth_user"),localStorage.removeItem("last_login_time"),console.log("用户已成功登出")}catch(e){console.error("登出错误:",e),s(null),localStorage.removeItem("auth_user"),localStorage.removeItem("last_login_time")}}),resetPassword:(e,t)=>u(this,null,function*(){var s;try{const{data:s,error:n}=yield Promise.race([Qn.from("users").select("id, phone, name").eq("id_card",e).eq("is_active",!0).single(),new Promise((e,t)=>setTimeout(()=>t(new Error("查询超时")),8e3))]);if(n)return console.error("用户查询错误:",n),"PGRST116"===n.code?{success:!1,error:"未找到该身份证号对应的用户"}:{success:!1,error:"查询用户失败，请重试"};if(!s)return{success:!1,error:"未找到该身份证号对应的用户"};if(!t)return{success:!0,user:{id:s.id,phone:s.phone,name:s.name}};const{error:r}=yield Promise.race([Qn.from("users").update({password_hash:t}).eq("id",s.id),new Promise((e,t)=>setTimeout(()=>t(new Error("更新超时")),8e3))]);return r?(console.error("密码更新错误:",r),{success:!1,error:"密码重置失败，请重试"}):{success:!0}}catch(n){return console.error("重置密码失败:",n),(null==(s=n.message)?void 0:s.includes("超时"))?{success:!1,error:"网络超时，请检查网络连接后重试"}:{success:!1,error:n.message||"密码重置失败"}}}),refreshUser:()=>u(this,null,function*(){if(null==t?void 0:t.id)try{const{data:e,error:n}=yield Qn.from("users").select("\n          *,\n          company:companies(*),\n          role:user_roles(*)\n        ").eq("id",t.id).eq("is_active",!0).single();if(e&&!n){const t=yield or(e.id),n={id:e.id,phone:e.phone,name:e.name,id_card:e.id_card,company:e.company,role:e.role,department_id:e.department_id,is_active:e.is_active,permissions:t};s(n),localStorage.setItem("auth_user",JSON.stringify(n))}}catch(e){console.error("刷新用户信息失败:",e)}}),isAuthenticated:()=>!!(t&&t.id&&t.is_active)};return M.jsxDEV(hr.Provider,{value:o,children:e},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/contexts/AuthContext.tsx",lineNumber:498,columnNumber:10},this)}function gr(){const e=m.useContext(hr);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}function fr({children:e,requireAuth:t=!0}){const{user:s,loading:n,isAuthenticated:r}=gr(),i=f();return n?M.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:M.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ProtectedRoute.tsx",lineNumber:17,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ProtectedRoute.tsx",lineNumber:16,columnNumber:7},this):t&&!r()?M.jsxDEV(p,{to:"/login",state:{from:i},replace:!0},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ProtectedRoute.tsx",lineNumber:26,columnNumber:12},this):!t&&r()?M.jsxDEV(p,{to:"/dashboard",replace:!0},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ProtectedRoute.tsx",lineNumber:31,columnNumber:12},this):M.jsxDEV(M.Fragment,{children:e},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ProtectedRoute.tsx",lineNumber:34,columnNumber:10},this)}function pr({children:e,allowedRoles:t,fallbackPath:s="/dashboard"}){var n;const{user:r,loading:i}=gr(),o=f();if(i)return M.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:M.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:22,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:21,columnNumber:7},this);if(!r)return M.jsxDEV(p,{to:"/login",state:{from:o},replace:!0},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:31,columnNumber:12},this);const a=null==(n=r.role)?void 0:n.name,l=t.some(e=>a===e||(null==a?void 0:a.toLowerCase())===e.toLowerCase());return console.log("🔍 RoleProtectedRoute 权限检查:",{userRole:a,allowedRoles:t,hasPermission:l,currentPath:o.pathname}),l?M.jsxDEV(M.Fragment,{children:e},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:70,columnNumber:10},this):M.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:M.jsxDEV("div",{className:"text-center",children:[M.jsxDEV("div",{className:"text-red-400 text-6xl mb-4",children:"🚫"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:54,columnNumber:11},this),M.jsxDEV("h1",{className:"text-2xl font-bold text-red-400 mb-2 font-mono",children:"访问被拒绝"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:55,columnNumber:11},this),M.jsxDEV("p",{className:"text-green-300 mb-6 font-mono",children:["您没有权限访问此页面。需要角色: ",t.join(", ")]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:56,columnNumber:11},this),M.jsxDEV("button",{onClick:()=>window.history.back(),className:"px-6 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded font-mono transition-colors",children:"返回上一页"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:59,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:53,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RoleProtectedRoute.tsx",lineNumber:52,columnNumber:7},this)}function yr(){var e,t;const[s,n]=m.useState({phone:"",password:""}),[r,i]=m.useState(!1),[o,c]=m.useState(!1),[h,d]=m.useState(""),[g,p]=m.useState(!1),[v,w]=m.useState(!1),[N,R]=m.useState([]),{login:T}=gr(),O=y(),D=(null==(t=null==(e=f().state)?void 0:e.from)?void 0:t.pathname)||"/dashboard",A=e=>{try{return atob(e)}catch(t){return""}};m.useEffect(()=>{const e=localStorage.getItem("savedUsers"),t=localStorage.getItem("savedCredentials");if(e){const t=JSON.parse(e);R(t),t.length>0&&(n(e=>l(a({},e),{phone:t[0].phone})),p(!0))}if(t)try{const e=JSON.parse(t);e.phone&&e.password&&(n({phone:e.phone,password:A(e.password)}),w(!0),p(!0))}catch(s){console.error("Failed to load saved credentials:",s)}},[]);const P=e=>{n(l(a({},s),{[e.target.name]:e.target.value}))};return M.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center px-4",children:M.jsxDEV("div",{className:"max-w-md w-full space-y-8",children:[M.jsxDEV("div",{className:"text-center",children:[M.jsxDEV("div",{className:"flex items-center justify-center mb-2",children:[M.jsxDEV("svg",{className:"w-16 h-16 mr-4",viewBox:"0 0 80 80",xmlns:"http://www.w3.org/2000/svg",children:[M.jsxDEV("ellipse",{cx:"40",cy:"40",rx:"38",ry:"30",fill:"black",stroke:"#22c55e",strokeWidth:"3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:163,columnNumber:15},this),M.jsxDEV("text",{x:"40",y:"50",textAnchor:"middle",fill:"#22c55e",fontSize:"28",fontWeight:"bold",fontFamily:"Arial, sans-serif",children:"JT"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:164,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:162,columnNumber:13},this),M.jsxDEV("h1",{className:"text-4xl font-bold text-green-400 font-mono",children:"工时管理系统"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:166,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:161,columnNumber:11},this),M.jsxDEV("div",{className:"mt-4 h-1 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:170,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:160,columnNumber:9},this),M.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-8 shadow-lg shadow-green-400/20",children:[M.jsxDEV("h2",{className:"text-2xl font-bold text-green-400 mb-6 text-center font-mono",children:"用户登录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:175,columnNumber:11},this),h&&M.jsxDEV("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-400 rounded text-red-300 text-sm",children:h},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:180,columnNumber:13},this),M.jsxDEV("form",{onSubmit:e=>u(this,null,function*(){if(e.preventDefault(),c(!0),d(""),!s.phone||!s.password)return d("请填写所有必填字段"),void c(!1);const t=yield T(s.phone,s.password);if(t.success){if(g){const e=JSON.parse(localStorage.getItem("savedUsers")||"[]");if(e.find(e=>e.phone===s.phone)){const t=e.filter(e=>e.phone!==s.phone),n=[{phone:s.phone},...t];localStorage.setItem("savedUsers",JSON.stringify(n))}else{const t=[{phone:s.phone},...e.slice(0,4)];localStorage.setItem("savedUsers",JSON.stringify(t))}}if(v){const e={phone:s.phone,password:(n=s.password,btoa(n))};localStorage.setItem("savedCredentials",JSON.stringify(e))}else localStorage.removeItem("savedCredentials");O(D,{replace:!0})}else d(t.error||"登录失败");var n;c(!1)}),className:"space-y-6",children:[M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-2",children:"手机号码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:188,columnNumber:15},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:192,columnNumber:17},this),M.jsxDEV("input",{type:"tel",name:"phone",value:s.phone,onChange:P,className:"w-full pl-12 pr-4 py-3 bg-black border border-green-400 rounded-lg text-green-300 placeholder-green-600 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono",placeholder:"请输入手机号码",maxLength:11},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:193,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:191,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:187,columnNumber:13},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-2",children:"登录密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:207,columnNumber:15},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:211,columnNumber:17},this),M.jsxDEV("input",{type:r?"text":"password",name:"password",value:s.password,onChange:P,className:"w-full pl-12 pr-12 py-3 bg-black border border-green-400 rounded-lg text-green-300 placeholder-green-600 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono",placeholder:"请输入密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:212,columnNumber:17},this),M.jsxDEV("button",{type:"button",onClick:()=>i(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-green-400 hover:text-green-300",children:r?M.jsxDEV(k,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:225,columnNumber:35},this):M.jsxDEV(E,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:225,columnNumber:68},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:220,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:210,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:206,columnNumber:13},this),M.jsxDEV("div",{className:"space-y-3",children:[M.jsxDEV("div",{className:"flex items-center",children:[M.jsxDEV("input",{type:"checkbox",id:"rememberMe",checked:g,onChange:e=>p(e.target.checked),className:"w-4 h-4 text-green-600 bg-black border-green-400 rounded focus:ring-green-500 focus:ring-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:233,columnNumber:17},this),M.jsxDEV("label",{htmlFor:"rememberMe",className:"ml-2 text-sm text-green-300 font-mono",children:"记住账号"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:240,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:232,columnNumber:15},this),M.jsxDEV("div",{className:"flex items-center",children:[M.jsxDEV("input",{type:"checkbox",id:"rememberPassword",checked:v,onChange:e=>w(e.target.checked),className:"w-4 h-4 text-green-600 bg-black border-green-400 rounded focus:ring-green-500 focus:ring-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:246,columnNumber:17},this),M.jsxDEV("label",{htmlFor:"rememberPassword",className:"ml-2 text-sm text-green-300 font-mono",children:"记住密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:253,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:245,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:231,columnNumber:13},this),M.jsxDEV("button",{type:"submit",disabled:o,className:"w-full py-3 bg-green-600 hover:bg-green-500 disabled:bg-green-800 text-black font-bold rounded-lg transition-colors duration-200 font-mono text-lg",children:o?"登录中...":"登录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:260,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:185,columnNumber:11},this),N.length>0&&M.jsxDEV("div",{className:"mt-6",children:[M.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[M.jsxDEV("h3",{className:"text-green-300 text-sm font-mono",children:"快速登录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:273,columnNumber:17},this),M.jsxDEV("button",{type:"button",onClick:()=>{localStorage.removeItem("savedUsers"),localStorage.removeItem("savedCredentials"),R([]),n({phone:"",password:""}),p(!1),w(!1)},className:"text-red-400 hover:text-red-300 text-xs font-mono flex items-center",title:"清除所有保存的登录信息",children:[M.jsxDEV(S,{className:"w-3 h-3 mr-1"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:280,columnNumber:19},this),"清除"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:274,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:272,columnNumber:15},this),M.jsxDEV("div",{className:"space-y-2",children:N.slice(0,3).map((e,t)=>M.jsxDEV("button",{type:"button",onClick:()=>(e=>{n(t=>l(a({},t),{phone:e}));const t=localStorage.getItem("savedCredentials");if(t)try{const s=JSON.parse(t);s.phone===e&&s.password&&(n({phone:e,password:A(s.password)}),w(!0))}catch(s){console.error("Failed to load saved password:",s)}})(e.phone),className:"w-full flex items-center p-2 bg-gray-800 hover:bg-gray-700 border border-green-400/30 rounded-lg transition-colors duration-200",children:[M.jsxDEV(j,{className:"w-4 h-4 text-green-400 mr-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:292,columnNumber:21},this),M.jsxDEV("span",{className:"text-green-300 font-mono text-sm",children:e.phone},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:293,columnNumber:21},this),s.phone===e.phone&&M.jsxDEV("span",{className:"ml-auto text-green-400 text-xs font-mono",children:"当前"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:295,columnNumber:23},this)]},e.phone,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:286,columnNumber:19},this))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:284,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:271,columnNumber:13},this),M.jsxDEV("div",{className:"mt-6 text-center space-y-2",children:[M.jsxDEV(b,{to:"/register",className:"block text-green-400 hover:text-green-300 text-sm font-mono transition-colors",children:"还没有账号？立即注册"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:305,columnNumber:13},this),M.jsxDEV(b,{to:"/reset-password",className:"block text-green-400 hover:text-green-300 text-sm font-mono transition-colors",children:"忘记密码？重置密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:311,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:304,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:174,columnNumber:9},this),M.jsxDEV("div",{className:"text-center text-green-600 text-xs font-mono",children:[M.jsxDEV("p",{children:"© 吉林省通用机械（集团）有限责任公司."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:322,columnNumber:11},this),M.jsxDEV("div",{className:"mt-2 flex justify-center space-x-2",children:[M.jsxDEV("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:324,columnNumber:13},this),M.jsxDEV("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:325,columnNumber:13},this),M.jsxDEV("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:326,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:323,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:321,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:158,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Login.tsx",lineNumber:157,columnNumber:5},this)}function br({isOpen:e,onClose:t,userName:s,userPhone:n}){return e?M.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:M.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg shadow-2xl shadow-green-400/30 max-w-md w-full",children:[M.jsxDEV("div",{className:"bg-gradient-to-r from-green-900/50 to-green-800/50 border-b border-green-400/30 p-6 rounded-t-lg",children:[M.jsxDEV("div",{className:"flex items-center justify-center mb-4",children:M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(R,{className:"w-16 h-16 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:26,columnNumber:15},this),M.jsxDEV("div",{className:"absolute inset-0 animate-ping",children:M.jsxDEV(R,{className:"w-16 h-16 text-green-400 opacity-30"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:28,columnNumber:17},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:27,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:25,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:24,columnNumber:11},this),M.jsxDEV("h2",{className:"text-2xl font-bold text-green-400 text-center font-mono",children:"注册申请提交成功"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:32,columnNumber:11},this),M.jsxDEV("p",{className:"text-green-300 text-center text-sm font-mono mt-2",children:"REGISTRATION SUBMITTED SUCCESSFULLY"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:35,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:23,columnNumber:9},this),M.jsxDEV("div",{className:"p-6 space-y-6",children:[M.jsxDEV("div",{className:"bg-black/50 border border-green-400/30 rounded-lg p-4",children:[M.jsxDEV("h3",{className:"text-green-400 font-mono text-sm mb-3 flex items-center",children:[M.jsxDEV(T,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:45,columnNumber:15},this),"申请人信息"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:44,columnNumber:13},this),M.jsxDEV("div",{className:"space-y-2 text-sm",children:[M.jsxDEV("div",{className:"flex justify-between",children:[M.jsxDEV("span",{className:"text-green-300",children:"姓名："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:50,columnNumber:17},this),M.jsxDEV("span",{className:"text-green-100 font-mono",children:s},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:51,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:49,columnNumber:15},this),M.jsxDEV("div",{className:"flex justify-between",children:[M.jsxDEV("span",{className:"text-green-300",children:"手机号："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:54,columnNumber:17},this),M.jsxDEV("span",{className:"text-green-100 font-mono",children:n},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:55,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:53,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:48,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:43,columnNumber:11},this),M.jsxDEV("div",{className:"bg-yellow-900/20 border border-yellow-400/30 rounded-lg p-4",children:[M.jsxDEV("h3",{className:"text-yellow-400 font-mono text-sm mb-3 flex items-center",children:[M.jsxDEV(O,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:63,columnNumber:15},this),"当前状态"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:62,columnNumber:13},this),M.jsxDEV("div",{className:"space-y-3",children:[M.jsxDEV("div",{className:"flex items-center",children:[M.jsxDEV("div",{className:"w-2 h-2 bg-yellow-400 rounded-full mr-3 animate-pulse"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:68,columnNumber:17},this),M.jsxDEV("span",{className:"text-yellow-100 text-sm",children:"账号状态：待激活"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:69,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:67,columnNumber:15},this),M.jsxDEV("p",{className:"text-yellow-200 text-xs leading-relaxed",children:'您的账号已成功创建，但当前处于"待激活"状态。系统管理员将在1-2个工作日内审核您的申请。'},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:71,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:66,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:61,columnNumber:11},this),M.jsxDEV("div",{className:"bg-blue-900/20 border border-blue-400/30 rounded-lg p-4",children:[M.jsxDEV("h3",{className:"text-blue-400 font-mono text-sm mb-3",children:"后续步骤"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:79,columnNumber:13},this),M.jsxDEV("div",{className:"space-y-2 text-xs text-blue-200",children:[M.jsxDEV("div",{className:"flex items-start",children:[M.jsxDEV(D,{className:"w-3 h-3 mr-2 mt-0.5 text-blue-400 flex-shrink-0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:82,columnNumber:17},this),M.jsxDEV("span",{children:"请耐心等待系统管理员审核激活您的账号"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:83,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:81,columnNumber:15},this),M.jsxDEV("div",{className:"flex items-start",children:[M.jsxDEV(D,{className:"w-3 h-3 mr-2 mt-0.5 text-blue-400 flex-shrink-0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:86,columnNumber:17},this),M.jsxDEV("span",{children:"账号激活后，您将可以使用注册的手机号和密码登录系统"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:87,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:85,columnNumber:15},this),M.jsxDEV("div",{className:"flex items-start",children:[M.jsxDEV(D,{className:"w-3 h-3 mr-2 mt-0.5 text-blue-400 flex-shrink-0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:90,columnNumber:17},this),M.jsxDEV("span",{children:"如有疑问，请联系系统管理员或IT支持部门"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:91,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:89,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:80,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:78,columnNumber:11},this),M.jsxDEV("div",{className:"pt-4",children:M.jsxDEV("button",{onClick:t,className:"w-full bg-green-600 hover:bg-green-500 text-white font-mono py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-50",children:"前往登录页面"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:98,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:97,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:41,columnNumber:9},this),M.jsxDEV("div",{className:"bg-gray-800/50 border-t border-green-400/30 p-4 rounded-b-lg",children:M.jsxDEV("p",{className:"text-green-300 text-xs text-center font-mono",children:"工时管理系统 · TIMETRACK SYSTEM"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:109,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:108,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:21,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/RegistrationSuccessDialog.tsx",lineNumber:20,columnNumber:5},this):null}function vr(){const[e,t]=m.useState({phone:"",password:"",confirmPassword:"",id_card:"",name:"",company_id:"",role_id:"",production_line:""}),[s,n]=m.useState(!1),[r,i]=m.useState(!1),[o,c]=m.useState(!1),[h,d]=m.useState(""),[g,f]=m.useState([]),[p,v]=m.useState([]),[w,N]=m.useState(""),[S,R]=m.useState(!0),[O,D]=m.useState([]),[C,V]=m.useState(!1),[L,$]=m.useState(null),[U,q]=m.useState(!1),[z,W]=m.useState(""),[B,F]=m.useState(!1),{register:J}=gr(),K=y();m.useEffect(()=>{const e=e=>{e.target.closest(".production-line-dropdown")||F(!1)};return B&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[B]),m.useEffect(()=>{(()=>{u(this,null,function*(){try{const{data:e,error:t}=yield Qn.from("companies").select("*").order("name");if(t)throw t;const{data:s,error:n}=yield Qn.from("user_roles").select("*").neq("name","超级管理员").order("name");if(n)throw n;f(e||[]),v(s||[])}catch(e){d("获取数据失败，请重试")}finally{R(!1)}})})()},[]);const H=e=>u(this,null,function*(){try{const{data:t,error:s}=yield Qn.from("processes").select("production_line").eq("company_id",e).eq("is_active",!0);if(s)throw s;const n=[...new Set((null==t?void 0:t.map(e=>e.production_line))||[])];D(n)}catch(t){console.error("获取生产线数据失败:",t),D([])}}),G=s=>u(this,null,function*(){const{name:n,value:r}=s.target;if(t(e=>l(a({},e),{[n]:r})),"role_id"===n){const s=p.find(e=>e.id===r);$(s||null);const n=s&&("班长"===s.name||"段长"===s.name);V(n||!1),n&&e.company_id&&(yield H(e.company_id)),n||t(e=>l(a({},e),{production_line:""}))}if("company_id"===n&&C&&(yield H(r),t(e=>l(a({},e),{production_line:""}))),"confirmPassword"===n||"password"===n){const t="password"===n?r:e.password,s="confirmPassword"===n?r:e.confirmPassword;N(s&&t!==s?"两次输入的密码不一致":"")}});return S?M.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:M.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:231,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:230,columnNumber:7},this):M.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center px-4 py-8",children:[M.jsxDEV("div",{className:"max-w-md w-full space-y-8",children:[M.jsxDEV("div",{className:"text-center",children:[M.jsxDEV("h1",{className:"text-4xl font-bold text-green-400 mb-2 font-mono",children:"工时管理系统"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:243,columnNumber:11},this),M.jsxDEV("p",{className:"text-green-300 text-lg font-mono",children:"TIMETRACK SYSTEM"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:246,columnNumber:11},this),M.jsxDEV("div",{className:"mt-4 h-1 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:249,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:242,columnNumber:9},this),M.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-8 shadow-lg shadow-green-400/20",children:[M.jsxDEV("h2",{className:"text-2xl font-bold text-green-400 mb-6 text-center font-mono",children:"用户注册"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:254,columnNumber:11},this),h&&M.jsxDEV("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-400 rounded text-red-300 text-sm",children:h},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:259,columnNumber:13},this),M.jsxDEV("form",{onSubmit:t=>u(this,null,function*(){if(t.preventDefault(),c(!0),d(""),!(e.phone&&e.password&&e.id_card&&e.name&&e.company_id&&e.role_id))return d("请填写所有必填字段"),void c(!1);if(C&&!e.production_line)return d("请选择生产线"),void c(!1);if(e.password!==e.confirmPassword)return d("两次输入的密码不一致"),N("两次输入的密码不一致"),void c(!1);if(e.password.length<6)return d("密码长度至少6位"),void c(!1);if(!/^1[3-9]\d{9}$/.test(e.phone))return d("请输入正确的手机号码"),void c(!1);if(!/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/.test(e.id_card))return d("请输入正确的身份证号码"),void c(!1);const s=yield J({phone:e.phone,password:e.password,id_card:e.id_card,name:e.name,company_id:e.company_id,role_id:e.role_id,production_line:C?e.production_line:null});s.success?(d(""),q(!0)):d(s.error||"注册失败"),c(!1)}),className:"space-y-4",children:[M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-1",children:"手机号码 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:267,columnNumber:15},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:271,columnNumber:17},this),M.jsxDEV("input",{type:"tel",name:"phone",value:e.phone,onChange:G,className:"w-full pl-10 pr-4 py-2 bg-black border border-green-400 rounded text-green-300 placeholder-green-600 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono text-sm",placeholder:"请输入手机号码",maxLength:11},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:272,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:270,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:266,columnNumber:13},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-1",children:"身份证号 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:286,columnNumber:15},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:290,columnNumber:17},this),M.jsxDEV("input",{type:"text",name:"id_card",value:e.id_card,onChange:G,className:"w-full pl-10 pr-4 py-2 bg-black border border-green-400 rounded text-green-300 placeholder-green-600 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono text-sm",placeholder:"请输入身份证号码",maxLength:18},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:291,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:289,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:285,columnNumber:13},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-1",children:"姓名 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:305,columnNumber:15},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:309,columnNumber:17},this),M.jsxDEV("input",{type:"text",name:"name",value:e.name,onChange:G,className:"w-full pl-10 pr-4 py-2 bg-black border border-green-400 rounded text-green-300 placeholder-green-600 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono text-sm",placeholder:"请输入真实姓名"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:310,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:308,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:304,columnNumber:13},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-1",children:"所属公司 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:325,columnNumber:15},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:329,columnNumber:17},this),M.jsxDEV("select",{name:"company_id",value:e.company_id,onChange:G,className:"w-full pl-10 pr-4 py-2 bg-black border border-green-400 rounded text-green-300 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono text-sm",children:[M.jsxDEV("option",{value:"",children:"请选择公司"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:336,columnNumber:19},this),g.map(e=>M.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:338,columnNumber:21},this))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:330,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:328,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:324,columnNumber:13},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-1",children:"用户角色 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:348,columnNumber:15},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:352,columnNumber:17},this),M.jsxDEV("select",{name:"role_id",value:e.role_id,onChange:G,className:"w-full pl-10 pr-4 py-2 bg-black border border-green-400 rounded text-green-300 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono text-sm",children:[M.jsxDEV("option",{value:"",children:"请选择角色"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:359,columnNumber:19},this),p.map(e=>M.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:361,columnNumber:21},this))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:353,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:351,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:347,columnNumber:13},this),C&&M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-1",children:"生产线 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:372,columnNumber:17},this),M.jsxDEV("div",{className:"relative production-line-dropdown",children:[M.jsxDEV(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:376,columnNumber:19},this),M.jsxDEV("input",{type:"text",value:e.production_line,onChange:e=>{W(e.target.value),t(t=>l(a({},t),{production_line:e.target.value})),F(!0)},onFocus:()=>F(!0),placeholder:"搜索或选择生产线",className:"w-full pl-10 pr-4 py-2 bg-black border border-green-400 rounded text-green-300 placeholder-green-600 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono text-sm"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:377,columnNumber:19},this),B&&M.jsxDEV("div",{className:"absolute z-20 w-full mt-1 bg-gray-900 border border-green-400 rounded-md shadow-lg max-h-48 overflow-y-auto",children:[O.filter(t=>t.toLowerCase().includes(e.production_line.toLowerCase())).slice(0,10).map(e=>M.jsxDEV("div",{onClick:()=>{t(t=>l(a({},t),{production_line:e})),W(""),F(!1)},className:"px-3 py-2 text-green-300 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0 text-sm font-mono",children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:397,columnNumber:25},this)),0===O.filter(t=>t.toLowerCase().includes(e.production_line.toLowerCase())).length&&M.jsxDEV("div",{className:"px-3 py-2 text-gray-400 text-sm font-mono",children:"未找到匹配的生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:412,columnNumber:25},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:390,columnNumber:21},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:375,columnNumber:17},this),0===O.length&&e.company_id&&M.jsxDEV("div",{className:"mt-1 text-yellow-400 text-xs font-mono",children:"该公司暂无可用生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:420,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:371,columnNumber:15},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-1",children:"登录密码 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:429,columnNumber:15},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:433,columnNumber:17},this),M.jsxDEV("input",{type:s?"text":"password",name:"password",value:e.password,onChange:G,className:"w-full pl-10 pr-10 py-2 bg-black border border-green-400 rounded text-green-300 placeholder-green-600 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono text-sm",placeholder:"请输入密码（至少6位）"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:434,columnNumber:17},this),M.jsxDEV("button",{type:"button",onClick:()=>n(!s),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-green-400 hover:text-green-300",children:s?M.jsxDEV(k,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:447,columnNumber:35},this):M.jsxDEV(E,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:447,columnNumber:68},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:442,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:432,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:428,columnNumber:13},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-1",children:"确认密码 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:454,columnNumber:15},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:458,columnNumber:17},this),M.jsxDEV("input",{type:r?"text":"password",name:"confirmPassword",value:e.confirmPassword,onChange:G,className:"w-full pl-10 pr-10 py-2 bg-black border rounded text-green-300 placeholder-green-600 focus:outline-none focus:ring-1 font-mono text-sm "+(w?"border-red-400 focus:border-red-300 focus:ring-red-300":"border-green-400 focus:border-green-300 focus:ring-green-300"),placeholder:"请再次输入密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:459,columnNumber:17},this),M.jsxDEV("button",{type:"button",onClick:()=>i(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-green-400 hover:text-green-300",children:r?M.jsxDEV(k,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:474,columnNumber:42},this):M.jsxDEV(E,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:474,columnNumber:75},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:469,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:457,columnNumber:15},this),w&&M.jsxDEV("div",{className:"mt-1 text-red-400 text-xs font-mono",children:w},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:478,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:453,columnNumber:13},this),M.jsxDEV("button",{type:"submit",disabled:o,className:"w-full py-3 bg-green-600 hover:bg-green-500 disabled:bg-green-800 text-black font-bold rounded-lg transition-colors duration-200 font-mono text-lg mt-6",children:o?"注册中...":"注册"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:485,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:264,columnNumber:11},this),M.jsxDEV("div",{className:"mt-6 text-center",children:M.jsxDEV(b,{to:"/login",className:"text-green-400 hover:text-green-300 text-sm font-mono transition-colors",children:"已有账号？立即登录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:496,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:495,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:253,columnNumber:9},this),M.jsxDEV("div",{className:"text-center text-green-600 text-xs font-mono",children:M.jsxDEV("p",{children:"© 2024 工时管理系统. All rights reserved."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:507,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:506,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:240,columnNumber:7},this),M.jsxDEV(br,{isOpen:U,onClose:()=>{q(!1),K("/login")},userName:e.name,userPhone:e.phone},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:512,columnNumber:7},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Register.tsx",lineNumber:239,columnNumber:5},this)}function wr(){const[e,t]=m.useState("verify"),[s,n]=m.useState({id_card:"",newPassword:"",confirmPassword:""}),[r,i]=m.useState(!1),[o,c]=m.useState(!1),[h,d]=m.useState(!1),[g,f]=m.useState(""),[p,v]=m.useState(""),[w,N]=m.useState(null),{resetPassword:x}=gr(),S=y(),j=e=>{const{name:t,value:r}=e.target;if(n(e=>l(a({},e),{[t]:r})),"confirmPassword"===t||"newPassword"===t){const e="newPassword"===t?r:s.newPassword,n="confirmPassword"===t?r:s.confirmPassword;v(n&&e!==n?"两次输入的密码不一致":"")}};return M.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center px-4",children:M.jsxDEV("div",{className:"max-w-md w-full space-y-8",children:[M.jsxDEV("div",{className:"text-center",children:[M.jsxDEV("h1",{className:"text-4xl font-bold text-green-400 mb-2 font-mono",children:"工时管理系统"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:124,columnNumber:11},this),M.jsxDEV("p",{className:"text-green-300 text-lg font-mono",children:"TIMETRACK SYSTEM"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:127,columnNumber:11},this),M.jsxDEV("div",{className:"mt-4 h-1 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:130,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:123,columnNumber:9},this),M.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-8 shadow-lg shadow-green-400/20",children:[M.jsxDEV("div",{className:"flex items-center mb-6",children:[M.jsxDEV("button",{onClick:()=>{"reset"===e?(t("verify"),N(null),f("")):S("/login")},className:"text-green-400 hover:text-green-300 mr-3 transition-colors",children:M.jsxDEV(C,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:140,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:136,columnNumber:13},this),M.jsxDEV("h2",{className:"text-2xl font-bold text-green-400 font-mono",children:"verify"===e?"身份验证":"重置密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:142,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:135,columnNumber:11},this),g&&M.jsxDEV("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-400 rounded text-red-300 text-sm",children:g},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:148,columnNumber:13},this),"verify"===e?M.jsxDEV("form",{onSubmit:e=>u(this,null,function*(){if(e.preventDefault(),d(!0),f(""),!s.id_card)return f("请输入身份证号码"),void d(!1);if(!/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/.test(s.id_card))return f("请输入正确的身份证号码"),void d(!1);const n=yield x(s.id_card);n.success&&n.user?(N(n.user),t("reset"),f("")):f(n.error||"身份证号码验证失败，请检查后重试"),d(!1)}),className:"space-y-6",children:[M.jsxDEV("div",{className:"text-center mb-6",children:M.jsxDEV("p",{className:"text-green-300 text-sm font-mono",children:"请输入您的身份证号码进行身份验证"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:156,columnNumber:17},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:155,columnNumber:15},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-2",children:"身份证号码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:163,columnNumber:17},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:167,columnNumber:19},this),M.jsxDEV("input",{type:"text",name:"id_card",value:s.id_card,onChange:j,className:"w-full pl-12 pr-4 py-3 bg-black border border-green-400 rounded text-green-300 placeholder-green-600 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono",placeholder:"请输入身份证号码",maxLength:18},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:168,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:166,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:162,columnNumber:15},this),M.jsxDEV("button",{type:"submit",disabled:h,className:"w-full py-3 bg-green-600 hover:bg-green-500 disabled:bg-green-800 text-black font-bold rounded-lg transition-colors duration-200 font-mono text-lg",children:h?"验证中...":"验证身份"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:181,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:154,columnNumber:13},this):M.jsxDEV("form",{onSubmit:e=>u(this,null,function*(){if(e.preventDefault(),d(!0),f(""),!s.newPassword||!s.confirmPassword)return f("请填写新密码和确认密码"),void d(!1);if(s.newPassword!==s.confirmPassword)return f("两次输入的密码不一致"),v("两次输入的密码不一致"),void d(!1);if(s.newPassword.length<6)return f("密码长度至少6位"),void d(!1);const t=yield x(s.id_card,s.newPassword);t.success?(alert("密码重置成功，请使用新密码登录"),S("/login")):f(t.error||"密码重置失败"),d(!1)}),className:"space-y-6",children:[w&&M.jsxDEV("div",{className:"bg-green-900/30 border border-green-400 rounded p-4 mb-6",children:[M.jsxDEV("p",{className:"text-green-300 text-sm font-mono",children:["验证成功！正在为用户 ",M.jsxDEV("span",{className:"text-green-400 font-bold",children:w.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:194,columnNumber:32},this)," 重置密码"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:193,columnNumber:19},this),M.jsxDEV("p",{className:"text-green-400 text-xs font-mono mt-1",children:["手机号: ",w.phone]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:196,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:192,columnNumber:17},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-2",children:"新密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:204,columnNumber:17},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:208,columnNumber:19},this),M.jsxDEV("input",{type:r?"text":"password",name:"newPassword",value:s.newPassword,onChange:j,className:"w-full pl-12 pr-12 py-3 bg-black border border-green-400 rounded text-green-300 placeholder-green-600 focus:outline-none focus:border-green-300 focus:ring-1 focus:ring-green-300 font-mono",placeholder:"请输入新密码（至少6位）"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:209,columnNumber:19},this),M.jsxDEV("button",{type:"button",onClick:()=>i(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-green-400 hover:text-green-300",children:r?M.jsxDEV(k,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:222,columnNumber:37},this):M.jsxDEV(E,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:222,columnNumber:70},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:217,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:207,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:203,columnNumber:15},this),M.jsxDEV("div",{children:[M.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-2",children:"确认新密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:229,columnNumber:17},this),M.jsxDEV("div",{className:"relative",children:[M.jsxDEV(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400 w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:233,columnNumber:19},this),M.jsxDEV("input",{type:o?"text":"password",name:"confirmPassword",value:s.confirmPassword,onChange:j,className:"w-full pl-12 pr-12 py-3 bg-black border rounded text-green-300 placeholder-green-600 focus:outline-none focus:ring-1 font-mono "+(p?"border-red-400 focus:border-red-300 focus:ring-red-300":"border-green-400 focus:border-green-300 focus:ring-green-300"),placeholder:"请再次输入新密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:234,columnNumber:19},this),M.jsxDEV("button",{type:"button",onClick:()=>c(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-green-400 hover:text-green-300",children:o?M.jsxDEV(k,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:249,columnNumber:44},this):M.jsxDEV(E,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:249,columnNumber:77},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:244,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:232,columnNumber:17},this),p&&M.jsxDEV("div",{className:"mt-1 text-red-400 text-xs font-mono",children:p},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:253,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:228,columnNumber:15},this),M.jsxDEV("button",{type:"submit",disabled:h,className:"w-full py-3 bg-green-600 hover:bg-green-500 disabled:bg-green-800 text-black font-bold rounded-lg transition-colors duration-200 font-mono text-lg",children:h?"重置中...":"重置密码"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:260,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:190,columnNumber:13},this),M.jsxDEV("div",{className:"mt-6 text-center",children:M.jsxDEV(b,{to:"/login",className:"text-green-400 hover:text-green-300 text-sm font-mono transition-colors",children:"返回登录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:272,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:271,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:134,columnNumber:9},this),M.jsxDEV("div",{className:"text-center text-green-600 text-xs font-mono",children:M.jsxDEV("p",{children:"© 2024 工时管理系统. All rights reserved."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:283,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:282,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:121,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ResetPassword.tsx",lineNumber:120,columnNumber:5},this)}const Nr=m.lazy(()=>B(()=>import("./Dashboard-Bno8VAdT.js"),__vite__mapDeps([0,1,2,3,4]))),xr=m.lazy(()=>B(()=>import("./TimesheetRecord-CHEeKV7y.js"),__vite__mapDeps([5,1,3,4]))),_r=m.lazy(()=>B(()=>import("./TimesheetHistory-CKlr4ANu.js"),__vite__mapDeps([6,1,3,4]))),kr=m.lazy(()=>B(()=>import("./CompanyManagement-CmNdExes.js"),__vite__mapDeps([7,1,2,3,4]))),Er=m.lazy(()=>B(()=>import("./UserManagement-SeFYZHUV.js"),__vite__mapDeps([8,1,3,4]))),Sr=m.lazy(()=>B(()=>import("./ProcessManagement-DxA0ZQ6o.js"),__vite__mapDeps([9,1,3,10,4]))),jr=m.lazy(()=>B(()=>import("./RoleList-YsIargfQ.js"),__vite__mapDeps([11,1,3,4]))),Rr=m.lazy(()=>B(()=>import("./RoleEdit-CUNWBjWE.js"),__vite__mapDeps([12,1,4,3]))),Tr=m.lazy(()=>B(()=>import("./RoleCreate-CbHGUUEw.js"),__vite__mapDeps([13,1,3,4]))),Or=m.lazy(()=>B(()=>import("./SupervisorApproval-IbExJNJd.js"),__vite__mapDeps([14,1,3,4]))),Dr=m.lazy(()=>B(()=>import("./SectionChiefApproval-nX6w7trm.js"),__vite__mapDeps([15,1,3,4]))),Ar=m.lazy(()=>B(()=>import("./Reports-Nnue_S1q.js"),__vite__mapDeps([16,1,3,4]))),Pr=m.lazy(()=>B(()=>import("./History-BcorryoA.js"),__vite__mapDeps([17,1,3,4]))),Ir=m.lazy(()=>B(()=>import("./ToastTest-DfU7oSmR.js"),__vite__mapDeps([18,3,1,4]))),Cr=()=>M.jsxDEV("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:M.jsxDEV("div",{className:"text-center p-8 bg-white rounded-lg shadow-lg max-w-md mx-4",children:[M.jsxDEV("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:47,columnNumber:9},void 0),M.jsxDEV("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"工时管理系统"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:48,columnNumber:9},void 0),M.jsxDEV("p",{className:"text-gray-600",children:"正在加载..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:49,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:46,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:45,columnNumber:5},void 0);class Vr extends m.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("应用错误边界捕获到错误:",e,t),this.setState({error:e,errorInfo:t})}render(){var e;return this.state.hasError?M.jsxDEV("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50 px-4",children:M.jsxDEV("div",{className:"max-w-md text-center",children:[M.jsxDEV("div",{className:"mb-6",children:[M.jsxDEV("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:M.jsxDEV("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:88,columnNumber:19},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:87,columnNumber:17},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:86,columnNumber:15},this),M.jsxDEV("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"应用出现错误"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:91,columnNumber:15},this),M.jsxDEV("p",{className:"text-gray-600 mb-6",children:"抱歉，应用遇到了一个意外错误。请尝试刷新页面或稍后再试。"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:92,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:85,columnNumber:13},this),M.jsxDEV("div",{className:"space-y-3",children:[M.jsxDEV("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"刷新页面"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:98,columnNumber:15},this),M.jsxDEV("button",{onClick:()=>this.setState({hasError:!1}),className:"w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:"重试"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:104,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:97,columnNumber:13},this),this.state.error&&M.jsxDEV("details",{className:"mt-6 text-left",children:[M.jsxDEV("summary",{className:"cursor-pointer text-sm text-gray-500 hover:text-gray-700",children:"查看错误详情"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:115,columnNumber:17},this),M.jsxDEV("pre",{className:"mt-2 p-3 bg-gray-100 rounded text-xs overflow-auto max-h-40",children:[this.state.error.toString(),null==(e=this.state.errorInfo)?void 0:e.componentStack]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:118,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:114,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:84,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:83,columnNumber:9},this):this.props.children}}const Lr=({children:e})=>M.jsxDEV(m.Suspense,{fallback:M.jsxDEV(Cr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:155,columnNumber:25},void 0),children:M.jsxDEV(Vr,{children:e},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:156,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:155,columnNumber:5},void 0);function $r(){m.useEffect(()=>{"requestIdleCallback"in window?requestIdleCallback(()=>{var e,t,s;null==(e=Nr.preload)||e.call(Nr),null==(t=xr.preload)||t.call(xr),null==(s=_r.preload)||s.call(_r)}):setTimeout(()=>{var e,t,s;null==(e=Nr.preload)||e.call(Nr),null==(t=xr.preload)||t.call(xr),null==(s=_r.preload)||s.call(_r)},2e3)},[]);return M.jsxDEV(Vr,{children:M.jsxDEV(dr,{children:M.jsxDEV(v,{basename:"",children:[M.jsxDEV(V,{position:"top-right",richColors:!0},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:176,columnNumber:11},this),M.jsxDEV(w,{children:[M.jsxDEV(N,{path:"/login",element:M.jsxDEV(yr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:179,columnNumber:41},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:179,columnNumber:11},this),M.jsxDEV(N,{path:"/register",element:M.jsxDEV(vr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:180,columnNumber:44},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:180,columnNumber:11},this),M.jsxDEV(N,{path:"/reset-password",element:M.jsxDEV(wr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:181,columnNumber:50},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:181,columnNumber:11},this),M.jsxDEV(N,{path:"/",element:M.jsxDEV(fr,{children:M.jsxDEV(p,{to:"/dashboard",replace:!0},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:186,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:185,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:184,columnNumber:11},this),M.jsxDEV(N,{path:"/dashboard",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(Nr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:191,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:191,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:190,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:189,columnNumber:11},this),M.jsxDEV(N,{path:"/company-management",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(kr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:196,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:196,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:195,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:194,columnNumber:11},this),M.jsxDEV(N,{path:"/user-management",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(Er,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:201,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:201,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:200,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:199,columnNumber:11},this),M.jsxDEV(N,{path:"/role-permissions",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(jr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:206,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:206,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:205,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:204,columnNumber:11},this),M.jsxDEV(N,{path:"/role-permissions/edit/:id",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(Rr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:212,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:212,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:211,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:210,columnNumber:11},this),M.jsxDEV(N,{path:"/role-permissions/create",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(Tr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:217,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:217,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:216,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:215,columnNumber:11},this),M.jsxDEV(N,{path:"/process-management",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(Sr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:222,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:222,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:221,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:220,columnNumber:11},this),M.jsxDEV(N,{path:"/timesheet-record",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(xr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:227,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:227,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:226,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:225,columnNumber:11},this),M.jsxDEV(N,{path:"/timesheet-history",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(_r,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:232,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:232,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:231,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:230,columnNumber:11},this),M.jsxDEV(N,{path:"/supervisor-approval",element:M.jsxDEV(pr,{allowedRoles:["班长","supervisor","超级管理员","super_admin"],children:M.jsxDEV(Lr,{children:M.jsxDEV(Or,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:237,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:237,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:236,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:235,columnNumber:11},this),M.jsxDEV(N,{path:"/section-chief-approval",element:M.jsxDEV(pr,{allowedRoles:["段长","section_chief","超级管理员","super_admin"],children:M.jsxDEV(Lr,{children:M.jsxDEV(Dr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:242,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:242,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:241,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:240,columnNumber:11},this),M.jsxDEV(N,{path:"/reports",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(Ar,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:247,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:247,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:246,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:245,columnNumber:11},this),M.jsxDEV(N,{path:"/history",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(Pr,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:252,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:252,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:251,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:250,columnNumber:11},this),M.jsxDEV(N,{path:"/toast-test",element:M.jsxDEV(fr,{children:M.jsxDEV(Lr,{children:M.jsxDEV(Ir,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:257,columnNumber:28},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:257,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:256,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:255,columnNumber:11},this),M.jsxDEV(N,{path:"*",element:M.jsxDEV(p,{to:"/dashboard",replace:!0},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:264,columnNumber:36},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:264,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:177,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:175,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:174,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/App.tsx",lineNumber:173,columnNumber:5},this)}Array.from||(Array.from=function(){const e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},s=Math.pow(2,53)-1,n=function(e){const t=function(e){const t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),s)};return function(e,s,r){const i=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");const o=void 0===s?void 0:s;if(void 0!==o){if(!t(o))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(r=arguments[2])}const a=n(i.length),l=t(this)?Object(new this(a)):new Array(a);let c,u=0;for(;u<a;)c=i[u],l[u]=o?void 0===r?o(c,u):o.call(r,c,u):c,u+=1;return l.length=a,l}}()),Array.prototype.includes||(Array.prototype.includes=function(e,t){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");const s=Object(this),n=parseInt(s.length)||0;if(0===n)return!1;const r=parseInt(t)||0;let i,o;for(r>=0?i=r:(i=n+r,i<0&&(i=0));i<n;){if(o=s[i],e===o||e!=e&&o!=o)return!0;i++}return!1}),String.prototype.includes||(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");const t=Object(e),s=Array.prototype.slice.call(arguments,1);for(let n=0;n<s.length;n++){const e=s[n];if(null!=e)for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t}),"undefined"==typeof Promise&&(window.Promise=class e{constructor(e){c(this,"state","pending"),c(this,"value"),c(this,"handlers",[]);try{e(this.resolve.bind(this),this.reject.bind(this))}catch(t){this.reject(t)}}resolve(e){"pending"===this.state&&(this.state="fulfilled",this.value=e,this.handlers.forEach(e=>this.handle(e)),this.handlers=[])}reject(e){"pending"===this.state&&(this.state="rejected",this.value=e,this.handlers.forEach(e=>this.handle(e)),this.handlers=[])}handle(e){"pending"===this.state?this.handlers.push(e):("fulfilled"===this.state&&"function"==typeof e.onFulfilled&&e.onFulfilled(this.value),"rejected"===this.state&&"function"==typeof e.onRejected&&e.onRejected(this.value))}then(t,s){return new e((e,n)=>{this.handle({onFulfilled:s=>{if("function"==typeof t)try{e(t(s))}catch(r){n(r)}else e(s)},onRejected:t=>{if("function"==typeof s)try{e(s(t))}catch(r){n(r)}else n(t)},resolve:e,reject:n})})}catch(e){return this.then(void 0,e)}static resolve(t){return new e(e=>e(t))}static reject(t){return new e((e,s)=>s(t))}static all(t){return new e((e,s)=>{if(0===t.length)return void e([]);const n=[];let r=0;t.forEach((i,o)=>{i.then(s=>{n[o]=s,r++,r===t.length&&e(n)}).catch(s)})})}}),"undefined"==typeof fetch&&(window.fetch=function(e,t={}){return new Promise((s,n)=>{const r=new XMLHttpRequest;r.open(t.method||"GET",e),t.headers&&Object.keys(t.headers).forEach(e=>{r.setRequestHeader(e,t.headers[e])}),r.onload=()=>{const e={ok:r.status>=200&&r.status<300,status:r.status,statusText:r.statusText,json:()=>Promise.resolve(JSON.parse(r.responseText)),text:()=>Promise.resolve(r.responseText)};s(e)},r.onerror=()=>n(new Error("Network error")),r.send(t.body)})}),"undefined"==typeof IntersectionObserver&&(window.IntersectionObserver=class{constructor(e,t={}){c(this,"callback"),c(this,"options"),c(this,"targets",[]),this.callback=e,this.options=t,setTimeout(()=>{this.checkIntersections()},100)}observe(e){this.targets.push(e)}unobserve(e){const t=this.targets.indexOf(e);t>-1&&this.targets.splice(t,1)}disconnect(){this.targets=[]}checkIntersections(){const e=this.targets.map(e=>({target:e,isIntersecting:!0,intersectionRatio:1}));e.length>0&&this.callback(e)}});const Ur=()=>{if(/iPhone|iPad|iPod/.test(navigator.userAgent)){const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)};e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(e,100)})}/Android/.test(navigator.userAgent)&&document.addEventListener("touchstart",()=>{},{passive:!0}),"undefined"==typeof console&&(window.console={log:()=>{},warn:()=>{},error:()=>{},info:()=>{},debug:()=>{}}),window.requestAnimationFrame||(window.requestAnimationFrame=e=>window.setTimeout(e,1e3/60)),window.cancelAnimationFrame||(window.cancelAnimationFrame=e=>{clearTimeout(e)})},Mr=()=>{const e={es6:!0,fetch:"undefined"!=typeof fetch,promise:"undefined"!=typeof Promise,intersectionObserver:"undefined"!=typeof IntersectionObserver,serviceWorker:"serviceWorker"in navigator,localStorage:(()=>{try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}})(),flexbox:CSS.supports("display","flex"),grid:CSS.supports("display","grid")};return console.log("浏览器兼容性检测结果:",e),e};const qr=new class{constructor(){this.isMobile=this.detectMobileDevice(),this.networkType=this.getNetworkType(),this.isLowEndDevice=this.detectLowEndDevice(),this.optimizationLevel=this.calculateOptimizationLevel(),this.init()}detectMobileDevice(){const e=navigator.userAgent.toLowerCase();return["mobile","android","iphone","ipad","ipod","blackberry","windows phone","opera mini"].some(t=>e.includes(t))||window.innerWidth<=768||"ontouchstart"in window}getNetworkType(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e?{type:e.effectiveType||"unknown",downlink:e.downlink||0,rtt:e.rtt||0,saveData:e.saveData||!1}:"unknown"}detectLowEndDevice(){const e=navigator.hardwareConcurrency||1,t=navigator.deviceMemory||1,s=navigator.userAgent.toLowerCase(),n=["android 4","android 5","android 6"].some(e=>s.includes(e));return e<=2||t<=2||n}calculateOptimizationLevel(){let e=0;return"slow-2g"===this.networkType.type||"2g"===this.networkType.type?e+=3:"3g"===this.networkType.type?e+=2:"4g"===this.networkType.type&&(e+=1),this.isLowEndDevice&&(e+=2),this.networkType.saveData&&(e+=2),Math.min(e,5)}init(){this.isMobile&&(console.log("🔧 Initializing mobile optimization:",{level:this.optimizationLevel,networkType:this.networkType.type,isLowEnd:this.isLowEndDevice}),this.applyOptimizations(),this.setupNetworkListeners())}applyOptimizations(){switch(this.optimizationLevel){case 5:this.enableAggressiveOptimization();break;case 4:this.enableHighOptimization();break;case 3:this.enableMediumOptimization();break;case 2:this.enableLowOptimization();break;default:this.enableBasicOptimization()}}enableAggressiveOptimization(){this.disableNonCriticalFeatures(),this.minimizeResourceLoading(),this.enableTextCompression(),this.enableLazyLoading(),console.log("📱 Aggressive optimization enabled")}enableHighOptimization(){this.minimizeResourceLoading(),this.enableLazyLoading(),this.optimizeImages(),console.log("📱 High optimization enabled")}enableMediumOptimization(){this.enableLazyLoading(),this.optimizeImages(),console.log("📱 Medium optimization enabled")}enableLowOptimization(){this.optimizeImages(),console.log("📱 Low optimization enabled")}enableBasicOptimization(){this.setupViewport(),console.log("📱 Basic optimization enabled")}disableNonCriticalFeatures(){const e=document.createElement("style");e.textContent="\n            *, *::before, *::after {\n                animation-duration: 0.01ms !important;\n                animation-iteration-count: 1 !important;\n                transition-duration: 0.01ms !important;\n            }\n        ",document.head.appendChild(e),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("video").forEach(e=>{e.autoplay=!1,e.preload="none"})})}minimizeResourceLoading(){document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll('link[rel="stylesheet"]').forEach(e=>{e.href.includes("critical")||e.href.includes("main")||(e.media="print",e.onload=function(){this.media="all"})})})}enableTextCompression(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{var t;null==(t=e.active)||t.postMessage({type:"ENABLE_COMPRESSION",level:"aggressive"})})}enableLazyLoading(){if("IntersectionObserver"in window){const e=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const s=t.target;s.dataset.src&&(s.src=s.dataset.src,s.removeAttribute("data-src"),e.unobserve(s))}})});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("img[data-src]").forEach(t=>e.observe(t))})}}optimizeImages(){document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("img").forEach(e=>{if(e.hasAttribute("loading")||(e.loading="lazy"),window.devicePixelRatio>1){const t=Math.min(e.naturalWidth,window.innerWidth);e.style.maxWidth=t+"px"}})})}setupViewport(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}setupNetworkListeners(){"connection"in navigator&&navigator.connection.addEventListener("change",()=>{this.networkType=this.getNetworkType(),this.optimizationLevel=this.calculateOptimizationLevel(),this.applyOptimizations(),console.log("📱 Network changed, reapplying optimizations:",{type:this.networkType.type,level:this.optimizationLevel})}),window.addEventListener("online",()=>{console.log("📱 Device back online"),this.handleOnlineStatus(!0)}),window.addEventListener("offline",()=>{console.log("📱 Device went offline"),this.handleOnlineStatus(!1)})}handleOnlineStatus(e){e?this.restoreFeatures():this.enableOfflineMode()}restoreFeatures(){document.querySelectorAll("[data-mobile-disabled]").forEach(e=>{e.removeAttribute("data-mobile-disabled"),e.style.display=""})}enableOfflineMode(){document.querySelectorAll("[data-requires-network]").forEach(e=>{e.setAttribute("data-mobile-disabled","true"),e.style.display="none"}),this.showOfflineNotification()}showOfflineNotification(){const e=document.createElement("div");e.className="mobile-offline-notification",e.innerHTML='\n            <div class="offline-content">\n                📱 离线模式已启用\n                <button onclick="this.parentElement.parentElement.remove()">×</button>\n            </div>\n        ',e.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            background: #ff9800;\n            color: white;\n            padding: 10px;\n            text-align: center;\n            z-index: 10000;\n            font-size: 14px;\n        ",document.body.appendChild(e),setTimeout(()=>{e.parentElement&&e.remove()},5e3)}getOptimizationRecommendations(){const e=[];return"slow-2g"!==this.networkType.type&&"2g"!==this.networkType.type||e.push("检测到慢速网络，建议切换到WiFi或移动到信号更好的位置"),this.isLowEndDevice&&e.push("检测到低端设备，已启用性能优化模式"),this.networkType.saveData&&e.push("检测到数据节省模式，已减少资源加载"),this.isMobile&&window.innerWidth<400&&e.push("屏幕较小，建议横屏使用以获得更好体验"),e}getStatus(){return{isMobile:this.isMobile,networkType:this.networkType,isLowEndDevice:this.isLowEndDevice,optimizationLevel:this.optimizationLevel,recommendations:this.getOptimizationRecommendations()}}};const zr=new class{constructor(){c(this,"loadingState",{isLoading:!1,progress:0,retryCount:0}),c(this,"maxRetries",3),c(this,"baseTimeout",15e3),c(this,"isMobile"),c(this,"connectionType"),c(this,"loadQueue",[]),c(this,"loadedResources",new Set),this.isMobile=this.detectMobileDevice(),this.connectionType=this.getConnectionType(),this.setupProgressiveLoading()}detectMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768}getConnectionType(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e&&e.effectiveType||"unknown"}setupProgressiveLoading(){if(!this.isMobile)return;["slow-2g","2g","3g"].includes(this.connectionType)&&(this.maxRetries=5,this.baseTimeout=3e4),window.addEventListener("online",()=>{this.retryFailedLoads()}),document.addEventListener("visibilitychange",()=>{!document.hidden&&this.loadingState.error&&this.retryFailedLoads()})}preloadCriticalResources(){return u(this,null,function*(){if(!this.isMobile)return;console.log("📱 开始预加载关键资源...");const e=[{url:"/src/main.tsx",type:"script",priority:"critical",timeout:this.baseTimeout},{url:"/src/App.tsx",type:"script",priority:"critical",timeout:this.baseTimeout}];yield this.loadResourcesInBatches(e,2)})}loadResourcesInBatches(e,t){return u(this,null,function*(){this.loadingState.isLoading=!0,this.loadingState.progress=0,this.loadingState.error=void 0;const s=e.length;let n=0;for(let i=0;i<e.length;i+=t){const o=e.slice(i,i+t);try{yield Promise.all(o.map(e=>this.loadSingleResource(e))),n+=o.length,this.loadingState.progress=n/s*100,i+t<e.length&&(yield this.delay(100))}catch(r){if(console.warn("📱 批次加载失败:",r),this.loadingState.error=`加载失败: ${r}`,this.loadingState.retryCount<this.maxRetries){this.loadingState.retryCount++,console.log(`📱 重试第 ${this.loadingState.retryCount} 次...`),yield this.delay(1e3*this.loadingState.retryCount),i-=t;continue}throw r}}this.loadingState.isLoading=!1,this.loadingState.progress=100,console.log("📱 资源预加载完成")})}loadSingleResource(e){return u(this,null,function*(){if(!this.loadedResources.has(e.url))return new Promise((t,s)=>{const n=e.timeout||this.baseTimeout,r=setTimeout(()=>{s(new Error(`资源加载超时: ${e.url}`))},n),i=()=>{clearTimeout(r),this.loadedResources.add(e.url)};switch(e.type){case"script":this.loadScript(e.url).then(()=>{i(),t()}).catch(s);break;case"style":this.loadStyle(e.url).then(()=>{i(),t()}).catch(s);break;case"image":this.loadImage(e.url).then(()=>{i(),t()}).catch(s);break;default:i(),t()}})})}loadScript(e){return new Promise((t,s)=>{if(document.querySelector(`script[src="${e}"]`))return void t();const n=document.createElement("script");n.src=e,n.async=!0,n.crossOrigin="anonymous",n.onload=()=>t(),n.onerror=()=>s(new Error(`脚本加载失败: ${e}`)),document.head.appendChild(n)})}loadStyle(e){return new Promise((t,s)=>{if(document.querySelector(`link[href="${e}"]`))return void t();const n=document.createElement("link");n.rel="stylesheet",n.href=e,n.crossOrigin="anonymous",n.onload=()=>t(),n.onerror=()=>s(new Error(`样式加载失败: ${e}`)),document.head.appendChild(n)})}loadImage(e){return new Promise((t,s)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>t(),n.onerror=()=>s(new Error(`图片加载失败: ${e}`)),n.src=e})}retryFailedLoads(){return u(this,null,function*(){this.loadingState.error&&this.loadingState.retryCount<this.maxRetries&&(console.log("📱 网络恢复，重试加载..."),this.loadingState.retryCount++,this.loadingState.error=void 0,yield this.delay(1e3),yield this.preloadCriticalResources())})}delay(e){return new Promise(t=>setTimeout(t,e))}getLoadingState(){return a({},this.loadingState)}cleanup(){this.loadQueue=[],this.loadedResources.clear(),this.loadingState={isLoading:!1,progress:0,retryCount:0}}checkResourceAvailability(e){return u(this,null,function*(){try{return(yield fetch(e,{method:"HEAD",mode:"no-cors",cache:"no-cache"})).ok}catch(t){return!1}})}optimizeMobileCache(){if(!this.isMobile)return;const e=document.createElement("meta");e.httpEquiv="Cache-Control",e.content="public, max-age=86400, stale-while-revalidate=604800",document.head.appendChild(e);const t=document.createElement("link");t.rel="preconnect",t.href=window.location.origin,document.head.appendChild(t)}};const Wr=new class{constructor(){c(this,"retryCount",0),c(this,"maxRetries",3),c(this,"retryDelay",2e3),c(this,"connectionCheckInterval",null),this.initializeApp(),this.setupNetworkMonitoring(),console.log("🌐 Starting mobile optimization systems"),this.initializeMobileOptimizations()}initializeMobileOptimizations(){return u(this,null,function*(){try{zr.optimizeMobileCache(),yield zr.preloadCriticalResources(),console.log("📱 移动端优化系统启动完成")}catch(e){console.warn("📱 移动端优化启动失败:",e)}})}setupNetworkMonitoring(){window.addEventListener("online",this.handleOnline.bind(this)),window.addEventListener("offline",this.handleOffline.bind(this)),window.addEventListener("mobileConnectionChange",e=>{const{type:t,networkState:s}=e.detail;switch(console.log(`📱 移动端连接状态变化: ${t}`,s),t){case"unstable":this.updateLoaderText("检测到网络不稳定，正在优化连接...");break;case"restored":this.updateLoaderText("网络连接已恢复")}}),this.connectionCheckInterval=setInterval(()=>{this.checkNetworkConnection()},3e4)}checkNetworkConnection(){return u(this,null,function*(){try{return navigator.onLine}catch(e){return console.warn("网络连接检查失败:",e),navigator.onLine}})}handleOnline(){console.log("网络连接已恢复"),this.updateLoaderText("网络连接已恢复，正在重新初始化..."),this.retryCount=0,setTimeout(()=>{this.initializeApp()},1e3)}handleOffline(){console.log("网络连接已断开"),this.updateLoaderText("网络连接已断开，请检查网络设置"),this.showNetworkError()}initializeApp(){return u(this,null,function*(){try{this.updateLoaderText("正在初始化兼容性支持..."),Ur();{const e=Mr();console.log("浏览器兼容性检测完成:",e)}if(this.updateLoaderText("正在初始化应用..."),!navigator.onLine)return void this.handleOfflineState();yield this.preloadCriticalResources(),yield this.registerServiceWorker(),this.renderApp()}catch(e){console.error("应用初始化失败:",e),this.handleInitializationError(e)}})}preloadCriticalResources(){return u(this,null,function*(){try{this.updateLoaderText("正在加载核心资源...");const e=document.createElement("link");e.rel="prefetch",e.href="/timesheet-management-system/favicon.svg",document.head.appendChild(e),yield new Promise(e=>setTimeout(e,100))}catch(e){console.warn("预加载资源失败:",e)}})}registerServiceWorker(){return u(this,null,function*(){if("serviceWorker"in navigator&&"https:"===window.location.protocol)try{this.updateLoaderText("正在注册服务工作者...");const e=yield navigator.serviceWorker.register("/timesheet-management-system/sw.js",{scope:"/timesheet-management-system/"});console.log("Service Worker 注册成功:",e),e.addEventListener("updatefound",()=>{console.log("发现 Service Worker 更新")})}catch(e){console.warn("Service Worker 注册失败:",e)}})}renderApp(){try{this.updateLoaderText("正在启动应用..."),console.log("📱 Mobile optimization status:",qr.getStatus());const e=document.getElementById("root");if(!e)throw new Error("找不到根容器元素");U(e).render(M.jsxDEV(m.StrictMode,{children:M.jsxDEV($r,{},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/main.tsx",lineNumber:192,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/main.tsx",lineNumber:191,columnNumber:9},this)),setTimeout(()=>{window.hideInitialLoader&&window.hideInitialLoader()},500),console.log("应用启动成功")}catch(e){console.error("应用渲染失败:",e),this.handleInitializationError(e)}}handleOfflineState(){this.updateLoaderText("当前处于离线状态"),this.showNetworkError(),setTimeout(()=>{try{this.renderApp()}catch(e){console.error("离线模式下应用启动失败:",e)}},2e3)}handleInitializationError(e){var t,s,n;this.retryCount++;if(((null==(t=e.message)?void 0:t.includes("fetch"))||(null==(s=e.message)?void 0:s.includes("network"))||(null==(n=e.message)?void 0:n.includes("Failed to import")))&&this.retryCount<=this.maxRetries){this.updateLoaderText(`网络连接失败，正在重试... (${this.retryCount}/${this.maxRetries})`);const e=this.retryDelay*Math.pow(1.5,this.retryCount-1);setTimeout(()=>{this.initializeApp()},e)}else this.retryCount<=this.maxRetries?(this.updateLoaderText(`初始化失败，正在重试... (${this.retryCount}/${this.maxRetries})`),setTimeout(()=>{this.initializeApp()},this.retryDelay)):(this.updateLoaderText("应用启动失败"),this.showFinalError(e))}updateLoaderText(e){const t=document.getElementById("loader-text");t&&(t.textContent=e),console.log("加载状态:",e)}showNetworkError(){const e=document.getElementById("error-message"),t=document.getElementById("retry-button");e&&t&&(e.textContent="网络连接异常，请检查网络设置后重试",e.style.display="block",t.style.display="inline-block",t.onclick=()=>{this.retryCount=0,e.style.display="none",t.style.display="none",this.initializeApp()})}showFinalError(e){const t=document.getElementById("error-message"),s=document.getElementById("retry-button");t&&s&&(t.textContent=`应用启动失败: ${e.message||"未知错误"}。请刷新页面重试。`,t.style.display="block",s.textContent="刷新页面",s.style.display="inline-block",s.onclick=()=>{window.location.reload()})}cleanup(){this.connectionCheckInterval&&clearInterval(this.connectionCheckInterval),window.removeEventListener("online",this.handleOnline.bind(this)),window.removeEventListener("offline",this.handleOffline.bind(this))}};window.addEventListener("beforeunload",()=>{Wr.cleanup()}),window.addEventListener("error",e=>{console.error("全局错误:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("未处理的 Promise 错误:",e.reason)});export{sr as D,er as P,tr as S,B as _,nr as c,ar as f,cr as g,ur as h,lr as i,M as j,Qn as s,gr as u};
