var e=Object.defineProperty,t=Object.defineProperties,m=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(t,m,s)=>m in t?e(t,m,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[m]=s,i=(e,t)=>{for(var m in t||(t={}))r.call(t,m)&&a(e,m,t[m]);if(s)for(var m of s(t))n.call(t,m)&&a(e,m,t[m]);return e},o=(e,s)=>t(e,m(s));import{d as l,r as u,j as c,l as h,s as g,I as d,X as b}from"./react-core-CEw6lU7H.js";import{u as N,D as x,s as y,S as p}from"./index-Bu9C9BlJ.js";import"./vendor-Dj0T90Ik.js";import"./supabase-DInoECZ_.js";import"./ui-BmDV7GQB.js";function f(){const e=l(),{user:t}=N(),[m,s]=u.useState({name:"",permissions:[]}),[r,n]=u.useState(!1),[a,f]=u.useState(null),[v,j]=u.useState(!1);if(v)return c.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:c.jsxDEV("div",{className:"text-center",children:c.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:49,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:48,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:47,columnNumber:7},this);if(!t)return c.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:c.jsxDEV("div",{className:"bg-gray-900 border border-green-400 p-8 rounded-lg max-w-md w-full text-center",children:[c.jsxDEV("h2",{className:"text-xl font-semibold text-green-400 mb-2 font-mono",children:"未登录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:61,columnNumber:11},this),c.jsxDEV("p",{className:"text-green-300 mb-6 font-mono",children:"请先登录后再访问此页面"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:62,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:60,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:59,columnNumber:7},this);return c.jsxDEV("div",{className:"min-h-screen bg-black text-green-300 p-4 sm:p-6",children:c.jsxDEV("div",{className:"max-w-4xl mx-auto",children:[c.jsxDEV("div",{className:"mb-6",children:c.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[c.jsxDEV("h1",{className:"text-xl sm:text-2xl font-bold text-green-400 font-mono truncate",children:"创建角色"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:130,columnNumber:13},this),c.jsxDEV("button",{onClick:()=>e("/role-permissions"),className:"flex items-center text-green-400 hover:text-green-300 transition-colors flex-shrink-0 font-mono",children:[c.jsxDEV(h,{className:"h-5 w-5 mr-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:137,columnNumber:15},this),"返回"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:133,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:129,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:128,columnNumber:9},this),a&&c.jsxDEV("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-400/60 rounded text-red-200 text-sm font-mono",children:a},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:144,columnNumber:11},this),c.jsxDEV("form",{onSubmit:t=>{return s=this,r=null,a=function*(){if(t.preventDefault(),m.name.trim()){n(!0),f(null);try{const{data:t}=yield y.from("user_roles").select("id").eq("name",m.name.trim()).single();if(t)return f("角色名称已存在，请使用其他名称"),void n(!1);if(m.name.trim()===p)return f("超级管理员角色已存在，无法重复创建"),void n(!1);const{error:s}=yield y.from("user_roles").insert({name:m.name.trim(),permissions:m.permissions});if(s)return void f("创建角色失败，请重试");f(""),e("/roles")}catch(s){f("创建角色时发生错误，请重试")}finally{n(!1)}}else f("角色名称不能为空")},new Promise((e,m)=>{var n=e=>{try{o(a.next(e))}catch(t){m(t)}},i=e=>{try{o(a.throw(e))}catch(t){m(t)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,i);o((a=a.apply(s,r)).next())});var s,r,a},className:"space-y-4 sm:space-y-6",children:[c.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[c.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"基本信息"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:152,columnNumber:13},this),c.jsxDEV("div",{className:"space-y-4",children:c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-2",children:"角色名称 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:156,columnNumber:17},this),c.jsxDEV("div",{className:"relative",children:[c.jsxDEV(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400/70 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:160,columnNumber:19},this),c.jsxDEV("input",{type:"text",value:m.name,onChange:e=>s(t=>o(i({},t),{name:e.target.value})),required:!0,className:"w-full pl-10 pr-4 py-2 sm:py-3 bg-black border border-green-400/30 rounded text-green-200 placeholder-green-700 focus:outline-none focus:border-green-400 focus:bg-gray-900/30 font-mono text-sm transition-all",placeholder:"请输入角色名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:161,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:159,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:155,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:154,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:151,columnNumber:11},this),c.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[c.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"权限设置"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:178,columnNumber:13},this),c.jsxDEV("div",{className:"space-y-3",children:[c.jsxDEV("div",{className:"text-green-300 font-mono text-sm mb-4",children:"选择该角色可以访问的Dashboard模块："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:181,columnNumber:15},this),c.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:x.map(e=>c.jsxDEV("label",{className:"flex flex-col items-start gap-2 p-3 border border-green-400/20 rounded transition-colors cursor-pointer hover:bg-gray-800/30",children:[c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV("input",{type:"checkbox",checked:m.permissions.includes(e.permission),onChange:()=>{return t=e.permission,void s(e=>o(i({},e),{permissions:e.permissions.includes(t)?e.permissions.filter(e=>e!==t):[...e.permissions,t]}));var t},className:"w-4 h-4 text-green-600 bg-black border-green-400 rounded focus:ring-green-500 focus:ring-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:189,columnNumber:23},this),c.jsxDEV("div",{className:"text-green-300 font-mono text-sm font-medium",children:e.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:195,columnNumber:23},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:188,columnNumber:21},this),c.jsxDEV("div",{className:"text-green-600 font-mono text-xs ml-6",children:e.description},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:199,columnNumber:21},this)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:187,columnNumber:19},this))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:185,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:180,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:177,columnNumber:11},this),c.jsxDEV("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[c.jsxDEV("button",{type:"submit",disabled:r||!m.name.trim(),className:"flex items-center justify-center gap-2 px-4 py-2 sm:py-3 bg-green-600 hover:bg-green-500 disabled:bg-green-800 disabled:opacity-50 text-black font-medium rounded transition-all font-mono text-sm",children:[c.jsxDEV(d,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:215,columnNumber:15},this),r?"创建中...":"创建角色"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:210,columnNumber:13},this),c.jsxDEV("button",{type:"button",onClick:()=>e("/role-permissions"),className:"flex items-center justify-center gap-2 px-4 py-2 sm:py-3 border border-gray-500 hover:border-gray-400 hover:bg-gray-800/30 text-gray-300 font-medium rounded transition-all font-mono text-sm",children:[c.jsxDEV(b,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:223,columnNumber:15},this),"取消"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:218,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:209,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:149,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:126,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleCreate.tsx",lineNumber:125,columnNumber:5},this)}export{f as default};
