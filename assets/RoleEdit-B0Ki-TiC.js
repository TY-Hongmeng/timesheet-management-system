var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(s,t,m)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:m}):s[t]=m,a=(e,s)=>{for(var t in s||(s={}))n.call(s,t)&&i(e,t,s[t]);if(m)for(var t of m(s))r.call(s,t)&&i(e,t,s[t]);return e},o=(e,m)=>s(e,t(m)),l=(e,s,t)=>new Promise((m,n)=>{var r=e=>{try{a(t.next(e))}catch(s){n(s)}},i=e=>{try{a(t.throw(e))}catch(s){n(s)}},a=e=>e.done?m(e.value):Promise.resolve(e.value).then(r,i);a((t=t.apply(e,s)).next())});import{W as h,r as c,d as u,j as d,J as g,f as N,l as b,s as x,I as y,X as f}from"./react-core-CEw6lU7H.js";import{u as p,h as E,s as v,S as w,D as j,P as k}from"./index-D4m2Xi5e.js";import"./vendor-Dj0T90Ik.js";import"./supabase-DInoECZ_.js";import"./ui-BmDV7GQB.js";function D(){const{id:e}=h(),[s,t]=c.useState(null),[m,n]=c.useState({name:"",permissions:[]}),[r,i]=c.useState(!0),[D,R]=c.useState(!1),[V,O]=c.useState(""),{user:S,loading:P}=p(),_=u();if(c.useEffect(()=>{var e;if(P||S)return S&&(null==(e=S.role)?void 0:e.permissions)&&!E(S,k.ROLE_MANAGE)?(O("您没有权限访问角色管理功能"),void i(!1)):void 0;_("/login")},[S,P,_]),P)return d.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:d.jsxDEV("div",{className:"text-center",children:[d.jsxDEV("div",{className:"text-green-400 text-2xl font-mono mb-4",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:54,columnNumber:11},this),d.jsxDEV("div",{className:"text-green-600 font-mono",children:"正在验证用户身份"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:55,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:53,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:52,columnNumber:7},this);c.useEffect(()=>{var s;S&&(null==(s=S.role)?void 0:s.permissions)&&E(S,k.ROLE_MANAGE)&&e&&q()},[S,e]);const q=()=>l(this,null,function*(){if(e)try{const{data:s,error:m}=yield v.from("user_roles").select("*").eq("id",e).single();if(m)throw m;if(!s)throw new Error("角色不存在");t(s),n({name:s.name,permissions:s.permissions||[]})}catch(s){O(s.message||"获取角色信息失败")}finally{i(!1)}});return r?d.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:d.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:158,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:157,columnNumber:7},this):V?d.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:d.jsxDEV("div",{className:"text-center",children:[d.jsxDEV(g,{className:"w-16 h-16 text-red-400 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:169,columnNumber:11},this),d.jsxDEV("div",{className:"text-red-400 text-xl font-mono mb-4",children:V},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:170,columnNumber:11},this),d.jsxDEV(N,{to:"/role-permissions",className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:"返回角色列表"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:171,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:168,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:167,columnNumber:7},this):s?d.jsxDEV("div",{className:"min-h-screen bg-black text-green-300 p-4 sm:p-6",children:d.jsxDEV("div",{className:"max-w-4xl mx-auto",children:[d.jsxDEV("div",{className:"mb-6",children:d.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[d.jsxDEV("h1",{className:"text-xl sm:text-2xl font-bold text-green-400 font-mono truncate",children:["编辑角色 - ",s.name]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:203,columnNumber:13},this),d.jsxDEV(N,{to:"/role-permissions",className:"flex items-center text-green-400 hover:text-green-300 transition-colors flex-shrink-0 font-mono",children:[d.jsxDEV(b,{className:"h-5 w-5 mr-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:210,columnNumber:15},this),"返回"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:206,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:202,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:201,columnNumber:9},this),V&&d.jsxDEV("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-400/60 rounded text-red-200 text-sm font-mono",children:V},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:217,columnNumber:11},this),d.jsxDEV("form",{onSubmit:s=>l(this,null,function*(){s.preventDefault(),R(!0),O("");try{if(!e)throw new Error("角色ID不存在");const{data:s}=yield v.from("user_roles").select("id").eq("name",m.name).neq("id",e).single();if(s)throw new Error("角色名称已存在");const{data:t,error:n}=yield v.from("user_roles").update({name:m.name,permissions:m.permissions,updated_at:(new Date).toISOString()}).eq("id",e).select("*");if(n)throw n;if(!t||0===t.length)throw new Error("更新失败：无法获取更新后的数据，请检查权限设置");_("/role-permissions")}catch(t){console.error("保存角色失败:",t),O(t.message||"保存失败")}finally{R(!1)}}),className:"space-y-4 sm:space-y-6",children:[d.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[d.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"基本信息"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:225,columnNumber:13},this),d.jsxDEV("div",{className:"space-y-4",children:d.jsxDEV("div",{children:[d.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-2",children:"角色名称 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:229,columnNumber:17},this),d.jsxDEV("div",{className:"relative",children:[d.jsxDEV(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400/70 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:233,columnNumber:19},this),d.jsxDEV("input",{type:"text",value:m.name,onChange:e=>n(s=>o(a({},s),{name:e.target.value})),required:!0,className:"w-full pl-10 pr-4 py-2 sm:py-3 bg-black border border-green-400/30 rounded text-green-200 placeholder-green-700 focus:outline-none focus:border-green-400 focus:bg-gray-900/30 font-mono text-sm transition-all",placeholder:"请输入角色名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:234,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:232,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:228,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:227,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:224,columnNumber:11},this),s&&s.name!==w&&d.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[d.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"权限设置"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:252,columnNumber:15},this),d.jsxDEV("div",{className:"space-y-3",children:[d.jsxDEV("div",{className:"text-green-300 font-mono text-sm mb-4",children:"选择该角色可以访问的Dashboard模块："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:255,columnNumber:17},this),d.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:j.map(e=>d.jsxDEV("label",{className:"flex flex-col items-start gap-2 p-3 border border-green-400/20 rounded transition-colors cursor-pointer hover:bg-gray-800/30",children:[d.jsxDEV("div",{className:"flex items-center gap-2",children:[d.jsxDEV("input",{type:"checkbox",checked:m.permissions.includes(e.permission),onChange:()=>{return s=e.permission,void n(e=>o(a({},e),{permissions:e.permissions.includes(s)?e.permissions.filter(e=>e!==s):[...e.permissions,s]}));var s},className:"w-4 h-4 text-green-600 bg-black border-green-400 rounded focus:ring-green-500 focus:ring-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:263,columnNumber:25},this),d.jsxDEV("div",{className:"text-green-300 font-mono text-sm font-medium",children:e.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:269,columnNumber:25},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:262,columnNumber:23},this),d.jsxDEV("div",{className:"text-green-600 font-mono text-xs ml-6",children:e.description},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:273,columnNumber:23},this)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:261,columnNumber:21},this))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:259,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:254,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:251,columnNumber:13},this),s&&s.name===w&&d.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[d.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"权限设置"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:286,columnNumber:15},this),d.jsxDEV("div",{className:"p-4 bg-yellow-900/30 border border-yellow-400/60 rounded",children:[d.jsxDEV("div",{className:"flex items-center gap-2 mb-2",children:[d.jsxDEV(x,{className:"w-5 h-5 text-yellow-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:289,columnNumber:19},this),d.jsxDEV("span",{className:"text-yellow-400 font-mono font-bold",children:"超级管理员"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:290,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:288,columnNumber:17},this),d.jsxDEV("p",{className:"text-yellow-300 font-mono text-sm",children:"超级管理员自动拥有系统所有权限，可以访问所有Dashboard模块，无需手动设置。"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:292,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:287,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:285,columnNumber:13},this),d.jsxDEV("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[d.jsxDEV("button",{type:"submit",disabled:D,className:"flex items-center justify-center gap-2 px-4 py-2 sm:py-3 bg-green-600 hover:bg-green-500 disabled:bg-green-800 disabled:opacity-50 text-black font-medium rounded transition-all font-mono text-sm",children:[d.jsxDEV(y,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:308,columnNumber:15},this),D?"保存中...":"保存"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:303,columnNumber:13},this),d.jsxDEV(N,{to:"/role-permissions",className:"flex items-center justify-center gap-2 px-4 py-2 sm:py-3 border border-gray-500 hover:border-gray-400 hover:bg-gray-800/30 text-gray-300 font-medium rounded transition-all font-mono text-sm",children:[d.jsxDEV(f,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:315,columnNumber:15},this),"取消"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:311,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:302,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:222,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:199,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:198,columnNumber:5},this):d.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:d.jsxDEV("div",{className:"text-center",children:[d.jsxDEV(g,{className:"w-16 h-16 text-red-400 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:184,columnNumber:11},this),d.jsxDEV("div",{className:"text-red-400 text-xl font-mono mb-4",children:"角色不存在"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:185,columnNumber:11},this),d.jsxDEV(N,{to:"/role-permissions",className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:"返回角色列表"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:186,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:183,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:182,columnNumber:7},this)}export{D as default};
