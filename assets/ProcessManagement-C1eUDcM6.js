var e=Object.defineProperty,t=Object.defineProperties,m=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,m,n)=>m in t?e(t,m,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[m]=n,a=(e,t)=>{for(var m in t||(t={}))s.call(t,m)&&o(e,m,t[m]);if(n)for(var m of n(t))r.call(t,m)&&o(e,m,t[m]);return e},i=(e,n)=>t(e,m(n)),l=(e,t,m)=>new Promise((n,s)=>{var r=e=>{try{a(m.next(e))}catch(t){s(t)}},o=e=>{try{a(m.throw(e))}catch(t){s(t)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,o);a((m=m.apply(e,t)).next())});import{j as c,X as u,r as d,Q as g,H as h,V as p,d as N,S as x,f as b,l as y,G as v,F as f,J as w,D as E,O as D,T as k}from"./react-core-CEw6lU7H.js";import{u as _,c as j,s as V,i as M,P}from"./index-CUGN2lWn.js";import{t as I}from"./ui-BmDV7GQB.js";import{utils as S,writeFile as $,read as C}from"./xlsx-DfDjAMCE.js";import"./vendor-Dj0T90Ik.js";import"./supabase-DInoECZ_.js";const O=({isOpen:e,title:t,message:m,onConfirm:n,onCancel:s,confirmText:r="确定",cancelText:o="取消",type:a="warning"})=>{if(!e)return null;const i=(()=>{switch(a){case"danger":return{confirmButton:"bg-red-600 hover:bg-red-700 text-white",icon:"text-red-400"};case"warning":return{confirmButton:"bg-yellow-600 hover:bg-yellow-700 text-white",icon:"text-yellow-400"};default:return{confirmButton:"bg-green-600 hover:bg-green-700 text-white",icon:"text-green-400"}}})();return c.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:c.jsxDEV("div",{className:"bg-gray-900 border border-green-500 rounded-lg shadow-xl max-w-md w-full mx-4",children:[c.jsxDEV("div",{className:"flex items-center justify-between p-6 border-b border-green-500",children:[c.jsxDEV("h3",{className:"text-lg font-semibold text-green-400",children:t},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:54,columnNumber:11},void 0),c.jsxDEV("button",{onClick:s,className:"text-green-400 hover:text-green-300 transition-colors",children:c.jsxDEV(u,{size:20},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:59,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:55,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:53,columnNumber:9},void 0),c.jsxDEV("div",{className:"p-6",children:c.jsxDEV("p",{className:"text-green-300 leading-relaxed",children:m},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:65,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:64,columnNumber:9},void 0),c.jsxDEV("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-green-500 bg-gray-800",children:[c.jsxDEV("button",{onClick:s,className:"px-4 py-2 text-green-400 bg-gray-700 border border-green-500 rounded-md hover:bg-gray-600 transition-colors",children:o},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:70,columnNumber:11},void 0),c.jsxDEV("button",{onClick:n,className:`px-4 py-2 rounded-md transition-colors ${i.confirmButton}`,children:r},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:76,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:69,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:51,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ConfirmDialog.tsx",lineNumber:50,columnNumber:5},void 0)},B=({isOpen:e,onClose:t,onImport:m,companies:n,currentUser:s,existingProcesses:r=[]})=>{const[o,a]=d.useState(null),[i,N]=d.useState([]),[x,b]=d.useState([]),[y,v]=d.useState(!1),[f,w]=d.useState(null),[E,D]=d.useState(0),[k,_]=d.useState(""),[j,V]=d.useState(!1);if(!e)return null;const M=e=>{if(e.size>10485760)return"文件大小不能超过10MB";if(0===e.size)return"文件不能为空";const t=e.name.toLowerCase();if(![".xlsx",".xls"].some(e=>t.endsWith(e)))return"请选择有效的Excel文件（.xlsx 或 .xls 格式）";return e.type&&!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","application/octet-stream"].includes(e.type)?"文件类型不正确，请选择有效的Excel文件":null},P=e=>l(void 0,null,function*(){v(!0),b([]);try{const t=yield e.arrayBuffer();if(!t||0===t.byteLength)return void b(["文件内容为空，请检查文件是否损坏"]);const m=C(t,{type:"array",cellDates:!0,cellNF:!1,cellText:!1,raw:!1,dateNF:"yyyy-mm-dd"});if(!m||!m.SheetNames||0===m.SheetNames.length)return void b(["Excel文件格式错误：未找到有效的工作表"]);const n=m.SheetNames[0],s=m.Sheets[n];if(!s)return void b(["Excel文件格式错误：工作表为空"]);const r=S.sheet_to_json(s,{header:1,defval:"",blankrows:!1});if(!r||0===r.length)return void b(["Excel文件中没有数据"]);if(r.length<2)return void b(["Excel文件至少需要包含标题行和一行数据"]);const o=r[0],a=["公司名称","生产线","工时类型","产品名称","产品工序","单价","生效年月"],i=a.filter(e=>!o.includes(e));if(i.length>0)return void b(["Excel文件标题行不正确，缺少以下列："+i.join("、"),"正确的标题行应该包含："+a.join("、")]);const l=r.slice(1).filter(e=>e.some(e=>""!==e&&null!=e)).map((e,t)=>{const m={};return o.forEach((t,n)=>{m[t]=e[n]||""}),{"公司名称":String(m["公司名称"]||"").trim(),"生产线":String(m["生产线"]||"").trim(),"工时类型":String(m["工时类型"]||"").trim(),"产品名称":String(m["产品名称"]||"").trim(),"产品工序":String(m["产品工序"]||"").trim(),"单价":m["单价"],"生效年月":I(m["生效年月"])}});if(0===l.length)return void b(["Excel文件中没有有效的数据行"]);const c=O(l);c.length>0&&b(c),N(l.slice(0,10))}catch(t){console.error("Excel解析错误:",t);let e="Excel文件解析失败";t instanceof Error&&(e=t.message.includes("Unsupported file")?"不支持的文件格式，请确保文件是有效的Excel文件（.xlsx或.xls）":t.message.includes("Invalid file")?"文件格式无效或文件已损坏，请检查文件是否正确":t.message.includes("password")?"文件受密码保护，请先解除密码保护后再导入":`文件解析失败：${t.message}`),b([e,"请确保文件是有效的Excel格式，且包含正确的数据结构"])}finally{v(!1),setTimeout(()=>{V(!1),D(0),_("")},1e3)}}),I=e=>{if(!e)return"";if("number"==typeof e){const t=new Date(86400*(e-25569)*1e3);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`}const t=String(e).trim();if(t.match(/^\d{4}-\d{2}$/))return t;if(t.match(/^\d{4}-\d{2}-\d{2}$/))return t.substring(0,7);if(t.match(/^\d{4}\/\d{1,2}$/)){const[e,m]=t.split("/");return`${e}-${m.padStart(2,"0")}`}if(t.match(/^\d{4}\/\d{1,2}\/\d{1,2}$/)){const[e,m]=t.split("/");return`${e}-${m.padStart(2,"0")}`}return t},O=e=>{const t=[],m=new Set(n.map(e=>e.name)),s=new Map(n.map(e=>[e.name,e.id])),o=new Set(["生产工时","非生产工时"]),a=new Map;r.forEach(e=>{const t=`${e.company_id}_${e.production_line.trim()}_${e.production_category}_${e.product_name.trim()}_${e.product_process.trim()}`;a.set(t,e)});const i=new Map;return e.forEach((e,n)=>{const r=n+2;if(e.公司名称?m.has(e.公司名称)||t.push(`第${r}行：公司"${e.公司名称}"不存在`):t.push(`第${r}行：公司名称不能为空`),e.生产线||t.push(`第${r}行：生产线不能为空`),e.工时类型&&o.has(e.工时类型)||t.push(`第${r}行：工时类型必须是"生产工时"或"非生产工时"`),e.产品名称||t.push(`第${r}行：产品名称不能为空`),e.产品工序||t.push(`第${r}行：产品工序不能为空`),e.单价&&""!==e.单价&&"string"==typeof e.单价&&isNaN(Number(e.单价))&&t.push(`第${r}行：单价必须是有效数字`),e.生效年月||t.push(`第${r}行：生效年月不能为空`),e.公司名称&&e.生产线&&e.工时类型&&e.产品名称&&e.产品工序){const m=`${e.公司名称.trim()}_${e.生产线.trim()}_${e.工时类型}_${e.产品名称.trim()}_${e.产品工序.trim()}`;i.has(m)?i.get(m).push(r):i.set(m,[r]);const n=s.get(e.公司名称);if(n){const m=`${n}_${e.生产线.trim()}_${e.工时类型}_${e.产品名称.trim()}_${e.产品工序.trim()}`,s=a.get(m);s&&t.push(`第${r}行：与现有工序重复！（公司：${s.company_name||e.公司名称}，生产线：${s.production_line}，工时类型：${s.production_category}，产品名称：${s.product_name}，产品工序：${s.product_process}）`)}}}),i.forEach((e,m)=>{if(e.length>1){const[n,s,r,o,a]=m.split("_");t.push(`导入数据内部重复：第${e.join("、")}行（公司：${n}，生产线：${s}，工时类型：${r}，产品名称：${o}，产品工序：${a}）`)}}),t},B=()=>{a(null),N([]),b([]),w(null),t()};return c.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxDEV("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[c.jsxDEV("div",{className:"flex justify-between items-center mb-6",children:[c.jsxDEV("h2",{className:"text-xl font-bold text-green-400",children:"批量导入工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:569,columnNumber:11},void 0),c.jsxDEV("button",{onClick:B,className:"text-gray-400 hover:text-white transition-colors",children:c.jsxDEV(u,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:574,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:570,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:568,columnNumber:9},void 0),f?c.jsxDEV("div",{className:"text-center",children:[c.jsxDEV("div",{className:"mb-6",children:[c.jsxDEV("h3",{className:"text-xl font-semibold text-green-400 mb-4",children:"导入完成"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:717,columnNumber:15},void 0),c.jsxDEV("div",{className:"space-y-2",children:[c.jsxDEV("p",{className:"text-white",children:["成功导入：",c.jsxDEV("span",{className:"text-green-400 font-semibold",children:f.success},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:719,columnNumber:48},void 0)," 条"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:719,columnNumber:17},void 0),c.jsxDEV("p",{className:"text-white",children:["导入失败：",c.jsxDEV("span",{className:"text-red-400 font-semibold",children:f.failed},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:720,columnNumber:48},void 0)," 条"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:720,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:718,columnNumber:15},void 0),f.errors.length>0&&c.jsxDEV("div",{className:"mt-4 p-4 bg-red-900 border border-red-600 rounded text-left",children:[c.jsxDEV("h4",{className:"text-red-400 font-semibold mb-2",children:"错误信息："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:725,columnNumber:19},void 0),c.jsxDEV("ul",{className:"text-red-300 text-sm space-y-1",children:f.errors.map((e,t)=>c.jsxDEV("li",{children:["• ",e]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:728,columnNumber:23},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:726,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:724,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:716,columnNumber:13},void 0),c.jsxDEV("button",{onClick:B,className:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded transition-colors",children:"关闭"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:735,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:715,columnNumber:11},void 0):c.jsxDEV(c.Fragment,{children:[c.jsxDEV("div",{className:"mb-6",children:[c.jsxDEV("div",{className:"flex items-center gap-4 mb-4",children:[c.jsxDEV("label",{className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded cursor-pointer transition-colors",children:[c.jsxDEV(g,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:584,columnNumber:19},void 0),"选择Excel文件",c.jsxDEV("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;const m=null==(t=e.target.files)?void 0:t[0];if(m){b([]),N([]);const e=M(m);if(e)return b([e]),void a(null);a(m),P(m)}},className:"hidden"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:586,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:583,columnNumber:17},void 0),c.jsxDEV("button",{onClick:()=>{var e;const t=[{"公司名称":(null==(e=null==s?void 0:s.company)?void 0:e.name)||"示例公司","生产线":"生产线A","工时类型":"生产工时","产品名称":"示例产品","产品工序":"示例工序","单价":"","生效年月":(new Date).toISOString().slice(0,7)}],m=S.json_to_sheet(t),n=S.book_new();S.book_append_sheet(n,m,"工序导入模板"),$(n,"工序导入模板.xlsx")},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors",children:[c.jsxDEV(h,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:597,columnNumber:19},void 0),"下载模板"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:593,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:582,columnNumber:15},void 0),c.jsxDEV("div",{className:"mb-4 p-3 bg-blue-900 border border-blue-600 rounded",children:[c.jsxDEV("h4",{className:"text-blue-400 font-semibold mb-2",children:"文件格式要求："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:604,columnNumber:17},void 0),c.jsxDEV("ul",{className:"text-blue-300 text-sm space-y-1",children:[c.jsxDEV("li",{children:"• 支持 .xlsx 和 .xls 格式的Excel文件"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:606,columnNumber:19},void 0),c.jsxDEV("li",{children:"• 文件大小不超过 10MB"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:607,columnNumber:19},void 0),c.jsxDEV("li",{children:"• 必须包含标题行：公司名称、生产线、工时类型、产品名称、产品工序、单价、生效年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:608,columnNumber:19},void 0),c.jsxDEV("li",{children:'• 工时类型只能是"生产工时"或"非生产工时"'},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:609,columnNumber:19},void 0),c.jsxDEV("li",{children:"• 生效年月格式：YYYY-MM（如：2024-01）"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:610,columnNumber:19},void 0),c.jsxDEV("li",{children:"• 单价可以为空，如填写必须是有效数字"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:611,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:605,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:603,columnNumber:15},void 0),o&&c.jsxDEV("div",{className:"flex items-center gap-2 text-green-400",children:[c.jsxDEV(p,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:617,columnNumber:19},void 0),c.jsxDEV("span",{children:o.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:618,columnNumber:19},void 0),c.jsxDEV("span",{className:"text-gray-400 text-sm",children:["(",(o.size/1024/1024).toFixed(2)," MB)"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:619,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:616,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:581,columnNumber:13},void 0),x.length>0&&c.jsxDEV("div",{className:"mb-6 p-4 bg-red-900 border border-red-600 rounded",children:[c.jsxDEV("h3",{className:"text-red-400 font-semibold mb-2",children:"数据验证错误："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:629,columnNumber:17},void 0),c.jsxDEV("ul",{className:"text-red-300 text-sm space-y-1",children:[x.slice(0,10).map((e,t)=>c.jsxDEV("li",{children:["• ",e]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:632,columnNumber:21},void 0)),x.length>10&&c.jsxDEV("li",{className:"text-red-400",children:["... 还有 ",x.length-10," 个错误"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:635,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:630,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:628,columnNumber:15},void 0),i.length>0&&c.jsxDEV("div",{className:"mb-6",children:[c.jsxDEV("h3",{className:"text-green-400 font-semibold mb-3",children:"数据预览（前10行）："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:644,columnNumber:17},void 0),c.jsxDEV("div",{className:"overflow-x-auto",children:c.jsxDEV("table",{className:"w-full border border-gray-600 rounded",children:[c.jsxDEV("thead",{children:c.jsxDEV("tr",{className:"bg-gray-700",children:[c.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"公司名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:649,columnNumber:25},void 0),c.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:650,columnNumber:25},void 0),c.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:651,columnNumber:25},void 0),c.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:652,columnNumber:25},void 0),c.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:653,columnNumber:25},void 0),c.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:654,columnNumber:25},void 0),c.jsxDEV("th",{className:"border border-gray-600 px-3 py-2 text-green-400 text-sm",children:"生效年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:655,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:648,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:647,columnNumber:21},void 0),c.jsxDEV("tbody",{children:i.map((e,t)=>c.jsxDEV("tr",{className:"hover:bg-gray-700",children:[c.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:e.公司名称},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:661,columnNumber:27},void 0),c.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:e.生产线},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:662,columnNumber:27},void 0),c.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:e.工时类型},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:663,columnNumber:27},void 0),c.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:e.产品名称},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:664,columnNumber:27},void 0),c.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:e.产品工序},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:665,columnNumber:27},void 0),c.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:e.单价},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:666,columnNumber:27},void 0),c.jsxDEV("td",{className:"border border-gray-600 px-3 py-2 text-white text-sm",children:e.生效年月},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:667,columnNumber:27},void 0)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:660,columnNumber:25},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:658,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:646,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:645,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:643,columnNumber:15},void 0),j&&c.jsxDEV("div",{className:"mb-6 p-4 bg-gray-700 border border-green-400 rounded",children:[c.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[c.jsxDEV("span",{className:"text-green-400 font-semibold",children:"导入进度"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:680,columnNumber:19},void 0),c.jsxDEV("span",{className:"text-green-400 text-sm",children:[E,"%"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:681,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:679,columnNumber:17},void 0),c.jsxDEV("div",{className:"w-full bg-gray-600 rounded-full h-3 mb-2",children:c.jsxDEV("div",{className:"bg-gradient-to-r from-green-500 to-green-400 h-3 rounded-full transition-all duration-300 ease-out",style:{width:`${E}%`}},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:684,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:683,columnNumber:17},void 0),c.jsxDEV("div",{className:"text-green-300 text-sm flex items-center",children:[c.jsxDEV("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-green-400 border-t-transparent mr-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:690,columnNumber:19},void 0),k]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:689,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:678,columnNumber:15},void 0),c.jsxDEV("div",{className:"flex justify-end gap-4",children:[c.jsxDEV("button",{onClick:B,className:"px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:698,columnNumber:15},void 0),c.jsxDEV("button",{onClick:()=>l(void 0,null,function*(){if(o&&!(x.length>0)){v(!0),V(!0),D(0),_("开始导入...");try{_("正在读取Excel文件..."),D(5);const e=yield o.arrayBuffer();_("正在解析Excel数据..."),D(15);const t=C(e,{type:"array",cellDates:!0,cellNF:!1,cellText:!1,raw:!1,dateNF:"yyyy-mm-dd"}),s=t.SheetNames[0],r=t.Sheets[s],a=S.sheet_to_json(r,{header:1,defval:"",blankrows:!1});D(30),_(`正在处理 ${a.length-1} 条数据...`);const i=a[0],l=a.slice(1),c=[],u=l.length;for(let m=0;m<u;m++){const e=l[m];if(!e.some(e=>""!==e&&null!=e))continue;const t={};i.forEach((m,n)=>{t[m]=e[n]||""}),c.push({"公司名称":String(t["公司名称"]||"").trim(),"生产线":String(t["生产线"]||"").trim(),"工时类型":String(t["工时类型"]||"").trim(),"产品名称":String(t["产品名称"]||"").trim(),"产品工序":String(t["产品工序"]||"").trim(),"单价":t["单价"],"生效年月":I(t["生效年月"])});const n=30+Math.floor(m/u*20);D(n),m%50==0&&(yield new Promise(e=>setTimeout(e,1)))}_(`正在转换 ${c.length} 条有效数据格式...`),D(50);const d=c.map((e,t)=>{const m=n.find(t=>t.name===e.公司名称);if(t%10==0){const e=50+Math.floor(t/c.length*20);D(e)}return{company_id:(null==m?void 0:m.id)||"",production_line:e.生产线,production_category:e.工时类型,product_name:e.产品名称,product_process:e.产品工序,unit_price:e.单价&&""!==e.单价&&void 0!==e.单价?Number(e.单价):null,effective_date:e.生效年月||null}});_(`正在保存 ${d.length} 条工序数据到数据库...`),D(70),yield m(d),D(100),_(`导入完成！成功导入 ${d.length} 条工序数据`),w({success:d.length,failed:0,errors:[]})}catch(e){console.error("导入错误:",e);let t="导入失败";e instanceof Error&&(t=e.message.includes("duplicate")?"导入失败：存在重复数据":e.message.includes("permission")?"导入失败：权限不足":e.message.includes("network")?"导入失败：网络连接错误":`导入失败：${e.message}`),w({success:0,failed:i.length,errors:[t]}),D(0),_("")}finally{v(!1)}}}),disabled:!o||x.length>0||y,className:"px-6 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded transition-colors",children:y?"导入中...":"确认导入"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:704,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:697,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:579,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:567,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/ExcelImportDialog.tsx",lineNumber:566,columnNumber:5},void 0)},F=()=>{var e;const{user:t,loading:m}=_(),n=N(),[s,r]=d.useState([]),[o,h]=d.useState([]),[p,S]=d.useState(!0),[$,C]=d.useState(""),[F,L]=d.useState(""),[T,z]=d.useState(""),[q,W]=d.useState(""),[Y,A]=d.useState(!1),[U,G]=d.useState(!1),[H,J]=d.useState(null),[Q,R]=d.useState(!1),[K,X]=d.useState([]),[Z,ee]=d.useState([]),[te,me]=d.useState([]),[ne,se]=d.useState([]),[re,oe]=d.useState([]),[ae,ie]=d.useState([]),[le,ce]=d.useState(!1),[ue,de]=d.useState(!1),[ge,he]=d.useState(!1),[pe,Ne]=d.useState({production_line:"",production_category:"",product_name:""}),[xe,be]=d.useState({company_id:"",production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"}),[ye,ve]=d.useState(null),[fe,we]=d.useState(!1),[Ee,De]=d.useState(1),[ke,_e]=d.useState(20),[je,Ve]=d.useState(null),[Me,Pe]=d.useState(!1),[Ie,Se]=d.useState(!1);d.useEffect(()=>{if(!m&&!t)return I.error("请先登录"),void n("/login");t&&$e()},[t,m,n]);const $e=()=>l(void 0,null,function*(){if(!t)return;if(!(yield j(t.id,P.PROCESS_MANAGEMENT)))return I.error("您没有权限访问工序管理功能"),void n("/dashboard");Ce(),Le()}),Ce=()=>l(void 0,null,function*(){var e;try{if(S(!0),!t)return void I.error("用户信息不存在");let m=V.from("processes").select("\n          *,\n          companies!inner(\n            name\n          )\n        ").eq("is_active",!0);if(!M(t.role)){if(!(null==(e=t.company)?void 0:e.id))return void I.error("用户没有关联的公司，请联系管理员");m=m.eq("company_id",t.company.id)}const{data:n,error:s}=yield m.order("created_at",{ascending:!1});if(s)return void I.error(`获取工序列表失败: ${s.message}`);const o=(n||[]).map(e=>{var t;return i(a({},e),{company_name:(null==(t=e.companies)?void 0:t.name)||"未知公司"})});r(o),Oe(o)}catch(m){I.error(`获取工序列表失败: ${m.message||"未知错误"}`)}finally{S(!1)}}),Oe=e=>{var m;if(!(null==(m=null==t?void 0:t.company)?void 0:m.id))return;const n=e.filter(e=>{var m;return e.company_id===(null==(m=t.company)?void 0:m.id)}),s=[...new Set(n.map(e=>e.production_line).filter(Boolean))];X(s);const r=[...new Set(n.map(e=>e.product_name).filter(Boolean))];ee(r);const o=[...new Set(n.map(e=>e.product_process).filter(Boolean))];me(o)},Be=(e,t)=>{switch(be(m=>i(a({},m),{[e]:t})),e){case"production_line":const e=K.filter(e=>e.toLowerCase().includes(t.toLowerCase()));se(e),ce(t.length>0&&e.length>0);break;case"product_name":const m=Z.filter(e=>e.toLowerCase().includes(t.toLowerCase()));oe(m),de(t.length>0&&m.length>0);break;case"product_process":const n=te.filter(e=>e.toLowerCase().includes(t.toLowerCase()));ie(n),he(t.length>0&&n.length>0)}},Fe=(e,t)=>{switch(be(m=>i(a({},m),{[e]:t})),e){case"production_line":ce(!1);break;case"product_name":de(!1);break;case"product_process":he(!1)}},Le=()=>l(void 0,null,function*(){var e,m;try{if(!t)return void I.error("用户信息不存在");let n=V.from("companies").select("id, name");M(t.role)||(n=n.eq("id",null==(e=t.company)?void 0:e.id));const{data:s,error:r}=yield n.order("name");if(r)return void I.error("获取公司列表失败");h(s||[]),!M(t.role)&&(null==(m=t.company)?void 0:m.id)&&be(e=>i(a({},e),{company_id:t.company.id}))}catch(n){I.error("获取公司列表失败")}}),Te=()=>{var e;return!M(null==t?void 0:t.role)&&(null==(e=null==t?void 0:t.company)?void 0:e.id)?t.company.id:""},ze=s.reduce((e,t)=>{var m,n,s;const r=`${t.company_id}_${null==(m=t.production_line)?void 0:m.trim()}_${t.production_category}_${null==(n=t.product_name)?void 0:n.trim()}_${null==(s=t.product_process)?void 0:s.trim()}`;return(!e[r]||new Date(t.created_at)>new Date(e[r].created_at))&&(e[r]=t),e},{}),qe=Object.values(ze).filter(e=>{if(Ie)return!e.unit_price||e.unit_price<=0;const t=""===$||e.production_line.toLowerCase().includes($.toLowerCase())||e.product_name.toLowerCase().includes($.toLowerCase())||e.production_category&&e.production_category.toLowerCase().includes($.toLowerCase())||e.product_process&&e.product_process.toLowerCase().includes($.toLowerCase()),m=""===pe.production_line||e.production_line===pe.production_line,n=""===pe.production_category||e.production_category===pe.production_category,s=!q||e.effective_date===q;return t&&m&&n&&s}),We=qe.length,Ye=Math.ceil(We/ke),Ae=(Ee-1)*ke,Ue=Ae+ke,Ge=qe.slice(Ae,Ue),He=[...new Set(s.map(e=>e.production_line).filter(Boolean))],Je=[...new Set(s.map(e=>e.production_category).filter(Boolean))];return c.jsxDEV("div",{className:"min-h-screen bg-black text-green-400 font-mono",children:[c.jsxDEV("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[c.jsxDEV("div",{className:"mb-8",children:[c.jsxDEV("div",{className:"flex justify-between items-center mb-4",children:[c.jsxDEV("div",{className:"flex items-center",children:[c.jsxDEV(x,{className:"w-8 h-8 text-green-400 mr-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:847,columnNumber:15},void 0),c.jsxDEV("h1",{className:"text-4xl font-bold text-green-400 font-mono",children:"工序管理"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:848,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:846,columnNumber:13},void 0),c.jsxDEV(b,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[c.jsxDEV(y,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:854,columnNumber:15},void 0),c.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:855,columnNumber:15},void 0),c.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:856,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:850,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:845,columnNumber:11},void 0),c.jsxDEV("div",{className:"h-1 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:859,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:844,columnNumber:9},void 0),c.jsxDEV("div",{className:"mb-6 space-y-4",children:[c.jsxDEV("div",{className:"flex flex-col sm:flex-row gap-4",children:c.jsxDEV("div",{className:"flex-1",children:c.jsxDEV("div",{className:"relative",children:[c.jsxDEV(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-green-400/60"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:867,columnNumber:17},void 0),c.jsxDEV("input",{type:"text",placeholder:"搜索工序内容、生产线、产品名称...",value:$,onChange:e=>{C(e.target.value),De(1)},className:"w-full bg-black border border-green-400/30 rounded px-10 py-2 text-green-400 placeholder-green-400/60 focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:868,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:866,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:865,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:864,columnNumber:11},void 0),c.jsxDEV("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4",children:[c.jsxDEV("button",{onClick:()=>R(!Q),className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono text-sm sm:text-base",children:[c.jsxDEV(f,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:888,columnNumber:15},void 0),c.jsxDEV("span",{className:"hidden sm:inline",children:"筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:889,columnNumber:15},void 0),c.jsxDEV("span",{className:"sm:hidden",children:"筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:890,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:884,columnNumber:13},void 0),c.jsxDEV("button",{onClick:()=>{0===s.filter(e=>!e.unit_price||e.unit_price<=0).length?I.info("当前没有未定价的工序"):(C(""),Ne({production_line:"",production_category:"",product_name:""}),W(""),Se(!Ie))},className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 font-bold rounded transition-colors font-mono text-sm sm:text-base "+(Ie?"bg-red-600 hover:bg-red-500 text-white":"bg-orange-600 hover:bg-orange-500 text-white"),children:[c.jsxDEV(w,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:911,columnNumber:15},void 0),c.jsxDEV("span",{className:"hidden sm:inline",children:Ie?"显示全部":"未定价工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:912,columnNumber:15},void 0),c.jsxDEV("span",{className:"sm:hidden",children:Ie?"全部":"未定价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:913,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:892,columnNumber:13},void 0),c.jsxDEV("button",{onClick:()=>Pe(!0),className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono text-sm sm:text-base",children:[c.jsxDEV(g,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:919,columnNumber:15},void 0),c.jsxDEV("span",{className:"hidden sm:inline",children:"批量导入"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:920,columnNumber:15},void 0),c.jsxDEV("span",{className:"sm:hidden",children:"导入"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:921,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:915,columnNumber:13},void 0),c.jsxDEV("button",{onClick:()=>{Y||(ye?be(i(a({},ye),{unit_price:""})):(()=>{const e=Te();be({company_id:e,production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"})})()),A(!Y)},className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono text-sm sm:text-base",children:[c.jsxDEV(E,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:941,columnNumber:15},void 0),c.jsxDEV("span",{className:"hidden sm:inline",children:"添加工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:942,columnNumber:15},void 0),c.jsxDEV("span",{className:"sm:hidden",children:"添加"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:943,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:923,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:883,columnNumber:11},void 0),Q&&c.jsxDEV("div",{className:"bg-green-900/10 border border-green-400/30 rounded p-4",children:[c.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium text-green-400 mb-2",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:952,columnNumber:19},void 0),c.jsxDEV("select",{value:pe.production_line,onChange:e=>{Ne(i(a({},pe),{production_line:e.target.value})),De(1)},className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"",children:"全部生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:963,columnNumber:21},void 0),He.map(e=>c.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:965,columnNumber:23},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:955,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:951,columnNumber:17},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium text-green-400 mb-2",children:"工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:970,columnNumber:19},void 0),c.jsxDEV("select",{value:pe.production_category,onChange:e=>{Ne(i(a({},pe),{production_category:e.target.value})),De(1)},className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"",children:"全部类别"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:981,columnNumber:21},void 0),Je.map(e=>c.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:983,columnNumber:23},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:973,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:969,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:950,columnNumber:15},void 0),c.jsxDEV("div",{className:"flex justify-start mt-4",children:c.jsxDEV("button",{onClick:()=>{Ne({production_line:"",production_category:"",product_name:""}),C(""),W(""),Se(!1),De(1)},className:"flex items-center space-x-2 bg-gray-900/20 border border-gray-400/30 px-4 py-2 rounded hover:bg-gray-900/30 transition-colors text-gray-400",children:[c.jsxDEV(u,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:999,columnNumber:19},void 0),c.jsxDEV("span",{children:"清除筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1e3,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:989,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:988,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:949,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:863,columnNumber:9},void 0),Y&&c.jsxDEV("div",{className:"mb-6 p-4 border border-green-400/30 rounded bg-green-900/10",children:[c.jsxDEV("h3",{className:"text-lg font-semibold mb-4 text-green-400",children:["为 ",c.jsxDEV("strong",{children:(null==(e=null==t?void 0:t.company)?void 0:e.name)||"未设置公司"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1011,columnNumber:17},void 0)," 添加新工序"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1010,columnNumber:13},void 0),c.jsxDEV("div",{className:"space-y-4",children:[c.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxDEV("div",{className:"relative",children:[c.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:["生产线 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1018,columnNumber:88},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1018,columnNumber:19},void 0),c.jsxDEV("input",{type:"text",value:xe.production_line,onChange:e=>Be("production_line",e.target.value),onFocus:()=>{xe.production_line&&ne.length>0&&ce(!0)},onBlur:()=>{setTimeout(()=>ce(!1),200)},className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1019,columnNumber:19},void 0),le&&ne.length>0&&c.jsxDEV("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-green-400/30 rounded-md shadow-lg max-h-40 overflow-y-auto",children:ne.map((e,t)=>c.jsxDEV("div",{onClick:()=>Fe("production_line",e),className:"px-3 py-2 text-green-400 hover:bg-green-900/20 cursor-pointer border-b border-green-400/10 last:border-b-0",children:e},t,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1037,columnNumber:25},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1035,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1017,columnNumber:17},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:["工时类型 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1049,columnNumber:89},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1049,columnNumber:19},void 0),c.jsxDEV("select",{value:xe.work_time_type,onChange:e=>be(i(a({},xe),{work_time_type:e.target.value})),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"生产工时",children:"生产工时"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1055,columnNumber:21},void 0),c.jsxDEV("option",{value:"非生产工时",children:"非生产工时"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1056,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1050,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1048,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1016,columnNumber:15},void 0),c.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxDEV("div",{className:"relative",children:[c.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:["产品名称 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1064,columnNumber:89},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1064,columnNumber:19},void 0),c.jsxDEV("input",{type:"text",value:xe.product_name,onChange:e=>Be("product_name",e.target.value),onFocus:()=>{xe.product_name&&re.length>0&&de(!0)},onBlur:()=>{setTimeout(()=>de(!1),200)},className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1065,columnNumber:19},void 0),ue&&re.length>0&&c.jsxDEV("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-green-400/30 rounded-md shadow-lg max-h-40 overflow-y-auto",children:re.map((e,t)=>c.jsxDEV("div",{onClick:()=>Fe("product_name",e),className:"px-3 py-2 text-green-400 hover:bg-green-900/20 cursor-pointer border-b border-green-400/10 last:border-b-0",children:e},t,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1083,columnNumber:23},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1081,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1063,columnNumber:17},void 0),c.jsxDEV("div",{className:"relative",children:[c.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:["产品工序 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1095,columnNumber:89},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1095,columnNumber:19},void 0),c.jsxDEV("input",{type:"text",value:xe.product_process,onChange:e=>Be("product_process",e.target.value),onFocus:()=>{xe.product_process&&ae.length>0&&he(!0)},onBlur:()=>{setTimeout(()=>he(!1),200)},className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1096,columnNumber:19},void 0),ge&&ae.length>0&&c.jsxDEV("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-green-400/30 rounded-md shadow-lg max-h-40 overflow-y-auto",children:ae.map((e,t)=>c.jsxDEV("div",{onClick:()=>Fe("product_process",e),className:"px-3 py-2 text-green-400 hover:bg-green-900/20 cursor-pointer border-b border-green-400/10 last:border-b-0",children:e},t,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1114,columnNumber:25},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1112,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1094,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1062,columnNumber:15},void 0),c.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:"单价（可选）"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1130,columnNumber:19},void 0),c.jsxDEV("input",{type:"number",step:"0.01",value:xe.unit_price,onChange:e=>be(i(a({},xe),{unit_price:e.target.value})),onWheel:e=>e.currentTarget.blur(),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400 [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]",placeholder:"请输入单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1131,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1129,columnNumber:17},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-green-400",children:"生效年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1142,columnNumber:19},void 0),c.jsxDEV("input",{type:"month",value:xe.effective_date,onChange:e=>be(i(a({},xe),{effective_date:e.target.value})),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1143,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1141,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1128,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1014,columnNumber:13},void 0),c.jsxDEV("div",{className:"flex space-x-4 mt-4",children:[c.jsxDEV("button",{type:"button",onClick:()=>l(void 0,null,function*(){var e,m;if(!t)return I.error("用户未登录，请重新登录"),void n("/login");const o=null==(e=t.company)?void 0:e.id;if(!o)return void I.error("用户没有关联的公司，请联系管理员");if(!xe.production_line.trim())return void I.error("请填写生产线");if(!xe.product_name.trim())return void I.error("请填写产品名称");if(!xe.product_process.trim())return void I.error("请填写产品工序");console.log("=== 开始添加工序 ==="),console.log("当前表单数据:",{company_id:o,production_line:xe.production_line.trim(),work_time_type:xe.work_time_type,product_name:xe.product_name.trim(),product_process:xe.product_process.trim()}),console.log("现有工序数据:",s.map(e=>({id:e.id,company_id:e.company_id,production_line:e.production_line,production_category:e.production_category,product_name:e.product_name,product_process:e.product_process}))),console.log("工序总数:",s.length);const l=s.find(e=>{const t=e.company_id===o&&e.production_line.trim()===xe.production_line.trim()&&e.production_category===xe.work_time_type&&e.product_name.trim()===xe.product_name.trim()&&e.product_process.trim()===xe.product_process.trim();return t&&console.log("找到重复工序:",e),t});if(console.log("重复检查结果:",l?"发现重复":"无重复"),l)return console.log("显示重复提示"),void I.error("该工序已存在，请检查输入信息！",{duration:4e3,style:{fontSize:"16px",fontWeight:"bold"}});try{const e={company_id:o,production_line:xe.production_line,production_category:xe.work_time_type,product_name:xe.product_name,product_process:xe.product_process,unit_price:xe.unit_price&&""!==xe.unit_price.trim()?parseFloat(xe.unit_price):null,effective_date:xe.effective_date?`${xe.effective_date}-01`:null,is_active:!0},{data:t,error:n}=yield V.from("processes").insert(e).select("\n          *,\n          companies!inner(\n            name\n          )\n        ").single();if(n)return void I.error(`添加工序失败: ${n.message}`);const l=i(a({},t),{company_name:(null==(m=t.companies)?void 0:m.name)||"未知公司"});r([l,...s]),ve(a({},xe)),be(i(a({},xe),{product_process:""})),A(!1),I.success("工序添加成功")}catch(c){I.error(`添加工序失败: ${c.message||"未知错误"}`)}}),className:"bg-green-900/20 border border-green-400/30 px-4 py-2 rounded hover:bg-green-900/30 transition-colors text-green-400",children:"确认添加"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1153,columnNumber:15},void 0),c.jsxDEV("button",{onClick:()=>{A(!1);const e=Te();be({company_id:e,production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"})},className:"border border-green-400/30 px-4 py-2 rounded hover:bg-green-900/20 transition-colors text-green-400",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1158,columnNumber:15},void 0),c.jsxDEV("button",{onClick:()=>{const e=Te();be({company_id:e,production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"}),I.success("表单内容已清除")},className:"bg-red-900/20 border border-red-400/30 px-4 py-2 rounded hover:bg-red-900/30 transition-colors text-red-400",children:"清除内容"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1177,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1152,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1009,columnNumber:11},void 0),U&&H&&c.jsxDEV("div",{className:"bg-gray-800 border border-green-500 rounded-lg p-6 mb-6",children:[c.jsxDEV("h3",{className:"text-lg font-semibold text-green-400 mb-4",children:"编辑工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1203,columnNumber:13},void 0),c.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["公司 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1207,columnNumber:22},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1206,columnNumber:17},void 0),c.jsxDEV("select",{value:xe.company_id,onChange:e=>be(i(a({},xe),{company_id:e.target.value})),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"",children:"请选择公司"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1214,columnNumber:19},void 0),o.map(e=>c.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1216,columnNumber:21},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1209,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1205,columnNumber:15},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["生产线 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1224,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1223,columnNumber:17},void 0),c.jsxDEV("input",{type:"text",value:xe.production_line,onChange:e=>be(i(a({},xe),{production_line:e.target.value})),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1226,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1222,columnNumber:15},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["工时类型 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1236,columnNumber:24},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1235,columnNumber:17},void 0),c.jsxDEV("select",{value:xe.work_time_type,onChange:e=>be(i(a({},xe),{work_time_type:e.target.value})),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"生产工时",children:"生产工时"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1243,columnNumber:19},void 0),c.jsxDEV("option",{value:"非生产工时",children:"非生产工时"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1244,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1238,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1234,columnNumber:15},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["产品名称 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1249,columnNumber:24},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1248,columnNumber:17},void 0),c.jsxDEV("input",{type:"text",value:xe.product_name,onChange:e=>be(i(a({},xe),{product_name:e.target.value})),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1251,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1247,columnNumber:15},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["产品工序 ",c.jsxDEV("span",{className:"text-red-400",children:"*"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1261,columnNumber:24},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1260,columnNumber:17},void 0),c.jsxDEV("input",{type:"text",value:xe.product_process,onChange:e=>be(i(a({},xe),{product_process:e.target.value})),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400",placeholder:"请输入产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1263,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1259,columnNumber:15},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1272,columnNumber:17},void 0),c.jsxDEV("input",{type:"number",step:"0.001",value:xe.unit_price,onChange:e=>be(i(a({},xe),{unit_price:e.target.value})),onWheel:e=>e.currentTarget.blur(),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400 [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]",placeholder:"请输入单价（精确到小数点后三位）"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1275,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1271,columnNumber:15},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"生效年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1286,columnNumber:17},void 0),c.jsxDEV("input",{type:"month",value:xe.effective_date,onChange:e=>be(i(a({},xe),{effective_date:e.target.value})),className:"w-full bg-black border border-green-400/30 rounded px-3 py-2 text-green-400 focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1289,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1285,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1204,columnNumber:13},void 0),c.jsxDEV("div",{className:"flex justify-end space-x-3 mt-4",children:[c.jsxDEV("button",{onClick:()=>{G(!1),J(null),be({company_id:"",production_line:"",production_category:"",product_name:"",product_process:"",unit_price:"",effective_date:(new Date).toISOString().slice(0,7),work_time_type:"生产工时"})},className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1298,columnNumber:15},void 0),c.jsxDEV("button",{onClick:()=>l(void 0,null,function*(){var e,m,o;if(!H)return;if(!t)return I.error("用户未登录，请重新登录"),void n("/login");if(!M(t.role)&&H.company_id!==(null==(e=t.company)?void 0:e.id))return void I.error("您只能编辑自己公司的工序");if(!M(t.role)&&xe.company_id!==(null==(m=t.company)?void 0:m.id))return void I.error("您只能将工序分配给自己的公司");if(!xe.company_id)return void I.error("请选择公司");if(!xe.production_line.trim())return void I.error("请输入生产线");if(!xe.product_name.trim())return void I.error("请输入产品名称");if(s.find(e=>e.id!==H.id&&e.company_id===xe.company_id&&e.production_line.trim()===xe.production_line.trim()&&e.production_category===xe.work_time_type&&e.product_name.trim()===xe.product_name.trim()&&e.product_process.trim()===xe.product_process.trim()))I.error("该工序已存在，请检查输入信息！",{duration:4e3,style:{fontSize:"16px",fontWeight:"bold"}});else try{const{data:e,error:t}=yield V.from("processes").update({company_id:xe.company_id,production_line:xe.production_line,production_category:xe.work_time_type,product_name:xe.product_name,product_process:xe.product_process,unit_price:xe.unit_price?parseFloat(xe.unit_price):null,effective_date:xe.effective_date?`${xe.effective_date}-01`:null}).eq("id",H.id).select("\n          *,\n          companies!inner(\n            name\n          )\n        ").single();if(t)return void I.error("更新工序失败");const m=i(a({},e),{company_name:(null==(o=e.companies)?void 0:o.name)||"未知公司"});r(s.map(e=>e.id===H.id?m:e)),ve(a({},xe)),G(!1),J(null),I.success("工序更新成功")}catch(l){I.error("更新工序失败")}}),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"更新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1317,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1297,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1202,columnNumber:11},void 0),c.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg overflow-hidden",children:p?c.jsxDEV("div",{className:"p-8 text-center text-green-400/60",children:c.jsxDEV("div",{className:"animate-pulse",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1332,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1331,columnNumber:13},void 0):0===qe.length?c.jsxDEV("div",{className:"p-8 text-center text-green-400/60",children:$?"未找到匹配的工序":"暂无工序数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1335,columnNumber:13},void 0):c.jsxDEV("div",{className:"overflow-x-auto",children:c.jsxDEV("table",{className:"w-full",children:[c.jsxDEV("thead",{className:"bg-green-900/30",children:c.jsxDEV("tr",{children:[c.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"序号"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1343,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"公司"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1346,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1349,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1352,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1353,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1356,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1359,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"生效年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1362,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-sm font-mono font-medium text-green-400 uppercase tracking-wider",children:"操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1365,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1342,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1341,columnNumber:17},void 0),c.jsxDEV("tbody",{className:"divide-y divide-green-800",children:Ge.map((e,t)=>c.jsxDEV("tr",{className:"hover:bg-green-900/10",children:[c.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:c.jsxDEV("span",{className:"text-sm font-mono text-green-300",children:Ae+t+1},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1374,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1373,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:c.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:e.company_name,children:e.company_name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1379,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1378,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:c.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:e.production_line,children:e.production_line},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1384,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1383,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:c.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:e.production_category||"-",children:e.production_category||"-"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1389,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1388,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:c.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:e.product_name,children:e.product_name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1394,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1393,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:c.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:e.product_process||"-",children:e.product_process||"-"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1399,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1398,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:c.jsxDEV("span",{className:"text-sm font-mono "+(null==e.unit_price||void 0===e.unit_price?"text-red-400 font-bold":"text-green-300"),title:null!=e.unit_price?`¥${e.unit_price.toFixed(3)}`:"未定价",children:null!=e.unit_price?`¥${e.unit_price.toFixed(3)}`:"未定价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1404,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1403,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:c.jsxDEV("span",{className:"text-sm font-mono text-green-300",title:e.effective_date,children:e.effective_date?e.effective_date.substring(0,7):""},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1409,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1408,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-4 py-3 whitespace-nowrap",children:c.jsxDEV("div",{className:"flex justify-center space-x-1",children:[c.jsxDEV("button",{onClick:()=>(e=>{var t;J(e);let m="";m=e.effective_date?e.effective_date.includes("-")&&e.effective_date.length>=7?e.effective_date.substring(0,7):e.effective_date:(new Date).toISOString().slice(0,7),be({company_id:e.company_id,production_line:e.production_line,production_category:e.production_category,product_name:e.product_name,product_process:e.product_process,unit_price:(null==(t=e.unit_price)?void 0:t.toString())||"",effective_date:m,work_time_type:e.production_category}),G(!0)})(e),className:"p-1 text-blue-400/60 hover:text-blue-400 hover:bg-blue-900/20 rounded transition-colors",title:"编辑工序",children:c.jsxDEV(D,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1420,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1415,columnNumber:27},void 0),c.jsxDEV("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),Ve(e),we(!0)},className:"p-1 text-red-400/60 hover:text-red-400 hover:bg-red-900/20 rounded transition-colors",title:"删除工序",children:c.jsxDEV(k,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1432,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1422,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1414,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1413,columnNumber:23},void 0)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1372,columnNumber:21},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1370,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1340,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1339,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1328,columnNumber:9},void 0),c.jsxDEV("div",{className:"mt-6 text-center text-green-400/60 text-sm",children:["共 ",qe.length," 个工序",$&&` (从 ${s.length} 个工序中筛选)`,Ie&&c.jsxDEV("span",{className:"ml-2 text-red-400 font-bold",children:"(显示未定价工序)"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1449,columnNumber:13},void 0),!Ie&&c.jsxDEV("span",{className:"ml-2 text-orange-400",children:["(未定价: ",s.filter(e=>null==e.unit_price||void 0===e.unit_price).length," 个)"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1454,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1445,columnNumber:9},void 0),Ye>1&&c.jsxDEV("div",{className:"mt-6 flex flex-col sm:flex-row items-center justify-between gap-4",children:[c.jsxDEV("div",{className:"flex items-center gap-2 text-sm text-green-400",children:[c.jsxDEV("span",{children:"每页显示:"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1465,columnNumber:15},void 0),c.jsxDEV("select",{value:ke,onChange:e=>{_e(Number(e.target.value)),De(1)},className:"bg-gray-800 border border-green-400/30 rounded px-2 py-1 text-green-400 focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:10,children:"10"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1474,columnNumber:17},void 0),c.jsxDEV("option",{value:20,children:"20"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1475,columnNumber:17},void 0),c.jsxDEV("option",{value:50,children:"50"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1476,columnNumber:17},void 0),c.jsxDEV("option",{value:100,children:"100"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1477,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1466,columnNumber:15},void 0),c.jsxDEV("span",{children:"条"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1479,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1464,columnNumber:13},void 0),c.jsxDEV("div",{className:"text-sm text-green-400/60",children:["显示第 ",Ae+1," - ",Math.min(Ue,We)," 条，共 ",We," 条"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1483,columnNumber:13},void 0),c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV("button",{onClick:()=>De(1),disabled:1===Ee,className:"px-3 py-1 bg-gray-800 border border-green-400/30 rounded text-green-400 hover:bg-green-900/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"首页"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1489,columnNumber:15},void 0),c.jsxDEV("button",{onClick:()=>De(e=>Math.max(1,e-1)),disabled:1===Ee,className:"px-3 py-1 bg-gray-800 border border-green-400/30 rounded text-green-400 hover:bg-green-900/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"上一页"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1496,columnNumber:15},void 0),c.jsxDEV("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,Ye)},(e,t)=>{let m;return m=Ye<=5||Ee<=3?t+1:Ee>=Ye-2?Ye-4+t:Ee-2+t,c.jsxDEV("button",{onClick:()=>De(m),className:"px-3 py-1 border rounded transition-colors "+(Ee===m?"bg-green-600 border-green-600 text-white":"bg-gray-800 border-green-400/30 text-green-400 hover:bg-green-900/20"),children:m},m,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1519,columnNumber:21},void 0)})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1505,columnNumber:15},void 0),c.jsxDEV("button",{onClick:()=>De(e=>Math.min(Ye,e+1)),disabled:Ee===Ye,className:"px-3 py-1 bg-gray-800 border border-green-400/30 rounded text-green-400 hover:bg-green-900/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"下一页"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1534,columnNumber:15},void 0),c.jsxDEV("button",{onClick:()=>De(Ye),disabled:Ee===Ye,className:"px-3 py-1 bg-gray-800 border border-green-400/30 rounded text-green-400 hover:bg-green-900/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"末页"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1541,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1488,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1462,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:842,columnNumber:7},void 0),c.jsxDEV(O,{isOpen:fe,title:"确认删除",message:je?`确定要删除工序"${je.product_name}"吗？\n\n此操作不可撤销！`:"",onConfirm:()=>{var e;je&&(e=je.id,l(void 0,null,function*(){var m;if(!t)return I.error("用户未登录，请重新登录"),void n("/login");const o=s.find(t=>t.id===e);if(o)if(M(t.role)||o.company_id===(null==(m=t.company)?void 0:m.id))try{const{error:t}=yield V.from("processes").update({is_active:!1}).eq("id",e);if(t)return void I.error(`删除工序失败: ${t.message}`);r(s.filter(t=>t.id!==e)),I.success("工序删除成功")}catch(a){I.error("删除工序失败")}else I.error("您只能删除自己公司的工序");else I.error("工序不存在")}),we(!1),Ve(null))},onCancel:()=>{we(!1),Ve(null)},confirmText:"删除",cancelText:"取消",type:"danger"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1554,columnNumber:7},void 0),c.jsxDEV(B,{isOpen:Me,onClose:()=>Pe(!1),onImport:e=>l(void 0,null,function*(){var m,s;if(!t)return I.error("用户未登录，请重新登录"),void n("/login");let o=0,l=0;const c=[];try{const n=null==(m=t.company)?void 0:m.id;if(!n)return void I.error("无法获取用户公司信息");const g=[],h=100;for(let m=0;m<e.length;m++){const s=e[m];if(!M(t.role)&&s.company_id!==n){c.push(`第 ${m+1} 行: 您只能导入自己公司的工序`),l++;continue}const r={company_id:n,production_line:s.production_line,production_category:s.production_category,product_name:s.product_name,product_process:s.product_process,unit_price:s.unit_price,effective_date:s.effective_date?s.effective_date.match(/^\d{4}-\d{2}$/)?`${s.effective_date}-01`:s.effective_date:null,is_active:!0};g.push(r)}if(0===g.length)return void I.error("没有有效的数据可以导入");for(let e=0;e<g.length;e+=h){const t=g.slice(e,e+h);try{const{data:m,error:n}=yield V.from("processes").insert(t).select("\n              *,\n              companies!inner(\n                name\n              )\n            ");if(n){console.warn("批量插入失败，尝试逐条插入:",n);for(let m=0;m<t.length;m++)try{const{data:n,error:u}=yield V.from("processes").insert(t[m]).select("\n                    *,\n                    companies!inner(\n                      name\n                    )\n                  ").single();if(u)c.push(`第 ${e+m+1} 行: ${u.message}`),l++;else{const e=i(a({},n),{company_name:(null==(s=n.companies)?void 0:s.name)||"未知公司"});r(t=>[e,...t]),o++}}catch(u){c.push(`第 ${e+m+1} 行: ${u.message||"未知错误"}`),l++}}else{const e=m.map(e=>{var t;return i(a({},e),{company_name:(null==(t=e.companies)?void 0:t.name)||"未知公司"})});r(t=>[...e,...t]),o+=m.length}}catch(d){console.error("批次处理错误:",d),c.push(`批次 ${Math.floor(e/h)+1} 处理失败: ${d.message||"未知错误"}`),l+=t.length}}o>0&&0===l?I.success(`批量导入成功！共导入 ${o} 条工序`):o>0&&l>0?(I.warning(`部分导入成功！成功 ${o} 条，失败 ${l} 条`),c.length>0&&console.warn("导入错误详情:",c.slice(0,10))):(I.error(`导入失败！共 ${l} 条数据导入失败`),c.length>0&&console.error("导入错误详情:",c.slice(0,10)))}catch(g){console.error("批量导入失败:",g),I.error(`批量导入失败: ${g.message||"未知错误"}`)}}),companies:o,currentUser:t,existingProcesses:s},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:1575,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/ProcessManagement.tsx",lineNumber:841,columnNumber:5},void 0)};export{F as default};
