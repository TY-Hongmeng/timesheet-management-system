var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,s,m)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:m}):t[s]=m,a=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&o(e,s,t[s]);if(m)for(var s of m(t))r.call(t,s)&&o(e,s,t[s]);return e},i=(e,m)=>t(e,s(m)),l=(e,t,s)=>new Promise((m,n)=>{var r=e=>{try{a(s.next(e))}catch(t){n(t)}},o=e=>{try{a(s.throw(e))}catch(t){n(t)}},a=e=>e.done?m(e.value):Promise.resolve(e.value).then(r,o);a((s=s.apply(e,t)).next())});import{_ as u}from"./supabase-k270UWii.js";import{j as c,J as d,X as h,O as g,d as p,r as N,y as x,z as y,f as v,l as b,F as f,W as w,a3 as D,a4 as k,H as j,R as E,a5 as _,a6 as V,U as R,_ as C,a7 as A,$ as I,T as S,x as F}from"./react-core-CmOG7fiH.js";import{u as P,i as $,s as q}from"./index-fJdEo9IN.js";import{t as T}from"./ui-BpXc_XmY.js";import"./vendor-Dj0T90Ik.js";const Q=({isOpen:e,title:t="确认删除",message:s="您确定要删除以下工时记录吗？",employeeName:m,workDate:n,workProject:r,onConfirm:o,onCancel:a,confirmText:i="确认删除",cancelText:l="取消"})=>e?c.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:c.jsxDEV("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 border border-gray-600",children:[c.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-gray-600",children:[c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV("div",{className:"w-8 h-8 bg-red-600 rounded-full flex items-center justify-center",children:c.jsxDEV(d,{className:"w-5 h-5 text-white"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:38,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:37,columnNumber:13},void 0),c.jsxDEV("h3",{className:"text-lg font-semibold text-white",children:t},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:40,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:36,columnNumber:11},void 0),c.jsxDEV("button",{onClick:a,className:"text-gray-400 hover:text-gray-300 transition-colors",children:c.jsxDEV(h,{size:20},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:46,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:42,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:35,columnNumber:9},void 0),c.jsxDEV("div",{className:"p-4",children:[c.jsxDEV("p",{className:"text-gray-300 mb-4",children:s},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:52,columnNumber:11},void 0),(m||n||r)&&c.jsxDEV("div",{className:"bg-gray-700 rounded-lg p-3 mb-4 space-y-2",children:[m&&c.jsxDEV("div",{className:"flex justify-between",children:[c.jsxDEV("span",{className:"text-gray-400",children:"员工姓名："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:59,columnNumber:19},void 0),c.jsxDEV("span",{className:"text-white",children:m},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:60,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:58,columnNumber:17},void 0),n&&c.jsxDEV("div",{className:"flex justify-between",children:[c.jsxDEV("span",{className:"text-gray-400",children:"工作日期："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:65,columnNumber:19},void 0),c.jsxDEV("span",{className:"text-white",children:n},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:66,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:64,columnNumber:17},void 0),r&&c.jsxDEV("div",{className:"flex justify-between",children:[c.jsxDEV("span",{className:"text-gray-400",children:"工时项目："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:71,columnNumber:19},void 0),c.jsxDEV("span",{className:"text-white",children:r},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:72,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:70,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:56,columnNumber:13},void 0),c.jsxDEV("div",{className:"flex items-center gap-2 p-3 bg-red-900 bg-opacity-20 border border-red-600 rounded-lg",children:[c.jsxDEV(d,{className:"w-4 h-4 text-red-400 flex-shrink-0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:80,columnNumber:13},void 0),c.jsxDEV("span",{className:"text-red-400 text-sm",children:"删除后数据将无法恢复，请谨慎操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:81,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:79,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:51,columnNumber:9},void 0),c.jsxDEV("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-gray-600",children:[c.jsxDEV("button",{onClick:a,className:"px-4 py-2 text-gray-300 bg-gray-600 border border-gray-500 rounded-md hover:bg-gray-500 transition-colors",children:l},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:87,columnNumber:11},void 0),c.jsxDEV("button",{onClick:o,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors flex items-center gap-2",children:[c.jsxDEV(d,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:97,columnNumber:13},void 0),i]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:93,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:86,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:33,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/DeleteConfirmDialog.tsx",lineNumber:32,columnNumber:5},void 0):null,M=({isOpen:e,title:t="确认修改数量",message:s="您确定要修改数量吗？",currentQuantity:m,newQuantity:n,onConfirm:r,onCancel:o,confirmText:a="确认修改",cancelText:i="取消"})=>e?c.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:c.jsxDEV("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 border border-gray-600",children:[c.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-gray-600",children:[c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center",children:c.jsxDEV(g,{className:"w-5 h-5 text-white"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:36,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:35,columnNumber:13},void 0),c.jsxDEV("h3",{className:"text-lg font-semibold text-white",children:t},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:38,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:34,columnNumber:11},void 0),c.jsxDEV("button",{onClick:o,className:"text-gray-400 hover:text-gray-300 transition-colors",children:c.jsxDEV(h,{size:20},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:44,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:40,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:33,columnNumber:9},void 0),c.jsxDEV("div",{className:"p-4",children:[c.jsxDEV("p",{className:"text-gray-300 mb-4",children:s},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:50,columnNumber:11},void 0),void 0!==m&&void 0!==n&&c.jsxDEV("div",{className:"bg-gray-700 rounded-lg p-3 mb-4",children:[c.jsxDEV("div",{className:"flex justify-between items-center",children:[c.jsxDEV("span",{className:"text-gray-400",children:"当前数量："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:56,columnNumber:17},void 0),c.jsxDEV("span",{className:"text-white font-mono",children:m},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:57,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:55,columnNumber:15},void 0),c.jsxDEV("div",{className:"flex justify-between items-center mt-2",children:[c.jsxDEV("span",{className:"text-gray-400",children:"修改为："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:60,columnNumber:17},void 0),c.jsxDEV("span",{className:"text-blue-400 font-mono font-bold",children:n},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:61,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:59,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:54,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:49,columnNumber:9},void 0),c.jsxDEV("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-gray-600",children:[c.jsxDEV("button",{onClick:o,className:"px-4 py-2 text-gray-300 bg-gray-600 border border-gray-500 rounded-md hover:bg-gray-500 transition-colors",children:i},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:69,columnNumber:11},void 0),c.jsxDEV("button",{onClick:r,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors flex items-center gap-2",children:[c.jsxDEV(g,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:79,columnNumber:13},void 0),a]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:75,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:68,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:31,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/components/EditConfirmDialog.tsx",lineNumber:30,columnNumber:5},void 0):null,z=()=>{var e,t,s;const{user:m,loading:n}=P(),r=p(),[o,d]=N.useState([]),[g,z]=N.useState([]),[L,O]=N.useState(!0),[W,B]=N.useState(!1),[H,Y]=N.useState({totalRecords:0,totalAmount:0,pendingCount:0,approvedCount:0,rejectedCount:0,supervisorApprovedCount:0,sectionChiefApprovedCount:0}),[J,U]=N.useState({dailyStats:[],monthlyStats:[],userStats:[],workTypeStats:{production:[],nonProduction:[],productionTotal:0,nonProductionTotal:0},duplicateRecords:[],priceIssues:[],workDayStats:[]}),[G,K]=N.useState({key:"",direction:"asc"}),[X,Z]=N.useState(new Set),[ee,te]=N.useState(!0),[se,me]=N.useState(!1),[ne,re]=N.useState(null),[oe,ae]=N.useState(0),[ie,le]=N.useState(!1),[ue,ce]=N.useState(!1),[de,he]=N.useState(null),[ge,pe]=N.useState(null),[Ne,xe]=N.useState({startDate:"",endDate:"",userId:"",status:"",productionLine:"",workType:"",productName:"",productProcess:"",yearMonth:""}),[ye,ve]=N.useState([]),[be,fe]=N.useState([]),[we,De]=N.useState([]),[ke,je]=N.useState([]),[Ee,_e]=N.useState([]);N.useEffect(()=>{if(!n&&!m)return T.error("请先登录"),void r("/login");m&&Ve()},[m,n,r]),N.useEffect(()=>{Se()},[o,Ne]);const Ve=()=>l(void 0,null,function*(){console.log("=== checkReportsPermission 被调用 ==="),console.log("user:",m),m?(Re(),Ce()):console.log("用户不存在，返回")}),Re=()=>l(void 0,null,function*(){var e;console.log("=== fetchReportData 被调用 ===");try{if(O(!0),!m)return console.error("fetchReportData: 用户信息不存在"),void T.error("用户信息不存在");let t;if($(m.role)){const{data:e,error:s}=yield q.from("timesheet_records").select("\n            *,\n            user_name,\n            supervisor_name,\n            section_chief_name,\n            user:user_id(id, name, company_id),\n            supervisor:supervisor_id(id, name),\n            section_chief:section_chief_id(id, name)\n          ").neq("status","draft").order("created_at",{ascending:!1});if(s)throw s;t=e}else{if(!(null==(e=m.company)?void 0:e.id))return console.error("fetchReportData: 用户没有关联的公司ID"),void T.error("用户没有关联的公司，请联系管理员");const{data:s,error:n}=yield q.from("users").select("id").eq("company_id",m.company.id);if(n)throw console.error("查询公司用户失败:",n),n;const r=(null==s?void 0:s.map(e=>e.id))||[];if(0===r.length)return d([]),void Ae([]);const{data:o,error:a}=yield q.from("timesheet_records").select("\n            *,\n            user_name,\n            supervisor_name,\n            section_chief_name,\n            user:user_id(id, name, company_id),\n            supervisor:supervisor_id(id, name),\n            section_chief:section_chief_id(id, name)\n          ").in("user_id",r).neq("status","draft").order("created_at",{ascending:!1});if(a)throw a;t=o}const s=(null==t?void 0:t.map(e=>e.id))||[],{data:n,error:r}=yield q.from("timesheet_record_items").select("\n          *,\n          processes:process_id(\n            product_process,\n            product_name,\n            production_category,\n            production_line,\n            unit_price\n          )\n        ").in("timesheet_record_id",s);if(r)throw r;const{data:o,error:l}=yield q.from("approval_history").select("\n          *,\n          approver_name,\n          approver:approver_id(name)\n        ").in("timesheet_record_id",s);if(l)throw l;const u=(null==n?void 0:n.map(e=>e.id))||[],{data:c,error:h}=yield q.from("timesheet_item_modification_history").select("\n          *,\n          modifier_name,\n          modifier:modifier_id(\n            name,\n            role:role_id(name)\n          )\n        ").in("timesheet_record_item_id",u).order("created_at",{ascending:!1});if(h)throw h;console.log("=== 修改历史查询结果 ==="),console.log("modificationData:",c),console.log("modificationData length:",(null==c?void 0:c.length)||0),c&&c.length>0&&console.log("第一条修改历史:",c[0]),console.log("========================");const g=(null==t?void 0:t.map(e=>{const t=(null==n?void 0:n.filter(t=>t.timesheet_record_id===e.id).map(e=>{const t=(null==c?void 0:c.filter(t=>t.timesheet_record_item_id===e.id))||[];return i(a({},e),{modification_history:t})}))||[],s=(null==o?void 0:o.filter(t=>t.timesheet_record_id===e.id))||[],m=t.reduce((e,t)=>e+t.quantity*t.unit_price,0);return i(a({},e),{items:t,approval_history:s,total_amount:m})}))||[];d(g),Ae(g),Ie(g)}catch(t){console.error("获取报表数据失败:",t),T.error("获取报表数据失败")}finally{O(!1)}}),Ce=()=>l(void 0,null,function*(){var e;try{if(!m)return void T.error("用户信息不存在");let t=q.from("users").select("id, name, company_id").eq("is_active",!0);if(!$(m.role)){if(!(null==(e=m.company)?void 0:e.id))return console.error("fetchFilterOptions: 用户没有关联的公司ID"),void T.error("用户没有关联的公司，请联系管理员");t=t.eq("company_id",m.company.id)}const{data:s}=yield t.order("name");s&&ve(s);let n=q.from("processes").select("production_line, production_category, product_name, product_process").eq("is_active",!0);$(m.role)||(n=n.eq("company_id",m.company.id));const{data:r}=yield n;if(r){const e=[...new Set(r.map(e=>e.production_line).filter(Boolean))];fe(e);const t=[...new Set(r.map(e=>e.production_category).filter(Boolean))];De(t);const s=[...new Set(r.map(e=>e.product_name).filter(Boolean))];je(s);const m=[...new Set(r.map(e=>e.product_process).filter(Boolean))];_e(m)}}catch(t){console.error("获取筛选选项失败:",t)}}),Ae=e=>{const t=e.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.quantity*t.unit_price,0),0),s={totalRecords:e.length,totalAmount:t,pendingCount:e.filter(e=>"pending"===e.status).length,approvedCount:e.filter(e=>"approved"===e.status).length,rejectedCount:e.filter(e=>"rejected"===e.status).length,supervisorApprovedCount:e.filter(e=>e.supervisor_approved_at).length,sectionChiefApprovedCount:e.filter(e=>e.section_chief_approved_at).length};Y(s),Ie(e)},Ie=e=>{const t=Me(e),s=Oe(e),m=Le(e),n=We(e),r=Be(e),o=He(e).filter(e=>e.records.some((t,s)=>e.records.slice(s+1).some(e=>t.work_date===e.work_date&&t.user_id===e.user_id&&t.items.some(t=>e.items.some(e=>{var s,m;return(null==(s=t.processes)?void 0:s.product_process)===(null==(m=e.processes)?void 0:m.product_process)}))))),a=Ye(e);U({dailyStats:t,monthlyStats:s,workDayStats:m,userStats:n,workTypeStats:r,duplicateRecords:o,priceIssues:a})},Se=()=>{let e=[...o];Ne.startDate&&(e=e.filter(e=>e.work_date>=Ne.startDate)),Ne.endDate&&(e=e.filter(e=>e.work_date<=Ne.endDate)),Ne.userId&&(e=e.filter(e=>e.user_id===Ne.userId)),Ne.status&&(e=e.filter(e=>e.status===Ne.status)),Ne.productionLine&&(e=e.filter(e=>e.items.some(e=>{var t;return(null==(t=e.processes)?void 0:t.production_line)===Ne.productionLine}))),Ne.workType&&(e=e.filter(e=>e.items.some(e=>{var t;return(null==(t=e.processes)?void 0:t.production_category)===Ne.workType}))),Ne.productName&&(e=e.filter(e=>e.items.some(e=>{var t;return(null==(t=e.processes)?void 0:t.product_name)===Ne.productName}))),Ne.productProcess&&(e=e.filter(e=>e.items.some(e=>{var t;return(null==(t=e.processes)?void 0:t.product_process)===Ne.productProcess}))),Ne.yearMonth&&(e=e.filter(e=>{const t=new Date(e.work_date);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`===Ne.yearMonth})),z(e),Ae(e),Ie(e)},Fe=e=>new Date(e).toLocaleDateString("zh-CN"),Pe=e=>{switch(e){case"pending":return"待班长审核";case"approved":return"待段长审核";case"section_chief_approved":return"已通过";default:return"未知"}},$e=e=>{const t=(e=>{switch(e){case"pending":return{text:"待班长审核",icon:"⚠",color:"text-yellow-400"};case"approved":return{text:"待段长审核",icon:"⚠",color:"text-blue-400"};case"section_chief_approved":return{text:"已通过",icon:"✓",color:"text-green-400"};default:return{text:"未知",icon:"⚠",color:"text-gray-400"}}})(e);return c.jsxDEV("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ${t.color}`,children:[c.jsxDEV("span",{className:"w-3 h-3 text-center",children:t.icon},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:815,columnNumber:9},void 0),t.text]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:814,columnNumber:7},void 0)},qe=e=>{var t,s,m;return`${(null==(t=e.processes)?void 0:t.production_category)||"未知工时类型"} - ${(null==(s=e.processes)?void 0:s.product_name)||"未知产品"} - ${(null==(m=e.processes)?void 0:m.product_process)||"未知工序"}`},Te=e=>e.modification_history&&0!==e.modification_history.length?e.modification_history.map(t=>{var s;const m=new Date(t.created_at).toLocaleDateString("zh-CN");let n="未知用户";return(null==(s=t.modifier)?void 0:s.name)?n=t.modifier.name:t.modifier_name?n=t.modifier_name:e.record&&t.modifier_id?t.modifier_id===e.record.supervisor_id&&e.record.supervisor_name?n=e.record.supervisor_name:t.modifier_id===e.record.section_chief_id&&e.record.section_chief_name&&(n=e.record.section_chief_name):e.record&&!t.modifier_id&&(e.record.supervisor_name?n=e.record.supervisor_name:e.record.section_chief_name&&(n=e.record.section_chief_name)),`${n} ${m} ${t.old_quantity}→${t.new_quantity}`}).join("; "):"暂无修改记录",Qe=e=>{if(!e.modification_history||0===e.modification_history.length)return c.jsxDEV("span",{className:"text-gray-400",children:"暂无修改记录"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:867,columnNumber:14},void 0);const t=e.modification_history.filter((e,t,s)=>t===s.findIndex(t=>t.created_at===e.created_at&&t.old_quantity===e.old_quantity&&t.new_quantity===e.new_quantity&&t.modifier_id===e.modifier_id)).map(t=>{var s;const m=new Date(t.created_at).toLocaleDateString("zh-CN");let n="未知用户";(null==(s=t.modifier)?void 0:s.name)?n=t.modifier.name:t.modifier_name?n=t.modifier_name:e.record&&t.modifier_id?t.modifier_id===e.record.supervisor_id&&e.record.supervisor_name?n=e.record.supervisor_name:t.modifier_id===e.record.section_chief_id&&e.record.section_chief_name&&(n=e.record.section_chief_name):e.record&&!t.modifier_id&&(e.record.supervisor_name?n=e.record.supervisor_name:e.record.section_chief_name&&(n=e.record.section_chief_name));return`${n} ${m} ${t.old_quantity}→${t.new_quantity}`});return c.jsxDEV("span",{className:"text-xs text-gray-300",children:t.join("; ")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:917,columnNumber:7},void 0)},Me=e=>{const t=new Map;return e.forEach(e=>{var s,m,n;const r=`${null==(s=e.user)?void 0:s.id}-${e.work_date}`,o=t.get(r),a=e.items.reduce((e,t)=>e+t.quantity*t.unit_price,0);o?(o.totalAmount+=a,o.recordCount+=1):t.set(r,{userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,workDate:e.work_date,totalAmount:a,recordCount:1,items:e.items})}),Array.from(t.values()).sort((e,t)=>new Date(t.workDate).getTime()-new Date(e.workDate).getTime())},ze=e=>{const t=e.getDay();if(0===t||6===t)return!1;e.getFullYear();const s=e.getMonth()+1,m=e.getDate();return(1!==s||1!==m)&&(!(1===s&&m>=21&&m<=27)&&(!(2===s&&m>=10&&m<=16)&&((4!==s||4!==m&&5!==m)&&(!(5===s&&m>=1&&m<=3)&&(!(6===s&&m>=20&&m<=22)&&(!(9===s&&m>=15&&m<=17)&&!(10===s&&m>=1&&m<=7)))))))},Le=e=>{const t=new Map;return e.forEach(e=>{var s,m,n;const r=new Date(e.work_date),o=null==(s=e.user)?void 0:s.id,a=t.get(o),i=ze(r),l=e.items.reduce((e,t)=>e+t.quantity*t.unit_price,0);a?(a.totalAmount+=l,a.workDates.add(e.work_date),i?(a.workingAmount+=l,a.workingDates.add(e.work_date)):(a.holidayAmount+=l,a.holidayDates.add(e.work_date))):t.set(o,{userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,totalAmount:l,workingAmount:i?l:0,holidayAmount:i?0:l,workDates:new Set([e.work_date]),workingDates:new Set(i?[e.work_date]:[]),holidayDates:new Set(i?[]:[e.work_date])})}),Array.from(t.values()).map(e=>i(a({},e),{actualWorkDays:e.workingDates.size,actualWorkingDays:e.workingDates.size,actualHolidayDays:e.holidayDates.size,avgDailyAmount:e.totalAmount/e.workDates.size,avgWorkingDayAmount:e.workingDates.size>0?e.workingAmount/e.workingDates.size:0,avgHolidayDayAmount:e.holidayDates.size>0?e.holidayAmount/e.holidayDates.size:0})).sort((e,t)=>t.totalAmount-e.totalAmount)},Oe=e=>{const t=new Map;return e.forEach(e=>{var s,m,n;const r=new Date(e.work_date),o=`${null==(s=e.user)?void 0:s.id}-${r.getFullYear()}-${r.getMonth()+1}`,a=t.get(o),i=ze(r),l=e.items.reduce((e,t)=>e+t.quantity*t.unit_price,0);a?(a.totalAmount+=l,a.totalDays+=1,i?(a.workDays+=1,a.workAmount+=l):(a.holidayDays+=1,a.holidayAmount+=l)):t.set(o,{userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,year:r.getFullYear(),month:r.getMonth()+1,totalDays:1,workDays:i?1:0,holidayDays:i?0:1,totalAmount:l,workAmount:i?l:0,holidayAmount:i?0:l})}),Array.from(t.values()).map(e=>i(a({},e),{avgDailyAmount:e.totalAmount/e.totalDays})).sort((e,t)=>t.year-e.year||t.month-e.month)},We=e=>{const t=new Map;e.forEach(e=>{var s,m,n,r;if(!e.items||0===e.items.length)return;const o=t.get(null==(s=e.user)?void 0:s.id),a=e.items.reduce((e,t)=>e+t.quantity*t.unit_price,0),i=e.items.reduce((e,t)=>e+t.quantity,0);if(o)o.totalAmount+=a,o.totalQuantity+=i,o.recordCount+=1,o.dates.add(e.work_date);else{const s={userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,totalAmount:a,totalQuantity:i,recordCount:1,dates:new Set([e.work_date])};t.set(null==(r=e.user)?void 0:r.id,s)}});return Array.from(t.values()).map(e=>i(a({},e),{workDays:e.dates.size,avgDailyAmount:e.totalAmount/e.dates.size,avgDailyQuantity:e.totalQuantity/e.dates.size})).sort((e,t)=>t.totalAmount-e.totalAmount)},Be=e=>{const t=new Map,s=new Map;e.forEach(e=>{e.items.forEach(e=>{var m;const n=(null==(m=e.processes)?void 0:m.production_category)||"未知类型",r=n.includes("生产")||n.includes("加工"),o=r?t:s,a=o.get(n),i=e.quantity*e.unit_price;a?(a.totalAmount+=i,a.quantity+=e.quantity,a.recordCount+=1):o.set(n,{category:n,totalAmount:i,quantity:e.quantity,recordCount:1,isProduction:r})})});const m=Array.from(t.values()),n=Array.from(s.values());return{production:m.sort((e,t)=>t.totalAmount-e.totalAmount),nonProduction:n.sort((e,t)=>t.totalAmount-e.totalAmount),productionTotal:m.reduce((e,t)=>e+t.totalAmount,0),nonProductionTotal:n.reduce((e,t)=>e+t.totalAmount,0)}},He=e=>{const t=[],s=new Map;return e.forEach(e=>{e.items.forEach(m=>{var n,r,o;const a=`${null==(n=e.user)?void 0:n.id}-${e.work_date}-${m.process_id}`,i=s.get(a);i?t.push({userId:null==(r=e.user)?void 0:r.id,userName:null==(o=e.user)?void 0:o.name,workDate:e.work_date,processId:m.process_id,processName:qe(m),records:[i.record,e],items:[i.item,m]}):s.set(a,{record:e,item:m})})}),t},Ye=e=>{const t=[];return e.forEach(e=>{e.items.forEach(s=>{var m,n,r,o;null!=s.unit_price&&void 0!==s.unit_price||t.push({recordId:e.id,userId:null==(m=e.user)?void 0:m.id,userName:null==(n=e.user)?void 0:n.name,workDate:e.work_date,processId:s.process_id,processName:qe(s),issue:"单价为空或无效",unitPrice:s.unit_price}),s.processes||t.push({recordId:e.id,userId:null==(r=e.user)?void 0:r.id,userName:null==(o=e.user)?void 0:o.name,workDate:e.work_date,processId:s.process_id,processName:"工序信息缺失",issue:"工序引用缺失",unitPrice:s.unit_price})})}),t},Je=e=>{let t="asc";G.key===e&&"asc"===G.direction&&(t="desc"),K(i(a({},G),{key:e,direction:t}))},Ue=()=>{let e=J.userStats.filter(e=>e.totalQuantity>0||e.totalAmount>0);if(!G.key)return e;return[...e].sort((e,t)=>{const s=Ge(e,G.key),m=Ge(t,G.key);return"asc"===G.direction?s>m?1:-1:s<m?1:-1})},Ge=(e,t)=>{const s=g.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId}),m=Be(s),n=J.workDayStats.find(t=>t.userId===e.userId),r=J.duplicateRecords.filter(t=>t.userId===e.userId),o=J.priceIssues.filter(t=>t.userId===e.userId);switch(t){case"userName":return e.userName;case"totalQuantity":return e.totalQuantity;case"totalAmount":return e.totalAmount;case"workDays":return e.workDays;case"avgDailyQuantity":return e.avgDailyQuantity;case"workingDays":return(null==n?void 0:n.actualWorkingDays)||0;case"holidayDays":return(null==n?void 0:n.actualHolidayDays)||0;case"workingAmount":return(null==n?void 0:n.workingAmount)||0;case"holidayAmount":return(null==n?void 0:n.holidayAmount)||0;case"avgDailyAmount":return e.avgDailyAmount;case"productionTotal":return m.productionTotal||0;case"nonProductionTotal":return m.nonProductionTotal||0;case"duplicateCount":return r.length;case"priceIssueCount":return o.length;case"totalIssues":return r.length+o.length;default:return 0}},Ke=(e,t)=>{var s,m;const n=null==(s=e.approval_history)?void 0:s.find(e=>e.approver_type===t);return n?{name:(null==(m=n.approver)?void 0:m.name)||"未知",date:Fe(n.created_at)}:null};return L?c.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:c.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1343,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1342,columnNumber:7},void 0):c.jsxDEV("div",{className:"min-h-screen bg-black text-green-300",children:[c.jsxDEV("header",{className:"bg-gray-900 border-b border-green-400 px-2 sm:px-4 lg:px-6 py-4",children:c.jsxDEV("div",{className:"w-full",children:c.jsxDEV("div",{className:"flex items-center justify-between",children:[c.jsxDEV("h1",{className:"text-2xl font-bold text-green-400 font-mono flex items-center gap-2",children:[c.jsxDEV(x,{className:"w-6 h-6"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1357,columnNumber:15},void 0),"查看报表"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1356,columnNumber:13},void 0),c.jsxDEV("div",{className:"flex items-center gap-3",children:[c.jsxDEV("button",{onClick:()=>l(void 0,null,function*(){try{B(!0),yield Promise.all([Re(),Ce()]),T.success("数据刷新成功")}catch(e){console.error("刷新数据失败:",e),T.error("刷新数据失败")}finally{B(!1)}}),disabled:W,className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 disabled:from-gray-700 disabled:to-gray-800 text-green-300 hover:text-green-200 disabled:text-gray-400 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50 disabled:border-gray-600",children:[c.jsxDEV(y,{className:"w-4 h-4 "+(W?"animate-spin":"")},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1366,columnNumber:17},void 0),c.jsxDEV("span",{className:"hidden sm:inline",children:W?"刷新中...":"刷新"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1367,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1361,columnNumber:15},void 0),c.jsxDEV(v,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[c.jsxDEV(b,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1374,columnNumber:17},void 0),c.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1375,columnNumber:17},void 0),c.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1376,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1370,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1360,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1355,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1354,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1353,columnNumber:7},void 0),c.jsxDEV("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-6",children:[c.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg p-4 mb-6",children:[c.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV(f,{className:"w-5 h-5 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1390,columnNumber:15},void 0),c.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono",children:"数据筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1391,columnNumber:15},void 0),c.jsxDEV("button",{onClick:()=>me(!se),className:"p-1 text-green-400 hover:text-green-300 transition-colors duration-200",children:se?c.jsxDEV(w,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1397,columnNumber:19},void 0):c.jsxDEV(D,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1399,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1392,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1389,columnNumber:13},void 0),c.jsxDEV("button",{onClick:()=>{xe({startDate:"",endDate:"",userId:"",status:"",productionLine:"",workType:"",productName:"",productProcess:"",yearMonth:""})},className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-500 hover:to-gray-700 text-green-300 border border-green-400 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 font-mono text-sm",children:[c.jsxDEV(y,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1407,columnNumber:15},void 0),c.jsxDEV("span",{className:"hidden sm:inline",children:"重置筛选"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1408,columnNumber:15},void 0),c.jsxDEV("span",{className:"sm:hidden",children:"重置"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1409,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1403,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1388,columnNumber:11},void 0),!se&&c.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:[c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"年月"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1416,columnNumber:15},void 0),c.jsxDEV("input",{type:"month",value:Ne.yearMonth,onChange:e=>xe(i(a({},Ne),{yearMonth:e.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1419,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1415,columnNumber:13},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"开始日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1428,columnNumber:15},void 0),c.jsxDEV("input",{type:"date",value:Ne.startDate,onChange:e=>xe(i(a({},Ne),{startDate:e.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1431,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1427,columnNumber:13},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"结束日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1440,columnNumber:15},void 0),c.jsxDEV("input",{type:"date",value:Ne.endDate,onChange:e=>xe(i(a({},Ne),{endDate:e.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1443,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1439,columnNumber:13},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1452,columnNumber:15},void 0),c.jsxDEV("select",{value:Ne.userId,onChange:e=>xe(i(a({},Ne),{userId:e.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"",children:"全部员工"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1460,columnNumber:17},void 0),ye.map(e=>c.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1462,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1455,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1451,columnNumber:13},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"状态"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1468,columnNumber:15},void 0),c.jsxDEV("select",{value:Ne.status,onChange:e=>xe(i(a({},Ne),{status:e.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"",children:"全部状态"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1476,columnNumber:17},void 0),c.jsxDEV("option",{value:"pending",children:"待班长审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1477,columnNumber:17},void 0),c.jsxDEV("option",{value:"approved",children:"待段长审核"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1478,columnNumber:17},void 0),c.jsxDEV("option",{value:"section_chief_approved",children:"已通过"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1479,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1471,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1467,columnNumber:13},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1484,columnNumber:15},void 0),c.jsxDEV("select",{value:Ne.productionLine,onChange:e=>xe(i(a({},Ne),{productionLine:e.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"",children:"全部生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1492,columnNumber:17},void 0),be.map(e=>c.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1494,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1487,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1483,columnNumber:13},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1500,columnNumber:15},void 0),c.jsxDEV("select",{value:Ne.workType,onChange:e=>xe(i(a({},Ne),{workType:e.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"",children:"全部工时类型"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1508,columnNumber:17},void 0),we.map(e=>c.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1510,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1503,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1499,columnNumber:13},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1516,columnNumber:15},void 0),c.jsxDEV("select",{value:Ne.productName,onChange:e=>xe(i(a({},Ne),{productName:e.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"",children:"全部产品"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1524,columnNumber:17},void 0),ke.map(e=>c.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1526,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1519,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1515,columnNumber:13},void 0),c.jsxDEV("div",{children:[c.jsxDEV("label",{className:"block text-green-300 text-sm font-medium mb-2 font-mono",children:"产品工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1532,columnNumber:15},void 0),c.jsxDEV("select",{value:Ne.productProcess,onChange:e=>xe(i(a({},Ne),{productProcess:e.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-300 font-mono focus:outline-none focus:border-green-400",children:[c.jsxDEV("option",{value:"",children:"全部工序"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1540,columnNumber:17},void 0),Ee.map(e=>c.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1542,columnNumber:19},void 0))]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1535,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1531,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1414,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1387,columnNumber:9},void 0),c.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg overflow-hidden",children:[c.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg overflow-hidden",children:[c.jsxDEV("div",{className:"bg-gray-800 border-b border-green-600 p-4",children:c.jsxDEV("div",{className:"flex items-center justify-between",children:[c.jsxDEV("h3",{className:"text-lg font-bold text-green-400 font-mono flex items-center gap-2",children:[c.jsxDEV(k,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1559,columnNumber:19},void 0),"统计分析"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1558,columnNumber:17},void 0),c.jsxDEV("div",{className:"flex items-center gap-4",children:c.jsxDEV("button",{onClick:()=>l(void 0,null,function*(){const e=yield u(()=>import("./xlsx-DfDjAMCE.js"),[]),t=Ue().map(e=>{var t,s;const m=g.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId}),n=Be(m),r=J.workDayStats.find(t=>t.userId===e.userId),o=J.duplicateRecords.filter(t=>t.userId===e.userId),a=J.priceIssues.filter(t=>t.userId===e.userId);return{"姓名":e.userName,"总额":e.totalAmount.toFixed(2),"天数":(null==r?void 0:r.actualWorkDays)||e.workDays,"日平均":e.avgDailyAmount.toFixed(2),"生产工时金额":(null==(t=n.productionTotal)?void 0:t.toFixed(2))||"0.00","非生产工时金额":(null==(s=n.nonProductionTotal)?void 0:s.toFixed(2))||"0.00","重复记录数":o.length,"单价问题数":a.length,"异常总数":o.length+a.length}}),s=g.flatMap(e=>e.items.map(t=>{var s,m,n,r,o,l,u;const c=Ke(e,"supervisor"),d=Ke(e,"section_chief");return{"工作日期":Fe(e.work_date),"员工姓名":(null==(s=e.user)?void 0:s.name)||"未知","班次":e.shift_type||"白班","生产线":(null==(m=t.processes)?void 0:m.production_line)||"未知","生产类别":(null==(n=t.processes)?void 0:n.production_category)||"未知","产品名称":(null==(r=t.processes)?void 0:r.product_name)||"未知","工序名称":(null==(o=t.processes)?void 0:o.product_process)||"未知","数量":t.quantity,"单价":null!=t.unit_price?t.unit_price.toFixed(3):"未定义","金额":t.amount.toFixed(2),"状态":Pe(e.status),"班长":c?c.name:(null==(l=e.supervisor)?void 0:l.name)||"未分配","段长":d?d.name:(null==(u=e.section_chief)?void 0:u.name)||"未分配","修改历史":Te(i(a({},t),{record:e})),"创建时间":(h=e.created_at,new Date(h).toLocaleString("zh-CN"))};var h})),m=(()=>{const e=new Map;return g.forEach(t=>{t.items.forEach(t=>{var s,m,n,r,o,a,i,l;const u=`${(null==(s=t.processes)?void 0:s.production_line)||"未知"}-${(null==(m=t.processes)?void 0:m.production_category)||"未知"}-${(null==(n=t.processes)?void 0:n.product_name)||"未知"}-${(null==(r=t.processes)?void 0:r.product_process)||"未知"}`;e.has(u)||e.set(u,{productionLine:(null==(o=t.processes)?void 0:o.production_line)||"未知",productionCategory:(null==(a=t.processes)?void 0:a.production_category)||"未知",productName:(null==(i=t.processes)?void 0:i.product_name)||"未知",productProcess:(null==(l=t.processes)?void 0:l.product_process)||"未知",totalQuantity:0,totalAmount:0});const c=e.get(u);c.totalQuantity+=t.quantity,c.totalAmount+=t.amount})}),Array.from(e.values()).sort((e,t)=>e.productionCategory!==t.productionCategory?e.productionCategory.localeCompare(t.productionCategory):t.totalAmount-e.totalAmount).map(e=>({"生产线":e.productionLine,"生产类别":e.productionCategory,"产品名称":e.productName,"工序名称":e.productProcess,"总数量":e.totalQuantity.toFixed(1),"总金额":e.totalAmount.toFixed(2)}))})(),n=[];Ue().forEach(e=>{const t=g.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId}).flatMap(e=>e.items.map(t=>i(a({},t),{workDate:e.work_date}))),s=new Map;t.forEach(e=>{var t,m,n,r,o,a,i,l;const u=`${(null==(t=e.processes)?void 0:t.production_category)||"未知"}-${(null==(m=e.processes)?void 0:m.production_line)||"未知"}-${(null==(n=e.processes)?void 0:n.product_name)||"未知"}-${(null==(r=e.processes)?void 0:r.product_process)||"未知"}`;s.has(u)||s.set(u,{productionCategory:(null==(o=e.processes)?void 0:o.production_category)||"未知",productionLine:(null==(a=e.processes)?void 0:a.production_line)||"未知",productName:(null==(i=e.processes)?void 0:i.product_name)||"未知",productProcess:(null==(l=e.processes)?void 0:l.product_process)||"未知",totalQuantity:0,recordCount:0});const c=s.get(u);c.totalQuantity+=e.quantity,c.recordCount+=1});Array.from(s.values()).forEach(t=>{n.push({"员工姓名":e.userName,"生产类别":t.productionCategory,"生产线":t.productionLine,"产品名称":t.productName,"工序名称":t.productProcess,"数量总计":t.totalQuantity.toFixed(1),"记录条数":t.recordCount})})});const r=e.utils.book_new(),o=e.utils.json_to_sheet(t);o["!cols"]=[{wch:12},{wch:10},{wch:8},{wch:10},{wch:15},{wch:15},{wch:12},{wch:12},{wch:10}];const l=e.utils.decode_range(o["!ref"]||"A1");for(let a=l.s.c;a<=l.e.c;a++){const t=e.utils.encode_cell({r:0,c:a});o[t]&&(o[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"4A5568"}},alignment:{horizontal:"center"}})}e.utils.book_append_sheet(r,o,"工时统计分析");const c=e.utils.json_to_sheet(m);c["!cols"]=[{wch:12},{wch:12},{wch:15},{wch:15},{wch:10},{wch:12}];const d=e.utils.decode_range(c["!ref"]||"A1");for(let a=d.s.c;a<=d.e.c;a++){const t=e.utils.encode_cell({r:0,c:a});c[t]&&(c[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2B6CB0"}},alignment:{horizontal:"center"}})}c["!autofilter"]={ref:c["!ref"]},e.utils.book_append_sheet(r,c,"工时统计分析汇总");const h=e.utils.json_to_sheet(s);h["!cols"]=[{wch:12},{wch:12},{wch:8},{wch:10},{wch:12},{wch:15},{wch:15},{wch:8},{wch:10},{wch:10},{wch:12},{wch:15},{wch:15},{wch:20},{wch:18}];const p=e.utils.decode_range(h["!ref"]||"A1");for(let a=p.s.c;a<=p.e.c;a++){const t=e.utils.encode_cell({r:0,c:a});h[t]&&(h[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2D3748"}},alignment:{horizontal:"center"}})}h["!autofilter"]={ref:h["!ref"]},e.utils.book_append_sheet(r,h,"详细工时记录");const N=e.utils.json_to_sheet(n);N["!cols"]=[{wch:12},{wch:12},{wch:10},{wch:15},{wch:15},{wch:10},{wch:10}];const x=e.utils.decode_range(N["!ref"]||"A1");for(let a=x.s.c;a<=x.e.c;a++){const t=e.utils.encode_cell({r:0,c:a});N[t]&&(N[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"1A202C"}},alignment:{horizontal:"center"}})}N["!autofilter"]={ref:N["!ref"]},e.utils.book_append_sheet(r,N,"数量统计汇总");const y=`工时报告_${(new Date).toISOString().split("T")[0]}.xlsx`;e.writeFile(r,y),T.success("报告导出成功！")}),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded transition-colors font-mono text-sm",children:[c.jsxDEV(j,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1849,columnNumber:21},void 0),"导出报告"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1565,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1562,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1557,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1556,columnNumber:13},void 0),c.jsxDEV("div",{className:"overflow-x-auto",children:c.jsxDEV("table",{className:"w-full",children:[c.jsxDEV("thead",{className:"bg-gray-800 border-b border-green-600",children:c.jsxDEV("tr",{children:[c.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:c.jsxDEV("button",{onClick:()=>Je("userName"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"员工姓名"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1862,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1861,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:c.jsxDEV("button",{onClick:()=>Je("totalAmount"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"总额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1871,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1870,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:c.jsxDEV("button",{onClick:()=>Je("workDays"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"天数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1879,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1878,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:c.jsxDEV("button",{onClick:()=>Je("avgDailyAmount"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"日平均"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1889,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1888,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:c.jsxDEV("button",{onClick:()=>Je("productionTotal"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"生产工时金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1897,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1896,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:c.jsxDEV("button",{onClick:()=>Je("nonProductionTotal"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:"非生产工时金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1905,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1904,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:c.jsxDEV("button",{onClick:()=>Je("duplicateCount"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:["重复记录(",J.duplicateRecords.length,")"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1913,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1912,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:c.jsxDEV("button",{onClick:()=>Je("priceIssueCount"),className:"flex items-center gap-1 hover:text-green-300 transition-colors",children:["单价问题(",J.priceIssues.length,")"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1921,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1920,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-4 py-3 text-left text-green-400 font-mono text-sm",children:"操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1928,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1860,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1859,columnNumber:17},void 0),c.jsxDEV("tbody",{children:Ue().map((e,t)=>{var s,m;J.dailyStats.filter(t=>t.userId===e.userId),J.monthlyStats.filter(t=>t.userId===e.userId),J.workDayStats.find(t=>t.userId===e.userId);const n=J.duplicateRecords.filter(t=>t.userId===e.userId),r=J.priceIssues.filter(t=>t.userId===e.userId),l=g.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId}),u=Be(l),d=n.length>0||r.length>0;return c.jsxDEV(E.Fragment,{children:[c.jsxDEV("tr",{className:"border-b transition-colors "+(d?"border-red-500 bg-red-900 bg-opacity-20 hover:bg-red-900 hover:bg-opacity-30":"border-gray-700 hover:bg-gray-800"),children:[c.jsxDEV("td",{className:"px-4 py-3 text-green-300 font-mono text-sm font-medium",children:e.userName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1956,columnNumber:27},void 0),c.jsxDEV("td",{className:"px-4 py-3 text-green-300 font-mono text-sm font-bold",children:["¥",e.totalAmount.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1960,columnNumber:27},void 0),c.jsxDEV("td",{className:"px-4 py-3 text-green-300 font-mono text-sm",children:e.workDays},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1963,columnNumber:27},void 0),c.jsxDEV("td",{className:"px-4 py-3 text-purple-300 font-mono text-sm",children:["¥",e.avgDailyAmount.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1968,columnNumber:27},void 0),c.jsxDEV("td",{className:"px-4 py-3 text-blue-300 font-mono text-sm",children:["¥",(null==(s=u.productionTotal)?void 0:s.toFixed(2))||"0.00"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1971,columnNumber:27},void 0),c.jsxDEV("td",{className:"px-4 py-3 text-red-300 font-mono text-sm",children:["¥",(null==(m=u.nonProductionTotal)?void 0:m.toFixed(2))||"0.00"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1974,columnNumber:27},void 0),c.jsxDEV("td",{className:"px-4 py-3 font-mono text-sm",children:n.length>0?c.jsxDEV("span",{className:"text-yellow-400 font-bold",children:n.length},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1979,columnNumber:31},void 0):c.jsxDEV("span",{className:"text-green-400",children:"0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1981,columnNumber:31},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1977,columnNumber:27},void 0),c.jsxDEV("td",{className:"px-4 py-3 font-mono text-sm",children:r.length>0?c.jsxDEV("span",{className:"text-red-400 font-bold",children:r.length},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1986,columnNumber:31},void 0):c.jsxDEV("span",{className:"text-green-400",children:"0"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1988,columnNumber:31},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1984,columnNumber:27},void 0),c.jsxDEV("td",{className:"px-4 py-3",children:c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV("button",{onClick:()=>{const t=new Set(X);X.has(e.userId)?t.delete(e.userId):t.add(e.userId),Z(t)},className:"text-blue-400 hover:text-blue-300 transition-colors",title:X.has(e.userId)?"收起详细记录":"展开详细记录",children:X.has(e.userId)?c.jsxDEV(_,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2007,columnNumber:35},void 0):c.jsxDEV(V,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2009,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1993,columnNumber:31},void 0),d&&c.jsxDEV("span",{className:"text-red-400",title:"存在异常数据",children:"⚠"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2013,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1992,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1991,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1949,columnNumber:25},void 0),X.has(e.userId)&&(()=>{const t=g.filter(t=>{var s;return(null==(s=t.user)?void 0:s.id)===e.userId});return 0===t.length||t.every(e=>0===e.items.length)?null:c.jsxDEV("tr",{className:"bg-gray-800 border-b border-gray-600",children:c.jsxDEV("td",{colSpan:11,className:"px-4 py-4",children:c.jsxDEV("div",{className:"bg-gray-700 rounded-lg p-4",children:[c.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:c.jsxDEV("h4",{className:"text-lg font-bold text-green-400 font-mono flex items-center gap-2",children:[c.jsxDEV(R,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2035,columnNumber:37},void 0),e.userName," - 详细工时记录"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2034,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2033,columnNumber:33},void 0),c.jsxDEV("div",{className:"bg-gray-600 rounded-lg overflow-hidden",children:c.jsxDEV("div",{className:"overflow-x-auto",children:c.jsxDEV("table",{className:"w-full",children:[c.jsxDEV("thead",{className:"bg-gray-700",children:c.jsxDEV("tr",{children:[c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"工作日期"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2046,columnNumber:43},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"班次"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2047,columnNumber:43},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"日工时金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2048,columnNumber:43},void 0),ee&&c.jsxDEV(c.Fragment,{children:[c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2051,columnNumber:47},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产类别"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2052,columnNumber:47},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2053,columnNumber:47},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"工序名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2054,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2050,columnNumber:45},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2057,columnNumber:43},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"单价"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2058,columnNumber:43},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2059,columnNumber:43},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"状态"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2060,columnNumber:43},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"班长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2061,columnNumber:43},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"段长"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2062,columnNumber:43},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"修改历史"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2063,columnNumber:43},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2064,columnNumber:43},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2045,columnNumber:41},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2044,columnNumber:39},void 0),c.jsxDEV("tbody",{children:(()=>{const e=t.reduce((e,t)=>{const s=t.work_date;return e[s]||(e[s]=[]),e[s].push(t),e},{});return Object.keys(e).sort((e,t)=>new Date(t).getTime()-new Date(e).getTime()).flatMap(t=>{const s=e[t],m=s.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.amount,0),0),l=s.flatMap(e=>e.items.map(t=>i(a({},t),{record:e})));return l.map((e,s)=>{var a,i,u,d,g;const p=n.some(t=>t.workDate===e.record.work_date&&t.processId===e.process_id),N=r.some(t=>t.workDate===e.record.work_date&&t.processId===e.process_id),x=p||N;return c.jsxDEV("tr",{className:"border-b border-gray-600 hover:bg-gray-600 transition-colors "+(x?"bg-red-900 bg-opacity-20":""),children:[0===s?c.jsxDEV(c.Fragment,{children:[c.jsxDEV("td",{className:"px-3 py-2 text-yellow-400 font-mono text-xs font-bold border-r border-gray-500",rowSpan:l.length,children:c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV(C,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2122,columnNumber:57},void 0),Fe(t)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2121,columnNumber:55},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2117,columnNumber:53},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-400 font-mono text-xs border-r border-gray-500",rowSpan:l.length,children:e.record.shift_type||"白班"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2126,columnNumber:53},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-400 font-mono text-xs font-bold border-r border-gray-500",rowSpan:l.length,children:["¥",m.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2132,columnNumber:53},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2116,columnNumber:51},void 0):null,ee&&c.jsxDEV(c.Fragment,{children:[c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(null==(a=e.processes)?void 0:a.production_line)||"未知"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2144,columnNumber:53},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:c.jsxDEV("span",{className:"px-2 py-1 rounded text-xs font-bold "+("生产工时"===(null==(i=e.processes)?void 0:i.production_category)?"bg-blue-900 text-blue-300":"bg-red-900 text-red-300"),children:(null==(u=e.processes)?void 0:u.production_category)||"未知"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2148,columnNumber:55},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2147,columnNumber:53},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(null==(d=e.processes)?void 0:d.product_name)||"未知"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2156,columnNumber:53},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(null==(g=e.processes)?void 0:g.product_process)||"未知"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2159,columnNumber:53},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2143,columnNumber:51},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs font-bold",children:(null==ne?void 0:ne.recordId)===e.record.id&&(null==ne?void 0:ne.itemId)===e.id?c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV("input",{type:"number",value:oe,onChange:e=>{e.stopPropagation(),ae(Number(e.target.value))},onClick:e=>e.stopPropagation(),onWheel:e=>e.preventDefault(),className:"w-16 px-2 py-1 bg-gray-700 border border-gray-600 rounded text-green-300 font-mono text-xs [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",min:"0",step:"0.1"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2167,columnNumber:55},void 0),c.jsxDEV("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),(()=>{if(!ne)return void T.error("请先选择要编辑的项目");if(oe<0)return void T.error("数量不能为负数");const e={recordId:ne.recordId,itemId:ne.itemId,newQuantity:oe};he(e),le(!0)})()},className:"p-1 text-green-400 hover:text-green-300 transition-colors",title:"确认修改",children:c.jsxDEV(A,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2189,columnNumber:57},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2180,columnNumber:55},void 0),c.jsxDEV("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),re(null),ae(0)},className:"p-1 text-red-400 hover:text-red-300 transition-colors",title:"取消修改",children:c.jsxDEV(h,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2200,columnNumber:57},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2191,columnNumber:55},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2166,columnNumber:53},void 0):c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV("span",{children:e.quantity},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2205,columnNumber:55},void 0),c.jsxDEV("button",{onClick:t=>{var s,m,n;t.preventDefault(),t.stopPropagation(),s=e.record.id,m=e.id,n=e.quantity,re({recordId:s,itemId:m}),ae(n)},className:"p-1 text-blue-400 hover:text-blue-300 transition-colors",title:"编辑数量",children:c.jsxDEV(I,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2215,columnNumber:57},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2206,columnNumber:55},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2204,columnNumber:53},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2164,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:[null!=e.unit_price?`¥${e.unit_price.toFixed(3)}`:"未定义",N&&c.jsxDEV("span",{className:"ml-1 text-red-400",title:"单价异常",children:"⚠"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2223,columnNumber:53},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2220,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs font-bold",children:["¥",e.amount.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2228,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:c.jsxDEV("div",{className:"flex items-center gap-1",children:[$e(e.record.status),p&&c.jsxDEV("span",{className:"text-yellow-400",title:"重复记录",children:"⚠"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2235,columnNumber:55},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2232,columnNumber:51},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2231,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(()=>{var t;const s=Ke(e.record,"supervisor"),m=(null==(t=e.record.supervisor)?void 0:t.name)||"未分配";return s?c.jsxDEV("div",{className:"flex flex-col",children:[c.jsxDEV("div",{children:s.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2248,columnNumber:59},void 0),c.jsxDEV("div",{className:"text-xs text-gray-400",children:s.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2249,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2247,columnNumber:57},void 0):m})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2241,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:(()=>{var t;const s=Ke(e.record,"section_chief"),m=(null==(t=e.record.section_chief)?void 0:t.name)||"未分配";return s?c.jsxDEV("div",{className:"flex flex-col",children:[c.jsxDEV("div",{children:s.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2263,columnNumber:59},void 0),c.jsxDEV("div",{className:"text-xs text-gray-400",children:s.date},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2264,columnNumber:59},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2262,columnNumber:57},void 0):m})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2256,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:Qe(e)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2271,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:c.jsxDEV("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),((e,t)=>{var s,m;const n=o.find(t=>t.id===e),r=null==(s=null==n?void 0:n.items)?void 0:s.find(e=>e.id===t),a=(null==(m=null==n?void 0:n.user)?void 0:m.name)||"未知员工",i=(null==n?void 0:n.work_date)?Fe(n.work_date):"未知日期",l=r?qe(r):"未知项目";pe({recordId:e,itemId:t,employeeName:a,workDate:i,workProject:l}),ce(!0)})(e.record.id,e.id)},className:"p-1 text-red-400 hover:text-red-300 transition-colors",title:"删除工时项目",children:c.jsxDEV(S,{className:"w-3 h-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2284,columnNumber:53},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2275,columnNumber:51},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2274,columnNumber:49},void 0)]},`${t}-${e.record.id}-${s}`,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2108,columnNumber:47},void 0)})})})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2067,columnNumber:39},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2043,columnNumber:37},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2042,columnNumber:35},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2041,columnNumber:33},void 0),c.jsxDEV("div",{className:"mt-6 bg-gray-600 rounded-lg p-4",children:[c.jsxDEV("h5",{className:"text-md font-bold text-green-400 font-mono mb-4 flex items-center gap-2",children:[c.jsxDEV(x,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2300,columnNumber:37},void 0),e.userName," - 数量统计汇总"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2299,columnNumber:35},void 0),(()=>{const e=t.flatMap(e=>e.items.map(t=>i(a({},t),{workDate:e.work_date}))),s=new Map;e.forEach(e=>{var t,m,n,r,o,a,i,l;const u=`${(null==(t=e.processes)?void 0:t.production_category)||"未知"}-${(null==(m=e.processes)?void 0:m.production_line)||"未知"}-${(null==(n=e.processes)?void 0:n.product_name)||"未知"}-${(null==(r=e.processes)?void 0:r.product_process)||"未知"}`;s.has(u)||s.set(u,{productionCategory:(null==(o=e.processes)?void 0:o.production_category)||"未知",productionLine:(null==(a=e.processes)?void 0:a.production_line)||"未知",productName:(null==(i=e.processes)?void 0:i.product_name)||"未知",productProcess:(null==(l=e.processes)?void 0:l.product_process)||"未知",totalQuantity:0,recordCount:0});const c=s.get(u);c.totalQuantity+=e.quantity,c.recordCount+=1});const m=Array.from(s.values()).sort((e,t)=>e.productionCategory!==t.productionCategory?e.productionCategory.localeCompare(t.productionCategory):t.totalQuantity-e.totalQuantity);return 0===m.length?c.jsxDEV("div",{className:"text-center py-4 text-gray-400 font-mono text-sm",children:"暂无统计数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2345,columnNumber:41},void 0):c.jsxDEV("div",{className:"overflow-x-auto",children:c.jsxDEV("table",{className:"w-full",children:[c.jsxDEV("thead",{className:"bg-gray-700",children:c.jsxDEV("tr",{children:[c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产类别"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2356,columnNumber:47},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2357,columnNumber:47},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2358,columnNumber:47},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"工序名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2359,columnNumber:47},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"数量总计"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2360,columnNumber:47},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"记录条数"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2361,columnNumber:47},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2355,columnNumber:45},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2354,columnNumber:43},void 0),c.jsxDEV("tbody",{children:m.map((e,t)=>c.jsxDEV("tr",{className:"border-b border-gray-600 hover:bg-gray-600 transition-colors",children:[c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:c.jsxDEV("span",{className:"px-2 py-1 rounded text-xs font-bold "+("生产工时"===e.productionCategory?"bg-blue-900 text-blue-300":"bg-red-900 text-red-300"),children:e.productionCategory},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2368,columnNumber:51},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2367,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productionLine},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2376,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2379,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productProcess},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2382,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-yellow-400 font-mono text-xs font-bold",children:e.totalQuantity.toFixed(1)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2385,columnNumber:49},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-blue-400 font-mono text-xs",children:e.recordCount},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2388,columnNumber:49},void 0)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2366,columnNumber:47},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2364,columnNumber:43},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2353,columnNumber:41},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2352,columnNumber:39},void 0)})()]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2298,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2032,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2031,columnNumber:31},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2030,columnNumber:29},void 0)})()]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1948,columnNumber:23},void 0)})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1931,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1858,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1857,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1554,columnNumber:11},void 0),J.userStats.length>0&&c.jsxDEV("div",{className:"mt-6 bg-gray-900 rounded-lg border border-green-400 overflow-hidden",children:[c.jsxDEV("div",{className:"bg-gray-800 px-4 py-3 border-b border-gray-600",children:c.jsxDEV("h3",{className:"text-lg font-bold text-green-400 font-mono flex items-center gap-2",children:[c.jsxDEV(x,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2420,columnNumber:19},void 0),"汇总分析"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2419,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2418,columnNumber:15},void 0),c.jsxDEV("div",{className:"p-4",children:(()=>{const e=new Map;g.forEach(t=>{t.items.forEach(t=>{var s,m,n,r,o,a,i,l;const u=`${(null==(s=t.processes)?void 0:s.production_line)||"未知"}-${(null==(m=t.processes)?void 0:m.production_category)||"未知"}-${(null==(n=t.processes)?void 0:n.product_name)||"未知"}-${(null==(r=t.processes)?void 0:r.product_process)||"未知"}`;e.has(u)||e.set(u,{productionLine:(null==(o=t.processes)?void 0:o.production_line)||"未知",productionCategory:(null==(a=t.processes)?void 0:a.production_category)||"未知",productName:(null==(i=t.processes)?void 0:i.product_name)||"未知",productProcess:(null==(l=t.processes)?void 0:l.product_process)||"未知",totalQuantity:0,totalAmount:0});const c=e.get(u);c.totalQuantity+=t.quantity,c.totalAmount+=t.amount})});const t=Array.from(e.values()).sort((e,t)=>e.productionCategory!==t.productionCategory?e.productionCategory.localeCompare(t.productionCategory):t.totalAmount-e.totalAmount);return 0===t.length?c.jsxDEV("div",{className:"text-center py-4 text-gray-400 font-mono text-sm",children:"暂无汇总数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2461,columnNumber:23},void 0):c.jsxDEV("div",{className:"overflow-x-auto",children:c.jsxDEV("table",{className:"w-full",children:[c.jsxDEV("thead",{className:"bg-gray-700",children:c.jsxDEV("tr",{children:[c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产线"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2472,columnNumber:29},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"生产类别"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2473,columnNumber:29},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"产品名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2474,columnNumber:29},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"工序名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2475,columnNumber:29},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"总数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2476,columnNumber:29},void 0),c.jsxDEV("th",{className:"px-3 py-2 text-left text-green-400 font-mono text-xs",children:"总金额"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2477,columnNumber:29},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2471,columnNumber:27},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2470,columnNumber:25},void 0),c.jsxDEV("tbody",{children:t.map((e,t)=>c.jsxDEV("tr",{className:"border-b border-gray-600 hover:bg-gray-600 transition-colors",children:[c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productionLine},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2483,columnNumber:31},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:c.jsxDEV("span",{className:"px-2 py-1 rounded text-xs font-bold "+("生产工时"===e.productionCategory?"bg-blue-900 text-blue-300":"bg-red-900 text-red-300"),children:e.productionCategory},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2487,columnNumber:33},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2486,columnNumber:31},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productName},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2495,columnNumber:31},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs",children:e.productProcess},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2498,columnNumber:31},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-yellow-400 font-mono text-xs font-bold",children:e.totalQuantity.toFixed(1)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2501,columnNumber:31},void 0),c.jsxDEV("td",{className:"px-3 py-2 text-green-300 font-mono text-xs font-bold",children:["¥",e.totalAmount.toFixed(2)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2504,columnNumber:31},void 0)]},t,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2482,columnNumber:29},void 0))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2480,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2469,columnNumber:23},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2468,columnNumber:21},void 0)})()},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2425,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2417,columnNumber:13},void 0),0===J.userStats.length&&c.jsxDEV("div",{className:"text-center py-12",children:[c.jsxDEV("div",{className:"text-blue-600 mb-4",children:c.jsxDEV(F,{className:"h-16 w-16 mx-auto"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2522,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2521,columnNumber:15},void 0),c.jsxDEV("h3",{className:"text-lg font-medium text-blue-400 mb-2 font-mono",children:"暂无统计数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2524,columnNumber:15},void 0),c.jsxDEV("p",{className:"text-blue-600 font-mono",children:"请调整筛选条件或刷新数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2525,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2520,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1552,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1383,columnNumber:7},void 0),c.jsxDEV(M,{isOpen:ie,currentQuantity:ne?null==(s=null==(t=null==(e=o.find(e=>e.id===ne.recordId))?void 0:e.items)?void 0:t.find(e=>e.id===ne.itemId))?void 0:s.quantity:void 0,newQuantity:null==de?void 0:de.newQuantity,onConfirm:()=>l(void 0,null,function*(){if(de)try{const e=o.find(e=>e.id===de.recordId),t=null==e?void 0:e.items.find(e=>e.id===de.itemId),s=(null==t?void 0:t.unit_price)||0,n=de.newQuantity*s,{error:r}=(null==t||t.quantity,null==t||t.amount,yield q.rpc("update_timesheet_item_with_user",{item_id:de.itemId,new_quantity:de.newQuantity,new_amount:n,modifier_id:(null==m?void 0:m.id)||null,modifier_name:(null==m?void 0:m.name)||"未知用户"}));if(r)throw r;T.success("数量修改成功"),yield Re(),re(null),ae(0),he(null),le(!1)}catch(e){console.error("修改数量失败:",e),T.error("修改数量失败")}}),onCancel:()=>{le(!1),he(null)}},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2532,columnNumber:7},void 0),c.jsxDEV(Q,{isOpen:ue,employeeName:null==ge?void 0:ge.employeeName,workDate:null==ge?void 0:ge.workDate,workProject:null==ge?void 0:ge.workProject,onConfirm:()=>l(void 0,null,function*(){if(ge)try{const{data:e,error:t}=yield q.from("timesheet_record_items").select("id").eq("timesheet_record_id",ge.recordId);if(t)throw t;const{error:s}=yield q.from("timesheet_record_items").delete().eq("id",ge.itemId);if(s)throw s;if(e&&1===e.length){const{error:e}=yield q.from("timesheet_records").delete().eq("id",ge.recordId);e&&console.error("删除空的工时记录失败:",e)}T.success("工时项目删除成功"),yield Re(),pe(null),ce(!1)}catch(e){console.error("删除工时项目失败:",e),T.error("删除工时项目失败")}}),onCancel:()=>{ce(!1),pe(null)}},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:2544,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/Reports.tsx",lineNumber:1351,columnNumber:5},void 0)};export{z as default};
