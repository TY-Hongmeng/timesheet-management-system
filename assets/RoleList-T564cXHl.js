var e=Object.defineProperty,m=Object.defineProperties,s=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(m,s,t)=>s in m?e(m,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[s]=t,o=(e,m)=>{for(var s in m||(m={}))n.call(m,s)&&a(e,s,m[s]);if(t)for(var s of t(m))r.call(m,s)&&a(e,s,m[s]);return e},i=(e,t)=>m(e,s(t)),l=(e,m,s)=>new Promise((t,n)=>{var r=e=>{try{o(s.next(e))}catch(m){n(m)}},a=e=>{try{o(s.throw(e))}catch(m){n(m)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,a);o((s=s.apply(e,m)).next())});import{r as u,j as c,J as d,f as h,s as g,l as N,G as x,D as b,x as y,O as v,T as p,X as f}from"./react-core-CmOG7fiH.js";import{u as w,h as j,s as k,P as E}from"./index-BABFRRsr.js";import"./vendor-Dj0T90Ik.js";import"./supabase-k270UWii.js";import"./ui-BpXc_XmY.js";const D=()=>{const{user:e}=w(),[m,s]=u.useState([]),[t,n]=u.useState(!0),[r,a]=u.useState(""),[D,L]=u.useState({show:!1,role:null}),[R,V]=u.useState(!1);u.useEffect(()=>{var m;if(document.title="权限管理 - 工时管理系统",e&&(null==(m=e.role)?void 0:m.permissions)){if(!j(e,E.ROLE_MANAGE))return a("您没有权限访问角色管理页面"),void n(!1);_()}},[e]);const _=()=>l(void 0,null,function*(){try{const{data:e,error:m}=yield k.from("user_roles").select("*").order("created_at",{ascending:!1});if(m)throw m;const{data:t,error:n}=yield k.from("users").select("role_id");if(n){console.error("获取用户统计失败:",n);const m=(e||[]).map(e=>i(o({},e),{user_count:0}));return void s(m)}const r=new Map;null==t||t.forEach(e=>{const m=r.get(e.role_id)||0;r.set(e.role_id,m+1)});const a=(e||[]).map(e=>i(o({},e),{user_count:r.get(e.id)||0}));s(a)}catch(e){console.error("获取角色列表失败:",e),a("获取角色列表失败，请重试")}finally{n(!1)}}),O=()=>{L({show:!1,role:null})};return t?c.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:c.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:131,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:130,columnNumber:7},void 0):r?c.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:c.jsxDEV("div",{className:"text-center",children:[c.jsxDEV(d,{className:"w-16 h-16 text-red-400 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:142,columnNumber:11},void 0),c.jsxDEV("div",{className:"text-red-400 text-xl font-mono mb-4",children:r},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:143,columnNumber:11},void 0),c.jsxDEV(h,{to:"/dashboard",className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:"返回首页"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:144,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:141,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:140,columnNumber:7},void 0):c.jsxDEV("div",{className:"min-h-screen bg-black text-green-400 p-6",children:c.jsxDEV("div",{className:"max-w-7xl mx-auto",children:[c.jsxDEV("div",{className:"mb-8",children:[c.jsxDEV("div",{className:"flex justify-between items-center mb-4",children:[c.jsxDEV("div",{className:"flex items-center",children:[c.jsxDEV(g,{className:"w-8 h-8 text-green-400 mr-3"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:162,columnNumber:15},void 0),c.jsxDEV("h1",{className:"text-4xl font-bold text-green-400 font-mono",children:"权限管理"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:163,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:161,columnNumber:13},void 0),c.jsxDEV(h,{to:"/dashboard",className:"flex items-center gap-2 px-3 py-2 sm:px-4 sm:py-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-green-300 hover:text-green-200 rounded-lg font-mono transition-all duration-200 shadow-md hover:shadow-lg border border-gray-600 hover:border-green-500/50",children:[c.jsxDEV(N,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:169,columnNumber:15},void 0),c.jsxDEV("span",{className:"hidden sm:inline",children:"返回控制台"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:170,columnNumber:15},void 0),c.jsxDEV("span",{className:"sm:hidden",children:"返回"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:171,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:165,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:160,columnNumber:11},void 0),c.jsxDEV("div",{className:"h-1 bg-gradient-to-r from-transparent via-green-400 to-transparent"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:174,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:159,columnNumber:9},void 0),c.jsxDEV("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[c.jsxDEV("div",{className:"flex-1",children:c.jsxDEV("div",{className:"relative",children:[c.jsxDEV(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-green-400/60"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:181,columnNumber:15},void 0),c.jsxDEV("input",{type:"text",placeholder:"搜索角色名称...",className:"w-full bg-black border border-green-400/30 rounded px-10 py-2 text-green-400 placeholder-green-400/60 focus:outline-none focus:border-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:182,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:180,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:179,columnNumber:11},void 0),c.jsxDEV(h,{to:"/role-permissions/create",className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:[c.jsxDEV(b,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:193,columnNumber:13},void 0),"创建角色"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:189,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:178,columnNumber:9},void 0),c.jsxDEV("div",{className:"bg-gray-900 border border-green-400 rounded-lg overflow-hidden",children:0===m.length?c.jsxDEV("div",{className:"p-8 text-center",children:[c.jsxDEV(g,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:205,columnNumber:15},void 0),c.jsxDEV("p",{className:"text-gray-400 font-mono",children:"暂无角色数据"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:206,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:204,columnNumber:13},void 0):c.jsxDEV("div",{className:"overflow-x-auto",children:c.jsxDEV("table",{className:"w-full",children:[c.jsxDEV("thead",{className:"bg-green-900/30",children:c.jsxDEV("tr",{children:[c.jsxDEV("th",{className:"px-6 py-3 text-left text-sm font-medium text-green-400 uppercase tracking-wider font-mono",children:"角色名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:213,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-6 py-3 text-left text-sm font-medium text-green-400 uppercase tracking-wider font-mono",children:"用户数量"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:216,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-6 py-3 text-left text-sm font-medium text-green-400 uppercase tracking-wider font-mono",children:"创建时间"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:219,columnNumber:21},void 0),c.jsxDEV("th",{className:"px-6 py-3 text-left text-sm font-medium text-green-400 uppercase tracking-wider font-mono",children:"操作"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:222,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:212,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:211,columnNumber:17},void 0),c.jsxDEV("tbody",{className:"divide-y divide-green-800",children:m.map(e=>{return c.jsxDEV("tr",{className:"hover:bg-green-900/10 transition-colors",children:[c.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV(g,{className:"w-4 h-4 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:232,columnNumber:27},void 0),c.jsxDEV("span",{className:"text-green-400 font-mono font-medium",children:e.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:233,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:231,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:230,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:c.jsxDEV("div",{className:"flex items-center gap-1",children:[c.jsxDEV(y,{className:"w-4 h-4 text-green-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:238,columnNumber:27},void 0),c.jsxDEV("span",{className:"text-green-400 font-mono",children:e.user_count},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:239,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:237,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:236,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:c.jsxDEV("span",{className:"text-green-300 font-mono text-sm",children:(m=e.created_at,new Date(m).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:243,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:242,columnNumber:23},void 0),c.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:c.jsxDEV("div",{className:"flex items-center gap-2",children:[c.jsxDEV(h,{to:`/role-permissions/edit/${e.id}`,className:"p-2 text-blue-400 hover:text-blue-300 hover:bg-gray-700 rounded transition-colors",title:"编辑角色",children:c.jsxDEV(v,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:254,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:249,columnNumber:27},void 0),c.jsxDEV("button",{onClick:()=>(e=>{L({show:!0,role:e})})(e),className:"p-2 text-red-400 hover:text-red-300 hover:bg-gray-700 rounded transition-colors",title:"删除角色",children:c.jsxDEV(p,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:261,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:256,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:248,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:247,columnNumber:23},void 0)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:229,columnNumber:21},void 0);var m})},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:227,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:210,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:209,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:201,columnNumber:9},void 0),D.show&&D.role&&c.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxDEV("div",{className:"bg-gray-900 border border-red-400 rounded-lg p-6 max-w-md w-full mx-4",children:[c.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[c.jsxDEV("h3",{className:"text-xl font-bold text-red-400 font-mono",children:"确认删除角色"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:278,columnNumber:17},void 0),c.jsxDEV("button",{onClick:O,className:"text-gray-400 hover:text-gray-300 transition-colors",children:c.jsxDEV(f,{className:"w-5 h-5"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:283,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:279,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:277,columnNumber:15},void 0),c.jsxDEV("div",{className:"mb-6",children:[c.jsxDEV("p",{className:"text-green-300 font-mono mb-2",children:["您确定要删除角色 ",c.jsxDEV("span",{className:"text-red-400 font-bold",children:['"',D.role.name,'"']},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:289,columnNumber:28},void 0)," 吗？"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:288,columnNumber:17},void 0),c.jsxDEV("div",{className:"bg-gray-800 border border-gray-600 rounded p-3 mb-3",children:c.jsxDEV("p",{className:"text-green-300 font-mono text-sm",children:["使用用户数：",D.role.user_count]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:292,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:291,columnNumber:17},void 0),D.role.user_count>0&&c.jsxDEV("div",{className:"bg-red-900 border border-red-400 rounded p-3 mb-3",children:c.jsxDEV("p",{className:"text-red-300 font-mono text-sm",children:["⚠️ 该角色正被 ",D.role.user_count," 个用户使用，无法删除！"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:298,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:297,columnNumber:19},void 0),c.jsxDEV("p",{className:"text-gray-400 font-mono text-sm",children:"此操作不可撤销，请谨慎操作。"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:303,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:287,columnNumber:15},void 0),c.jsxDEV("div",{className:"flex gap-3 justify-end",children:[c.jsxDEV("button",{onClick:O,className:"px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white font-bold rounded transition-colors font-mono",disabled:R,children:"取消"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:309,columnNumber:17},void 0),c.jsxDEV("button",{onClick:()=>l(void 0,null,function*(){if(!D.role)return;const e=D.role;if(e.user_count>0)return a(`无法删除角色 "${e.name}"，该角色正被 ${e.user_count} 个用户使用`),void L({show:!1,role:null});V(!0);try{const{error:m}=yield k.from("user_roles").delete().eq("id",e.id);if(m)throw m;yield _(),L({show:!1,role:null}),a("")}catch(m){a("删除角色失败，请重试")}finally{V(!1)}}),disabled:R||D.role.user_count>0,className:"px-4 py-2 bg-red-600 hover:bg-red-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold rounded transition-colors font-mono",children:R?"删除中...":"确认删除"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:316,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:308,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:276,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:275,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:157,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleList.tsx",lineNumber:156,columnNumber:5},void 0)};export{D as default};
