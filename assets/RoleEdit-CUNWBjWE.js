var e=Object.defineProperty,m=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(m,t,s)=>t in m?e(m,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[t]=s,a=(e,m)=>{for(var t in m||(m={}))n.call(m,t)&&i(e,t,m[t]);if(s)for(var t of s(m))r.call(m,t)&&i(e,t,m[t]);return e},o=(e,s)=>m(e,t(s)),l=(e,m,t)=>new Promise((s,n)=>{var r=e=>{try{a(t.next(e))}catch(m){n(m)}},i=e=>{try{a(t.throw(e))}catch(m){n(m)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,i);a((t=t.apply(e,m)).next())});import{u as h,h as c,j as u,s as d,S as g,D as N,P as b}from"./index-BXUZDvBH.js";import{r as x}from"./vendor-J95WCW4x.js";import{c as y,a as f,L as p}from"./router-BSPfhsUn.js";import{q as E,e as v,g as w,p as j,X as k}from"./ui-CHDxits7.js";function D(){const{id:e}=y(),[m,t]=x.useState(null),[s,n]=x.useState({name:"",permissions:[]}),[r,i]=x.useState(!0),[D,R]=x.useState(!1),[V,O]=x.useState(""),{user:S,loading:P}=h(),q=f();if(x.useEffect(()=>{var e;if(P||S)return S&&(null==(e=S.role)?void 0:e.permissions)&&!c(S,b.ROLE_MANAGE)?(O("您没有权限访问角色管理功能"),void i(!1)):void 0;q("/login")},[S,P,q]),P)return u.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:u.jsxDEV("div",{className:"text-center",children:[u.jsxDEV("div",{className:"text-green-400 text-2xl font-mono mb-4",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:54,columnNumber:11},this),u.jsxDEV("div",{className:"text-green-600 font-mono",children:"正在验证用户身份"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:55,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:53,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:52,columnNumber:7},this);x.useEffect(()=>{var m;S&&(null==(m=S.role)?void 0:m.permissions)&&c(S,b.ROLE_MANAGE)&&e&&_()},[S,e]);const _=()=>l(this,null,function*(){if(e)try{const{data:m,error:s}=yield d.from("user_roles").select("*").eq("id",e).single();if(s)throw s;if(!m)throw new Error("角色不存在");t(m),n({name:m.name,permissions:m.permissions||[]})}catch(m){O(m.message||"获取角色信息失败")}finally{i(!1)}});return r?u.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:u.jsxDEV("div",{className:"text-green-400 text-xl animate-pulse font-mono",children:"加载中..."},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:158,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:157,columnNumber:7},this):V?u.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:u.jsxDEV("div",{className:"text-center",children:[u.jsxDEV(E,{className:"w-16 h-16 text-red-400 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:169,columnNumber:11},this),u.jsxDEV("div",{className:"text-red-400 text-xl font-mono mb-4",children:V},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:170,columnNumber:11},this),u.jsxDEV(p,{to:"/role-permissions",className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:"返回角色列表"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:171,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:168,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:167,columnNumber:7},this):m?u.jsxDEV("div",{className:"min-h-screen bg-black text-green-300 p-4 sm:p-6",children:u.jsxDEV("div",{className:"max-w-4xl mx-auto",children:[u.jsxDEV("div",{className:"mb-6",children:u.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[u.jsxDEV("h1",{className:"text-xl sm:text-2xl font-bold text-green-400 font-mono truncate",children:["编辑角色 - ",m.name]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:203,columnNumber:13},this),u.jsxDEV(p,{to:"/role-permissions",className:"flex items-center text-green-400 hover:text-green-300 transition-colors flex-shrink-0 font-mono",children:[u.jsxDEV(v,{className:"h-5 w-5 mr-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:210,columnNumber:15},this),"返回"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:206,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:202,columnNumber:11},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:201,columnNumber:9},this),V&&u.jsxDEV("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-400/60 rounded text-red-200 text-sm font-mono",children:V},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:217,columnNumber:11},this),u.jsxDEV("form",{onSubmit:m=>l(this,null,function*(){m.preventDefault(),R(!0),O("");try{if(!e)throw new Error("角色ID不存在");const{data:m}=yield d.from("user_roles").select("id").eq("name",s.name).neq("id",e).single();if(m)throw new Error("角色名称已存在");const{data:t,error:n}=yield d.from("user_roles").update({name:s.name,permissions:s.permissions,updated_at:(new Date).toISOString()}).eq("id",e).select("*");if(n)throw n;if(!t||0===t.length)throw new Error("更新失败：无法获取更新后的数据，请检查权限设置");q("/role-permissions")}catch(t){console.error("保存角色失败:",t),O(t.message||"保存失败")}finally{R(!1)}}),className:"space-y-4 sm:space-y-6",children:[u.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[u.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"基本信息"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:225,columnNumber:13},this),u.jsxDEV("div",{className:"space-y-4",children:u.jsxDEV("div",{children:[u.jsxDEV("label",{className:"block text-green-300 text-sm font-mono mb-2",children:"角色名称 *"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:229,columnNumber:17},this),u.jsxDEV("div",{className:"relative",children:[u.jsxDEV(w,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400/70 w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:233,columnNumber:19},this),u.jsxDEV("input",{type:"text",value:s.name,onChange:e=>n(m=>o(a({},m),{name:e.target.value})),required:!0,className:"w-full pl-10 pr-4 py-2 sm:py-3 bg-black border border-green-400/30 rounded text-green-200 placeholder-green-700 focus:outline-none focus:border-green-400 focus:bg-gray-900/30 font-mono text-sm transition-all",placeholder:"请输入角色名称"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:234,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:232,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:228,columnNumber:15},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:227,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:224,columnNumber:11},this),m&&m.name!==g&&u.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[u.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"权限设置"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:252,columnNumber:15},this),u.jsxDEV("div",{className:"space-y-3",children:[u.jsxDEV("div",{className:"text-green-300 font-mono text-sm mb-4",children:"选择该角色可以访问的Dashboard模块："},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:255,columnNumber:17},this),u.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:N.map(e=>u.jsxDEV("label",{className:"flex flex-col items-start gap-2 p-3 border border-green-400/20 rounded transition-colors cursor-pointer hover:bg-gray-800/30",children:[u.jsxDEV("div",{className:"flex items-center gap-2",children:[u.jsxDEV("input",{type:"checkbox",checked:s.permissions.includes(e.permission),onChange:()=>{return m=e.permission,void n(e=>o(a({},e),{permissions:e.permissions.includes(m)?e.permissions.filter(e=>e!==m):[...e.permissions,m]}));var m},className:"w-4 h-4 text-green-600 bg-black border-green-400 rounded focus:ring-green-500 focus:ring-2"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:263,columnNumber:25},this),u.jsxDEV("div",{className:"text-green-300 font-mono text-sm font-medium",children:e.name},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:269,columnNumber:25},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:262,columnNumber:23},this),u.jsxDEV("div",{className:"text-green-600 font-mono text-xs ml-6",children:e.description},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:273,columnNumber:23},this)]},e.id,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:261,columnNumber:21},this))},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:259,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:254,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:251,columnNumber:13},this),m&&m.name===g&&u.jsxDEV("div",{className:"bg-gray-900/50 border border-green-400/50 rounded p-4 sm:p-6",children:[u.jsxDEV("h2",{className:"text-lg font-bold text-green-400 font-mono mb-3 sm:mb-4",children:"权限设置"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:286,columnNumber:15},this),u.jsxDEV("div",{className:"p-4 bg-yellow-900/30 border border-yellow-400/60 rounded",children:[u.jsxDEV("div",{className:"flex items-center gap-2 mb-2",children:[u.jsxDEV(w,{className:"w-5 h-5 text-yellow-400"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:289,columnNumber:19},this),u.jsxDEV("span",{className:"text-yellow-400 font-mono font-bold",children:"超级管理员"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:290,columnNumber:19},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:288,columnNumber:17},this),u.jsxDEV("p",{className:"text-yellow-300 font-mono text-sm",children:"超级管理员自动拥有系统所有权限，可以访问所有Dashboard模块，无需手动设置。"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:292,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:287,columnNumber:15},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:285,columnNumber:13},this),u.jsxDEV("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[u.jsxDEV("button",{type:"submit",disabled:D,className:"flex items-center justify-center gap-2 px-4 py-2 sm:py-3 bg-green-600 hover:bg-green-500 disabled:bg-green-800 disabled:opacity-50 text-black font-medium rounded transition-all font-mono text-sm",children:[u.jsxDEV(j,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:308,columnNumber:15},this),D?"保存中...":"保存"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:303,columnNumber:13},this),u.jsxDEV(p,{to:"/role-permissions",className:"flex items-center justify-center gap-2 px-4 py-2 sm:py-3 border border-gray-500 hover:border-gray-400 hover:bg-gray-800/30 text-gray-300 font-medium rounded transition-all font-mono text-sm",children:[u.jsxDEV(k,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:315,columnNumber:15},this),"取消"]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:311,columnNumber:13},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:302,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:222,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:199,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:198,columnNumber:5},this):u.jsxDEV("div",{className:"min-h-screen bg-black flex items-center justify-center",children:u.jsxDEV("div",{className:"text-center",children:[u.jsxDEV(E,{className:"w-16 h-16 text-red-400 mx-auto mb-4"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:184,columnNumber:11},this),u.jsxDEV("div",{className:"text-red-400 text-xl font-mono mb-4",children:"角色不存在"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:185,columnNumber:11},this),u.jsxDEV(p,{to:"/role-permissions",className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-black font-bold rounded transition-colors font-mono",children:"返回角色列表"},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:186,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:183,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/timesheet-management-system/timesheet-management-system/src/pages/RoleEdit.tsx",lineNumber:182,columnNumber:7},this)}export{D as default};
